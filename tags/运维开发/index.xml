<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>è¿ç»´å¼€å‘ on cAlmçš„ä¸ªäººBlog</title><link>https://www.calmkart.com/tags/%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/</link><description>Recent content in è¿ç»´å¼€å‘ on cAlmçš„ä¸ªäººBlog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 25 Dec 2019 00:00:00 +0000</lastBuildDate><atom:link href="https://www.calmkart.com/tags/%E8%BF%90%E7%BB%B4%E5%BC%80%E5%8F%91/index.xml" rel="self" type="application/rss+xml"/><item><title>çäº‹ç¹å¤šæ˜¯ä¸æ˜¯ä¸€å®šä¸å¥½?</title><link>https://www.calmkart.com/posts/2019/12/2019-12-25-%E7%90%90%E4%BA%8B%E7%B9%81%E5%A4%9A%E6%98%AF%E4%B8%8D%E6%98%AF%E4%B8%80%E5%AE%9A%E4%B8%8D%E5%A5%BD/</link><pubDate>Wed, 25 Dec 2019 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2019/12/2019-12-25-%E7%90%90%E4%BA%8B%E7%B9%81%E5%A4%9A%E6%98%AF%E4%B8%8D%E6%98%AF%E4%B8%80%E5%AE%9A%E4%B8%8D%E5%A5%BD/</guid><description>&lt;p&gt;æ‘˜æŠ„è‡ª ã€ŠSRE: Googleè¿ç»´è§£å¯†ã€‹&lt;/p&gt;
&lt;p&gt;å­—å­—ç ç‘ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;çäº‹ä¸ä¼šæ€»æ˜¯è®©æ¯ä¸ªäººéƒ½ä¸å¼€å¿ƒï¼Œç‰¹åˆ«æ˜¯ä¸å¤ªå¤šçš„æ—¶å€™ã€‚å·²çŸ¥çš„å’Œé‡å¤æ€§çš„å·¥ä½œæœ‰ä¸€ç§è®©äººå¹³é™çš„åŠŸæ•ˆã€‚å®Œæˆè¿™äº›äº‹å¯ä»¥å¸¦æ¥ä¸€ç§æ»¡è¶³æ„Ÿå’Œå¿«é€Ÿèƒœåˆ©æ„Ÿã€‚çäº‹å¯èƒ½æ˜¯ä½é£é™©ä½å‹åŠ›çš„æ´»åŠ¨ï¼Œæœ‰äº›å‘˜å·¥ç”šè‡³å–œæ¬¢åšè¿™ç§ç±»å‹çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;çäº‹çš„å­˜åœ¨å¹¶ä¸æ€»æ˜¯åäº‹ï¼Œä½†æ˜¯æ¯ä¸ªäººéƒ½å¿…é¡»æ¸…æ¥šï¼Œåœ¨SREæ‰€æ‰®æ¼”çš„è§’è‰²ä¸­ï¼Œä¸€å®šæ•°é‡çš„çäº‹æ˜¯ä¸å¯é¿å…çš„ï¼Œè¿™å…¶å®æ˜¯ä»»ä½•å·¥ç¨‹ç±»å·¥ä½œéƒ½å…·æœ‰çš„ç‰¹ç‚¹ã€‚å°‘é‡çš„çäº‹å­˜åœ¨ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†æ˜¯ä¸€æ—¦çäº‹çš„æ•°é‡å˜å¤šï¼Œå°±ä¼šæœ‰å®³äº†ã€‚å¦‚æœçäº‹ç‰¹åˆ«ç¹é‡ï¼Œé‚£å°±åº”è¯¥éå¸¸æ‹…æ‰°ï¼Œå¤§å£°æŠ±æ€¨ã€‚åœ¨è®¸å¤šçäº‹æœ‰å®³çš„åŸå› ä¸­ï¼Œæœ‰å¦‚ä¸‹å› ç´ éœ€è¦è€ƒè™‘ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;èŒä¸šåœæ»&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœèŠ±åœ¨å·¥ç¨‹é¡¹ç›®ä¸Šçš„æ—¶é—´å¤ªå°‘ï¼Œä½ çš„èŒä¸šå‘å±•ä¼šå˜æ…¢ï¼Œç”šè‡³åœæ»ã€‚Googleç¡®å®ä¼šå¥–åŠ±åšé‚£äº›è„æ´»ç´¯æ´»çš„äººï¼Œä½†æ˜¯ä»…ä»…æ˜¯è¯¥å·¥ä½œæ˜¯ä¸å¯é¿å…ï¼Œå¹¶æœ‰å·¨å¤§çš„æ­£é¢å½±å“çš„æ—¶å€™æ‰ä¼šè¿™æ ·åšã€‚æ²¡æœ‰äººå¯ä»¥é€šè¿‡ä¸åœåœ°åšè„æ´»ç´¯æ´»æ»¡è¶³è‡ªå·±çš„èŒä¸šå‘å±•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å£«æ°”ä½è½&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªäººå¯¹è‡ªå·±å¯ä»¥æ‰¿æ‹…çš„çäº‹é™åº¦æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯ä¸€å®šæœ‰ä¸ªé™åº¦ã€‚è¿‡å¤šçš„çäº‹ä¼šå¯¼è‡´è¿‡åº¦åŠ³ç´¯ï¼Œç–²å€¦å’Œä¸æ»¡ã€‚&lt;/p&gt;
&lt;p&gt;Â &lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œç‰ºç‰²å·¥ç¨‹å®è·µè€Œåšçäº‹ä¼šå¯¹SREç»„ç»‡çš„æ•´ä½“å‘å±•é€ æˆæŸå®³ï¼ŒåŸå› å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€ æˆè¯¯è§£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åŠªåŠ›ç¡®ä¿æ¯ä¸ªSREä»¥åŠä¸SREä¸€èµ·å·¥ä½œçš„äººéƒ½ç†è§£SREæ˜¯ä¸€ä¸ªå·¥ç¨‹ç»„ç»‡ã€‚å¦‚æœä¸ªäººæˆ–å›¢é˜Ÿè¿‡åº¦å‚ä¸çäº‹ï¼Œä¼šç ´åè¿™ç§è§’è‰²ï¼Œé€ æˆè¯¯è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿›å±•ç¼“æ…¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;çäº‹è¿‡å¤šä¼šå¯¼è‡´å›¢é˜Ÿç”Ÿäº§åŠ›ä¸‹é™ï¼Œå¦‚æœSREå›¢é˜Ÿå¿™äºä¸ºæ‰‹å·¥æ“ä½œå’Œå¯¼å‡ºæ•°æ®æ•‘ç«ï¼Œæ–°åŠŸèƒ½çš„å‘å¸ƒå°±ä¼šå˜æ…¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼€åˆ›å…ˆä¾‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœSREè¿‡äºæ„¿æ„æ‰¿æ‹…çäº‹ï¼Œç ”å‘åŒäº‹å°±æ›´å€¾å‘äºåŠ å…¥æ›´å¤šçš„çäº‹ï¼Œæœ‰æ—¶å€™ç”šè‡³å°†æœ¬è¯¥ç”±ç ”å‘å›¢é˜Ÿæ‰¿æ‹…çš„è¿ç»´å·¥ä½œè½¬ç»™SREæ¥æ‰¿æ‹…ã€‚å…¶ä»–å›¢é˜Ÿä¹Ÿä¼šå¼€å§‹æŒ‡æœ›SREæ¥å—è¿™æ ·çš„å·¥ä½œï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¥½çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¿ƒè¿›æ‘©æ“¦äº§ç”Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å³ä½¿ä½ ä¸ªäººå¯¹çäº‹æ²¡æœ‰æ€¨è¨€ï¼Œä½ ç°åœ¨çš„æˆ–æœªæ¥çš„é˜Ÿå‹å¯èƒ½ä¼šå¾ˆä¸å¼€å¿ƒã€‚å¦‚æœå›¢é˜Ÿä¸­å¼•å…¥äº†å¤ªå¤šçš„çäº‹ï¼Œå…¶å®å°±æ˜¯åœ¨é¼“åŠ±å›¢é˜Ÿé‡Œæœ€å¥½çš„å·¥ç¨‹å¸ˆå¼€å§‹å¯»æ‰¾å…¶ä»–åœ°æ–¹æä¾›çš„æ›´æœ‰ä»·å€¼çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿åæ‰¿è¯º&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é‚£äº›ä¸ºäº†é¡¹ç›®å·¥ç¨‹å·¥ä½œè€Œå…¥èŒçš„æ–°å‘˜å·¥ï¼Œä»¥åŠè½¬å…¥SREçš„è€å‘˜å·¥ä¼šæœ‰è¢«æ¬ºéª—çš„æ„Ÿè§‰ï¼Œè¿™éå¸¸ä¸åˆ©äºå…¬å¸çš„å£«æ°”ã€‚&lt;/p&gt;
&lt;p&gt;Â &lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬éƒ½è‡´åŠ›äºæ¯ä¸€å‘¨é€šè¿‡å·¥ç¨‹å·¥ä½œæ¶ˆé™¤ä¸€ç‚¹çäº‹ï¼Œå°±å¯ä»¥æŒç»­æ€§åœ°æ•´é¡¿æœåŠ¡ã€‚æˆ‘ä»¬å°±å¯ä»¥å°†æ›´å¤šçš„åŠ›é‡æŠ•å…¥åˆ°æ‰©å¤§æœåŠ¡è§„æ¨¡çš„å·¥ç¨‹å·¥ä½œä¸Šå»ï¼Œæˆ–è€…æ˜¯è¿›è¡Œä¸‹ä¸€ä»£çš„æœåŠ¡çš„æ¶æ„è®¾è®¡ï¼Œåˆæˆ–è€…æ˜¯å»ºç«‹ä¸€å¥—è·¨SREä½¿ç”¨çš„å·¥å…·é“¾ã€‚è®©æˆ‘ä»¬å¤šåˆ›æ–°ï¼Œå°‘å¹²çäº‹å§ï¼&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="å†å²è¯„è®º-1-æ¡"&gt;å†å²è¯„è®º (1 æ¡)
&lt;/h2&gt;&lt;p&gt;&lt;em&gt;ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚&lt;/em&gt;&lt;/p&gt;

 &lt;blockquote&gt;
 &lt;p&gt;&lt;strong&gt;wallsis&lt;/strong&gt; (2020-03-12 11:40)&lt;/p&gt;
&lt;p&gt;å¤§ç¥ï¼Œæ„Ÿè§‰æ‚¨å¥½ä¹…éƒ½æ²¡æ›´æ–°æ–‡ç« äº†ï¼Œå¸Œæœ›èƒ½çœ‹åˆ°æ‚¨æ›´å¤šçš„æŠ€æœ¯åˆ†äº«ï¼ŒğŸ˜†&lt;/p&gt;

 &lt;/blockquote&gt;</description></item><item><title>kubernetesæ­å»ºå¹¶ä½¿ç”¨rook/cephçš„pvå­˜å‚¨</title><link>https://www.calmkart.com/posts/2019/05/2019-05-24-kubernetes%E6%90%AD%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8rook-ceph%E7%9A%84pv%E5%AD%98%E5%82%A8/</link><pubDate>Fri, 24 May 2019 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2019/05/2019-05-24-kubernetes%E6%90%AD%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8rook-ceph%E7%9A%84pv%E5%AD%98%E5%82%A8/</guid><description>&lt;p&gt;k8sä¸­podçš„å­˜å‚¨åœ¨éå•èŠ‚ç‚¹æ˜¯ä¸æ”¯æŒhostpathçš„ï¼Œéƒ½å¾—ç”¨å„ç§åˆ†å¸ƒå¼å­˜å‚¨æ¥å®ç°.æ¯ä¸ªpvcå¯¹åº”çš„pvæ‰‹å·¥åˆ›å»ºä¹Ÿå¾ˆä¸ç°å®,è¯•äº†ä¸‹rook-cephåˆ†å¸ƒå¼å­˜å‚¨çš„ææ³•ï¼Œæ„Ÿè§‰ä¸é”™.å…¶ä¸­ä¹Ÿè¿˜æ˜¯é‡åˆ°äº†å¾ˆå¤šå‘,è¿™é‡Œç¨å¾®è®°å½•ä¸€ä¸‹.&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæœ‰ä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„k8sé›†ç¾¤ &lt;a class="link" href="http://www.calmkart.com/wp-content/uploads/2019/05/111.png" target="_blank" rel="noopener"
 &gt;&lt;img src="images/111.png" alt="" /&gt;
&lt;/a&gt; é¦–å…ˆåˆ›å»ºrook-ceph-common&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;wget https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/common.yaml
kubectl apply -f common.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶ååˆ›å»ºrook-ceph-operator&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;wget https://raw.githubusercontent.com/rook/rook/release-1.0/cluster/examples/kubernetes/ceph/operator.yaml
kubectl apply -f operator.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»¥ä¸Šä¸¤æ­¥åŸºæœ¬ä¸Šä¸ä¼šå‡ºå•¥é—®é¢˜,æ ‡å‡†é…ç½® æ¥ä¸‹æ¥åˆ›å»ºclusterçš„é—®é¢˜æ¯”è¾ƒå¤š,è´´ä¸Šæˆ‘çš„é…ç½®&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;vim cluster.yaml

apiVersion: ceph.rook.io/v1
kind: CephCluster
metadata:
 name: rook-ceph
 namespace: rook-ceph
spec:
 cephVersion:
 image: ceph/ceph:v14.2.1-20190430
 allowUnsupported: true
 #è®¾ç½®dataè·¯å¾„åˆ°è‡ªå·±è§„åˆ’çš„è·¯å¾„
 dataDirHostPath: /home/shared/rook
 mon:
 count: 3
 allowMultiplePerNode: true
 dashboard:
 enabled: true
 port: 8443
 urlPrefix: /
 #å…³é—­https
 ssl: false
 network:
 #å¦‚è¦åœ¨k8sé›†ç¾¤å¤–ä½¿ç”¨,è¿™é‡Œå¯ä»¥æ‰“å¼€
 hostNetwork: false
 rbdMirroring:
 workers: 0
 storage:
 #å…¨èŠ‚ç‚¹ä½¿ç”¨
 useAllNodes: true
 useAllDevices: false
 deviceFilter:
 config:
 osdsPerDevice: &amp;#34;1&amp;#34;
 directories:
 - path: /home/shared/rook
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl apply -f cluster.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æŸ¥çœ‹éƒ¨ç½²æƒ…å†µ &lt;a class="link" href="http://www.calmkart.com/wp-content/uploads/2019/05/2.png" target="_blank" rel="noopener"
 &gt;&lt;img src="images/2.png" alt="" /&gt;
&lt;/a&gt; è¿™æ ·å°±åŸºæœ¬ä¸Šæ²¡é—®é¢˜äº†,k8sä¸­çš„æ¯ä¸ªNodeä¼šå¯ä¸¤ä¸ªpod(rook-ceph-agentå’Œrook-discover),å¹¶ä¸”mgrå’Œosdéƒ½æ²¡é—®é¢˜ã€‚ ç„¶åç»™ceph-dashboardæä¾›NodePortçš„å¤–éƒ¨è®¿é—®service&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;vim dashboard-external-http.yaml

apiVersion: v1
kind: Service
metadata:
 name: rook-ceph-mgr-dashboard-external-https
 namespace: rook-ceph
 labels:
 app: rook-ceph-mgr
 rook_cluster: rook-ceph
spec:
 ports:
 - name: dashboard
 port: 8443
 protocol: TCP
 targetPort: 8443
 selector:
 app: rook-ceph-mgr
 rook_cluster: rook-ceph
 sessionAffinity: None
 type: NodePort
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl apply -f dashboard-external-https.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åæŸ¥çœ‹ä¸‹serviceçš„æƒ…å†µ,æ˜¯å¦æ­£å¸¸ &lt;a class="link" href="http://www.calmkart.com/wp-content/uploads/2019/05/3.png" target="_blank" rel="noopener"
 &gt;&lt;img src="images/3.png" alt="" /&gt;
&lt;/a&gt; è¿™æ ·å°±å¯¹äº†,å¯ä»¥è®¿é—®ä¸€ä¸‹http://&lt;!-- raw HTML omitted --&gt;:&lt;!-- raw HTML omitted --&gt;ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯èƒ½è¿›ceph-dashboard&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹é—®é¢˜ä¸å¤§,æŸ¥çœ‹adminçš„é»˜è®¤å¯†ç &lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath=&amp;#34;{[&amp;#39;data&amp;#39;][&amp;#39;password&amp;#39;]}&amp;#34; | base64 --decode &amp;amp;&amp;amp; echo
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½†æ˜¯adminç™»é™†è¿›å»äº†ä¹‹åï¼Œè‚¯å®šä¼šç–¯ç‹‚500é”™è¯¯ï¼ŒæŸ¥äº†ä¸‹å®˜æ–¹çš„issueï¼Œè¿™é‡Œæœ‰bugã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³åŠæ³•æ˜¯:&lt;/strong&gt; &lt;strong&gt;åœ¨dashboardé‡Œåˆ›å»ºä¸€ä¸ªæ–°roleè§’è‰²(å³ä¸Šè§’ç”¨æˆ·ç®¡ç†,roles)ï¼ŒæŠŠæƒé™å…¨é’©ä¸Šï¼Œç„¶åå»æ‰iscsiçš„æ‰€æœ‰æƒé™ã€‚&lt;/strong&gt; &lt;strong&gt;æ¥ç€åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·,ç»‘å®šè¿™ä¸ªæ–°çš„roleè§’è‰²,æœ€åç”¨æ–°ç”¨æˆ·ç™»é™†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¥ç€åˆ›å»ºpoolå’Œstorageç”¨äºè‡ªåŠ¨ç”ŸæˆpvcåŒ¹é…çš„pv&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;vim storageclass.yaml

apiVersion: ceph.rook.io/v1
kind: CephBlockPool
metadata:
 name: replicapool
 namespace: rook-ceph
spec:
 replicated:
 size: 2
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
 name: rook-ceph-block
provisioner: ceph.rook.io/block
parameters:
 blockPool: replicapool
 clusterNamespace: rook-ceph
 fstype: xfs
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;kubectl apply -f storagecalss.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åˆ›å»ºpoolå’Œstorageä¹‹åé€šè¿‡dashboardæˆ–è€…å‘½ä»¤ kubectl get cephcluster -n rook-ceph æŸ¥çœ‹ä¸€ä¸‹é›†ç¾¤æ˜¯å¦healthï¼Œå¦‚æœæ˜¯healthå°±æ²¡æ¯›ç—…äº†&lt;/p&gt;
&lt;p&gt;æœ€åæµ‹è¯•ä¸€ä¸‹ç”³è¯·ä¸€ä¸ªpvcçœ‹çœ‹æ˜¯å¦ä¼šè‡ªåŠ¨ç”Ÿæˆpvä¸ä¹‹ç»‘å®š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;apiVersion: v1
kind: PersistentVolumeClaim
metadata:
 name: jenkins-home
 namespace: kube-ops
 labels:
 app: jenkins-home
spec:
 storageClassName: rook-ceph-block
 accessModes:
 - ReadWriteOnce
 resources:
 requests:
 storage: 20Gi
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;a class="link" href="http://www.calmkart.com/wp-content/uploads/2019/05/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_dd2a2f8b-10fb-4f3f-8d21-bbaa31a4ba7d.png" target="_blank" rel="noopener"
 &gt;&lt;img src="images/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_dd2a2f8b-10fb-4f3f-8d21-bbaa31a4ba7d.png" alt="" /&gt;
&lt;/a&gt; å¯è§ï¼Œç®¡ç”¨äº†.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¤–åŠ ä¸€äº›å°tips:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœrook-cephé…ç½®æœ‰è¯¯éœ€è¦è¿˜åŸé‡æ–°é…ç½®,ä¸€å®šè¦éµå¾ªå®˜æ–¹çš„æ¸…ç†æ­¥éª¤ &lt;a class="link" href="https://rook.github.io/docs/rook/v1.0/ceph-teardown.html" target="_blank" rel="noopener"
 &gt;https://rook.github.io/docs/rook/v1.0/ceph-teardown.html&lt;/a&gt; åˆ‡è®°è¦åˆ é™¤æ‰æ‰€æœ‰k8sçš„nodeä¸Šé…ç½®çš„dataæ–‡ä»¶å¤¹,ä¸ç„¶ä¼šå¯¼è‡´æ–°é›†ç¾¤æ— æ³•åˆå§‹åŒ–.&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸å‡ºpodå¾ˆå¤šéƒ½æ˜¯æƒé™åŸå› æˆ–è€…nodeæ— æ³•è°ƒåº¦,éœ€è¦æ£€æŸ¥ä¸‹rbacæƒé™è®¾ç½®æˆ–è€…å„ä¸ªnodeçš„æƒ…å†µ.&lt;/p&gt;
&lt;p&gt;æœ€åé™„ä¸Šrooké¡¹ç›®çš„githubåœ°å€: &lt;a class="link" href="https://github.com/rook/rook" target="_blank" rel="noopener"
 &gt;https://github.com/rook/rook&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="å†å²è¯„è®º-2-æ¡"&gt;å†å²è¯„è®º (2 æ¡)
&lt;/h2&gt;&lt;p&gt;&lt;em&gt;ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚&lt;/em&gt;&lt;/p&gt;

 &lt;blockquote&gt;
 &lt;p&gt;&lt;strong&gt;huan&lt;/strong&gt; (2019-05-28 16:30)&lt;/p&gt;
&lt;p&gt;å¤§ä½¬åˆå¼€å§‹æK8Sï¼Œæˆ‘è¦è·Ÿç€å­¦ä¹ å­¦ä¹ &lt;/p&gt;

 &lt;/blockquote&gt;

 &lt;blockquote&gt;
 &lt;p&gt;â†³ &lt;strong&gt;calmkart&lt;/strong&gt; (2019-05-29 17:06)&lt;/p&gt;
&lt;p&gt;å­¦å­¦å­¦,å»ºè®®ä¹°è¯¾,æå®¢æ—¶é—´å¼ ç£Šåšå£«çš„æ·±å…¥å‰–æk8så¾ˆå¥½&lt;/p&gt;

 &lt;/blockquote&gt;</description></item><item><title>pythonæ“ä½œldap</title><link>https://www.calmkart.com/posts/2018/09/2018-09-28-python%E6%93%8D%E4%BD%9Cldap/</link><pubDate>Fri, 28 Sep 2018 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2018/09/2018-09-28-python%E6%93%8D%E4%BD%9Cldap/</guid><description>&lt;p&gt;å°è£…äº†ä¸€ä¸ªpythonçš„ldapå¸¸ç”¨æ“ä½œç±»&lt;/p&gt;
&lt;p&gt;é¦–å…ˆpipè£…åº“&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;pip install python-ldap
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ç„¶åå¼€å§‹ä»£ç éƒ¨åˆ†&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;# -*- coding:utf-8 -*-
from __future__ import absolute_import

import binascii
import hashlib
from base64 import b64encode

import ldap
import ldap.modlist as modlist

from common.common import log

class MyLdap():
 
 def __init__(self,ldap_host=None,base_dn=None,user=None,password=None):
 self.base_dn = base_dn
 self.ldap_host = ldap_host
 self.user = user
 self.password = password
 try:
 self.ldapconn = ldap.initialize(ldap_host)
 self.ldapconn.simple_bind(user,password)
 except ldap.LDAPError,e:
 log().error(str(e))
 print e

 @property
 def status(self):
 &amp;#39;&amp;#39;&amp;#39;
 éªŒè¯åˆå§‹åŒ–ldapè´¦å·å¯†ç ,ä»¥åŠldapåœ°å€æ˜¯å¦æ­£ç¡®
 &amp;#39;&amp;#39;&amp;#39;
 ldap_client = ldap.initialize(self.ldap_host)
 try:
 ldap_client.simple_bind_s(self.user, self.password)
 ldap_client.unbind_s()
 return {&amp;#34;status&amp;#34;:True}
 except Exception as e:
 log().error(str(e))
 return {&amp;#34;status&amp;#34;:False, &amp;#34;msg&amp;#34;:&amp;#34;ldapåˆå§‹åŒ–ç®¡ç†å‘˜è´¦å·å¯†ç æˆ–ldapåœ°å€æœ‰è¯¯,è¯¦æƒ…:{0}&amp;#34;.format(str(e))}

 def _ldap_search_dn(self,uid=None):
 obj = self.ldapconn
 obj.protocal_version = ldap.VERSION3
 searchScope = ldap.SCOPE_SUBTREE
 retrieveAttributes = None 
 searchFilter = &amp;#34;cn=&amp;#34; + uid
 
 try:
 ldap_result_id = obj.search(self.base_dn, searchScope, searchFilter, retrieveAttributes)
 result_type, result_data = obj.result(ldap_result_id, 0)
 if result_type == ldap.RES_SEARCH_ENTRY:
 return result_data[0][0]
 else:
 return None
 except ldap.LDAPError, e:
 log().error(str(e))

 def ldap_get_user(self,uid=None):
 &amp;#39;&amp;#39;&amp;#39;
 è·å–ldapç”¨æˆ·è¯¦æƒ…,å¤±è´¥è¿”None
 &amp;#39;&amp;#39;&amp;#39;
 obj = self.ldapconn
 obj.protocal_version = ldap.VERSION3
 searchScope = ldap.SCOPE_SUBTREE
 retrieveAttributes = None 
 searchFilter = &amp;#34;cn=&amp;#34; + uid
 try:
 ldap_result_id = obj.search(self.base_dn, searchScope, searchFilter, retrieveAttributes)
 result_type, result_data = obj.result(ldap_result_id, 0)
 if result_type == ldap.RES_SEARCH_ENTRY:
 username = result_data[0][1][&amp;#39;cn&amp;#39;][0]
 mail = result_data[0][1][&amp;#39;mail&amp;#39;][0]
 displayName = result_data[0][1][&amp;#39;displayName&amp;#39;][0]
 sn = result_data[0][1][&amp;#39;sn&amp;#39;][0]
 result = {&amp;#39;username&amp;#39;:username,&amp;#39;mail&amp;#39;:mail,&amp;#39;displayName&amp;#39;:displayName, &amp;#39;sn&amp;#39;:sn}
 return result
 else:
 return None
 except ldap.LDAPError, e:
 log().error(str(e))
 
 def ldap_get(self,uid=None,passwd=None):
 &amp;#39;&amp;#39;&amp;#39;
 éªŒè¯ldapè´¦å·å¯†ç ,æˆåŠŸè¿”True,å¤±è´¥è¿”False
 &amp;#39;&amp;#39;&amp;#39;
 target_cn = self._ldap_search_dn(uid)
 if not target_cn:
 return False 
 try:
 client = ldap.initialize(self.ldap_host)
 client.simple_bind_s(target_cn,passwd)
 client.unbind_s()
 return True
 except ldap.LDAPError,e:
 log().error(str(e))
 return False

 
 def cnupdatepass(self, cn, passwd):
 &amp;#39;&amp;#39;&amp;#39;
 æ›´æ”¹ldapå¯†ç ,æˆåŠŸè¿”True,å¤±è´¥è¿”error
 &amp;#39;&amp;#39;&amp;#39;
 dn=&amp;#39;cn={0},{1}&amp;#39;.format(cn, self.base_dn)
 try:
 result=self.ldapconn.search_s(dn, ldap.SCOPE_SUBTREE, &amp;#39;cn=%s&amp;#39; % cn)
 oldpass=result[0][1][&amp;#39;userPassword&amp;#39;]
 oldwifipass=result[0][1][&amp;#39;sambaNTPassword&amp;#39;]
 newpass=&amp;#39;{MD5}&amp;#39; + b64encode(hashlib.md5(passwd).digest())
 wifipass=binascii.hexlify(hashlib.new(&amp;#39;md4&amp;#39;, passwd.encode(&amp;#39;utf-16le&amp;#39;)).digest())
 old={&amp;#39;userPassword&amp;#39;:oldpass,&amp;#39;sambaNTPassword&amp;#39;: oldwifipass}
 new={&amp;#34;sambaNTPassword&amp;#34;: [wifipass],&amp;#34;userPassword&amp;#34;:[newpass]}
 mlist = modlist.modifyModlist(old, new)
 self.ldapconn.modify_s(dn, mlist)
 return {&amp;#34;status&amp;#34;:True}
 except ldap.LDAPError as e:
 log().error(str(e))
 return {&amp;#34;status&amp;#34;:False, &amp;#34;msg&amp;#34;:&amp;#34;ldapæ›´æ”¹å¯†ç é”™è¯¯,è¯¦æƒ…: {0}&amp;#34;.format(str(e))}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½¿ç”¨æ—¶&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ldap_client = MyLdap(ldap_url, base_dn, admin, password)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä»£ç æ³¨é‡Šå·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†æ„Ÿè§‰,ä¸å†å†™è¯¦æƒ…äº†,æœ¬æ–‡åšä¸ªå¤‡å¿˜&lt;/p&gt;</description></item><item><title>djangoç”Ÿæˆå›¾ç‰‡éªŒè¯ç </title><link>https://www.calmkart.com/posts/2018/09/2018-09-18-django%E7%94%9F%E6%88%90%E7%99%BB%E5%BD%95%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81/</link><pubDate>Tue, 18 Sep 2018 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2018/09/2018-09-18-django%E7%94%9F%E6%88%90%E7%99%BB%E5%BD%95%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81/</guid><description>&lt;p&gt;æœ€è¿‘åœ¨åšä¸€ä¸ªå¥½ç©çš„é€šç”¨djangoå•ç‚¹ç™»å½•ç³»ç»Ÿï¼Œç™»å½•ç³»ç»Ÿå°‘ä¸äº†éªŒè¯ç ï¼Œå‚è€ƒäº†ä¸€ä¸‹åˆ«äººçš„åšæ³•å’Œå¼€æºé¡¹ç›®ï¼Œæ€»ç»“ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src="images/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_837b19bb-98df-4c26-afae-6678c91ff47a.png" alt="" /&gt;
&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ€è·¯æµç¨‹æ˜¯ï¼Œåç«¯æ ¹æ®éšæœºç ç»˜å›¾ï¼Œç„¶ååšæ··æ·†(æˆ‘è¿™é‡Œå‡ ä¹æ²¡åšæ¨¡ç³Šä¹‹ç±»çš„æ··æ·†)ï¼Œæœ€åå°†éšæœºéªŒè¯ç å†™è¿›åç«¯sessioné‡Œï¼Œå‰ç«¯è·å–å›¾åƒåï¼Œæäº¤æ—¶ä¸sessioné‡Œçš„éªŒè¯ç åšæ¯”è¾ƒã€‚æµç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¤§è‡´ä»£ç å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;1.captcha_handle.py&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;captcha_handle.py
#ç”¨äºç”Ÿæˆéšæœºå­—ç¬¦ä¸²ä»¥åŠç”ŸæˆéªŒè¯ç å›¾ç‰‡

# -*- coding:utf-8 -*-
import random,string
from PIL import Image,ImageDraw,ImageFont,ImageFilter

#ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
def _getRandomChar():
 #stringæ¨¡å—åŒ…å«å„ç§å­—ç¬¦ä¸²ï¼Œä»¥ä¸‹ä¸ºå°å†™å­—æ¯åŠ æ•°å­—
 ran = string.ascii_lowercase+string.digits
 char = &amp;#39;&amp;#39;
 for i in range(4):
 char += random.choice(ran)
 return char

#è¿”å›ä¸€ä¸ªéšæœºçš„RGBé¢œè‰²
def _getRandomColor():
 return (random.randint(50,150),random.randint(50,150),random.randint(50,150))

def create_captcha():

 #åˆ›å»ºå›¾ç‰‡ï¼Œæ¨¡å¼ï¼Œå¤§å°ï¼ŒèƒŒæ™¯è‰²
 img = Image.new(&amp;#39;RGB&amp;#39;, (120,30), (255,255,255))
 #åˆ›å»ºç”»å¸ƒ
 draw = ImageDraw.Draw(img)
 #è®¾ç½®å­—ä½“
 font = ImageFont.truetype(&amp;#39;Arial.ttf&amp;#39;, 25)

 code = _getRandomChar()
 #å°†ç”Ÿæˆçš„å­—ç¬¦ç”»åœ¨ç”»å¸ƒä¸Š
 for t in range(4):
 draw.text((30*t+5,0),code[t],_getRandomColor(),font)

 #ç”Ÿæˆå¹²æ‰°ç‚¹
 for _ in range(random.randint(0,50)):
 #ä½ç½®ï¼Œé¢œè‰²
 draw.point((random.randint(0, 120), random.randint(0, 30)),fill=_getRandomColor())

 #ä½¿ç”¨æ¨¡ç³Šæ»¤é•œä½¿å›¾ç‰‡æ¨¡ç³Š
 # img = img.filter(ImageFilter.BLUR)
 #ä¿å­˜
 #img.save(&amp;#39;&amp;#39;.join(code)+&amp;#39;.jpg&amp;#39;,&amp;#39;jpeg&amp;#39;)
 return img,code

if __name__ == &amp;#39;__main__&amp;#39;:
 create_code()
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.views.py&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;views.py
#è§†å›¾ï¼Œç”ŸæˆéªŒè¯ç å›¾ç‰‡å’Œcodeï¼Œè¿”å›å›¾ç‰‡ï¼Œcodeå­˜è¿›session
class get_captcha(View):

 def get(self, request):
 &amp;#39;&amp;#39;&amp;#39;
 ç”ŸæˆéªŒè¯ç å›¾ç‰‡å’ŒéªŒè¯ç code,è¿”å›éªŒè¯ç å›¾ç‰‡,å¹¶ä»¥å½¢å¼å°†éªŒè¯ç å­˜æ”¾åœ¨sessioné‡Œ
 &amp;#39;&amp;#39;&amp;#39;
 try:
 f = BytesIO()
 img, code = create_captcha()
 request.session[&amp;#34;captcha&amp;#34;] = code
 img.save(f,&amp;#39;PNG&amp;#39;)
 return HttpResponse(f.getvalue())
 except Exception as e:
 log().error(str(e))
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3.login.html&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;{# html #}
&amp;lt;div class=&amp;#34;col-xs-4&amp;#34;&amp;gt;
 &amp;lt;img id=&amp;#34;captcha_img&amp;#34; src=&amp;#34;{% url &amp;#39;get_captcha&amp;#39; %}&amp;#34; onclick=&amp;#34;refresh_captcha()&amp;#34; style=&amp;#34;margin-top: 28px;&amp;#34;&amp;gt;
 &amp;lt;p class=&amp;#34;help-block&amp;#34; onclick=&amp;#34;refresh_captcha()&amp;#34;&amp;gt;
 çœ‹ä¸æ¸…æ¥š?æ¢ä¸€å¼ !
 &amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;

{# js #}
&amp;lt;script&amp;gt;
 //åˆ·æ–°éªŒè¯ç 
 function refresh_captcha() {
 $(&amp;#34;#captcha_img&amp;#34;).attr(&amp;#34;src&amp;#34;,$(&amp;#34;#captcha_img&amp;#34;)[0].src + &amp;#39;?&amp;#39;);
 };
&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;4.url.py&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;url(r&amp;#39;^get_captcha/$&amp;#39;,cas_views.get_captcha.as_view(), name=&amp;#34;get_captcha&amp;#34;),
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;5.views.py&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#æ ¡éªŒéªŒè¯ç æ˜¯å¦æ­£ç¡®
if request.session[&amp;#34;captcha&amp;#34;].lower() != captcha.lower():
 return JsonResponse({&amp;#34;status&amp;#34;:False, &amp;#34;msg&amp;#34;:&amp;#34;éªŒè¯ç é”™è¯¯!&amp;#34;})
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸€äº›ä»£ç æ˜¯å‚è€ƒç½‘ç»œä¸Šå…¶ä»–å¼€æºä»£ç ï¼Œä¸è¿‡å…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œç†Ÿæ‚‰request.sessionå°±å·®ä¸å¤šäº†ã€‚åšä¸ªè®°å½•ã€‚&lt;/p&gt;</description></item><item><title>djangoç±»è§†å›¾è£…é¥°å™¨</title><link>https://www.calmkart.com/posts/2018/09/2018-09-18-django%E7%B1%BB%E8%A7%86%E5%9B%BE%E8%A3%85%E9%A5%B0%E5%99%A8/</link><pubDate>Tue, 18 Sep 2018 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2018/09/2018-09-18-django%E7%B1%BB%E8%A7%86%E5%9B%BE%E8%A3%85%E9%A5%B0%E5%99%A8/</guid><description>&lt;p&gt;ä¸€ç‚¹å…³äºdjangoç±»è§†å›¾è£…é¥°å™¨çš„å°ç¬”è®°ã€‚&lt;/p&gt;
&lt;p&gt;djangoç±»è§†å›¾æ˜¯å¾ˆå¸¸ç”¨çš„ï¼Œå¯¹äºä¼ ç»Ÿçš„å‡½æ•°è§†å›¾æ¥è¯´ï¼Œè£…é¥°å™¨å¯ä»¥ç›´æ¥è£…é¥°å‡½æ•°ï¼Œä½†ç±»è§†å›¾ï¼Œè£…é¥°å™¨æ— æ³•ç›´æ¥è£…é¥°ç±»æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒäº†å‡ ç§å¸¸è§çš„è§£å†³æ–¹æ³•,ä¸ªäººè§‰å¾—æ¯”è¾ƒä¼˜é›…çš„è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;from django.shortcuts import render
from django.utils.decorators import method_decorator
from django.views.decorators.csrf import csrf_exempt
from django.views.generic import View

@method_decorator(csrf_exempt, name=&amp;#34;dispatch&amp;#34;)
class login(View):

 @method_decorator(auth_login)
 def get(self, request, username):
 #....func...
 return render(request, &amp;#39;login.html&amp;#39;, {&amp;#34;displayName&amp;#34;:username, &amp;#34;admin_flag&amp;#34;:admin_flag})
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ—¢å¦‚ä»¥ä¸Šä»£ç ï¼Œå°†è£…é¥°å™¨å‡½æ•°ä¼ ç»™method_decoratoræ–¹æ³•ï¼Œç›´æ¥ä¿®é¥°è§†å›¾ç±»æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ç›´æ¥ä¿®é¥°è§†å›¾ç±»ï¼Œå¯¹äºéœ€è¦ä¿®é¥°çš„æ–¹æ³•ï¼Œç”¨nameå‚æ•°çš„å½¢å¼ä¼ å…¥method_decoratorä¸­å³å¯ï¼Œä½†æ„Ÿè§‰ä¸å¤Ÿä¼˜é›…ã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;from django.shortcuts import render
from django.utils.decorators import method_decorator
from django.views.decorators.csrf import csrf_exempt
from django.views.generic import View

@method_decorator(csrf_exempt, name=&amp;#34;dispatch&amp;#34;)
@method_decorator(auth_login, name=&amp;#34;get&amp;#34;)
class login(View):

 def get(self, request, username):
 #....func...
 return render(request, &amp;#39;login.html&amp;#39;, {&amp;#34;displayName&amp;#34;:username, &amp;#34;admin_flag&amp;#34;:admin_flag})
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;éœ€è¦ç¨å¾®æ³¨æ„çš„æ˜¯ï¼Œcsrf_exemptè·¨ç«™æ’é™¤è£…é¥°å™¨ï¼Œåªèƒ½ä¿®é¥°åœ¨ç±»è§†å›¾çš„dispatchæ–¹æ³•ä¸Šï¼Œæ—¢åŸå§‹å†™æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;class login(View):
 
 @method_decorator(csrf_exempt)
 def dispatch(self, request, *args, **kwargs):
 return super(login,self).dispatch(request,*args,**kwargs)
 
 def get(self, request, username):
 #....func...
 return render(request, &amp;#39;login.html&amp;#39;, {&amp;#34;displayName&amp;#34;:username, &amp;#34;admin_flag&amp;#34;:admin_flag})
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä½†å…¶å®ç›´æ¥ç”¨ç±»æ–¹æ³•è£…é¥°å™¨è£…é¥°è§†å›¾ç±»ï¼Œä¼ å…¥å‚æ•°name=dispatchå°±è¡Œäº†ï¼Œä¸éœ€è¦é‡å†™dispatchæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢å¦‚ä¸Šæ–‡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="å†å²è¯„è®º-2-æ¡"&gt;å†å²è¯„è®º (2 æ¡)
&lt;/h2&gt;&lt;p&gt;&lt;em&gt;ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚&lt;/em&gt;&lt;/p&gt;

 &lt;blockquote&gt;
 &lt;p&gt;&lt;strong&gt;( æ›°..æ›° )&lt;/strong&gt; (2018-09-19 16:06)&lt;/p&gt;
&lt;p&gt;å¤§ä½¬ï¼Œå¤§ä½¬ï¼Œè¿™ç»å¯¹æ˜¯å¤§ä½¬&lt;/p&gt;

 &lt;/blockquote&gt;

 &lt;blockquote&gt;
 &lt;p&gt;â†³ &lt;strong&gt;calmkart&lt;/strong&gt; (2018-09-20 19:02)&lt;/p&gt;
&lt;p&gt;æ€»è£è°¢ä½ è¯´å¤§ä½¬å°±å¤§ä½¬å¥½å§&lt;/p&gt;

 &lt;/blockquote&gt;</description></item><item><title>ä¸ºdjango-adminçš„userpermissionæ·»åŠ read only(can view)æƒé™</title><link>https://www.calmkart.com/posts/2018/09/2018-09-06-%E4%B8%BAdjango-admin%E7%9A%84userpermission%E6%B7%BB%E5%8A%A0read-onlycan-view%E6%9D%83%E9%99%90/</link><pubDate>Thu, 06 Sep 2018 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2018/09/2018-09-06-%E4%B8%BAdjango-admin%E7%9A%84userpermission%E6%B7%BB%E5%8A%A0read-onlycan-view%E6%9D%83%E9%99%90/</guid><description>&lt;p&gt;é»˜è®¤çš„django-adminä¸­ç”¨æˆ·çš„modelsæƒé™åªæœ‰ä¸‰ä¸ª,åˆ†åˆ«æ˜¯(Can change, Can add, Can delete),æ˜¾ç„¶çš„,å¯¹äºç»å¤§éƒ¨åˆ†crudå·¥ç¨‹å¸ˆ(^_^)è€Œè¨€,ä¸€çœ¼çœ‹è¿‡å»å°±å°‘äº†äº›ä»€ä¹ˆ,æ²¡é”™,å°‘äº†å¾ˆå…³é”®çš„Can viewæƒé™.&lt;/p&gt;
&lt;p&gt;å½“ç„¶django-adminçš„ç”¨æˆ·æƒé™æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„,éœ€è¦æ”¹permissionçš„meta,è¿™é‡Œä¸ç»†è¿°,å‘ç°ä¸€ä¸ªç®€å•å¥½ç”¨çš„django app,å¯ä»¥ç›´æ¥æ·»åŠ Can viewæƒé™,ç¾æ»‹æ»‹.&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ &lt;a class="link" href="http://www.calmkart.com/wp-content/uploads/2018/09/B6CE8AA0-F925-4290-B2C0-E3C98ECF0C79.png" target="_blank" rel="noopener"
 &gt;&lt;img src="images/B6CE8AA0-F925-4290-B2C0-E3C98ECF0C79.png" alt="" /&gt;
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ’ä»¶æ˜¯: django-admin-view-permission åœ°å€ &lt;a class="link" href="https://github.com/ctxis/django-admin-view-permission" target="_blank" rel="noopener"
 &gt;https://github.com/ctxis/django-admin-view-permission&lt;/a&gt; ä½¿ç”¨æ–¹å¼åŠå…¶ç®€å•&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#pipå®‰è£…æ’ä»¶
pip install django-admin-view-permission

#å°†appæ³¨å†Œ,è®°å¾—ä¸€å®šæ³¨å†Œåœ¨django.contrib.adminä¹‹å‰
INSTALLED_APPS = [
 &amp;#39;admin_view_permission&amp;#39;,
 &amp;#39;django.contrib.admin&amp;#39;,
 ...
]

#æ›´æ–°æ•°æ®åº“
python manage.py migrate

å³å¯

#å¦‚éœ€è¦åªå¯¹ä¸€äº›æ•°æ®åº“ç®¡ç”¨,å¯ä»¥
ADMIN_VIEW_PERMISSION_MODELS = [
 &amp;#39;auth.User&amp;#39;,
 ...
]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;çš„ç¡®æ˜¯ä¸ªå¥½ä¸œè¥¿å•Š,å…æ‰äº†æ‰‹å†™è¿™ç§æœ¬åº”å°±æœ‰çš„æƒé™.åˆ†äº«ä¸€ä¸‹.&lt;/p&gt;</description></item><item><title>ä¸€ä¸ªè‡ªè§£ænginx upstreamå’Œlocationå¹¶æ£€æµ‹è¿é€šæ€§çš„webç³»ç»Ÿ</title><link>https://www.calmkart.com/posts/2018/07/2018-07-23-%E4%B8%80%E4%B8%AA%E8%87%AA%E8%A7%A3%E6%9E%90nginx-upstream%E5%92%8Clocation%E5%B9%B6%E6%A3%80%E6%B5%8B%E8%BF%9E%E9%80%9A%E6%80%A7%E7%9A%84web%E7%B3%BB%E7%BB%9F/</link><pubDate>Mon, 23 Jul 2018 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2018/07/2018-07-23-%E4%B8%80%E4%B8%AA%E8%87%AA%E8%A7%A3%E6%9E%90nginx-upstream%E5%92%8Clocation%E5%B9%B6%E6%A3%80%E6%B5%8B%E8%BF%9E%E9%80%9A%E6%80%A7%E7%9A%84web%E7%B3%BB%E7%BB%9F/</guid><description>&lt;p&gt;æœ€è¿‘åšçš„ä¸€ä¸ªå°webç³»ç»Ÿï¼Œä¸»è¦çš„æ€è·¯æ˜¯ï¼Œæ€æ ·æ‰èƒ½å°†nginxé›†ç¾¤çš„æµ·é‡é…ç½®æ–‡ä»¶,åŒ…æ‹¬serverå’ŒupstreamåŠlocationç­‰å®Œå…¨å¯¹è±¡åŒ– æƒ³åšçš„ä¸œè¥¿å°±ç±»ä¼¼äºhttpdnsï¼Œå°†nginxçš„æµ·é‡é…ç½®æ–‡ä»¶å¯¹è±¡åŒ–ï¼Œæˆ–è€…è€ƒè™‘èƒ½ä¸èƒ½æ•°æ®åº“åŒ– ç°åœ¨çš„åŠŸèƒ½åªæ˜¯è§£ææ‰€æœ‰nginxé…ç½®æ–‡ä»¶,è‡ªåŠ¨è¯»å–upstreamåˆ—è¡¨å’Œlocationä¸­proxy_pass,ç„¶ååšè¿æ¥æ€§è¿½è¸ª å½“ç„¶,è¿½è¸ªåˆ—è¡¨ä¹Ÿå¯è‡ªå®šä¹‰æ·»åŠ ,åœ¨adminåå°é…ç½®å³å¯ æœ€ç»ˆæ•ˆæœå›¾ &lt;img src="images/custom.png" alt="custom" /&gt;
 &lt;img src="images/back.png" alt="back" /&gt;
&lt;/p&gt;
&lt;p&gt;gitåœ°å€ &lt;a class="link" href="https://github.com/calmkart/check_port" target="_blank" rel="noopener"
 &gt;https://github.com/calmkart/check_port&lt;/a&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#å¤§è‡´éƒ¨ç½²è¿‡ç¨‹
pip install -r pip.text
#åˆ›å»ºcheckportæ•°æ®åº“
#ä¿®æ”¹settings.pyä¸­çš„æ•°æ®åº“é…ç½®
python manage.py makemigrations
python manage.py migrate
#å®‰è£…redis,ä¿®æ”¹settings.pyä¸­çš„redisé…ç½®
#ä¿®æ”¹readnginxçš„handle.pyå’Œhandle_test.pyä¸­çš„CONFIG_PATHä»¥åŠGIT_PATH(ç”¨äºè‡ªåŠ¨è§£æå’Œæ›´æ–°nginxé…ç½®)
#ç”¨supervisorå¯åŠ¨ç³»ç»Ÿ
supervisord -c checkport/supervisord.conf
#æ­¤å¤–,floweréœ€è¦ç”¨nginxåšè½¬å‘,å‚è€ƒé…ç½®æ–‡ä»¶å¦‚ä¸‹
location ~ ^/flower/? {
rewrite ^/flower/?(.*)$ /$1 break;

sub_filter &amp;#39;=&amp;#34;/&amp;#39; &amp;#39;=&amp;#34;/flower/&amp;#39;;
sub_filter_last_modified on;
sub_filter_once off;

# proxy_pass http://unix:/tmp/flower.sock:/;
proxy_pass http://xxxxxxxxxxxxxxxx;
proxy_redirect off;
proxy_set_header Host $host;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection &amp;#34;upgrade&amp;#34;;
proxy_http_version 1.1;
}

å…¶ä¸­ä¸‰ç§å¸¸è§æ“ä½œä¸º:
1.å°†nginxé…ç½®æ–‡ä»¶åˆ—è¡¨pullåˆ°æœ€æ–°
2.è‡ªåŠ¨è¯»å–å’Œè§£ænginxé…ç½®æ–‡ä»¶,å¹¶å°†è·å–çš„upstreamä»¥åŠproxy_passåˆ—è¡¨å†™è¿›æ•°æ®åº“
3.æ¢æµ‹æ•°æ®åº“ä¸­æ‰€æœ‰éœ€è¦æ¢æµ‹çš„IP:PORTå¯¹è±¡å®ä¾‹

å¯åœ¨åå°ç®¡ç†-&amp;gt;æ•°æ®æ›´æ–°ä¸­æ‰‹åŠ¨æŒ‰é”®æ›´æ–°
ä¹Ÿå¯åœ¨adminåå°é…ç½®Periodic tasksçš„celery beatå®šæ—¶ä»»åŠ¡
å…¶ä¸­:
1.readnginx.tasks.git_pull_config ä»»åŠ¡æ›´æ–°nginxé…ç½®æ–‡ä»¶ä»“åº“
2.pubstatus.tasks.get_status ä»»åŠ¡è·å–æ‰€æœ‰IP:PORTå¯¹è±¡çŠ¶æ€
3.readnginx.tasks.read_nginx ä»»åŠ¡åº¦è¯»å–nginxé…ç½®æ–‡ä»¶å¹¶è§£æ,æ›´æ–°æ•°æ®åº“IP:PORTå¯¹è±¡åˆ—è¡¨
å¯æ ¹æ®éœ€æ±‚è®¾ç½®å®šæ—¶ä»»åŠ¡å‘¨æœŸ
é€šè¿‡floweråå°å¯ä»¥æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæƒ…å†µ

è‡ªå®šä¹‰è¿½è¸ªcheckportçš„IP:PORTåˆ—è¡¨é€šè¿‡adminåå°æ·»åŠ instanceå³å¯å®ç°
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>djangoä½¿ç”¨middlewareå®ç°viewsçš„è®¿é—®é™åˆ¶</title><link>https://www.calmkart.com/posts/2017/12/2017-12-27-django%E4%BD%BF%E7%94%A8middleware%E5%AE%9E%E7%8E%B0views%E7%9A%84%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6/</link><pubDate>Wed, 27 Dec 2017 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2017/12/2017-12-27-django%E4%BD%BF%E7%94%A8middleware%E5%AE%9E%E7%8E%B0views%E7%9A%84%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6/</guid><description>&lt;p&gt;éœ€è¦å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œå¯¹äºä»¥ä¸ªdjango appï¼Œéœ€è¦å¯¹å…¶ä¸­çš„ä¸€äº›restful apiåšIPè®¿é—®é™åˆ¶ï¼Œè¿™æ ·å®ç°èµ·æ¥æœ€æ–¹ä¾¿çš„æ˜¯åœ¨middlewareä¸­å†™é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºdjangoä¸­é—´ä»¶çš„è¯´æ˜ï¼š &lt;a class="link" href="http://usyiyi.cn/translate/Django_111/topics/http/middleware.html" target="_blank" rel="noopener"
 &gt;http://usyiyi.cn/translate/Django_111/topics/http/middleware.html&lt;/a&gt; &lt;a class="link" href="http://python.usyiyi.cn/translate/django_182/topics/http/middleware.html" target="_blank" rel="noopener"
 &gt;http://python.usyiyi.cn/translate/django_182/topics/http/middleware.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åœ¨django appå¾—middleware.pyä¸­æ·»åŠ å¦‚ä¸‹ä»£ç &lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;from django.http import HttpResponse

class checkIPMiddleware(object):
 def process_request(self, request):
 root_func = request.path.split(&amp;#34;/&amp;#34;)[1]
 api_flag = True if root_func==&amp;#34;api&amp;#34; else False
 if api_flag:
 ip = request.META.get(&amp;#34;HTTP_X_REAL_IP&amp;#34;, request.META.get(&amp;#34;REMOTE_ADDR&amp;#34;))
 if (ip==&amp;#34;10.10.10.10&amp;#34; or ip==&amp;#34;11.11.11.11&amp;#34;):
 return None
 else:
 return HttpReponse(&amp;#34;you are not allowed&amp;#34;)
 return None
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…³äºrequestå¯¹è±¡å†…å®¹ï¼Œè¯¦æƒ…å¦‚ä¸‹(æœ¬ä»£ç é™åˆ¶çš„æ˜¯æ‰€æœ‰/api/åçš„è®¿é—®)ï¼š &lt;a class="link" href="http://python.usyiyi.cn/translate/django_182/ref/request-response.html" target="_blank" rel="noopener"
 &gt;http://python.usyiyi.cn/translate/django_182/ref/request-response.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…³äºè·å–ç”¨æˆ·IPï¼Œåœ¨æ²¡æœ‰åå‘ä»£ç†çš„æƒ…å†µä¸‹å¯ä»¥è·å–httpå¤´ä¸­çš„REMOTE_ADDRå­—æ®µï¼Œç”¨request.METAå¯¹è±¡æ¥è·å– å½“æœ‰Nginxç­‰åå‘ä»£ç†çš„æ—¶å€™ï¼Œå°±ä¼šè·å–åˆ°æœ¬æœºIPï¼Œæ‰€ä»¥éœ€è¦åœ¨nginxåå‘ä»£ç†æ—¶ï¼Œå°†ç”¨æˆ·åŸIPè®°å½•ä¸‹æ¥å†™å…¥HTTPå¤´ä¸­ æ—¢é…ç½®nginxé…ç½®å¦‚ä¸‹(/site-enable/default):&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;location .... { 
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 proxy_set_header Host $http_host;
 proxy_set_header X-NginX-Proxy true;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æœ€ååœ¨settings.pyä¸­å°†è¿™ä¸ªclassæ·»åŠ è¿›å»&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;MIDDLEWARE_CLASSES = [
 &amp;#39;appname.middleware.checkIPMiddleware&amp;#39;
]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é‡å¯djangoä¹‹åï¼Œåˆ™/apiåçš„restful apiåªå…è®¸10.10.10.10å’Œ11.11.11.11è®¿é—®ï¼Œå…¶ä»–æ—¶å€™å°±ä¼šè¿”å›&amp;quot;you are not allowed&amp;quot;&lt;/p&gt;</description></item><item><title>ä½¿ç”¨zabbix apiæå–è¶‹åŠ¿(trend)å’Œå†å²(history)æ•°æ®</title><link>https://www.calmkart.com/posts/2017/12/2017-12-27-%E4%BD%BF%E7%94%A8zabbix-api%E6%8F%90%E5%8F%96%E8%B6%8B%E5%8A%BFtrend%E5%92%8C%E5%8E%86%E5%8F%B2history%E6%95%B0%E6%8D%AE/</link><pubDate>Wed, 27 Dec 2017 00:00:00 +0000</pubDate><guid>https://www.calmkart.com/posts/2017/12/2017-12-27-%E4%BD%BF%E7%94%A8zabbix-api%E6%8F%90%E5%8F%96%E8%B6%8B%E5%8A%BFtrend%E5%92%8C%E5%8E%86%E5%8F%B2history%E6%95%B0%E6%8D%AE/</guid><description>&lt;p&gt;zabbix restful apiè¯´æ˜è§å®˜ç½‘æ–‡æ¡£ &lt;a class="link" href="https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/apiinfo" target="_blank" rel="noopener"
 &gt;https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/apiinfo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨äº†githubä¸Šå°è£…å¥½çš„python zabbix api,å…å»äº†è‡ªå·±é€ è½®å­çš„è¿‡ç¨‹ &lt;a class="link" href="https://github.com/lukecyca/pyzabbix" target="_blank" rel="noopener"
 &gt;https://github.com/lukecyca/pyzabbix&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå°è£…çš„python zabbix apiå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ç”¨ç¼ºçœçš„ç±»__getattr__()æ–¹æ³•ï¼Œè°ƒç”¨zabbixçš„restful api&lt;/p&gt;
&lt;p&gt;é¦–å…ˆç”¨pipå®‰è£…pyzabbix&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;pip install pyzabbix
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…·ä½“å®ç°è·å–trendå’Œhistoryä»£ç å¦‚ä¸‹:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#---coding:utf-8---

from pyzabbix import ZabbixAPI
import time
class get_net(object):
	url = &amp;#34;&amp;#34;
	username = None
	password = None

	def __init__(self, server, user, passwd):
		self.url = &amp;#34;http://&amp;#34;+server+&amp;#34;/zabbix&amp;#34;
		self.username = user
		self.password = passwd

	def get_trend(self, info_list):
		z = ZabbixAPI(self.url)
		z.login(self.username,self.password)
		for info in info_list:
			hosts = z.host.get(filter={&amp;#34;host&amp;#34;:info[&amp;#34;ip&amp;#34;]})
			if hosts:
				host_id = hosts[0][&amp;#34;hostid&amp;#34;]
			print host_id
			items = z.item.get(hostids=host_id,filter={&amp;#34;key_&amp;#34;:&amp;#34;ifHCOutOctets[&amp;#34;+info[&amp;#34;interface&amp;#34;]+&amp;#34;]&amp;#34;})[0]
			if items:
				item_id = items[&amp;#34;itemid&amp;#34;]
			trend = z.trend.get(itemids=item_id)
			for td in trend:
				clock = self.get_clock(td[&amp;#39;clock&amp;#39;])
				if (&amp;#34;20:00&amp;#34; in clock) or (&amp;#34;21:00&amp;#34; in clock) or (&amp;#34;22:00&amp;#34; in clock):
					print clock+&amp;#34; &amp;#34;+str(int(td[&amp;#34;value_avg&amp;#34;])*8/1048576)
					f = open(info[&amp;#34;name&amp;#34;],&amp;#34;a&amp;#34;)
					f.write(clock+&amp;#34; &amp;#34;+str(int(td[&amp;#34;value_avg&amp;#34;])*8/1048576))
					f.write(&amp;#34;\n&amp;#34;)
			f.close()

	def get_history(self, info_list):
		z = ZabbixAPI(self.url)
		z.login(self.username,self.password)
		for info in info_list:
			hosts = z.host.get(filter={&amp;#34;host&amp;#34;:info[&amp;#34;ip&amp;#34;]})
			if hosts:
				host_id = hosts[0][&amp;#34;hostid&amp;#34;]
			print host_id
			items = z.item.get(hostids=host_id,filter={&amp;#34;key_&amp;#34;:&amp;#34;ifHCOutOctets[&amp;#34;+info[&amp;#34;interface&amp;#34;]+&amp;#34;]&amp;#34;})[0]
			if items:
				item_id = items[&amp;#34;itemid&amp;#34;]
			history = z.history.get(itemids=item_id,time_from=1512129600)
			r_t = []
			print history
			for hs in history:
				clock = self.get_clock(hs[&amp;#39;clock&amp;#39;])
				if (&amp;#34;20:&amp;#34; in clock) or (&amp;#34;21:&amp;#34; in clock) or (&amp;#34;22:&amp;#34; in clock):
					print clock+&amp;#34; &amp;#34;+str(int(hs[&amp;#34;value&amp;#34;])/1048576)
					r_t.append(clock+&amp;#34; &amp;#34;+str(int(hs[&amp;#34;value&amp;#34;])/1048576))
			r_t_str = &amp;#34;\n&amp;#34;.join(r_t)
			f = open(&amp;#34;test_history&amp;#34;,&amp;#34;a&amp;#34;)
			f.write(r_t_str)
			f.close()
	
	def get_clock(self, value):
		clock = time.localtime(int(value))
		format = &amp;#39;%Y-%m-%d %H:%M&amp;#39;
		return time.strftime(format,clock)

#test = get_net(&amp;#34;zabbixæœåŠ¡å™¨IP&amp;#34;, &amp;#34;user&amp;#34;, &amp;#34;pass&amp;#34;)
#test.get_trend([{&amp;#34;ip&amp;#34;:&amp;#34;æœºå™¨IP&amp;#34;,&amp;#34;name&amp;#34;:&amp;#34;æŸæœºå™¨&amp;#34;,&amp;#34;interface&amp;#34;:&amp;#34;æŸæ¥å£å&amp;#34;}])
#test.get_trend(infoåˆ—è¡¨ï¼Œæ ¼å¼å¦‚ä¸Š)
#test.get_history([{&amp;#34;ip&amp;#34;:&amp;#34;æœºå™¨IP&amp;#34;,&amp;#34;name&amp;#34;:&amp;#34;æŸæœºå™¨&amp;#34;,&amp;#34;interface&amp;#34;:&amp;#34;æŸæ¥å£å&amp;#34;}])
#test.get_history(infoåˆ—è¡¨ï¼Œæ ¼å¼å¦‚ä¸Š)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ³¨ï¼š å…¶ä¸­get_clock()å‡½æ•°ç”¨äºåšlinuxæ—¶é—´æˆ³è½¬æ¢ã€‚&lt;/p&gt;</description></item></channel></rss>