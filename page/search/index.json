[{"content":"æœ€è¿‘å­¦ä¹ äº†å¾ˆå¤šæœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ å’ŒLLMç›¸å…³çš„çŸ¥è¯†ï¼Œæœ‰ä¸€äº›ä¸æˆç†Ÿçš„æƒ³æ³•å†’å‡ºæ¥ï¼Œæƒ³è®°å½•ä¸‹æ¥ã€‚å› ä¸ºä¹‹å‰å¥½åƒæœªæ›¾å¬è¿‡æœ‰äººåšè¿‡ç±»ä¼¼çš„ç±»æ¯”å’Œæ€è€ƒè®¨è®ºï¼Œä½†åˆè§‰å¾—è‡ªå·±çš„æƒ³æ³•ä¹Ÿè®¸å¾ˆè’è°¬ï¼Œä¼šä¸ä¼šè¢«å–·å‘¢ï¼Ÿ\nä¸è¿‡å›å¤´æƒ³æƒ³ï¼Œå°ç‰›é©¬å†™çš„å’ŒæŠ€æœ¯ä¸ä¸€å®šæœ‰å…³çš„ç®€å•æ–‡å­—ï¼Œåº”è¯¥æœ¬æ¥ä¹Ÿä¸ä¼šè¢«å¤šå°‘äººçœ‹åˆ°ï¼Œåº”è¯¥è¿˜å¥½ã€‚å¦‚æœå„ç§å·§åˆä½¿æ‚¨ä¸å°å¿ƒçœ‹åˆ°è¯¥æ–‡ï¼Œå³ä½¿æˆ‘çš„æƒ³æ³•å¾ˆè’è°¬ï¼Œä¹Ÿè¯·çœ‹è¿‡ä¹‹åä¸€ç¬‘è€Œè¿‡å§ã€‚\næé—® åº·å¾·ç•Œå®šäº†äººç±»è®¤çŸ¥ä¸–ç•Œä»¥åŠå› æœå¾‹ï¼ˆå¹¿ä¹‰ç§‘å­¦ï¼‰ä¹‹æ‰€ä»¥å¯èƒ½çš„å…ˆéªŒè¾¹ç•Œï¼Œé‚£ä¹ˆAIçš„è®¤çŸ¥æ˜¯å¦å­˜åœ¨ç±»ä¼¼çš„å…ˆéªŒè¾¹ç•Œï¼Ÿå¦‚æœæœ‰ï¼Œè¿™äº›è¾¹ç•Œåˆåœ¨å“ªé‡Œï¼Ÿæ˜¯ä»€ä¹ˆä½¿å¾—AIçš„è®¤çŸ¥æˆä¸ºå¯èƒ½ï¼Ÿ\næ·±åº¦å­¦ä¹ æ¨¡å‹çš„åŸºæœ¬ç»“æ„ ç°ä»£æ·±åº¦å­¦ä¹ æ¨¡å‹é€šå¸¸é‡‡ç”¨å¤šå±‚æ„ŸçŸ¥æœºæ„æ¶ï¼šæ¯å±‚ç”±è‹¥å¹²ç¥ç»å…ƒç»„æˆï¼Œæ¯ä¸ªç¥ç»å…ƒæ‰§è¡Œ f(Wx + b) çš„è¿ç®—ï¼Œå…¶ä¸­ f æ˜¯éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ ReLUã€GELUï¼‰ï¼Œç”¨äºå¢å¼ºæ¨¡å‹è¡¨è¾¾èƒ½åŠ›ã€‚è™½ç„¶è¢«ç§°ä¸ºâ€œç¥ç»ç½‘ç»œâ€ï¼Œä½†å…¶ç»“æ„ä»…æ˜¯å¯¹ç”Ÿç‰©ç³»ç»Ÿçš„ç²—ç•¥ç±»æ¯”ï¼Œè¿œéçœŸå®è„‘æœºåˆ¶çš„å¤ç°ã€‚\nAttention æœºåˆ¶è¿›ä¸€æ­¥æ‰©å±•äº†è¿™ä¸€æ¡†æ¶ï¼Œé€šè¿‡å¯å­¦ä¹ çš„ Queryã€Keyã€Value æŠ•å½±çŸ©é˜µï¼ŒåŠ¨æ€å»ºç«‹è¾“å…¥åºåˆ—å†…éƒ¨çš„ä¾èµ–å…³ç³»ï¼Œä½¿æ¨¡å‹èƒ½æ ¹æ®ä¸Šä¸‹æ–‡è°ƒæ•´è¯çš„è¡¨ç¤ºï¼Œæœ‰æ•ˆè§£å†³ä¸€è¯å¤šä¹‰ç­‰é—®é¢˜ã€‚\nç„¶è€Œï¼Œæ— è®ºæœ€ç»ˆçš„æœºå™¨å­¦ä¹ /æ·±åº¦å­¦ä¹ /å¤§æ¨¡å‹æ¶æ„å¦‚ä½•å¤æ‚ï¼Œéƒ½å¯ä»¥æ¦‚æ‹¬ç†è§£æˆä¸€ä¸ª F(x) çš„å‡½æ•°å˜æ¢ï¼š\nè¾“å…¥ï¼šäººç»™çš„ç‰¹å¾ xï¼› å˜æ¢ï¼šç»è¿‡å‡½æ•° F(x) çš„å˜æ¢ï¼› è¾“å‡ºï¼šç»“æœ y_hatã€‚ æ ¹æ®è¾“å‡º y_hat å’Œäººç±»è®¤ä¸ºçš„æ­£ç¡®ç­”æ¡ˆ y åšæ¯”å¯¹ï¼Œé€šè¿‡æ¢¯åº¦ä¸‹é™çš„åå¾®åˆ†æ–¹ç¨‹è®¡ç®—ï¼Œè°ƒæ•´ F(x) å‡½æ•°å‚æ•°ï¼Œæœ€ç»ˆä½¿å¾— y_hat å°½é‡æ¥è¿‘ y ã€‚\né¢„è®¾ æˆ‘ä»¬åœ¨è¿™é‡Œåšä¸€ä¸ªé¢„è®¾ï¼šå‡è®¾è¿™ç§è¾“å…¥ x ï¼Œç»è¿‡ç³»ç»Ÿ F(x)ï¼Œè¾“å‡ºç»“æœ y çš„ç»“æ„ï¼Œå’Œäººè„‘å¤„ç†è¾“å…¥çš„è¿‡ç¨‹æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯ç›®å‰çš„ç®—æ³•è¿œæ¯”äººè„‘ç®€å•ã€‚å´æ©è¾¾ä¹Ÿæ›¾æåˆ°ï¼Œæ˜¯å¦æœªæ¥æˆ‘ä»¬èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤æ‚çš„ç®—æ³•ï¼Œåˆ°é‚£æ—¶æ˜¯å¦å°±å¯ä»¥è¾¾åˆ°ç”šè‡³è¶…è¶Šäººç±»æ™ºèƒ½ï¼Ÿæˆ‘è®¤ä¸ºä¸å¯èƒ½ã€‚\nåº·å¾·å“²å­¦çš„è§†è§’ ä»å“²å­¦ä¸Šæ¥è¯´ï¼Œåº·å¾·æ›¾ç»ä¸ºç§‘å­¦ï¼ˆå³å› æœå¾‹/å……è¶³æ ¹æ®å¾‹ï¼‰ä¹‹æ‰€ä»¥å¯ä»¥æˆç«‹ï¼Œå¯»æ‰¾è¿‡è¾¹ç•Œã€‚åº·å¾·å°†ä¸–ç•Œåˆ†ä¸ºç‰©è‡ªä½“ï¼ˆå®ä½“ï¼‰å’Œè¡¨è±¡ï¼ˆä½“éªŒï¼‰ï¼š\nç‰©è‡ªä½“å¯ä»¥è®¤è¯†ä¸€åˆ‡ï¼Œå´ä¸èƒ½è¢«ä¸€åˆ‡æ‰€è®¤è¯†ï¼› è¡¨è±¡æ˜¯ç‰©è‡ªä½“åœ¨äººç±»æ„ŸçŸ¥ä¸­çš„æŠ•å½±ï¼Œæ˜¯æˆ‘ä»¬èƒ½å¤Ÿæ„ŸçŸ¥åˆ°çš„éƒ¨åˆ†ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼š äººè®¤è¯†â€œèŠ±â€ï¼Œå¹¶ä¸æ˜¯è®¤è¯†â€œèŠ±â€æœ¬èº«ï¼Œè€Œæ˜¯è®¤è¯†â€œèŠ±â€çš„é¢œè‰²ã€å½¢çŠ¶ã€é¦™æ°”ï¼ˆè¡¨è±¡ï¼‰ã€‚ä¾‹å¦‚ï¼Œç‹—çš„è§†è§‰å› ä¸ºå…‰é”¥ç»†èƒæ¯”äººå°‘ï¼Œå°±åªèƒ½è®¤è¯†å°‘æ•°å‡ ç§é¢œè‰²ã€‚ä½†å³ä½¿æ˜¯ä¸¤ä¸ªäººå£ä¸­è¯´çš„â€œçº¢â€ï¼Œå¿ƒé‡Œæƒ³çš„â€œçº¢â€ï¼Œä¹Ÿä¸ä¸€å®šå°±æ˜¯ä¸€æ ·çš„è‰²å½©ã€‚äººè„‘å¯¹äº‹ç‰©çš„æ„ŸçŸ¥æœ¬èº«åªæ˜¯ä¸€ç§â€œèŠ±â€ä½œä¸ºç‰©è‡ªä½“åœ¨â€œäººè„‘â€ä¸­çš„æŠ•å½±ï¼ˆè¡¨è±¡ï¼‰ã€‚\nå› æœå¾‹çš„æœ¬è´¨ï¼š å› æœå¾‹ï¼ˆç§‘å­¦ï¼Œæ¯”å¦‚æ˜¥å¤©èŠ±ä¼šå¼€ï¼‰ä¹‹æ‰€ä»¥å­˜åœ¨ï¼Œä¸æ˜¯å› ä¸ºâ€œèŠ±â€ä½œä¸ºç‰©è‡ªä½“æœ¬èº«æ˜¯è¿™æ ·ï¼Œè€Œæ˜¯äººè„‘éœ€è¦é€šè¿‡å› æœå¾‹ï¼ˆç§‘å­¦ï¼‰æ¥ç†è§£ç‰©è‡ªä½“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå› æœå¾‹ï¼ˆç§‘å­¦ï¼‰æ˜¯å±äºäººè„‘çš„ä½“ç³»ï¼Œæ˜¯ç”¨æ¥æ„ŸçŸ¥ç‰©è‡ªä½“æ—¶æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æ‰€ä»¥å­˜åœ¨ï¼Œå¹¶ä¸æ˜¯å®ƒæœ¬èº«å°±è·Ÿéšç‰©è‡ªä½“å­˜åœ¨ã€‚\nç‰©è‡ªä½“ä¸å¯ä»¥è¢«è®¤è¯†ï¼Œä½†å¯ä»¥é€šè¿‡æˆ‘ä»¬çš„æ„ŸçŸ¥æˆä¸ºç¬¦åˆå› æœå¾‹çš„è¡¨è±¡ã€‚å½“äººè„‘ä¸å†æ„ŸçŸ¥æ—¶ï¼Œå› æœå¾‹ï¼ˆç§‘å­¦ï¼‰ä¹Ÿä¸å¤å­˜åœ¨ã€‚å› æ­¤ï¼Œå› æœå¾‹ï¼ˆå¹¿ä¹‰ç§‘å­¦ï¼‰çš„è¾¹ç•Œå°±åœ¨äººè®¤è¯†ç‰©è‡ªä½“çš„è¡¨è±¡ä¸­ï¼Œè€Œä¸€æ—¦æ¨åˆ°ç‰©è‡ªä½“æœ¬èº«ï¼Œåˆ™ä»»ä½•å› æœå¾‹ï¼ˆç§‘å­¦ï¼‰éƒ½å°†å¤±æ•ˆï¼Œä¹Ÿæ°¸è¿œä¸å¯èƒ½è¢«äººæ‰€è®¤çŸ¥ã€‚è¿™å°±æ˜¯ç§‘å­¦ï¼ˆå› æœè§„å¾‹ï¼‰çš„è¾¹ç•Œã€‚\nç±»æ¯” ä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€ä¸ªç±»æ¯”ï¼š\näººå¯¹äº‹ç‰©çš„æ„ŸçŸ¥ï¼š æœ¬ä½“é€šè¿‡è¡¨è±¡æ„ŸçŸ¥ç‰©è‡ªä½“ï¼› ç‰©è‡ªä½“è¢«ç¿»è¯‘æˆè‹¥å¹²ç¬¦åˆäººè„‘ç³»ç»Ÿæ‰€èƒ½ç†è§£çš„å› æœå¾‹ç‰¹å¾çš„è¡¨è±¡ï¼› äººè„‘ä¸å¯èƒ½çœŸæ­£è®¤è¯†ç‰©è‡ªä½“ï¼Œä¹Ÿä¸å¯èƒ½è¶…è¶Šç‰©è‡ªä½“ã€‚ æœºå™¨å­¦ä¹ /æ·±åº¦å­¦ä¹ /LLMå¯¹äº‹ç‰©çš„æ„ŸçŸ¥ï¼š æœºå™¨é€šè¿‡äººå¯¹ç‰©è‡ªä½“æ„ŸçŸ¥çš„è¡¨è±¡è¿›è¡Œå­¦ä¹ ï¼› å¯¹äºæœºå™¨æ¥è¯´ï¼Œäººç±»å¯¹ç‰©ä½“æ„ŸçŸ¥çš„è¡¨è±¡æ˜¯æœºå™¨éœ€è¦è¯†åˆ«çš„â€œç‰©è‡ªä½“â€ï¼› æœºå™¨ä¸å¯èƒ½çœŸæ­£è®¤è¯†äººå¯¹ç‰©è‡ªä½“æ„ŸçŸ¥çš„è¡¨è±¡ï¼Œä¹Ÿä¸å¯èƒ½è¶…è¶Šäººå¯¹ç‰©è‡ªä½“æ„ŸçŸ¥çš„è¡¨è±¡ã€‚ æ¢å¥è¯è¯´ï¼š\näººæ°¸è¿œä¸å¯èƒ½çŸ¥é“ä»€ä¹ˆæ˜¯ç‰©è‡ªä½“çš„â€œèŠ±â€ï¼Œåªèƒ½é€šè¿‡â€œçº¢â€ï¼ˆé¢œè‰²ï¼‰ã€â€œé¦™â€ï¼ˆå‘³é“ï¼‰ã€â€œæ˜¥å¤©èŠ±ä¼šå¼€â€ï¼ˆæ„å»ºå› æœå¾‹é€»è¾‘ï¼‰æ¥æ„å»ºè¡¨è±¡ï¼Œé—´æ¥ç†è§£â€œèŠ±â€ã€‚ è€Œæœºå™¨ç›¸è¾ƒäºäººæ›´å¼±ä¸€å±‚ï¼šå®ƒæ ¹æœ¬ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ç‰©è‡ªä½“çš„â€œèŠ±â€ï¼Œç”šè‡³ä¹Ÿæ— æ³•é€šè¿‡è¡¨è±¡å»è®¤è¯†ç‰©è‡ªä½“çš„â€œèŠ±â€ã€‚æœºå™¨åªèƒ½é€šè¿‡è‡ªå·±çš„â€œè„‘â€ï¼ˆå¹¶éäººè„‘çš„å› æœå¾‹è„‘ï¼‰ï¼Œé€šè¿‡äººç±»è®¤è¯†ç‰©è‡ªä½“â€œèŠ±â€çš„è¡¨è±¡â€œçº¢â€/â€œé¦™â€/â€œæ˜¥å¤©èŠ±ä¼šå¼€â€ï¼Œä¹Ÿæ°¸è¿œä¸å¯èƒ½çŸ¥é“ä»€ä¹ˆæ˜¯â€œçº¢â€ï¼ˆé¢œè‰²ï¼‰ã€â€œé¦™â€ï¼ˆå‘³é“ï¼‰ã€â€œæ˜¥å¤©èŠ±ä¼šå¼€â€ï¼ˆäººçš„å› æœå¾‹é€»è¾‘ï¼‰ã€‚æœºå™¨åªèƒ½é€šè¿‡è‡ªå·±çš„ Attention QKV çŸ©é˜µã€ç¥ç»ç½‘ç»œéçº¿æ€§å˜æ¢å±‚ï¼Œæ¥é—´æ¥ç†è§£â€œçº¢â€ï¼ˆé¢œè‰²ï¼‰ã€â€œé¦™â€ï¼ˆå‘³é“ï¼‰ã€‚ å±€é™æ€§ ä¸€æ–¹é¢ï¼Œæœºå™¨çš„è¾“å…¥æ¥è‡ªäººç±»å¯¹äº‹ç‰©æ„ŸçŸ¥çš„è¡¨è±¡ï¼Œè€Œè¿™äº›è¡¨è±¡ä¸€å®šç¬¦åˆå±äºäººè„‘ç‹¬æœ‰çš„å› æœå¾‹ï¼ˆå³å¹¿ä¹‰ç§‘å­¦ï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡æ¢¯åº¦ä¸‹é™è®­ç»ƒçš„æ ‡å‡†è¾“å‡º y ä¼šè®© y_hat ä¹Ÿå°½é‡æ¥è¿‘äººè„‘ç‹¬æœ‰çš„å› æœå¾‹ï¼ˆç§‘å­¦ç»“æœï¼‰ã€‚å› æ­¤ï¼Œæœºå™¨æ°¸è¿œæ— æ³•è¶…è¶Šäººç±»è®¤è¯†ç‰©è‡ªä½“çš„è¡¨è±¡ï¼ˆäººè„‘çš„è®¤è¯†ï¼‰ã€‚\nå¦‚æœäººç±»å¸Œæœ›é€šè¿‡æœºå™¨æ¥å­¦ä¹ ï¼Œä»è€Œæ›´å¥½åœ°è®¤è¯†ç‰©è‡ªä½“ï¼Œä»è¿™ä¸ªè§’åº¦æ¥çœ‹æ˜¯ä¸å¯èƒ½çš„ã€‚æœºå™¨çš„è®¤è¯†è¾¹ç•Œä¸å¯èƒ½è¶…è¿‡äººè„‘å¯¹ç‰©è‡ªä½“è®¤è¯†çš„è¡¨è±¡ï¼Œä¸å¯èƒ½ä¸ç¬¦åˆäººè„‘è®¤è¯†äº‹ç‰©çš„å› æœè§„å¾‹ï¼Œä¹Ÿå°±æ˜¯ä¸å¯èƒ½è¯ç”Ÿäººè„‘å¯ä»¥è¯ç”Ÿä¹‹å¤–çš„åˆ›é€ æ€§çš„ä¸œè¥¿ã€‚\næ€»çš„æ¥è¯´ æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ æ¨¡å‹çš„è¿ä½œæ–¹å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹äººç±»æ„ŸçŸ¥ä¸–ç•Œçš„æ¨¡ä»¿ï¼Œä½†å®ƒå§‹ç»ˆå—é™äºäººç±»æä¾›çš„è¾“å…¥å’Œå› æœå¾‹æ¡†æ¶ã€‚æ­£å¦‚åº·å¾·æ‰€è¨€ï¼Œæˆ‘ä»¬æ‰€è®¤è¯†çš„ï¼Œä»æ¥ä¸æ˜¯äº‹ç‰©æœ¬èº«ï¼Œè€Œæ˜¯æˆ‘ä»¬çœ‹å¾…äº‹ç‰©çš„æ–¹å¼ï¼Œäººç±»é€šè¿‡å› æœå¾‹æ„ŸçŸ¥ç‰©è‡ªä½“ï¼Œè€Œæœºå™¨åˆ™é€šè¿‡äººç±»çš„è¡¨è±¡æ„ŸçŸ¥å› æœå¾‹ã€‚\nç§‘å­¦ä¹‹æ‰€ä»¥æˆç«‹ï¼Œä¸æ˜¯å› ä¸ºå®ƒæ­ç¤ºäº†ç‰©è‡ªä½“çš„çœŸç›¸ï¼Œ\nè€Œæ˜¯å› ä¸ºå®ƒæ˜¯äººç±»è®¤çŸ¥ç»“æ„çš„ä¸€éƒ¨åˆ†â€”â€”\næˆ‘ä»¬ç”¨å› æœå¾‹å»â€œæ„é€ â€ä¸–ç•Œï¼Œè€Œéâ€œå‘ç°â€ä¸–ç•Œã€‚\nåœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œæœºå™¨çš„å­¦ä¹ èƒ½åŠ›å’Œåˆ›é€ åŠ›æ°¸è¿œæ— æ³•è¶…è¶Šäººç±»çš„è®¤çŸ¥è¾¹ç•Œã€‚\nç»§ç»­æé—® äººçš„è‡ªç”±æ„å¿—æ˜¯å¦å­˜åœ¨ï¼Ÿä½•ä»¥å­˜åœ¨ï¼ŸAIçš„è‡ªç”±æ„å¿—åˆä½•ç”±å¯ä»¥å­˜åœ¨å‘¢ï¼Ÿ\næ›´å¤šçš„é—®é¢˜ï¼Œæœ‰ç©ºå†™ä¸ªä¸‹ç¯‡ç»§ç»­ç®€å•èŠèŠ\n","date":"2025-11-03T00:00:00Z","permalink":"/posts/2025/11/2025-11-03-%E4%B8%80%E4%BA%9B%E6%83%B3%E6%B3%95%E6%9D%A5%E8%87%AA%E5%BA%B7%E5%BE%B7/","title":"ä¸€äº›æƒ³æ³•ï¼Œæ¥è‡ªåº·å¾·"},{"content":"kubeconåŸæ–‡é“¾æ¥\nå†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nclmert (2024-05-17 13:47) å¤§ç¥ï¼Œä»€ä¹ˆæ—¶å€™æ›´æ–°ä¸‹ä¸€ç¯‡æ–‡ç« å•Šï¼Ÿç­‰äº†2å¹´äº† zzlua (2025-08-13 15:32) å¤§ä½¬ï¼Œæ±‚æ›´æ–°æ–‡ç« å•Š ","date":"2022-03-05T00:00:00Z","permalink":"/posts/2022/03/2022-03-05-%E5%9C%A8%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E6%88%91%E4%BB%AC%E5%A6%82%E4%BD%95%E5%85%88%E4%BA%8E%E7%94%A8%E6%88%B7%E5%8F%91%E7%8E%B0%E5%92%8C%E5%AE%9A%E4%BD%8D-kubernetes-%E9%9B%86/","title":"åœ¨é˜¿é‡Œå·´å·´ï¼Œæˆ‘ä»¬å¦‚ä½•å…ˆäºç”¨æˆ·å‘ç°å’Œå®šä½ Kubernetes é›†ç¾¤é—®é¢˜ï¼Ÿ"},{"content":"æ˜¯ä»€ä¹ˆ å®˜æ–¹çš„ä»‹ç»ä¸­æ˜¯è¿™æ ·è¯´çš„\nAn operator for synthetic monitoring on Kubernetes\nä¸€ä¸ªç”¨äºåˆæˆç›‘æ§çš„operator\nä¹Ÿå°±æ˜¯ä¸€ä¸ªç”¨äºåœ¨k8sé›†ç¾¤ä¸­è¿è¡Œå„ç§å¥åº·æ£€æŸ¥å¹¶ä¸ŠæŠ¥é›†ç¾¤å·¡æ£€çŠ¶æ€çš„operator\næµç¨‹é€»è¾‘ å¤§è‡´è¿è¡Œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º\nkuberhealthyå°†åˆ›å»ºä¸¤ä¸ªcrdï¼Œåˆ†åˆ«ä¸º\nkhchecks khstates å…¶ä¸­ khchecks crç”¨æ¥æè¿°æˆ‘ä»¬éœ€è¦åœ¨é›†ç¾¤ä¸­åˆ›å»ºå¹¶æŒç»­è¿è¡Œçš„å·¡æ£€è¯¦æƒ…\nè€Œkhstate crç”¨æ¥è®°å½•æ¯ä¸€ä¸ªå·¡æ£€çš„å½“å‰å·¡æ£€ç»“æœ\nkuberhealthy operatorè¿è¡Œåœ¨é›†ç¾¤ä¸­ï¼Œä¼šå®æ—¶ç›‘å¬khchecks custom resourceçš„å˜åŒ–ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªkhcheck cræ—¶ï¼Œkuberhealthyä¼šæ ¹æ®crä¸­çš„å„ç§æè¿°å­—æ®µåˆ›å»ºå¯¹åº”çš„å·¡æ£€checked podï¼Œ checked podæ‰§è¡Œå·¡æ£€é€»è¾‘ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™kuberhealthy deployment podã€‚\nkuberhealthyæ”¯æŒå¤šç§å·¡æ£€ç»“æœè¾“å‡ºï¼Œå¦‚khstate crå¯¹è±¡å°±æ˜¯ç”¨æ¥ä¿å­˜æŸkhcheckå·¡æ£€å½“å‰ç»“æœçš„ã€‚åŒæ—¶ä¹Ÿæ”¯æŒjson/prometheusç­‰å¤šç§ç»“æœè¾“å‡ºã€‚\nç®€å•ä½¿ç”¨ éƒ¨ç½² kuberhealthy\ngit clone https://github.com/Comcast/kuberhealthy.git cd kuberhealthy kubectl apply -f deploy/kuberhealthy.yaml æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªreplicasä¸º2çš„kuberhealthy deploymentã€‚(å®é™…å·¥ä½œçš„åªæœ‰ä¸€ä¸ªpodï¼Œå¦ä¸€ä¸ªä¸ºä¿è¯é«˜å¯ç”¨ï¼Œkuberhealthyä¼šè¿›è¡Œé€‰ä¸»æ“ä½œï¼Œä½†è¿‡ç¨‹å®é™…ä¸Šæœ‰bug)\nåŒæ—¶kuberhealthyè¿˜å°†ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€å †khcheckå·¡æ£€å…¨å®¶æ¡¶(å…¶å®å¾ˆå¤šéƒ½æ˜¯æˆ‘ä»¬ä¸éœ€è¦çš„)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡\nkubectl get khchecks -n kuberhealthy è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸éœ€è¦çš„å¯ä»¥åˆ é™¤\néƒ¨ç½²ä¸€ä¸ªç®€å•çš„å·¡æ£€khcheck http-checkä¸ºå®˜æ–¹æä¾›çš„è‹¥å¹²å·¡æ£€ç”¨ä¾‹ä¹‹ä¸€ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å‘ä¸€ä¸ªæŒ‡å®šçš„urlå‘é€getè¯·æ±‚ï¼ŒæˆåŠŸåˆ™å·¡æ£€æˆåŠŸï¼Œå¤±è´¥åˆ™å·¡æ£€å¤±è´¥.\næ ·ä¾‹yamlå¦‚ä¸‹\n--- apiVersion: comcast.github.io/v1 kind: KuberhealthyCheck # crç±»å‹ä¸ºkuberhealthyCheck metadata: name: http namespace: kuberhealthy spec: runInterval: 2m # å·¡æ£€å‘¨æœŸ timeout: 6m # å·¡æ£€è¶…æ—¶æ—¶é—´ podSpec: containers: - name: http image: kuberhealthy/http-check:v1.1.1 # è¿™é‡Œä¸ºå®ç°å·¡æ£€é€»è¾‘çš„é•œåƒ imagePullPolicy: IfNotPresent env: - name: CHECK_URL # æˆ‘ä»¬é€šè¿‡envæ³¨å…¥ï¼Œæ§åˆ¶http-checkæ‰€å‘é€getè¯·æ±‚çš„urlåœ°å€ï¼Œå®ç°åŒä¸€ä¸ªå·¡æ£€é•œåƒä½†åˆçµæ´»çš„å·¡æ£€ value: \u0026#34;http://google.com\u0026#34; resources: requests: cpu: 15m memory: 15Mi limits: cpu: 25m restartPolicy: Always terminationGracePeriodSeconds: 5 æˆ‘ä»¬applyä¹‹åï¼Œä¼šåˆ›å»ºä¸€ä¸ªkhcheckå¯¹è±¡ï¼ŒåŒæ—¶kuberhealthy deployment podä¼šæ ¹æ®khcheck crä¸­çš„æè¿°ï¼Œåˆ›å»ºå‡ºå·¡æ£€podã€‚\næŸ¥çœ‹å·¡æ£€podçŠ¶æ€ï¼ŒæŸ¥è¯¢å·¡æ£€ç»“æœ æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨kuberhealthy namespaceä¸­æŸ¥çœ‹å·¡æ£€podçŠ¶æ€\nkubectl get pod -n kuberhealthy æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹khstateè‡ªå®šä¹‰èµ„æºå¯¹è±¡æŸ¥è¯¢å½“å‰å·¡æ£€ç»“æœ\nkubectl get khstate -n kuberhealthy kubectl get khstate -n kuberhealthy \u0026lt;example\u0026gt; -o yaml æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡kuberhealthy service/podæä¾›çš„httpæ¥å£æŸ¥è¯¢å·¡æ£€ç»“æœ è®¿é—®kuberhealthy service 80ç«¯å£æˆ– kuberhealthy master pod 8080ç«¯å£\n{ \u0026#34;OK\u0026#34;: true, \u0026#34;Errors\u0026#34;: [], \u0026#34;CheckDetails\u0026#34;: { \u0026#34;kuberhealthy/daemonset\u0026#34;: { \u0026#34;OK\u0026#34;: true, \u0026#34;Errors\u0026#34;: [], \u0026#34;RunDuration\u0026#34;: \u0026#34;22.512278967s\u0026#34;, \u0026#34;Namespace\u0026#34;: \u0026#34;kuberhealthy\u0026#34;, \u0026#34;LastRun\u0026#34;: \u0026#34;2019-11-14T23:24:16.7718171Z\u0026#34;, \u0026#34;AuthoritativePod\u0026#34;: \u0026#34;kuberhealthy-67bf8c4686-mbl2j\u0026#34;, \u0026#34;uuid\u0026#34;: \u0026#34;9abd3ec0-b82f-44f0-b8a7-fa6709f759cd\u0026#34; }, \u0026#34;kuberhealthy/deployment\u0026#34;: { \u0026#34;OK\u0026#34;: true, \u0026#34;Errors\u0026#34;: [], \u0026#34;RunDuration\u0026#34;: \u0026#34;29.142295647s\u0026#34;, \u0026#34;Namespace\u0026#34;: \u0026#34;kuberhealthy\u0026#34;, \u0026#34;LastRun\u0026#34;: \u0026#34;2019-11-14T23:26:40.7444659Z\u0026#34;, \u0026#34;AuthoritativePod\u0026#34;: \u0026#34;kuberhealthy-67bf8c4686-mbl2j\u0026#34;, \u0026#34;uuid\u0026#34;: \u0026#34;5f0d2765-60c9-47e8-b2c9-8bc6e61727b2\u0026#34; }, \u0026#34;kuberhealthy/dns-status-internal\u0026#34;: { \u0026#34;OK\u0026#34;: true, \u0026#34;Errors\u0026#34;: [], \u0026#34;RunDuration\u0026#34;: \u0026#34;2.43940936s\u0026#34;, \u0026#34;Namespace\u0026#34;: \u0026#34;kuberhealthy\u0026#34;, \u0026#34;LastRun\u0026#34;: \u0026#34;2019-11-14T23:34:04.8927434Z\u0026#34;, \u0026#34;AuthoritativePod\u0026#34;: \u0026#34;kuberhealthy-67bf8c4686-mbl2j\u0026#34;, \u0026#34;uuid\u0026#34;: \u0026#34;c85f95cb-87e2-4ff5-b513-e02b3d25973a\u0026#34; }, \u0026#34;kuberhealthy/pod-restarts\u0026#34;: { \u0026#34;OK\u0026#34;: true, \u0026#34;Errors\u0026#34;: [], \u0026#34;RunDuration\u0026#34;: \u0026#34;2.979083775s\u0026#34;, \u0026#34;Namespace\u0026#34;: \u0026#34;kuberhealthy\u0026#34;, \u0026#34;LastRun\u0026#34;: \u0026#34;2019-11-14T23:34:06.1938491Z\u0026#34;, \u0026#34;AuthoritativePod\u0026#34;: \u0026#34;kuberhealthy-67bf8c4686-mbl2j\u0026#34;, \u0026#34;uuid\u0026#34;: \u0026#34;a718b969-421c-47a8-a379-106d234ad9d8\u0026#34; } }, \u0026#34;CurrentMaster\u0026#34;: \u0026#34;kuberhealthy-7cf79bdc86-m78qr\u0026#34; } ç¼–å†™è‡ªå®šä¹‰å·¡æ£€ æˆ‘ä»¬ä»¥http-checkä¸ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å·¡æ£€\né¦–å…ˆæˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹http-checkçš„main.goæ ¸å¿ƒä»£ç \npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; kh \u0026#34;github.com/Comcast/kuberhealthy/v2/pkg/checks/external/checkclient\u0026#34; log \u0026#34;github.com/sirupsen/logrus\u0026#34; ) var ( // HTTP endpoint to send a request to. checkURL = os.Getenv(\u0026#34;CHECK_URL\u0026#34;) ) func init() { // Check that the URL environment variable is valid. if len(checkURL) == 0 { log.Fatalln(\u0026#34;Empty URL. Please update your CHECK_URL environment variable.\u0026#34;) } // If the URL does not begin with HTTP, exit. if !strings.HasPrefix(checkURL, \u0026#34;http\u0026#34;) { log.Fatalln(\u0026#34;Given URL does not declare a supported protocol. (http | https)\u0026#34;) } } func main() { log.Infoln(\u0026#34;Beginning check.\u0026#34;) // Make a GET request. r, err := http.Get(checkURL) if err != nil { reportErr := fmt.Errorf(\u0026#34;error occurred performing a \u0026#34; + http.MethodGet + \u0026#34; to \u0026#34; + checkURL + \u0026#34;: \u0026#34; + err.Error()) log.Errorln(reportErr.Error()) reportFailureErr := kh.ReportFailure([]string{reportErr.Error()}) if reportFailureErr != nil { log.Fatalln(\u0026#34;error when reporting to kuberhealthy:\u0026#34;, reportFailureErr.Error()) } os.Exit(0) } // Check if the response status code is a 200. if r.StatusCode == http.StatusOK { log.Infoln(\u0026#34;Got a\u0026#34;, r.StatusCode, \u0026#34;with a\u0026#34;, http.MethodGet, \u0026#34;to\u0026#34;, checkURL) reportSuccessErr := kh.ReportSuccess() if err != nil { log.Fatalln(\u0026#34;error when reporting to kuberhealthy:\u0026#34;, reportSuccessErr.Error()) } os.Exit(0) } reportErr := fmt.Errorf(\u0026#34;unable to retrieve a \u0026#34; + strconv.Itoa(http.StatusOK) + \u0026#34; from \u0026#34; + checkURL + \u0026#34; got a \u0026#34; + strconv.Itoa(r.StatusCode) + \u0026#34; instead\u0026#34;) log.Errorln(reportErr.Error()) reportFailureErr := kh.ReportFailure([]string{reportErr.Error()}) if reportFailureErr != nil { log.Fatalln(\u0026#34;error when reporting to kuberhealthy:\u0026#34;, reportFailureErr.Error()) } os.Exit(0) } å…¶å®å…¶ä¸­é™¤äº†å·¡æ£€é€»è¾‘ï¼Œå’Œkuberhealthyç›¸å…³çš„æ–¹æ³•åªæœ‰ä¸¤ä¸ª\n// å¯¼å…¥kuberhealthyè‡ªå®šä¹‰å·¡æ£€clientåº“ import kh \u0026#34;github.com/Comcast/kuberhealthy/v2/pkg/checks/external/checkclient\u0026#34; // å¦‚æœå·¡æ£€æˆåŠŸï¼Œè°ƒç”¨ReportSuccessæ–¹æ³•ä¸ŠæŠ¥æˆåŠŸ kh.ReportSuccess() // å¦‚æœå·¡æ£€å¤±è´¥ï¼Œè°ƒç”¨ReportFailureæ–¹æ³•ä¸ŠæŠ¥å¤±è´¥ kh.ReportFailure([]string{}) ç„¶åå°†å…¶buildæˆä¸€ä¸ªé•œåƒ\nDockerfile\nFROM golang:1.13 AS builder WORKDIR /build COPY go.mod go.sum /build/ RUN go mod download COPY . /build WORKDIR /build/cmd/http-check ENV CGO_ENABLED=0 RUN go build -v RUN groupadd -g 999 user \u0026amp;\u0026amp; \\ useradd -r -u 999 -g user user FROM scratch COPY --from=builder /etc/passwd /etc/passwd USER user COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ COPY --from=builder /build/cmd/http-check/http-check /app/http-check ENTRYPOINT [\u0026#34;/app/http-check\u0026#34;] Makefile\nbuild: docker build -t kuberhealthy/http-check:v1.2.2 -f Dockerfile ../../ push: docker push kuberhealthy/http-check:v1.2.2 è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªè‡ªå®šä¹‰å·¡æ£€ç”¨ä¾‹çš„å…¨éƒ¨ç¼–å†™å’Œæ‰“åŒ…\nä½¿ç”¨égoè¯­è¨€æ€ä¹ˆåŠï¼Ÿ å¦‚æœä½¿ç”¨çš„æ˜¯égolangç¼–å†™å·¡æ£€ç”¨ä¾‹ï¼Œæ— æ³•è°ƒç”¨å®˜æ–¹å¤–éƒ¨å·¡æ£€clientåº“ï¼Œä¹Ÿæ˜¯å¾ˆç®€å•çš„ã€‚\nè¯»å–KH_REPORTING_URLç¯å¢ƒå˜é‡\nå°†å¦‚ä¸‹JSONå·¡æ£€ç»“æœé€šè¿‡POSTæ–¹æ³•å‘é€åˆ°KH_REPORTING_URLåœ°å€ä¸Š\n{ \u0026#34;Errors\u0026#34;: [ \u0026#34;Error 1 here\u0026#34;, \u0026#34;Error 2 here\u0026#34; ], \u0026#34;OK\u0026#34;: false } kuberhealthyä»£ç è¯¦è§£ é¦–å…ˆæ¦‚è§ˆä¸€ä¸‹kuberhealthyçš„ä»£ç ç»„ç»‡ç»“æ„ ä¸é‡è¦çš„ç›®å½•å’Œæ–‡ä»¶å·²çœç•¥\n./ â”œâ”€â”€ clients # è¿™é‡Œå­˜æ”¾å…¶ä»–è¯­è¨€ç¼–å†™è‡ªå®šä¹‰å·¡æ£€çš„clientåº“(ç›®å‰åªæœ‰js) â”œâ”€â”€ cmd # å­˜æ”¾è‹¥å¹²å·¡æ£€ç”¨ä¾‹ä»£ç ï¼Œå…¶ä¸­kuberhealthyå­ç›®å½•ä¸ºæ ¸å¿ƒä»£ç ä¸»ç›®å½• â”‚Â â”œâ”€â”€ kuberhealthy # kuberhealthyä»£ç ä¸»ç›®å½• â”‚Â â”‚Â â”œâ”€â”€ Dockerfile â”‚Â â”‚Â â”œâ”€â”€ Makefile â”‚Â â”‚Â â”œâ”€â”€ crd.go â”‚Â â”‚Â â”œâ”€â”€ fakecheck_test.go â”‚Â â”‚Â â”œâ”€â”€ influx.go â”‚Â â”‚Â â”œâ”€â”€ kuberhealthy.go â”‚Â â”‚Â â”œâ”€â”€ kuberhealthyCheck.go â”‚Â â”‚Â â”œâ”€â”€ main.go â”‚Â â”‚Â â”œâ”€â”€ main_test.go â”‚Â â”‚Â â”œâ”€â”€ reflector.go â”‚Â â”‚Â â”œâ”€â”€ test â”‚Â â”‚Â â”‚Â â””â”€â”€ basicCheckerPod.yaml â”‚Â â”‚Â â”œâ”€â”€ util.go â”‚Â â”‚Â â”œâ”€â”€ util_test.go â”‚Â â”‚Â â””â”€â”€ webserver_test.go â”œâ”€â”€ deploy # å­˜æ”¾ä¸€äº›éƒ¨ç½²Yaml â”œâ”€â”€ docs # å­˜æ”¾æ–‡æ¡£ â””â”€â”€ pkg # å­˜æ”¾ä¸€äº›éœ€è¦ä½¿ç”¨åˆ°çš„åŒ… â”œâ”€â”€ aws â”œâ”€â”€ checks #è¿™é‡Œæ¯”è¾ƒæ ¸å¿ƒï¼Œå­˜æ”¾äº†å¤§é‡å·¡æ£€ç”Ÿå‘½å‘¨æœŸé€»è¾‘ â”‚Â â””â”€â”€ external â”‚Â â”œâ”€â”€ checkclient â”‚Â â”‚Â â””â”€â”€ main.go â”‚Â â”œâ”€â”€ checker_test.go â”‚Â â”œâ”€â”€ main.go â”‚Â â”œâ”€â”€ main_test.go â”‚Â â”œâ”€â”€ status â”‚Â â”‚Â â””â”€â”€ main.go â”‚Â â”œâ”€â”€ test â”‚Â â”‚Â â””â”€â”€ basicCheckerPod.yaml â”‚Â â”œâ”€â”€ util â”‚Â â”‚Â â””â”€â”€ main.go â”‚Â â””â”€â”€ whitelist_test.go â”œâ”€â”€ health â”œâ”€â”€ khcheckcrd # khcheck crå¯¹è±¡ç›¸å…³å®šä¹‰ä»£ç  â”œâ”€â”€ khstatecrd # khstate crå¯¹è±¡ç›¸å…³å®šä¹‰ä»£ç  â”œâ”€â”€ kubeClient â”œâ”€â”€ masterCalculation â””â”€â”€ metrics å…¶å®æœ€æ ¸å¿ƒçš„åªæœ‰ä¸¤ä¸ªç›®å½•\ncmd/kuberhealthy å®ç°äº†kuberhealthy deployment master podä¸­çš„æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬å¦‚ä½•ç›‘å¬khcheckå¯¹è±¡çš„å˜åŒ–ï¼Œå¦‚ä½•å‘¨æœŸæ€§çš„è¿è¡Œå·¡æ£€ç”¨ä¾‹ï¼Œå¦‚ä½•åˆ¤æ–­è¶…æ—¶ï¼Œå¦‚ä½•å†™å…¥å·¡æ£€çŠ¶æ€ è¿˜åŒ…æ‹¬äº†influx/prometheusä¸Šæ¸¸çš„æ”¯æŒï¼Œä»¥åŠhttpæœåŠ¡å™¨(ç”¨äºæ¥æ”¶å·¡æ£€ç»“æœå’Œæä¾›å·¡æ£€ç»“æœæŸ¥è¯¢) pkg/checks å®ç°äº†æŸä¸€ä¸ªå·¡æ£€ä»»åŠ¡çš„å…¨éƒ¨é€»è¾‘ï¼Œé€šè¿‡ä¸€ä¸ªinterfaceæš´éœ²ï¼ŒåŒ…æ‹¬ è¿è¡Œæ£€æŸ¥/ç»“æŸæ£€æŸ¥/è·å–å½“å‰å·¡æ£€ç»“æœ ç­‰è‹¥å¹²æ–¹æ³• åŒ…æ‹¬äº†ç¼–å†™è‡ªå®šä¹‰å·¡æ£€æ‰€ä½¿ç”¨çš„clientåº“ï¼Œä½äºpkg/checks/external/checkclientä¸­ æ ¸å¿ƒé€»è¾‘ æ ¸å¿ƒé€»è¾‘ä»cmd/kuberhealthy/main.goå¼€å§‹\nfunc main() { // Create a new Kuberhealthy struct kuberhealthy = NewKuberhealthy() kuberhealthy.ListenAddr = listenAddress // create run context and start listening for shutdown interrupts khRunCtx, khRunCtxCancelFunc := context.WithCancel(context.Background()) kuberhealthy.shutdownCtxFunc = khRunCtxCancelFunc // load the KH struct with a func to shutdown its control system go listenForInterrupts() // tell Kuberhealthy to start all checks and master change monitoring kuberhealthy.Start(khRunCtx) time.Sleep(time.Second * 90) // give the interrupt handler a period of time to call exit before we shutdown \u0026lt;-time.After(terminationGracePeriod + (time.Second * 10)) log.Errorln(\u0026#34;shutdown: main loop was ready for shutdown for too long. exiting.\u0026#34;) os.Exit(1) } è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªKuberhealthyå¯¹è±¡ï¼Œå¹¶è°ƒç”¨Startæ–¹æ³•ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹Startæ–¹æ³•åšäº†å“ªäº›äº‹æƒ…\n// Start inits Kuberhealthy checks and master monitoring func (k *Kuberhealthy) Start(ctx context.Context) { // start the khState reflector go k.stateReflector.Start() // if influxdb is enabled, configure it if enableInflux { k.configureInfluxForwarding() } // Start the web server and restart it if it crashes go kuberhealthy.StartWebServer() // find all the external checks from the khcheckcrd resources on the cluster and keep them in sync. // use rate limiting to avoid reconfiguration spam maxUpdateInterval := time.Second * 10 externalChecksUpdateChan := make(chan struct{}, 50) externalChecksUpdateChanLimited := make(chan struct{}, 50) go notifyChanLimiter(maxUpdateInterval, externalChecksUpdateChan, externalChecksUpdateChanLimited) go k.monitorExternalChecks(ctx, externalChecksUpdateChan) // we use two channels to indicate when we gain or lose master status. use rate limiting to avoid // reconfiguration spam becameMasterChan := make(chan struct{}, 10) lostMasterChan := make(chan struct{}, 10) go k.masterMonitor(ctx, becameMasterChan, lostMasterChan) // loop and select channels to do appropriate thing when master changes for { select { case \u0026lt;-ctx.Done(): // we are shutting down log.Infoln(\u0026#34;control: shutting down from context abort...\u0026#34;) return case \u0026lt;-becameMasterChan: // we have become the current master instance and should run checks // reset checks and re-add from configuration settings log.Infoln(\u0026#34;control: Became master. Reconfiguring and starting checks.\u0026#34;) k.StartChecks() case \u0026lt;-lostMasterChan: // we are no longer master log.Infoln(\u0026#34;control: Lost master. Stopping checks.\u0026#34;) k.StopChecks() case \u0026lt;-externalChecksUpdateChanLimited: // external check change detected log.Infoln(\u0026#34;control: Witnessed a khcheck resource change...\u0026#34;) // if we are master, stop, reconfigure our khchecks, and start again with the new configuration if isMaster { log.Infoln(\u0026#34;control: Reloading external check configurations due to khcheck update\u0026#34;) k.RestartChecks() } } } } è¿™é‡Œçš„æµç¨‹å¤§æ¦‚å¦‚ä¸‹\nå¼€å¯khstateçš„ç›‘å¬ å¼€å¯http serveræ¥æ”¶å·¡æ£€podçš„è¿”å›å’Œæš´éœ²å·¡æ£€ç»“æœ é€šè¿‡k.monitorExternalChecks()ç›‘å¬khcheck crçš„å˜åŒ–ï¼Œå¹¶é€šè¿‡externalChecksUpdateChan channelè¿”å› é€šè¿‡notifyChanLimiter()å¯¹ç›‘å¬åˆ°khcheck crå˜åŒ–çš„æ¶ˆæ¯åšé™æµ é€šè¿‡k.masterMonitor()è¿›è¡Œé€‰æ‹©master podå·¥ä½œå®ç°é«˜å¯ç”¨ æœ€åçš„ä¸€ä¸ªfor-selectå¾ªç¯ä¸­ï¼Œå½“æ¥æ”¶åˆ°å¤–éƒ¨å·¡æ£€å˜åŒ–channelæ¶ˆæ¯æ—¶ï¼Œé‡å¯æ‰€æœ‰å·¡æ£€ã€‚å½“æœ¬å®ä¾‹æˆä¸ºmasteræ—¶ï¼Œå¯åŠ¨æ‰€æœ‰å·¡æ£€ï¼Œå½“æœ¬å®ä¾‹å¤±å»masterèº«ä»½æ—¶ï¼Œåœæ­¢æ‰€æœ‰å·¡æ£€. ç»†èŠ‚ 1. StartWebServeræ–¹æ³• // StartWebServer starts a JSON status web server at the specified listener. func (k *Kuberhealthy) StartWebServer() { log.Infoln(\u0026#34;Configuring web server\u0026#34;) http.HandleFunc(\u0026#34;/metrics\u0026#34;, func(w http.ResponseWriter, r *http.Request) { err := k.prometheusMetricsHandler(w, r) if err != nil { log.Errorln(err) } }) // Accept status reports coming from external checker pods http.HandleFunc(\u0026#34;/externalCheckStatus\u0026#34;, func(w http.ResponseWriter, r *http.Request) { err := k.externalCheckReportHandler(w, r) if err != nil { log.Errorln(\u0026#34;externalCheckStatus endpoint error:\u0026#34;, err) } }) // Assign all requests to be handled by the healthCheckHandler function http.HandleFunc(\u0026#34;/\u0026#34;, func(w http.ResponseWriter, r *http.Request) { err := k.healthCheckHandler(w, r) if err != nil { log.Errorln(err) } }) // start web server any time it exits for { log.Infoln(\u0026#34;Starting web services on port\u0026#34;, k.ListenAddr) err := http.ListenAndServe(k.ListenAddr, nil) if err != nil { log.Errorln(\u0026#34;Web server ERROR:\u0026#34;, err) } time.Sleep(time.Second / 2) } } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œhttp serverå…±æœ‰ä¸‰ä¸ªapi\n/metrics\nä¸ºprometheusæš´éœ²ç›‘æ§æ•°æ®\n/externalCheckStatus\næ¥æ”¶å·¡æ£€podçš„å·¡æ£€ç»“æœè¿”å›(å·¡æ£€podä¼šå¾€è¿™ä¸ªapié‡Œpost jsonæ•°æ®)\n/\nä¸ºæˆ‘ä»¬æŸ¥çœ‹å½“å‰é›†ç¾¤å·¡æ£€ç»“æœæä¾›æ¥å£(è¿”å›jsonæ•°æ®)\n2. monitorExternalChecksæ–¹æ³• // monitorExternalChecks watches for changes to the external check CRDs func (k *Kuberhealthy) monitorExternalChecks(ctx context.Context, notify chan struct{}) { ... go k.watchForKHCheckChanges(ctx, c) ... } æ ¸å¿ƒæ˜¯ä¸€ä¸ªwatchForKHCheckChangesæ–¹æ³•\n// watchForKHCheckChanges watches for changes to khcheck objects and returns them through the specified channel func (k *Kuberhealthy) watchForKHCheckChanges(ctx context.Context, c chan struct{}) { log.Debugln(\u0026#34;Spawned watcher for KH check changes\u0026#34;) for { log.Debugln(\u0026#34;Starting a watch for khcheck object changes\u0026#34;) // wait a second so we don\u0026#39;t retry too quickly on error time.Sleep(time.Second) // start a watch on khcheck resources watcher, err := khCheckClient.Watch(metav1.ListOptions{}, checkCRDResource, listenNamespace) if err != nil { log.Errorln(\u0026#34;error watching khcheck objects:\u0026#34;, err) continue } // watch for context expiration and close watcher if it happens go func(ctx context.Context, watcher watch.Interface) { \u0026lt;-ctx.Done() watcher.Stop() log.Debugln(\u0026#34;khcheck monitor watch stopping due to context cancellation\u0026#34;) }(ctx, watcher) // loop over results and return them to the calling channel until we hit an error, then close and restart for khc := range watcher.ResultChan() { switch khc.Type { case watch.Added: log.Debugln(\u0026#34;khcheck monitor saw an added event\u0026#34;) c \u0026lt;- struct{}{} case watch.Modified: log.Debugln(\u0026#34;khcheck monitor saw a modified event\u0026#34;) c \u0026lt;- struct{}{} case watch.Deleted: log.Debugln(\u0026#34;khcheck monitor saw a deleted event\u0026#34;) c \u0026lt;- struct{}{} case watch.Error: log.Debugln(\u0026#34;khcheck monitor saw an error event\u0026#34;) e := khc.Object.(*metav1.Status) log.Errorln(\u0026#34;Error when watching for khcheck changes:\u0026#34;, e.Reason) break default: log.Warningln(\u0026#34;khcheck monitor saw an unknown event type and ignored it:\u0026#34;, khc.Type) } } // if the context has expired, don\u0026#39;t start the watch again. just exit watcher.Stop() // TODO - does calling stop twice crash this? I am assuming not. select { case \u0026lt;-ctx.Done(): log.Debugln(\u0026#34;khcheck monitor closing due to context cancellation\u0026#34;) return default: } } } watchForKHCheckChangeså°†ç›‘å¬khcheck crçš„ Added/Modified/Deletedç­‰äº‹ä»¶ï¼Œå¦‚æœç›‘å¬åˆ°æœ‰ä»»ä½•äº‹ä»¶ï¼Œåˆ™æ— å·®åˆ«çš„é€šçŸ¥monitorExternalChecksæ–¹æ³•ä¸­çš„forå¾ªç¯ã€‚åœ¨forå¾ªç¯ä¸­å°†Listæ‰€æœ‰khcheckå¯¹è±¡ï¼Œä¸å†…å­˜ä¸­å·²ä¿å­˜çš„knownSettingsåšå¯¹æ¯”ï¼Œåªè¦å‘ç°æœ‰ä»»æ„å˜åŒ–ï¼Œå°±ä¼šé€šè¿‡channelé€šçŸ¥Startæ–¹æ³•ä¸­çš„notifyChanLimiteræ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰è§¦å‘notifyChanLimiterä¸­çš„æµé€Ÿé™åˆ¶ï¼Œå°±ä¼šé€šçŸ¥Startæ–¹æ³•ä¸­çš„forå¾ªç¯,è§¦å‘ä»¥ä¸‹æ‰§è¡Œå·¡æ£€é€»è¾‘\nfor { select { ... case \u0026lt;-externalChecksUpdateChanLimited: // external check change detected log.Infoln(\u0026#34;control: Witnessed a khcheck resource change...\u0026#34;) // if we are master, stop, reconfigure our khchecks, and start again with the new configuration if isMaster { log.Infoln(\u0026#34;control: Reloading external check configurations due to khcheck update\u0026#34;) k.RestartChecks() } } } 3. RestartChecksæ–¹æ³• å½“å‘ç°æœ‰ä»»æ„khcheck crå˜åŒ–å°±ä¼šè°ƒç”¨RestartChecksæ–¹æ³•\n// RestartChecks does a stop and start on all kuberhealthy checks func (k *Kuberhealthy) RestartChecks() { k.StopChecks() k.StartChecks() } æˆ‘ä»¬å‘ç°ï¼Œkuberhealthyä¼šå…ˆåœæ‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å·¡æ£€ï¼Œç„¶åé‡æ–°å¼€å¯æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å·¡æ£€ã€‚\nåœ¨StopChecksæ–¹æ³•ä¸­ï¼Œkuberhealthyä¼šéå†æ‰€æœ‰å­˜å‚¨åœ¨å†…å­˜ä¸­çš„check structï¼Œå¹¶åˆ†åˆ«è°ƒç”¨å…¶shutdown()æ–¹æ³•ï¼Œå¹¶ç­‰å¾…å…³é—­å®Œæˆ\nåœ¨StartChecksæ–¹æ³•ä¸­ï¼Œkuberhealthyä¼šå…ˆæ‰¾api-serveræ‹‰å–å…¨éƒ¨khcheckå¯¹è±¡ï¼Œå¹¶ç”Ÿæˆcheck structå­˜äºå†…å­˜ä¸­ï¼Œç„¶åéå†è°ƒç”¨runCheck()æ–¹æ³•ï¼Œå¹¶ç­‰å¾…å¯åŠ¨å·¡æ£€å®Œæˆ\nrunCheck()æ–¹æ³•ä¼šè¯»å–khcheckå¯¹è±¡ä¸­æ‰€ä¿å­˜çš„å‘¨æœŸç­‰ä¿¡æ¯ï¼Œå¯ä¸€ä¸ªgoroutineï¼Œé€šè¿‡å®šæ—¶å™¨çš„æ–¹å¼å®šæœŸè°ƒç”¨check structçš„Run()æ–¹æ³•å‘èµ·ä¸€æ¬¡æ£€æŸ¥ï¼Œå¹¶å°†ç»“æœå†™å…¥checkStates crä¸­ã€‚\næ³¨æ„ï¼Œè¿™é‡Œçš„RestartChecksæµç¨‹æ˜¯åŒæ­¥é€»è¾‘ï¼Œæ‰€ä»¥å¦‚æœåœ¨è¿™ä¸ªæµç¨‹ä¸­å› ä¸ºæŸäº›åŸå› å¡ä½ï¼Œkuberhealthyä¸»æµç¨‹ä¼šç›´æ¥å¡æ­»ï¼Œåªèƒ½é‡å¯è§£å†³ã€‚\n4. external checkerçš„Runæ–¹æ³• kuberhealthyä¸»æµç¨‹ä¸­ï¼ŒStartChecks()æ–¹æ³•ä¼šè¿è¡Œæ¯ä¸€ä¸ªexternal checkerçš„Run()æ–¹æ³•\næˆ‘ä»¬æ‰“å¼€æ–‡ä»¶pkg/checks/external/main.goä¸­çœ‹åˆ°checkerçš„Run()æ–¹æ³•å†…å®¹å¦‚ä¸‹\n// Run executes the checker. This is ran on each \u0026#34;tick\u0026#34; of // the RunInterval and is executed by the Kuberhealthy checker func (ext *Checker) Run(client *kubernetes.Clientset) error { // store the client in the checker ext.KubeClient = client // generate a new UUID for each run err := ext.setNewCheckUUID() if err != nil { return err } // run a check iteration ext.log(\u0026#34;Running external check iteration\u0026#34;) err = ext.RunOnce() // if the pod was removed, we skip this run gracefully if err != nil \u0026amp;\u0026amp; err.Error() == ErrPodRemovedExpectedly.Error() { ext.log(\u0026#34;pod was removed during check expectedly. skipping this run\u0026#34;) return ErrPodRemovedExpectedly } // if the pod had an error, we set the error if err != nil { ext.log(\u0026#34;Error with running external check:\u0026#34;, err) return err } return nil } æˆ‘ä»¬ä¼šå‘ç°è°ƒç”¨äº†RunOnce()æ–¹æ³•ï¼Œè€ŒRunOnce()æ–¹æ³•éå¸¸é•¿ï¼Œå†…éƒ¨é€»è¾‘éå¸¸å¤æ‚ï¼Œå¤§è‡´æµç¨‹æ˜¯å…ˆç­‰å¾…å½“å‰å·¡æ£€podç»“æŸï¼Œç„¶åè¿è¡Œä¸€ä¸ªå·¡æ£€podï¼Œæ¥ç€ç­‰å¾…è¿™ä¸ªåˆ›å»ºå‡ºæ¥çš„podè¿”å›å·¡æ£€ç»“æœã€‚\nè¿™é‡Œç”¨äº†waitgroupç­‰å¾…podåˆ›å»ºå’Œç»“æŸå®Œæ¯•ï¼Œå´å› ä¸ºé€»è¾‘å¤æ‚ï¼Œwg.Addè¿‡å¤šï¼Œç»å¸¸å‡ºç°å¡æ­»çš„æƒ…å†µ\næµç¨‹å›¾ Kuberhealthyçš„ç¼ºç‚¹ æ€»ç»“ä»¥ä¸‹kuberhealthyçš„ç¼ºç‚¹ä¸»è¦æ˜¯ä»¥ä¸‹å‡ ç‚¹\n1. ç›‘å¬khcheckçš„å˜åŒ–ä½†ä¸åŒºåˆ†å˜åŒ–ç±»å‹ è¿™ç§è®¾è®¡å¯¼è‡´äº†ï¼Œä»»ä½•ä¸€ä¸ªkhcheckå¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼Œå“ªæ€•æ˜¯ä¿®æ”¹ï¼Œä¹Ÿä¼šè®©æ‰€æœ‰å·¡æ£€å…¨éƒ¨Shutdownå†Startï¼Œä»è€Œä½¿å¾—khcheckçš„å‘¨æœŸè®¾ç½®å½¢åŒè™šè®¾ã€‚(ä¾‹å¦‚ï¼šå½“ä½ ä¿®æ”¹äº†aå·¡æ£€çš„é…ç½®ï¼Œä¼šå‘ç°bcdefå·¡æ£€éƒ½é‡å¯å¹¶è¿è¡Œäº†ä¸€æ¬¡)\n2. åŒæ­¥æµç¨‹é‡å¯å…¨éƒ¨khchecksæœ‰å¯èƒ½å¯¼è‡´ä¸»æµç¨‹å¡æ­» å› ä¸ºç›‘å¬khcheckä¸åŒºåˆ†å˜åŒ–ç±»å‹çš„è®¾è®¡ï¼Œæ‰€ä»¥å¸¦æ¥äº†æ‰€è°“çš„æµæ§ç­–ç•¥ï¼Œä¸“é—¨ç¼–å†™äº†ä¸€ä¸ªæ–¹æ³•ç”¨äºå¯¹å˜åŒ–ä¿¡å·æ§æµï¼Œå¹¶ä¸”ä¸»æµç¨‹çš„é‡å¯å…¨éƒ¨khchecksæ˜¯åŒæ­¥æµç¨‹ï¼Œå¦‚æœåœ¨é‡å¯è¿‡ç¨‹ä¸­å› ä¸ºç§ç§åŸå› æ— æ³•å®ç°shutdownæˆ–è€…runå°±ä¼šä¸»æµç¨‹å¡æ­»ï¼Œä¸å†å“åº”ä»»ä½•åç»­æŒ‡ä»¤ã€‚å‡ºäº†åˆ podé‡å»ºåˆ«æ— ä»–æ³•ã€‚\nè¿™ä¸ªé—®é¢˜å¸¦æ¥çš„bugæ˜¯å¾ˆå¤šçš„ï¼Œå¹¶ä¸”ä¸ºäº†é…åˆè¿™ä¸ªæµç¨‹ï¼Œåœ¨khcheckçš„runæµç¨‹ä¸­ä½¿ç”¨äº†æå¤šçš„ä¿¡å·ä¼ é€’å’Œwaitgroupç­‰å¾…ï¼Œéå¸¸å®¹æ˜“å‡ºé—®é¢˜ã€‚æˆ‘å·²ç»ä¿®äº†ä¸€äº›ä¸¥é‡çš„ä¸»æµç¨‹å¡æ­»bugä½†å‘ç°åªæ˜¯æ²»æ ‡ä¸æ²»æœ¬ï¼Œè¿™ç§æ— åŒºåˆ†äº‹ä»¶ç›‘å¬å’Œå…¨é‡é‡å¯æœºåˆ¶ä¸æ”¹ï¼Œè¿™é‡Œçš„ä¸»æµç¨‹å¡æ­»bugå‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚æ— éæ˜¯è§¦å‘bugéš¾æ˜“ç¨‹åº¦æœ‰å·®åˆ«ã€‚\n3. ä¸æ”¯æŒå•æ¬¡è§¦å‘å‹å·¡æ£€ kuberhealthyåœ¨è®¾è®¡ä¸Šå¤©ç”Ÿå°±ä¸æ”¯æŒå•æ¬¡è§¦å‘å‹å·¡æ£€ï¼Œç”šè‡³å¯¹å·¡æ£€é…ç½®åšæ”¹åŠ¨éƒ½ä¸åº”è¯¥é¢‘ç¹ã€‚\n4. khstateè‡ªå®šä¹‰å¯¹è±¡è®¾è®¡å†—ä½™,å·¡æ£€å†å²æ— è®°å½• kuberhealthyçš„khstateè‡ªå®šä¹‰èµ„æºå¯¹è±¡ç”¨äºè®°å½•å½“å‰å·¡æ£€ç»“æœï¼Œä½†æ— æ³•æŸ¥è¯¢å†å²å·¡æ£€è®°å½•ã€‚å¹¶ä¸”khstateè¿™ä¸ªcrçš„è®¾è®¡æ˜¯æ¯”è¾ƒå†—ä½™è€Œæ— æ„ä¹‰çš„ï¼Œåè€Œå¹³æ·»äº†å¾ˆå¤šå¤æ‚åº¦ã€‚\n5. åºŸå¼ƒçš„å·¡æ£€pod/khchecks/khstate/æ— æ³•å¾—åˆ°æ­£ç¡®çš„æ¸…ç† åŸç”Ÿçš„kuberhealthyåˆ›å»ºçš„å·¡æ£€podå®Œæˆä»»åŠ¡åä¸ä¼šè¢«æ­£ç¡®åˆ é™¤ï¼Œæ‰€ä»¥è¿è¡Œä¸€æ¬¡æ£€æŸ¥å°±ä¼šå¢åŠ ä¸€ä¸ªpodã€‚å®˜æ–¹çš„å¤„ç†æ–¹å¼æ˜¯å¢åŠ ä¸€ä¸ªæ–°crå¯¹è±¡å¯¹åºŸå¼ƒçš„å·¡æ£€podåšcronjobåˆ é™¤ã€‚è¿™æœ¬èº«å°±ä¸æ˜¯ä¸€ä¸ªéå¸¸è‰¯å¥½çš„è§£å†³æ–¹æ¡ˆã€‚å¹¶ä¸”khstateå…¶å®å’Œkhcheckæ˜¯ç»‘å®šå…³ç³»ï¼Œä½†å¹¶æ²¡æœ‰é‡‡ç”¨ownerreferencesçš„æ–¹å¼é›†è”åˆ é™¤ï¼Œåè€Œåœ¨kuberhealhty master podä¸­å¯äº†ä¸€ä¸ªgoroutineä¸åœè½®è¯¢khcheckså¯¹è±¡å’Œå†…å­˜ä¸­ä¿å­˜çš„çŠ¶æ€åšå¯¹æ¯”å¹¶åˆ é™¤khstateï¼Œå®¹æ˜“ç»å¸¸æ€§çš„å¯¼è‡´bugã€‚\n6. é«˜å¯ç”¨é€‰ä¸»ä¸ç¨³å®š è¿˜æ˜¯å› ä¸ºç¼ºç‚¹1ä¸­çš„ä¸åŒºåˆ†khcheckå¯¹è±¡å˜åŒ–ç±»å‹é‡å¯å…¨éƒ¨å·¡æ£€çš„è®¾è®¡ï¼Œæ‰€ä»¥å®¹æ˜“å¯¼è‡´é€‰ä¸»æµç¨‹ä¸­å‡ºç°ä¸»æµç¨‹å¡æ­»çš„é—®é¢˜ã€‚æ ¹å› åœ¨ç¼ºç‚¹1ï¼ŒåŸºæœ¬ä¸Šæ”¹å˜ä¸äº†ã€‚\n7.ä¸æ”¯æŒå¤šé›†ç¾¤ç»Ÿä¸€ä¸ŠæŠ¥ kuberhealthyå¤„ç†çš„è¿˜æ˜¯å•é›†ç¾¤çš„æƒ…å†µï¼Œå¦‚æœéœ€è¦å¤šé›†ç¾¤ç»Ÿä¸€æ§åˆ¶å°±æ¯”è¾ƒéº»çƒ¦ã€‚ä¹Ÿå¯ä»¥é€šè¿‡åœ¨clientä¸­å¢åŠ ç¬¬ä¸‰æ–¹ä¸ŠæŠ¥çš„åŠŸèƒ½ï¼Œä½†æ˜¾å¾—ä¸å¤Ÿä¼˜é›…ã€‚\næˆ‘æ›¾ç»è¯•ç€åœ¨ä¸æ”¹å˜è®¾è®¡çš„å‰æä¸‹å¯¹ä»¥ä¸Šä¸€äº›ä¸¥é‡å½±å“ä½¿ç”¨çš„é—®é¢˜å’Œbugåšä¿®å¤ï¼Œç»è¿‡äº†å‡ æ¬¡ä¿®å¤ä¹‹åå‘ç°ä»…ä»…æ˜¯æ²»æ ‡ä¸æ²»æœ¬ã€‚(æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å…³æ³¨ä¸€ä¸‹è¿™å¥—åŒæ­¥restartæµç¨‹ï¼Œbugå¤šçš„å¾ˆã€‚)è¿™äº›é—®é¢˜çš„æ ¸å¿ƒè¿˜æ˜¯å›åˆ°äº† ä¸åŒºåˆ†å˜åŒ–äº‹ä»¶ç±»å‹ ç®€å•ç²—æš´é‡å¯å…¨éƒ¨å·¡æ£€çš„è®¾è®¡ä¸Šã€‚å°è¯•å’Œå®˜æ–¹æ²Ÿé€šæ˜¯å¦èƒ½é€šè¿‡æ”¹å˜è¿™ä¸ªæ ¸å¿ƒè®¾è®¡æ¥é‡æ„ä»£ç ï¼Œå¾—åˆ°äº†å¦å®šçš„å›ç­”ã€‚\nå…¶å®æœ¬è´¨ä¸Šå·¡æ£€è¦å®ç°çš„åŠŸèƒ½å¹¶ä¸å¤æ‚ï¼Œæ‰€ä»¥å…¶å®ä¸å…¶å¯¹kuberhealthyåšæ”¹åŠ¨è¿˜ä¸å¦‚é‡æ–°å®ç°ä¸€ä¸ªæ¯”è¾ƒç®€å•ã€‚\nè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ€ç»ˆæˆ‘æ²¡æœ‰é‡‡ç”¨kuberhealthyä¸ºåŸå‹çš„åŸå› ï¼Œæˆ‘ä»¬çš„è®¾è®¡å‚è€ƒäº†kuberhealthyçš„åŠŸèƒ½è®¾è®¡ï¼Œå¢åŠ äº†å•æ¬¡è§¦å‘åŠŸèƒ½å’Œå¤šé›†ç¾¤ç»Ÿä¸€ä¸ŠæŠ¥åŠŸèƒ½ï¼Œè§£å†³äº†åºŸå¼ƒçš„å·¡æ£€podçš„æ¸…ç†é—®é¢˜ï¼Œå¢åŠ äº†å·¡æ£€å†å²è®°å½•ä»¥åŠç›‘æ§æŠ¥è­¦èƒ½åŠ›ï¼Œæ”¯æŒç™½å±åŒ–å¤šé›†ç¾¤å·¡æ£€é…ç½®éƒ¨ç½²å’Œå·¡æ£€ç»“æœ/å·¡æ£€podæ—¥å¿—/å·¡æ£€podäº‹ä»¶æŸ¥è¯¢åŠŸèƒ½ã€‚\n","date":"2020-06-05T00:00:00Z","permalink":"/posts/2020/06/2020-06-05-kuberhealthy%E8%AF%A6%E8%A7%A3/","title":"kuberhealthyè¯¦è§£"},{"content":"å·²ç»æœ‰æ•´æ•´4ä¸ªæœˆæ²¡æœ‰å†™åšå®¢äº†ã€‚åŸå› å¾ˆå¤šï¼Œ1æœˆåˆæ‹¿äº†ä¸ªæ–°offerï¼Œä¸Šæ—¬æäº†ç¦»èŒï¼Œæœ¬æ¥è®¡åˆ’2æœˆä¸­æ—¬å…¥èŒï¼Œç»“æœç¢°ä¸Šäº†å²æ— å‰ä¾‹çš„æ–°å† ã€‚è¿™é‡Œä¸å¾—ä¸å¯¹å‰åä¸¤ä¸ªä¸œå®¶è¡¨ç¤ºæ„Ÿè°¢ï¼Œå‰ä¸œå®¶æ¨è¿Ÿä¸Šç­åˆ°3æœˆä»½ï¼Œç°ä¸œå®¶ä¹Ÿè¡¨è¾¾äº†è¶³å¤Ÿçš„å…³å¿ƒå’Œå¸®åŠ©ã€‚ç–«æƒ…åœ¨å®¶æ•´æ—¥ä¹Ÿæ¯”è¾ƒæ— æ‰€äº‹äº‹ï¼Œå­¦ä¹ å¾ˆå°‘ã€‚3æœˆä¸­æ—¬å…¥èŒæ–°å…¬å¸åï¼Œå‘ç°è¿™é‡Œçš„å·¥ä½œå¼ºåº¦è¿˜æ˜¯æ¯”å‰å¸å¼ºäº†å¾ˆå¤šï¼Œä¸ªäººæ€§æ ¼åˆä¸å–œæ¬¢æ‹–æ²“äº‹æƒ…ï¼Œæ•´å¤©å¿™ç€ä¸€äº›åå‘ä¸šåŠ¡ä»£ç ä¸Šçš„å·¥ä½œï¼Œå­¦ä¹ çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒå°‘(é™¤äº†å·¥ä½œéœ€è¦çœ‹äº†ä¸€äº›k8så‘¨è¾¹é¡¹ç›®æºç å’ŒäºŒæ¬¡å¼€å‘)ã€‚\nå›é¡¾æ¥çœ‹ï¼Œæœ€è¿‘ä¸€ç›´å¿™äºå·¥ä½œï¼Œçœ‹èµ·æ¥æ˜¯å¾ˆå‹¤å¥‹çš„ã€‚ä½†èº«ä½“çš„å‹¤å¥‹å¾€å¾€è±¡å¾ç€ç²¾ç¥çš„æ‡’æƒ°ï¼Œå·²ç»æœ‰4ä¸ªæœˆæ²¡æœ‰è®¤è®¤çœŸçœŸå­¦è¿‡ä¸€å¥—è¯¾ç¨‹ï¼Œè¯»è¿‡ä¸€æœ¬è®¡ç®—æœºä¹¦ç±ï¼Œæ²¡æœ‰ç”¨å¿ƒæŠ•å…¥å‚ä¸ä¸€ä¸ªå¼€æºé¡¹ç›®(é™¤äº†å¶å°”æä¸€äº›ç®€å•çš„pr)ï¼Œå“ªæ€•æ˜¯è‡ªå·±ä¹‹å‰ç¼–å†™äº†å¾ˆå¤šä»£ç çš„å¼€æºé¡¹ç›®ï¼Œå‘¨æœ«çœ‹åˆ°issue bugä¹Ÿæ²¡å¿ƒæƒ…å»ä¿®ï¼Œè¿™æ ·æ˜¯ä¸è¡Œçš„ã€‚ä¸èƒ½ç”¨èº«ä½“çš„å‹¤å¥‹è’™è”½è‡ªå·±æ©ç›–ç²¾ç¥çš„æ‡’æƒ°ã€‚\næ°¸è¿œä¸è¦åœæ­¢å­¦ä¹ ï¼\nä¼šå°½é‡æŠ½ç©ºæ¯å¤©æˆ–è€…å‡ å¤©æˆ–è€…ä¸€å‘¨å­¦ä¹ ä¸€æ®µæ—¶é—´ï¼Œç»§ç»­æŠ•å…¥å’Œå‚ä¸å¼€æºé¡¹ç›®ï¼Œå¹¶å°½é‡åˆ†äº«ã€‚åŠ æ²¹ï¼\nå†å²è¯„è®º (5 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nAres (2020-04-21 17:02) ä¸è¦åœæ­¢å­¦ä¹ ï¼ï¼ï¼æœŸå¾…å¤§ç¥çš„åˆ†äº« minik (2020-05-20 19:07) å¤§ç¥ï¼Œä¸€ä¸ªæœˆè¿‡å»äº† calmkart (2020-05-21 14:35) å·¥ä½œå®åœ¨æ˜¯å¿’å¿™äº†...å‡ ä¹æŠ½ä¸å‡ºæ—¶é—´...æœ€è¿‘åº”è¯¥ä¼šå†™ä¸€ç‚¹å’Œkuberhealthyç›¸å…³çš„æ–‡ç« ã€‚ å¼ æ ‘è±ª (2023-09-28 14:11) å¤§ç¥å¥½ï¼Œä»Šå¤©å†æ¬¡è®¿é—®æ‚¨çš„åšå®¢ï¼Œå‘ç°ç½‘ç«™åˆèƒ½æ‰“å¼€äº†ï¼Œå¾ˆæ˜¯é«˜å…´ï¼Œä¹‹å‰å…³æ³¨äº†æ‚¨çš„åšå®¢å¾ˆä¹…ï¼Œå‰ä¸€æ®µæ—¶é—´çªç„¶è®¿é—®ä¸äº†ï¼Œè¿˜æ˜¯æŒºå¤±è½çš„ã€‚æœ€è¿‘é‡åˆ°ä¸€ä¸ªå›°æƒ‘ï¼Œæˆ‘åœ¨æ·±åœ³ä¸€å®¶äº’è”ç½‘å…¬å¸å·¥ä½œäº†4å¹´ï¼Œæœ€è¿‘å…¬å¸æ•ˆç›Šä¸å¥½ï¼Œä¼˜åŒ–äº†éƒ¨åˆ†äººå‘˜ï¼Œå¾ˆä¸å¹¸æˆ‘ä¹Ÿåœ¨å…¶ä¸­ï¼Œæœ€è¿‘ä¹ŸæŠ•äº†ä¸€äº›ç®€å†ï¼Œå¾ˆå¤šhréƒ½æ˜¯å·²è¯»ä¸å›ï¼Œå¥½ä¸å®¹æ˜“çº¦äº†2ä¸ªé¢è¯•ï¼Œè¦ä¸å°±æ˜¯ä¸šåŠ¡è°ƒæ•´æ²¡æœ‰hcï¼Œè¦ä¸å°±æ˜¯è®©é™è–ªï¼Œæˆ‘æœ¬äººä¹Ÿ30å‡ºå¤´äº†ï¼Œå¾ˆæ˜¯è¿·èŒ«ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ç»§ç»­åœ¨è¿™ä¸ªè¡Œä¸šå·ï¼Œè¿˜æ˜¯æ€ä¹ˆçš„ï¼Œå®¶é‡Œäººçš„æ„æ€æ˜¯ç¦»å¼€æ·±åœ³ï¼Œå›è€å®¶å‘å±•ï¼Œç”±äºå‰ä¸¤å¹´åœ¨è€å®¶ä¹°äº†æˆ¿ï¼ŒèƒŒç€æˆ¿è´·ï¼Œå‹åŠ›è¿˜æ˜¯æŒºå¤§çš„ï¼Œå›è€å®¶çš„è¯ï¼Œæœ¬åœ°ä¹Ÿæ²¡å•¥äº’è”ç½‘å…¬å¸ï¼ŒåŸºæœ¬å°±å¤±ä¸šäº†ï¼Œçˆ¶æ¯æƒ³è®©æˆ‘è€ƒå…¬åŠ¡å‘˜æˆ–äº‹ä¸šå•ä½ï¼Œå¬é—»å»äº†ä½“åˆ¶å†…ï¼Œå·¥ä½œåŸºæœ¬æ˜¯ä¸€çœ¼æœ›åˆ°å¤´äº†ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆå‘å±•ï¼Œæˆ‘æœ¬äººä¹Ÿå¾ˆè¿·èŒ«ï¼Œä¸çŸ¥é“ä»¥åçš„è·¯è¯¥æ€ä¹ˆèµ°ï¼Œå¸Œæœ›æ‚¨èƒ½æŒ‡ç‚¹ä¸€äºŒï¼Œç»™æˆ‘ä¸€äº›å»ºè®®ï¼Œå†æ¬¡æ‹œè°¢ï¼ calm (2023-12-01 14:39) â€œå¬é—»å»äº†ä½“åˆ¶å†…ï¼Œå·¥ä½œåŸºæœ¬æ˜¯ä¸€çœ¼æœ›åˆ°å¤´äº†ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆå‘å±•â€ï¼Œè¯æ˜¯è¿™ä¹ˆè¯´ï¼Œä½†é—®é¢˜æ˜¯ï¼Œç°åœ¨åœ¨å¤§éƒ¨åˆ†äº’è”ç½‘å…¬å¸ä¹Ÿæœªå¿…æœ‰ä»€ä¹ˆå‘å±•å§ã€‚å¦‚æœæ²¡æœ‰å®¶åº­å’Œå­©å­çš„è¯ï¼Œåœ¨å¤–é¢æ‰“æ‹¼æ‰“æ‹¼è¿˜æ˜¯å¯ä»¥çš„ã€‚å¦‚æœæœ‰äº†å®¶åº­æœ‰äº†å­©å­ï¼Œä»…ä»…æ˜¯èƒŒç€è€å®¶çš„æˆ¿è´·éƒ½ä¼šè§‰å¾—å‹åŠ›å¤§ï¼Œé‚£åŸºæœ¬ä¸Šæ²¡å¿…è¦ç•™åœ¨åŒ—ä¸Šæ·±äº†ï¼Œæ—©ç‚¹å›å»è¿‡è‡ªå·±çš„ç”Ÿæ´»å§ã€‚ äº’è”ç½‘çš„å·¥ä½œä¹Ÿä¸ä¸€å®šè¦æœ‰ä¸€ä¸ªå®ä½“å…¬å¸ï¼Œåªè¦ä½ æœ‰å…´è¶£ï¼Œå¤§å¯ä»¥å›è€å®¶æ‰¾ä¸ªä½“åˆ¶å†…ç¨³å®šå·¥ä½œä¹‹çº¿ä¸Šæ¥æ´»æˆ–è€…è¿œç¨‹å·¥ä½œçš„ã€‚ ","date":"2020-04-20T00:00:00Z","permalink":"/posts/2020/04/2020-04-20-%E4%B8%8D%E8%A6%81%E5%81%9C%E6%AD%A2%E5%AD%A6%E4%B9%A0/","title":"ä¸è¦åœæ­¢å­¦ä¹ "},{"content":"æ‘˜æŠ„è‡ª ã€ŠSRE: Googleè¿ç»´è§£å¯†ã€‹\nå­—å­—ç ç‘ã€‚\nçäº‹ä¸ä¼šæ€»æ˜¯è®©æ¯ä¸ªäººéƒ½ä¸å¼€å¿ƒï¼Œç‰¹åˆ«æ˜¯ä¸å¤ªå¤šçš„æ—¶å€™ã€‚å·²çŸ¥çš„å’Œé‡å¤æ€§çš„å·¥ä½œæœ‰ä¸€ç§è®©äººå¹³é™çš„åŠŸæ•ˆã€‚å®Œæˆè¿™äº›äº‹å¯ä»¥å¸¦æ¥ä¸€ç§æ»¡è¶³æ„Ÿå’Œå¿«é€Ÿèƒœåˆ©æ„Ÿã€‚çäº‹å¯èƒ½æ˜¯ä½é£é™©ä½å‹åŠ›çš„æ´»åŠ¨ï¼Œæœ‰äº›å‘˜å·¥ç”šè‡³å–œæ¬¢åšè¿™ç§ç±»å‹çš„å·¥ä½œã€‚\nçäº‹çš„å­˜åœ¨å¹¶ä¸æ€»æ˜¯åäº‹ï¼Œä½†æ˜¯æ¯ä¸ªäººéƒ½å¿…é¡»æ¸…æ¥šï¼Œåœ¨SREæ‰€æ‰®æ¼”çš„è§’è‰²ä¸­ï¼Œä¸€å®šæ•°é‡çš„çäº‹æ˜¯ä¸å¯é¿å…çš„ï¼Œè¿™å…¶å®æ˜¯ä»»ä½•å·¥ç¨‹ç±»å·¥ä½œéƒ½å…·æœ‰çš„ç‰¹ç‚¹ã€‚å°‘é‡çš„çäº‹å­˜åœ¨ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†æ˜¯ä¸€æ—¦çäº‹çš„æ•°é‡å˜å¤šï¼Œå°±ä¼šæœ‰å®³äº†ã€‚å¦‚æœçäº‹ç‰¹åˆ«ç¹é‡ï¼Œé‚£å°±åº”è¯¥éå¸¸æ‹…æ‰°ï¼Œå¤§å£°æŠ±æ€¨ã€‚åœ¨è®¸å¤šçäº‹æœ‰å®³çš„åŸå› ä¸­ï¼Œæœ‰å¦‚ä¸‹å› ç´ éœ€è¦è€ƒè™‘ï¼š\nèŒä¸šåœæ»\nå¦‚æœèŠ±åœ¨å·¥ç¨‹é¡¹ç›®ä¸Šçš„æ—¶é—´å¤ªå°‘ï¼Œä½ çš„èŒä¸šå‘å±•ä¼šå˜æ…¢ï¼Œç”šè‡³åœæ»ã€‚Googleç¡®å®ä¼šå¥–åŠ±åšé‚£äº›è„æ´»ç´¯æ´»çš„äººï¼Œä½†æ˜¯ä»…ä»…æ˜¯è¯¥å·¥ä½œæ˜¯ä¸å¯é¿å…ï¼Œå¹¶æœ‰å·¨å¤§çš„æ­£é¢å½±å“çš„æ—¶å€™æ‰ä¼šè¿™æ ·åšã€‚æ²¡æœ‰äººå¯ä»¥é€šè¿‡ä¸åœåœ°åšè„æ´»ç´¯æ´»æ»¡è¶³è‡ªå·±çš„èŒä¸šå‘å±•ã€‚\nå£«æ°”ä½è½\næ¯ä¸ªäººå¯¹è‡ªå·±å¯ä»¥æ‰¿æ‹…çš„çäº‹é™åº¦æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯ä¸€å®šæœ‰ä¸ªé™åº¦ã€‚è¿‡å¤šçš„çäº‹ä¼šå¯¼è‡´è¿‡åº¦åŠ³ç´¯ï¼Œç–²å€¦å’Œä¸æ»¡ã€‚\nå¦å¤–ï¼Œç‰ºç‰²å·¥ç¨‹å®è·µè€Œåšçäº‹ä¼šå¯¹SREç»„ç»‡çš„æ•´ä½“å‘å±•é€ æˆæŸå®³ï¼ŒåŸå› å¦‚ä¸‹ï¼š\né€ æˆè¯¯è§£\næˆ‘ä»¬åŠªåŠ›ç¡®ä¿æ¯ä¸ªSREä»¥åŠä¸SREä¸€èµ·å·¥ä½œçš„äººéƒ½ç†è§£SREæ˜¯ä¸€ä¸ªå·¥ç¨‹ç»„ç»‡ã€‚å¦‚æœä¸ªäººæˆ–å›¢é˜Ÿè¿‡åº¦å‚ä¸çäº‹ï¼Œä¼šç ´åè¿™ç§è§’è‰²ï¼Œé€ æˆè¯¯è§£ã€‚\nè¿›å±•ç¼“æ…¢\nçäº‹è¿‡å¤šä¼šå¯¼è‡´å›¢é˜Ÿç”Ÿäº§åŠ›ä¸‹é™ï¼Œå¦‚æœSREå›¢é˜Ÿå¿™äºä¸ºæ‰‹å·¥æ“ä½œå’Œå¯¼å‡ºæ•°æ®æ•‘ç«ï¼Œæ–°åŠŸèƒ½çš„å‘å¸ƒå°±ä¼šå˜æ…¢ã€‚\nå¼€åˆ›å…ˆä¾‹\nå¦‚æœSREè¿‡äºæ„¿æ„æ‰¿æ‹…çäº‹ï¼Œç ”å‘åŒäº‹å°±æ›´å€¾å‘äºåŠ å…¥æ›´å¤šçš„çäº‹ï¼Œæœ‰æ—¶å€™ç”šè‡³å°†æœ¬è¯¥ç”±ç ”å‘å›¢é˜Ÿæ‰¿æ‹…çš„è¿ç»´å·¥ä½œè½¬ç»™SREæ¥æ‰¿æ‹…ã€‚å…¶ä»–å›¢é˜Ÿä¹Ÿä¼šå¼€å§‹æŒ‡æœ›SREæ¥å—è¿™æ ·çš„å·¥ä½œï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¥½çš„ã€‚\nä¿ƒè¿›æ‘©æ“¦äº§ç”Ÿ\nå³ä½¿ä½ ä¸ªäººå¯¹çäº‹æ²¡æœ‰æ€¨è¨€ï¼Œä½ ç°åœ¨çš„æˆ–æœªæ¥çš„é˜Ÿå‹å¯èƒ½ä¼šå¾ˆä¸å¼€å¿ƒã€‚å¦‚æœå›¢é˜Ÿä¸­å¼•å…¥äº†å¤ªå¤šçš„çäº‹ï¼Œå…¶å®å°±æ˜¯åœ¨é¼“åŠ±å›¢é˜Ÿé‡Œæœ€å¥½çš„å·¥ç¨‹å¸ˆå¼€å§‹å¯»æ‰¾å…¶ä»–åœ°æ–¹æä¾›çš„æ›´æœ‰ä»·å€¼çš„å·¥ä½œã€‚\nè¿åæ‰¿è¯º\né‚£äº›ä¸ºäº†é¡¹ç›®å·¥ç¨‹å·¥ä½œè€Œå…¥èŒçš„æ–°å‘˜å·¥ï¼Œä»¥åŠè½¬å…¥SREçš„è€å‘˜å·¥ä¼šæœ‰è¢«æ¬ºéª—çš„æ„Ÿè§‰ï¼Œè¿™éå¸¸ä¸åˆ©äºå…¬å¸çš„å£«æ°”ã€‚\nå¦‚æœæˆ‘ä»¬éƒ½è‡´åŠ›äºæ¯ä¸€å‘¨é€šè¿‡å·¥ç¨‹å·¥ä½œæ¶ˆé™¤ä¸€ç‚¹çäº‹ï¼Œå°±å¯ä»¥æŒç»­æ€§åœ°æ•´é¡¿æœåŠ¡ã€‚æˆ‘ä»¬å°±å¯ä»¥å°†æ›´å¤šçš„åŠ›é‡æŠ•å…¥åˆ°æ‰©å¤§æœåŠ¡è§„æ¨¡çš„å·¥ç¨‹å·¥ä½œä¸Šå»ï¼Œæˆ–è€…æ˜¯è¿›è¡Œä¸‹ä¸€ä»£çš„æœåŠ¡çš„æ¶æ„è®¾è®¡ï¼Œåˆæˆ–è€…æ˜¯å»ºç«‹ä¸€å¥—è·¨SREä½¿ç”¨çš„å·¥å…·é“¾ã€‚è®©æˆ‘ä»¬å¤šåˆ›æ–°ï¼Œå°‘å¹²çäº‹å§ï¼\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nwallsis (2020-03-12 11:40) å¤§ç¥ï¼Œæ„Ÿè§‰æ‚¨å¥½ä¹…éƒ½æ²¡æ›´æ–°æ–‡ç« äº†ï¼Œå¸Œæœ›èƒ½çœ‹åˆ°æ‚¨æ›´å¤šçš„æŠ€æœ¯åˆ†äº«ï¼ŒğŸ˜† ","date":"2019-12-25T00:00:00Z","permalink":"/posts/2019/12/2019-12-25-%E7%90%90%E4%BA%8B%E7%B9%81%E5%A4%9A%E6%98%AF%E4%B8%8D%E6%98%AF%E4%B8%80%E5%AE%9A%E4%B8%8D%E5%A5%BD/","title":"çäº‹ç¹å¤šæ˜¯ä¸æ˜¯ä¸€å®šä¸å¥½?"},{"content":"è¿™ä¸¤å¤©è¯»Googleçš„ã€ŠSREã€‹æ—¶çœ‹åˆ°ä¸€æ®µè¯\nä»Šå¤©ï¼Œæˆ‘ä»¬èƒ½æ„Ÿå—åˆ°æ•´ä¸ªè¡Œä¸šéƒ½åœ¨é¼“å¹åšé¢œæ— è€»çš„\u0026quot;ä»£ç æ‹¿æ¥ä¸»ä¹‰\u0026quot;(just show me the code)ã€‚å¼€æºç¤¾åŒºå†…éƒ¨æ­£åœ¨å½¢æˆä¸€ç§\u0026quot;ä¸è¦é—®æˆ‘é—®é¢˜\u0026quot;çš„é£æ°”\u0026hellip;\u0026hellip;\u0026hellip;\u0026hellip;.è¿™æœ¬ä¹¦ä¸­æ²¡æœ‰ä¸‡èƒ½è¯ï¼Œæ²¡æœ‰ä»€ä¹ˆä¸œè¥¿èƒ½è§£å†³ä¸€åˆ‡é—®é¢˜ï¼Œä½†æ˜¯è¿™æ°æ°æ˜¯æœ¬ä¹¦çš„å®—æ—¨ï¼šç›¸æ¯”æœ€åçš„è½¯ä»¶ç»“æœï¼Œæ¶æ„è®¾è®¡è€Œè¨€ï¼ŒçœŸå®çš„è®¾è®¡è¿‡ç¨‹ï¼Œä½œè€…æœ¬èº«çš„æ€è€ƒç»å†æ›´æœ‰ä»·å€¼ã€‚å®ç°ç»†èŠ‚æ°¸è¿œåªæ˜¯çŸ­æš‚å­˜åœ¨çš„ï¼Œä½†æ˜¯æ–‡æ¡£åŒ–çš„è®¾è®¡è¿‡ç¨‹å´æ˜¯****æ— ä»·ä¹‹å®ã€‚Â \u0026ndash; ã€ŠGoogle SRE è¿ç»´è§£ç§˜ã€‹\næ·±ä»¥ä¸ºç„¶ï¼Œä¸ç¦è®©æˆ‘æƒ³åˆ°äº†è¿‡å»å­¦ä¹ å¼ ç£Šè€å¸ˆã€Šæ·±å…¥å‰–æKubernetesã€‹æ—¶æ›¾çœ‹åˆ°å¼ ç£Šè€å¸ˆå›å¤è¯¾åç•™è¨€æ—¶è¯´è¿‡çš„ä¸€å¥è¯\nç›´æ¥è®²æºç æ˜¯ä¸è´Ÿè´£ä»»ä¹Ÿæ˜¯é€ƒé¿å›°éš¾çš„åšæ³•ã€‚ï¼ˆå¤§æ„ï¼‰\nä»€ä¹ˆæ˜¯ä¸€æµçš„æŠ€æœ¯æ–‡ç« ï¼Ÿç»ä¸æ˜¯ä¸€ä¸Šæ¥å°±å¼€å§‹è´´æºç ç”»æµç¨‹å›¾æ·±å…¥åˆ°æ¯ä¸€ä¸ªå‡½æ•°ã€‚\nç›¸æ¯”å…·ä½“çš„å®ç°ï¼ŒæŒæ¡å…¶æ€æƒ³ï¼ŒæŒæ¡å…¶è®¾è®¡ç†å¿µ\u0026mdash;ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿæ¶æ„ä¸ºä»€ä¹ˆè¿™æ ·æ¼”è¿›ï¼Ÿæ›´ä¸ºé‡è¦ã€‚å½“ç„¶ï¼Œè¦èƒ½å°†è¿™äº›ç†å¿µå’Œæ¼”è¿›å†ç¨‹ä¼ æˆç»™è¯»è€…ï¼Œæ›´éœ€è¦æ‰å®çš„æŠ€æœ¯å’Œæ–‡å­—åŠŸåº•ã€‚è¿™è¿œæ¯”ä¸Šæ¥å°±è¿ç¯‡ç´¯ç‰è´´æºç æ›´å›°éš¾ä¹Ÿæ›´æœ‰æ„ä¹‰ã€‚\nTalk is not cheap.\nå‘æ¯ä¸€ä¸ªçœŸè¯šåˆ†äº«çš„æŠ€æœ¯äººè‡´è°¢ã€‚\n","date":"2019-12-24T00:00:00Z","permalink":"/posts/2019/12/2019-12-24-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E6%B5%81%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/","title":"ä»€ä¹ˆæ˜¯ä¸€æµçš„æŠ€æœ¯æ–‡ç« ï¼Ÿ"},{"content":"å¤§å®¶éƒ½çŸ¥é“,k8sä¸­çš„æœåŠ¡(service)æ˜¯å¯¹k8sä¸­çš„deploymentç­‰å¯¹è±¡çš„ä¸€ä¸ªä¸€è‡´è®¿é—®ç‚¹.æ‰€ä»¥serviceä¼šæœ‰ä¸€ä¸ªvip(headless serviceæ²¡æœ‰).æ— è®ºæ˜¯æ™®é€šserviceçš„vipæˆ–è€…headless serviceçš„pod ipå…¶å®éƒ½æ˜¯k8sé›†ç¾¤ä¸­çš„å†…éƒ¨ip,åœ¨é›†ç¾¤å†…è®¿é—®å®ƒæ˜¯éå¸¸å®¹æ˜“çš„.æ¯”å¦‚æœ‰ä¸€ä¸ªserviceå«nginx,æˆ‘ä»¬åœ¨é›†ç¾¤å†…çš„å¦ä¸€ä¸ªpodé‡Œæ—¢å¯ä»¥å¯¹è¿™ä¸ªnginx serviceçš„vipè¿›è¡Œgetè®¿é—®,ä¹Ÿå¯ä»¥é€šè¿‡corednså¯¹è¿™ä¸ªnginx serviceçš„åŸŸåå¦‚(nginx, nginx.defaultç­‰)è¿›è¡Œè®¿é—®.ä½†æ˜¯åœ¨é›†ç¾¤å¤–å‘¢?è¿™å°±éº»çƒ¦äº†.\nå¸¸è§çš„é›†ç¾¤å¤–è®¿é—®serviceçš„æ–¹å¼å¤§è‡´åˆ†ä¸º LoadBalance, NodePort, ExternalIpç­‰æ–¹å¼, å†ç»†è‡´ä¸€ç‚¹ä¹Ÿå¯ä»¥é€šè¿‡Ingressåœ¨7å±‚åšä¸€å±‚åˆ†å‘å†å¤–æ¥ä¸Šè¿°æµé‡æ¥å…¥,ç”šè‡³ä½ å¯ä»¥ç›´æ¥å°†api serveråšproxy. å¾ˆæ˜¾ç„¶çš„ï¼Œè¿™äº›æ–¹å¼å¦‚æœåœ¨æˆ‘ä»¬åªæ˜¯éœ€è¦å¯¹æœåŠ¡è¿›è¡Œè°ƒè¯•æˆ–è€…éšä¾¿ç”¨ç”¨çš„åœºæ™¯éƒ½æ˜¯è¦ä¹ˆå¤ªå¤æ‚(Ingress), è¦ä¹ˆèŠ±é’±(LoadBanlence),è¦ä¹ˆä¸é è°±(NodePort).\nè¿™æ—¶å€™ä½ ä¼šè¯´,å—·,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨kubectl port-forward åŠŸèƒ½,å°†serviceçš„ç«¯å£port-forwardåˆ°æœ¬åœ°ç«¯å£.å¯¹ï¼Œæ²¡é”™ï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹å¼ï¼Œä½†è¿™ä»ç„¶å­˜åœ¨éå¸¸å¤šçš„é—®é¢˜ã€‚\næ¯”å¦‚,æˆ‘ä»¬å¹¶ä¸æƒ³è¦å°†nginx serviceçš„80ç«¯å£port-forwardåˆ°æˆ‘çš„8080ç«¯å£ä¸Šï¼Œå°±æƒ³ç”¨80ç«¯å£ï¼Œé‚£ä¹ˆå¦‚æœæœ‰ä¸¤ä¸ªserviceåˆ†åˆ«å«nginx1å’Œnginx2ï¼Œè¿™ä¸å°±æ²¡æ³•å¼„äº†å—ï¼Ÿå†æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬port-forwardçš„svcçš„podå‘ç”Ÿäº†å˜åŠ¨,æ€ä¹ˆåŠï¼Ÿå†æ¯”å¦‚,æˆ‘ä»¬å°±æ˜¯æƒ³åƒåœ¨é›†ç¾¤å†…ä¸€æ ·ï¼Œé€šè¿‡serviceçš„å†…éƒ¨åŸŸåå¯¹å…¶è®¿é—®(nginx, nginx.defaultç­‰)ï¼Œæ€ä¹ˆåŠï¼Ÿå†æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰100ä¸ªæœåŠ¡ï¼Œéš¾é“æˆ‘ä»¬è¦æ‰‹åŠ¨å¯¹æ¯ä¸ªæœåŠ¡port-forwardç„¶åæ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªæ²¡ç”¨è¿‡çš„ç«¯å£å—ï¼Ÿç”šè‡³ï¼Œå½“æˆ‘ä»¬çš„æœåŠ¡åˆ›å»º,åˆ é™¤,æˆ‘ä»¬åˆå¾—æ‰‹åŠ¨æ“ä½œ,è¿™æ˜¯ä½•ç­‰çš„éº»çƒ¦ï¼Ÿ\nåŸºäºä¸Šè¿°é—®é¢˜,ä¸€ä¸ªå«kubefwdçš„å·¥å…·å‡ºç°äº†ã€‚\næˆ‘ä»¬å…ˆä»ä½¿ç”¨å¼€å§‹ã€‚ é¦–å…ˆæœ‰ä¸€ä¸ªé›†ç¾¤,æœ‰nginxå’Œnginx1ä¸¤ä¸ªservice,å…¶ä¸­nginxæ˜¯æ™®é€šservice,è€Œnginx1æ˜¯headless service.\nâœ ~ kubectl get pods NAME READY STATUS RESTARTS AGE nginx-deployment-5cdfb5fc49-fgn78 1/1 Running 0 24d nginx-deployment-5cdfb5fc49-rjg26 1/1 Running 0 24d nginx-deployment1-75c5577b94-tp7zr 1/1 Running 0 21d nginx-deployment1-75c5577b94-vcpn5 1/1 Running 0 21d pi-gw8s7 0/1 Completed 0 74d âœ ~ kubectl get service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.96.0.1 443/TCP 74d nginx ClusterIP 10.101.159.59 80/TCP 33d nginx1 ClusterIP None 80/TCP 21d âœ ~ ç„¶åæˆ‘ä»¬ä¸‹è½½æœ€æ–°ç‰ˆçš„kubefwd(release)åœ¨æœ¬åœ°è¿è¡Œã€‚\nâœ kubefwd git:(master) sudo kubefwd svc Password: INFO[11:44:47] _ _ __ _ INFO[11:44:47] | | ___ _| |__ ___ / _|_ ____| | INFO[11:44:47] | |/ / | | | \u0026#39;_ \\ / _ \\ |_\\ \\ /\\ / / _ | INFO[11:44:47] | \u0026lt;| |_| | |_) | __/ _|\\ V V / (_| | INFO[11:44:47] |_|\\_\\\\__,_|_.__/ \\___|_| \\_/\\_/ \\__,_| INFO[11:44:47] INFO[11:44:47] Version 0.0.0 INFO[11:44:47] https://github.com/txn2/kubefwd INFO[11:44:47] INFO[11:44:47] Press [Ctrl-C] to stop forwarding. INFO[11:44:47] \u0026#39;cat /etc/hosts\u0026#39; to see all host entries. INFO[11:44:47] Loaded hosts file /etc/hosts INFO[11:44:47] Hostfile management: Original hosts backup already exists at /Users/calmkart/hosts.original WARN[11:44:47] WARNING: No Pod selector for service kubernetes in default on cluster . INFO[11:44:47] Forwarding: nginx1:80 to pod nginx-deployment1-75c5577b94-tp7zr:80 INFO[11:44:47] Forwarding: nginx-deployment1-75c5577b94-tp7zr.nginx1:80 to pod nginx-deployment1-75c5577b94-tp7zr:80 INFO[11:44:47] Forwarding: nginx-deployment1-75c5577b94-vcpn5.nginx1:80 to pod nginx-deployment1-75c5577b94-vcpn5:80 INFO[11:44:47] Forwarding: nginx:80 to pod nginx-deployment-5cdfb5fc49-fgn78:80 æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶å°INFOè¾“å‡ºæ¸…æ™°çš„çœ‹åˆ°,æˆ‘ä»¬å·²ç»å°†æ™®é€šservice nginx port-forwardåˆ°äº†å®ƒçš„ç¬¬ä¸€ä¸ªpod nginx-deployment-5cdfb5fc49-fgn78ä¸Šï¼Œå°†headless service nginx1 port-forwardåˆ°äº†å®ƒçš„ç¬¬ä¸€ä¸ªpodä¸Šï¼ŒåŒæ—¶è¿˜port-forwardåˆ°äº†å®ƒçš„æ¯ä¸€ä¸ªpodä¸Š(å› ä¸ºheadless serviceä¸­çš„podæ˜¯ä¸ç­‰ä»·çš„).\næ¥ç€æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æœ¬æœºçš„hosts\nâœ ~ cat /etc/hosts ## # Host Database # # localhost is used to configure the loopback interface # when the system is booting. Do not change this entry. ## 127.0.0.1 localhost 127.1.27.1 nginx1 nginx1.default.svc.cluster.local nginx1.default 127.1.27.2 nginx-deployment1-75c5577b94-tp7zr.nginx1 nginx-deployment1-75c5577b94-tp7zr.nginx1.default.svc.cluster.local nginx-deployment1-75c5577b94-tp7zr.nginx1.default 127.1.27.3 nginx-deployment1-75c5577b94-vcpn5.nginx1 nginx-deployment1-75c5577b94-vcpn5.nginx1.default.svc.cluster.local nginx-deployment1-75c5577b94-vcpn5.nginx1.default 127.1.27.4 nginx nginx.default.svc.cluster.local nginx.default å‰å®³äº†ï¼Œå±…ç„¶å¤šå‡ºäº†è¿™ä¹ˆå¤šè®°å½•ã€‚ ä»è¿™ä¸ªhostsçœ‹èµ·æ¥ï¼Œæˆ‘ä»¬è®¿é—®nginx1/nginx1.default.svc.cluster.local/nginx1.defaultåº”è¯¥éƒ½å¯ä»¥è®¿é—®åˆ°k8sé›†ç¾¤ä¸­çš„nginx1æœåŠ¡; æˆ‘ä»¬è®¿é—®nginx/nginx.default.svc.cluster.local/nginx.defaultåº”è¯¥éƒ½å¯ä»¥è®¿é—®åˆ°k8sé›†ç¾¤ä¸­çš„nginxæœåŠ¡,æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹ã€‚ ä½¿ç”¨httpieè¯•è¯•\nâœ ~ http get nginx1 HTTP/1.1 200 OK Accept-Ranges: bytes Connection: keep-alive Content-Length: 612 Content-Type: text/html Date: Tue, 10 Dec 2019 03:57:05 GMT ETag: \u0026#34;58e66cf5-264\u0026#34; Last-Modified: Thu, 06 Apr 2017 16:29:41 GMT Server: nginx/1.11.13 âœ ~ http get nginx HTTP/1.1 200 OK Accept-Ranges: bytes Connection: keep-alive Content-Length: 612 Content-Type: text/html Date: Tue, 10 Dec 2019 03:57:17 GMT ETag: \u0026#34;54999765-264\u0026#34; Last-Modified: Tue, 23 Dec 2014 16:25:09 GMT Server: nginx/1.7.9 å‰å®³äº†ä¹Ÿï¼ŒçœŸçš„ç®¡ç”¨ã€‚\næˆ‘ä»¬å°è¯•åœ¨k8sé›†ç¾¤ä¸­æ–°æ·»åŠ ä¸€ä¸ªserviceå«nginx2,è¿™ä¸ªæœåŠ¡å’Œnginx1ä¸€æ ·æ˜¯ä¸€ä¸ªheadless service\napiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment2 labels: app: nginx2 spec: replicas: 2 selector: matchLabels: app: nginx2 template: metadata: labels: app: nginx2 test: test test1: test1 spec: containers: - name: nginx image: nginx:latest ports: - containerPort: 80 readinessProbe: tcpSocket: port: 80 livenessProbe: tcpSocket: port: 80 --- apiVersion: v1 kind: Service metadata: name: nginx2 spec: clusterIP: None selector: app: nginx2 ports: - protocol: TCP port: 80 targetPort: 80 âœ ~ kubectl apply -f nginx2.yaml deployment.apps/nginx-deployment2 created service/nginx2 created è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‘ç°è¿è¡Œçš„kubefwd INFOè®°å½•æ˜¾ç¤ºäº†å¦‚ä¸‹å†…å®¹\nINFO[12:01:12] Forwarding: nginx2:80 to pod nginx-deployment2-5995ddf44f-6r9fg:80 INFO[12:01:12] Forwarding: nginx-deployment2-5995ddf44f-6r9fg.nginx2:80 to pod nginx-deployment2-5995ddf44f-6r9fg:80 INFO[12:01:12] Forwarding: nginx-deployment2-5995ddf44f-d5q9d.nginx2:80 to pod nginx-deployment2-5995ddf44f-d5q9d:80 æˆ‘ä»¬æ¥çœ‹çœ‹Hosts\n127.1.27.5 nginx2 nginx2.default.svc.cluster.local nginx2.default 127.1.27.6 nginx-deployment2-5995ddf44f-6r9fg.nginx2 nginx-deployment2-5995ddf44f-6r9fg.nginx2.default.svc.cluster.local nginx-deployment2-5995ddf44f-6r9fg.nginx2.default 127.1.27.7 nginx-deployment2-5995ddf44f-d5q9d.nginx2 nginx-deployment2-5995ddf44f-d5q9d.nginx2.default.svc.cluster.local nginx-deployment2-5995ddf44f-d5q9d.nginx2.default æœç„¶ï¼Œæ–°æ·»åŠ äº†è¿™äº›è®°å½•ã€‚çœ‹æ¥æˆ‘ä»¬é€šè¿‡æœ¬åœ°åŸŸåè§£ænginx2å°±å¯ä»¥è®¿é—®åˆ°nginx2æœåŠ¡å•¦.æˆ‘ä»¬æ¥è¯•è¯•.\nâœ ~ http get nginx2 HTTP/1.1 200 OK Accept-Ranges: bytes Connection: keep-alive Content-Length: 612 Content-Type: text/html Date: Tue, 10 Dec 2019 04:03:23 GMT ETag: \u0026#34;5dd3e500-264\u0026#34; Last-Modified: Tue, 19 Nov 2019 12:50:08 GMT Server: nginx/1.17.6 æœç„¶ï¼Œå’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸€æ ·ã€‚ æœ€åæˆ‘ä»¬é€šè¿‡ctrl+cåœæ­¢kubefwd.\n^CWARN[12:04:08] Stopped forwarding nginx-deployment1-75c5577b94-vcpn5.nginx1 in default. WARN[12:04:08] Stopped forwarding nginx-deployment2-5995ddf44f-d5q9d.nginx2 in default. WARN[12:04:08] Stopped forwarding nginx2 in default. WARN[12:04:08] Stopped forwarding nginx in default. WARN[12:04:08] Stopped forwarding nginx-deployment2-5995ddf44f-6r9fg.nginx2 in default. WARN[12:04:08] Stopped forwarding nginx1 in default. WARN[12:04:08] Stopped forwarding nginx-deployment1-75c5577b94-tp7zr.nginx1 in default. INFO[12:04:08] Done... terminalä¸­æ˜¾ç¤ºæˆ‘ä»¬åœæ­¢äº†nginx,nginx1,nginx2çš„è½¬å‘,æˆ‘ä»¬å†æ¥çœ‹çœ‹hostså‘¢ï¼Ÿ\n## # Host Database # # localhost is used to configure the loopback interface # when the system is booting. Do not change this entry. ## 127.0.0.1 localhost æœç„¶ï¼Œå·²ç»æ¸…ç†å®Œæ¯•äº†ã€‚\nä»¥ä¸ŠåŸºæœ¬å°±æ˜¯å¸¸è§„ä½¿ç”¨çš„å…¨è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥å¤§è‡´è®²è®²åŸç†å§ã€‚\nkubefwdé¡¹ç›®è¿‡å»çš„è¿è¡Œæœºåˆ¶æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡api-serveræ‹‰å–k8sä¸­çš„æ‰€æœ‰serviceæœåŠ¡ä¿¡æ¯(List),å¹¶å°†æœåŠ¡åˆ†ä¸ºæ™®é€šæœåŠ¡å’Œæ— å¤´æœåŠ¡ä¸¤ç±»,é€šè¿‡æ™®é€šæœåŠ¡çš„ç¬¬ä¸€ä¸ªpod/æ— å¤´æœåŠ¡çš„æ¯ä¸€ä¸ªpodçš„port-forward subresourceå¯¹å…¶åšè½¬å‘,å¹¶åœ¨æœ¬åœ°ä¸ºå…¶åˆ›å»ºæ— äººä½¿ç”¨çš„ç¯å›æ¥å£ip,å°†å…¶è½¬å‘ä¸Šå»,å®ç°ç«¯å£çš„éš”ç¦»ã€‚\nåæ¥ä»£ç ç»è¿‡æˆ‘çš„ä¸€æ¬¡å¾ˆå¤§çš„é‡æ„,ç›®å‰çš„æµç¨‹æ˜¯åƒä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶å™¨ä¸€æ ·,åœ¨å¯åŠ¨æ—¶ListAndWatch api-serverçš„serviceä¿¡æ¯ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ„ŸçŸ¥api-serverçš„æœåŠ¡å˜åŒ–ï¼Œå½“æœåŠ¡è¢«åˆ›å»º/åˆ é™¤ï¼ŒæœåŠ¡è½¬å‘çš„podè¢«ä¿®æ”¹/åˆ é™¤æ—¶å¼€å¯å¯¹åº”çš„goroutineå¯¹å…¶è¿›è¡Œport-forwardå¹¶ä¿®æ”¹Hosts(è¿‡ç¨‹ä¸­åŠ é”).å½“kubefwdè¢«åœæ­¢æ—¶(æˆ–è€…æŸserviceè¢«åˆ é™¤æ—¶)å¯åŠ¨æ¸…ç†æµç¨‹ï¼Œç»“æŸè½¬å‘å¹¶æ¸…ç†hosts.\nå…¶å®åŸç†ä¸Šå¹¶ä¸å¤æ‚ï¼Œä½†ç¡®å®æ˜¯èƒ½åœ¨k8sç¯å¢ƒä¸­è§£å†³æŸä¸€ä¸ªæ–¹å‘ä¸Šçš„é—®é¢˜çš„ã€‚ æ¬¢è¿å¤§å®¶æ¥è¯•ç€ä½¿ç”¨ä½¿ç”¨ã€‚\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\n1 (2019-12-16 17:03) 1 ","date":"2019-12-10T00:00:00Z","permalink":"/posts/2019/12/2019-12-10-%E4%BD%BF%E7%94%A8kubefwd%E5%AF%B9k8s%E4%B8%AD%E7%9A%84service%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%B0%83%E8%AF%95/","title":"ä½¿ç”¨kubefwdå¯¹k8sä¸­çš„serviceè¿›è¡Œæœ¬åœ°åŒ–è°ƒè¯•"},{"content":"å¸¸è§çš„pythonæ’å…¥å…ƒç´ æ–¹å¼ä¸€èˆ¬æ˜¯insertæˆ–è€…æ‰‹åŠ¨æŒªåŠ¨åä¿®æ”¹å€¼,ç„¶åå…¶å®è¿˜æœ‰ç§æ¯”è¾ƒå°‘ç”¨çš„é€šè¿‡é›¶å®½åˆ‡ç‰‡æ’å…¥å…ƒç´ çš„æ–¹å¼,æ¯”è¾ƒæœ‰æ„æ€,éšä¾¿è®°å½•ä¸‹.\nPython 3.8.0 (v3.8.0:fa919fdf25, Oct 14 2019, 10:23:27) [Clang 6.0 (clang-600.0.57)] on darwin Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt; a = [1,2,3,4,5] \u0026gt;\u0026gt;\u0026gt; a[:0] = [0,0,0] \u0026gt;\u0026gt;\u0026gt; a [0, 0, 0, 1, 2, 3, 4, 5] \u0026gt;\u0026gt;\u0026gt; a[4:4] = [8,8,8,8,8,8] \u0026gt;\u0026gt;\u0026gt; a [0, 0, 0, 1, 8, 8, 8, 8, 8, 8, 2, 3, 4, 5] \u0026gt;\u0026gt;\u0026gt; a[4:8] = [] \u0026gt;\u0026gt;\u0026gt; a [0, 0, 0, 1, 8, 8, 2, 3, 4, 5] æ— æ­£æ–‡.\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\n_ (2019-10-30 19:30) a := int[]{1,2,3,4,5} b := int[]{0,0,0} c := make([]int, len(a)+len(b)) cnt := copy(c, b) copy(c[cnt:], a) fmt.Println(c) è·ŸPythonæ¯”èµ·æ¥ï¼ŒgoçœŸæ˜¯è ¢é€äº†, pythonçš„é›¶å®½åˆ‡ç‰‡æ’å…¥å…ƒç´ è·Ÿphpçš„array_splice()å‡½æ•°å¾ˆåƒ ","date":"2019-10-30T00:00:00Z","permalink":"/posts/2019/10/2019-10-30-python%E5%88%A9%E7%94%A8%E9%9B%B6%E5%AE%BD%E5%88%87%E7%89%87%E6%8F%92%E5%85%A5%E5%85%83%E7%B4%A0/","title":"pythonåˆ©ç”¨é›¶å®½åˆ‡ç‰‡æ’å…¥å…ƒç´ "},{"content":"åœ¨k8sç¯å¢ƒä¸­,æˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°å„ç§ç–‘éš¾æ‚ç—‡.æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­: æŸpodæ— æ³•å¯åŠ¨,æŸ¥çœ‹æ—¥å¿—æ˜¾ç¤ºåŸæ¥æ˜¯initæ—¶å®¹å™¨æ— æ³•æ‹‰å–æŸä¸ªå¤–éƒ¨ç½‘ç»œä¸Šçš„åŒ….æˆ‘ä»¬execç™»é™†å®¹å™¨åè¯•å›¾è°ƒè¯•ä¸‹äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŸå› ,æˆ‘ä»¬è¾“å…¥ping xxx.xxx.xxx,ä½†shç›´æ¥æç¤º\u0026quot;æ‰¾ä¸åˆ°pingå‘½ä»¤\u0026quot;,ç”šè‡³ç›´æ¥æ— æ³•execåˆ°ä¸€ä¸ªæ²¡æœ‰shçš„å®¹å™¨ä¸­. è¿™æ ·çš„æƒ…å†µæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªè§£å†³ç±»ä¼¼é—®é¢˜çš„è°ƒè¯•å·¥å…·kubectl-debug\nkubectl-debugçš„åŸç†ä¹Ÿå¾ˆç®€å•,å› ä¸ºdockerå®¹å™¨æ˜¯åŸºäºnamespaceåšçš„éš”ç¦»,æ‰€ä»¥å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„é¢„è£…å¥½äº†å„ç§è°ƒè¯•å·¥å…·çš„å®¹å™¨,ç›´æ¥åŠ å…¥å¾…è°ƒè¯•å®¹å™¨çš„namespaceä¸­,è¿™æ ·å°±å¯ä»¥ä¸å¾…è°ƒè¯•podå…±äº«å„ç±»æ ˆ,å®ç°æ–¹ä¾¿è°ƒè¯•.(æœ‰ç‚¹ç±»ä¼¼äºk8sä¸­çš„sidecarè®¾è®¡æ¨¡å¼,ä½†æ˜¯ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç”¨åæ—¢é”€çš„ç‹¬ç«‹å®¹å™¨)\nè¿™é‡Œä»‹ç»ä¸€ä¸‹ç®€å•çš„ä½¿ç”¨æ–¹å¼ æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶åŒ… https://github.com/aylei/kubectl-debug/releases ä¹Ÿå¯ä»¥cloneæºä»£ç è‡ªå·±åšç¼–è¯‘(å¯ä»¥è·å¾—æ›´å¤šæœ€æ–°ä¿®å¤å’Œæ›´æ–°)\n# è¿™é‡Œè¦å¼€å¯docker,å› ä¸ºæ˜¯é€šè¿‡dockerç¼–è¯‘çš„ git clone https://github.com/aylei/kubectl-debug.git cd kubectl-debug make æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼\nkubectl-debug POD_NAME kubectl-debugå°†æ‹‰å–nicolaka/netshooté•œåƒä½œä¸ºé»˜è®¤çš„debugé•œåƒ. è¿‡ä¸€å°ä¼šæ‹‰å–é•œåƒçš„åŠŸå¤«,æˆ‘ä»¬åˆ›å»ºå¥½äº†ä¸€ä¸ªæ’å…¥å¾…è°ƒè¯•pod namespaceä¸­çš„è°ƒè¯•å®¹å™¨,å¹¶ä¸”å·²ç»è·å–äº†stdinå’Œstdout,æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œè°ƒè¯•äº†. è°ƒè¯•å®Œæˆåexité€€å‡º,kubectl-debugå°†å®Œæˆç›¸å…³çš„æ¸…ç†å·¥ä½œ.\nå½“ç„¶,å¦‚æœè§‰å¾—é»˜è®¤çš„nicolaka/netshootè°ƒè¯•é•œåƒä¸å¥½ç”¨,ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç§æœ‰é•œåƒè¿›è¡Œè°ƒè¯•\n# ä½¿ç”¨ç§æœ‰ä»“åº“é•œåƒ,å¹¶è®¾ç½®ç§æœ‰ä»“åº“ä½¿ç”¨çš„kubernetes secret # secret dataåŸæ–‡è¯·è®¾ç½®ä¸º {Username: , Password: } # é»˜è®¤secret_nameä¸ºkubectl-debug-registry-secret,é»˜è®¤namspaceä¸ºdefault kubectl-debug POD_NAME --image calmkart/netshoot:latest --registry-secret-name --registry-secret-namespace ç”šè‡³å¦‚æœåŸpodå·²ç»æ— æ³•å¯åŠ¨äº†,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨forkæ¨¡å¼forkå‡ºä¸€ä¸ªæ–°çš„å¾…è°ƒè¯•podç”¨äºè°ƒè¯•(è‡ªåŠ¨æ›¿æ¢æ‰entry-point)\nkubectl debug POD_NAME --fork æ›´å¤šåŠŸèƒ½å¯ä»¥å‚è€ƒkubectl-debugå®˜æ–¹æ–‡æ¡£\næ€»ä¹‹è¿™ä¸ªå·¥å…·è¿˜æ˜¯éå¸¸å®ç”¨çš„,æˆ‘ä¹Ÿå‚ä¸æ·»åŠ äº†ä¸€äº›å¢å¼ºåŠŸèƒ½å’Œbugä¿®å¤.k8så®˜æ–¹æ®è¯´ä¹Ÿå°†åœ¨æœªæ¥ç‰ˆæœ¬å¢åŠ ä¸´æ—¶å®¹å™¨åŠŸèƒ½ä»¥æ”¯æŒè°ƒè¯•,è™½ç„¶ä¸çŸ¥é“å•¥æ—¶å€™èƒ½ç”¨ä¸Š,ä½†è¿˜æ˜¯æœŸå¾…çš„.\nå†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nmyway (2019-10-23 16:59) è¯·é—®ä¸‹å¦‚ä½•è°ƒè¯•ç”Ÿäº§ç¯å¢ƒçš„k8så‘¢ï¼Œç”¨kubectl-debugä¼šä¸ä¼šæœ‰ä»€ä¹ˆé£é™©ï¼Ÿ calmkart (2019-10-24 20:12) ä½ åªè¦ä¸ä¹±æï¼Œçœ‹ä¸å‡ºæœ‰å•¥é£é™©ã€‚ ä¹±æ,ex: 1.ä¹±ç»™forkpodæ‰“label 2.åœ¨debug containeré‡Œä¸€é¡¿ç¥æ“ä½œ ä¹‹ç±». ","date":"2019-10-21T00:00:00Z","permalink":"/posts/2019/10/2019-10-21-%E4%BD%BF%E7%94%A8kubectl-debug%E6%9D%A5%E8%B0%83%E8%AF%95pod/","title":"ä½¿ç”¨kubectl-debugæ¥è°ƒè¯•pod"},{"content":"è½¬ä¸€ä¸‹kubernetes contributionçš„github workflowï¼Œä¸ä»…ç”¨åœ¨k8sé‡Œï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨å…¶ä»–å„ä¸ªå¼€æºé¡¹ç›®ä¸Šï¼Œè´´å›¾å¤‡å¿˜ï¼Œæ— å†…å®¹\n","date":"2019-09-25T00:00:00Z","permalink":"/posts/2019/09/2019-09-25-kubetnetes-contribution-github-workflow/","title":"kubetnetes contribution github workflow"},{"content":"virt-manageræ˜¯ä¸€ä¸ªkvmçš„ç®¡ç†å·¥å…·ï¼Œåœ¨è‡ªå·±ç”¨çš„å°å‹ç¯å¢ƒé‡Œè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæˆ‘ä¹Ÿç”¨äº†æŒºä¹…ã€‚å› ä¸ºæ˜¯macæ‰€ä»¥æ˜¯ç”¨homebrew-virt-managerã€‚ä¹‹å‰ä¸€ç›´ç”¨çš„è€ç‰ˆæœ¬ï¼Œæœ€è¿‘macæ›´æ–°ï¼Œè€Œä¸”è€ç‰ˆæœ¬æœ‰å­˜å‚¨æ± æ— æ³•ä»/var/lib/libvirt/é‡Œåˆ‡æ¢çš„bugï¼Œæ‰€ä»¥é€šè¿‡brewæ›´æ–°åˆ°äº†æœ€æ–°çš„2.2.1ç‰ˆæœ¬ï¼Œå°±å‡ºç°äº† No module named \u0026rsquo;libxml2\u0026rsquo;Â çš„bugï¼Œé€šè¿‡googleå’Œå®˜æ–¹issueæ‰¾ä¸åˆ°è§£å†³åŠæ³•ï¼Œæœ€ç»ˆè‡ªå·±è§£å†³ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œæ–¹ä¾¿å…¶ä»–éœ€è¦çš„æœ‹å‹æŸ¥è¯¢ã€‚\nä¸»è¦çš„ç—‡çŠ¶æ˜¯brewå®‰è£…æˆ–è€…æ›´æ–°å®Œæˆhomebrew-virt-manageråï¼Œè¿è¡Œvirt-managerä¼šæ˜¾ç¤º\nFile \u0026#34;/usr/local/Cellar/virt-manager/2.2.1_2/libexec/share/virt-manager/virtinst/xmlapi.py\u0026#34;, line 7, in \u0026lt;module\u0026gt; import libxml2 ModuleNotFoundError: No module named \u0026#39;libxml2\u0026#39; åŸå› æ˜¯é»˜è®¤çš„åŒ…ä»python2å‡çº§åˆ°äº†python3ã€‚\næˆ‘ä»¬é¦–å…ˆå®‰è£…python3çš„libxml2åŒ…\npip3 install libxml2-python3 ç„¶åæŸ¥è¯¢å®‰è£…ä½ç½®\nâœ ~ python3 Python 3.7.1 (default, Nov 6 2018, 18:49:54) [Clang 9.0.0 (clang-900.0.39.2)] on darwin Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt; import libxml2 \u0026gt;\u0026gt;\u0026gt; print(libxml2.__file__) /usr/local/lib/python3.7/site-packages/libxml2.py ç„¶åå°†libxml2åŒ…å’Œç›¸å…³åŒ…ä»ç³»ç»Ÿpython3çš„é»˜è®¤site-packagesæ‹·è´åˆ°virt-managerçš„site-packagesä¸­å³å¯\nå‚è€ƒä¸Šé¢æ˜¾ç¤ºçš„è·¯å¾„ï¼Œæ—¢æ˜¯å°†\n/usr/local/lib/python3.7/site-packages/libxml*Â æ‹·è´åˆ°\n/usr/local/Cellar/virt-manager/2.2.1_2/libexec/lib/python3.7/site-packages\ncp -r /usr/local/lib/python3.7/site-packages/libxml* /usr/local/Cellar/virt-manager/2.2.1_2/libexec/lib/python3.7/site-packages TIPS:\n1ï¼Œæ³¨æ„è¦æ‹·è´libxml*è€Œä¸ä»…ä»…æ˜¯libxml2.pyï¼Œå› ä¸ºlibxml2è¿˜ä¾èµ–libxml2modã€‚æ‹·è´å°‘äº†è¿˜æ˜¯ä¼šæŠ¥æ‰¾ä¸åˆ°åŒ…ã€‚\n2ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†python3çš„packageæ·»åŠ åˆ°é»˜è®¤PYTHONPATHä¸­å»ï¼Œä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n3ï¼Œé¡ºä¾¿è®°å½•ä¸€ä¸ªvirt / virt-managerä½¿ç”¨çš„é—®é¢˜ï¼Œæ›´æ¢é»˜è®¤å­˜å‚¨æ± åæ–°å»ºçš„é»˜è®¤å­˜å‚¨æ± å¿…é¡»è®¾ç½®åç§°ä¸ºdefaultï¼Œä¸ç„¶ä¼šè‡ªåŠ¨åœ¨/var/lib/libvirt/ç›®å½•ä¸‹é‡å»ºé»˜è®¤å­˜å‚¨æ± \nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nhuku (2019-09-20 19:26) éå¸¸æ„Ÿè°¢ï¼Œå‰å‡ ä¸ªæœˆç¢°åˆ°åŒæ ·çš„é—®é¢˜äº†ï¼Œä¸€ç›´æ²¡æ‰¾åˆ°è§£å†³æ–¹æ³• ","date":"2019-09-19T00:00:00Z","permalink":"/posts/2019/09/2019-09-19-virt-manager-libxml2-module-bug%E8%A7%A3%E5%86%B3/","title":"virt-manager libxml2 module bugè§£å†³"},{"content":"æœ€è¿‘åœ¨è·Ÿç€ã€Šk8s-1.13ç‰ˆæœ¬æºç åˆ†æã€‹è¯»k8sæºç ï¼Œé¡ºç€æµç¨‹æŠŠschedulerè°ƒåº¦å™¨æ¨¡å—è¿‡äº†ä¸€éï¼Œæ–‡ä¸­æœ‰ä¸€å¹…k8sÂ schedulerè°ƒåº¦å™¨å·¥ä½œæµç¨‹å›¾ç”»çš„ä¸é”™ï¼Œè¿™é‡Œåšä¸ªè®°å½•å¤‡å¿˜ã€‚\n","date":"2019-09-18T00:00:00Z","permalink":"/posts/2019/09/2019-09-18-kubernetes-scheduler%E6%B5%81%E7%A8%8B%E5%9B%BE/","title":"kubernetes scheduleræµç¨‹å›¾"},{"content":"æˆ‘ä»¬åœ¨k8sé›†ç¾¤ä¸­ä½¿ç”¨äº‘åŸç”Ÿçš„promethuesé€šå¸¸éœ€è¦ç”¨åˆ°coreosçš„prometheus-operaterï¼Œå®ƒå¯ä»¥æ–¹ä¾¿çš„å¸®åŠ©æˆ‘ä»¬åœ¨k8sä¸­éƒ¨ç½²å’Œé…ç½®ä½¿ç”¨prometheusã€‚ä½†prometheuså¹¶ä¸æ˜¯å¼€ç®±å³ç”¨çš„ï¼Œå¦‚æœè¦åšåˆ°å¼€ç®±å³ç”¨çš„ç›‘æ§å…¨å®¶æ¡¶ï¼Œå®˜æ–¹æä¾›äº†ä¸¤ä¸ªé€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯prometheus-operater helm chartå’Œkube-prometheusã€‚è¿™ä¸¤è€…éƒ½å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›å¼€ç®±å³ç”¨çš„æ–¹å¼éƒ¨ç½²promethues+alertmanager+promethues-push-gateway(kube-promethueusä¸åŒ…å«,éœ€è¦å•ç‹¬éƒ¨ç½²)+grafanaå…¨å®¶æ¡¶ï¼ŒåŒæ—¶åŒ…å«kubernetes-mixinçš„ä¸€æ•´å¥—æŠ¥è­¦è§„åˆ™å’Œnode-exporterï¼Œkube-state-metricsç­‰ä¸€ç³»åˆ—metrics exporterã€‚åŒºåˆ«åœ¨äºhelm chartç”±ç¤¾åŒºç»´æŠ¤ï¼Œè€Œkube-promethuesç”±coreosç»´æŠ¤ã€‚è¿™é‡Œæˆ‘ä»¬å°†ä»¥kube-prometheusä¸ºä¾‹ï¼Œç®€è¦è¯´æ˜é…ç½®å’Œä½¿ç”¨æ–¹å¼ã€‚\né¦–å…ˆæ˜¯éƒ¨ç½²ï¼Œè¿˜æ˜¯éå¸¸ç®€å•çš„ï¼Œæˆ‘ä»¬å…ˆå°†kube-prometheusçš„ä»“åº“cloneä¸‹æ¥\ngit clone https://github.com/coreos/kube-prometheus.git ç„¶åæ ¹æ®å®˜æ–¹æ–‡æ¡£æ“ä½œå³å¯\n$ kubectl create -f manifests/ # It can take a few seconds for the above \u0026#39;create manifests\u0026#39; command to fully create the following resources, so verify the resources are ready before proceeding. $ until kubectl get customresourcedefinitions servicemonitors.monitoring.coreos.com ; do date; sleep 1; echo \u0026#34;\u0026#34;; done $ until kubectl get servicemonitors --all-namespaces ; do date; sleep 1; echo \u0026#34;\u0026#34;; done $ kubectl apply -f manifests/ # This command sometimes may need to be done twice (to workaround a race condition). è¿™é‡Œå°†è‡ªåŠ¨ä¸ºæˆ‘ä»¬éƒ¨ç½²prometheusï¼Œalertmanagerå’Œgrafanaã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡port-forwardä¹Ÿå¯ä»¥é€šè¿‡ingresså°†æœåŠ¡æš´éœ²å‡ºæ¥\nPrometheus $ kubectl --namespace monitoring port-forward svc/prometheus-k8s 9090 Then access via http://localhost:9090 Grafana $ kubectl --namespace monitoring port-forward svc/grafana 3000 Then access via http://localhost:3000 and use the default grafana user:password of admin:admin. Alert Manager $ kubectl --namespace monitoring port-forward svc/alertmanager-main 9093 Then access via http://localhost:9093 æˆ–è€…ç¼–å†™ingress\n# ingress-monitor.yaml apiVersion: extensions/v1beta1 kind: Ingress metadata: name: monitoring-ingress annotations: nginx.ingress.kubernetes.io/ssl-redirect: \u0026#34;false\u0026#34; namespace: monitoring spec: rules: - host: k8s-prometheus.calmkart.com http: paths: - path: / backend: serviceName: prometheus-k8s servicePort: 9090 - host: k8s-grafana.calmkart.com http: paths: - path: / backend: serviceName: grafana servicePort: 3000 - host: k8s-alertmanager.calmkart.com http: paths: - path: / backend: serviceName: alertmanager-main servicePort: 9093 # kubectl apply -f ingress-monitor.yaml ç„¶åæˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ°prometheus,alertmanagerå’Œgrafanaçš„æœåŠ¡é¡µé¢äº† è¿™é‡Œprometheuså·²ç»é›†æˆäº†ä¸€äº›k8sç›¸å…³çš„exporterå’Œkubernetes-mixinçš„æŠ¥è­¦è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥ä»prometheusçš„status-\u0026gt;ruleså’Œstatus-\u0026gt;targetä¸­æŸ¥çœ‹åˆ°ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éƒ¨ç½²push-gateway\n#å¯ä»¥å‚è€ƒæˆ‘è¿™é‡ŒNodePortçš„valueså‚æ•°,ä¹Ÿå¯ä»¥è‡ªè¡Œè®¾ç½® # values.yaml # Default values for prometheus-pushgateway. # This is a YAML-formatted file. # Declare variables to be passed into your templates. image: repository: prom/pushgateway tag: v0.9.0 pullPolicy: IfNotPresent service: type: NodePort port: 9091 targetPort: 9091 # Optional pod annotations podAnnotations: {} # Optional pod labels podLabels: {} # Optional service labels serviceLabels: {} # Optional serviceAccount labels serviceAccountLabels: {} # Optional additional arguments extraArgs: [] # Optional additional environment variables extraVars: [] resources: {} # We usually recommend not to specify default resources and to leave this as a conscious # choice for the user. This also increases chances charts run on environments with little # resources, such as Minikube. If you do want to specify resources, uncomment the following # lines, adjust them as necessary, and remove the curly braces after \u0026#39;resources:\u0026#39;. # limits: # cpu: 200m # memory: 50Mi # requests: # cpu: 100m # memory: 30Mi serviceAccount: # Specifies whether a ServiceAccount should be created create: true # The name of the ServiceAccount to use. # If not set and create is true, a name is generated using the fullname template name: ## Configure ingress resource that allow you to access the ## pushgateway installation. Set up the URL ## ref: http://kubernetes.io/docs/user-guide/ingress/ ## ingress: ## Enable Ingress. ## enabled: false ## Annotations. ## # annotations: # kubernetes.io/ingress.class: nginx # kubernetes.io/tls-acme: \u0026#39;true\u0026#39; ## Hostnames. ## Must be provided if Ingress is enabled. ## # hosts: # - pushgateway.domain.com ## TLS configuration. ## Secrets must be manually created in the namespace. ## # tls: # - secretName: pushgateway-tls # hosts: # - pushgateway.domain.com tolerations: {} # - effect: NoSchedule # operator: Exists ## Node labels for pushgateway pod assignment ## Ref: https://kubernetes.io/docs/user-guide/node-selection/ ## nodeSelector: {} replicaCount: 1 ## Affinity for pod assignment ## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity affinity: {} # Enable this if you\u0026#39;re using https://github.com/coreos/prometheus-operator serviceMonitor: enabled: true namespace: monitoring # fallback to the prometheus default unless specified # interval: 10s ## Defaults to what\u0026#39;s used if you follow CoreOS [Prometheus Install Instructions](https://github.com/helm/charts/tree/master/stable/prometheus-operator#tldr) ## [Prometheus Selector Label](https://github.com/helm/charts/tree/master/stable/prometheus-operator#prometheus-operator-1) ## [Kube Prometheus Selector Label](https://github.com/helm/charts/tree/master/stable/prometheus-operator#exporters) selector: prometheus: kube-prometheus # Retain the job and instance labels of the metrics pushed to the Pushgateway # [Scraping Pushgateway](https://github.com/prometheus/pushgateway#configure-the-pushgateway-as-a-target-to-scrape) honorLabels: true # The values to set in the PodDisruptionBudget spec (minAvailable/maxUnavailable) # If not set then a PodDisruptionBudget will not be created podDisruptionBudget: # helm install --name push-gateway -f values.yaml stable/prometheus-pushgateway ç„¶åæˆ‘ä»¬æ¥è¯•ç€æ¥å…¥å†…éƒ¨å’Œå¤–éƒ¨çš„prometheusç›‘æ§target.\n1.å®ç°æ¥å…¥å†…éƒ¨çš„target æ— è®ºæ˜¯å¤–éƒ¨æˆ–å†…éƒ¨çš„targetéƒ½éœ€è¦ä¸€ä¸ªmetrics-serverç›®æ ‡ï¼Œå¯¹äºå†…éƒ¨targetè€Œè¨€ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œæ¯”å¦‚æœåŠ¡calm-server åœ¨prometheus-operaterçš„ä½¿ç”¨æ–¹å¼ä¸­ï¼Œæœ‰ä¸€ä¸ªcrdå«serviceMonitorï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„serviceMonitorå°±åˆ›å»ºäº†ä¸€ä¸ªprometheusçš„target æˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹monitoringå‘½åç©ºé—´ä¸­å·²æœ‰çš„serviceMonitor(æ—¢prometheus target)\n[xxx@xxxxx]# kubectl get servicemonitors.monitoring.coreos.com -n monitoring NAME AGE alertmanager 23d coredns 23d grafana 23d ingress-nginx 17d kube-apiserver 23d kube-controller-manager 23d kube-scheduler 23d kube-state-metrics 23d kubelet 23d node-exporter 23d prometheus 23d prometheus-operator 23d prometheus-pushgateway 19d æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„serviceMonitor,å°†calm-serverçš„/metricsä½œä¸ºtarget # calm-server-serviceMonitor.yaml\napiVersion: monitoring.coreos.com/v1 kind: ServiceMonitor metadata: name: calm-server-metrics labels: k8s-app: calm-server-metrics namespace: monitoring spec: namespaceSelector: any: true selector: matchLabels: app: calm-server endpoints: - port: web interval: 10s honorLabels: true # kubectl apply -f calm-server-serviceMonitor.yaml è¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„tips:\n1.å¦‚æœserviceå’Œprometheusä¸å†åŒä¸€ä¸ªå‘½åç©ºé—´ï¼Œéœ€è¦è®¾ç½®namespaceSelectorï¼Œå¯ä»¥å•ç‹¬è®¾ç½®éœ€è¦æœç´¢çš„namespaceï¼Œä¹Ÿå¯ä»¥åƒä¸Šé¢é‚£æ ·è®¾ç½®ä¸ºå…¨å±€æœç´¢ã€‚\n2.å…¶æ¬¡ï¼Œendpointsä¸­è®¾ç½®çš„portä¼šæŒ‰ç…§intervalè®¾ç½®çš„æ—¶é—´å®šæ—¶å»:/metricsæ‹‰å–æ•°æ®ï¼Œæ‰€ä»¥å¯¹åº”çš„æœåŠ¡éœ€è¦æä¾›ç›¸åº”çš„metrics(å®˜æ–¹æœ‰éå¸¸å¤šçš„exporteræä¾›ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒhttps://prometheus.io/docs/instrumenting/exporters/)\næˆ‘ä»¬æ¥ä¸‹æ¥å†æŸ¥çœ‹æ‰€æœ‰serviceMonitor crd apiå¯¹è±¡ï¼Œå°±ä¼šå‘ç°åˆ›å»ºæˆåŠŸï¼ŒåŒæ—¶prometheusçš„state-\u0026gt;targetä¸­ä¹Ÿä¼šå‡ºç°å¯¹åº”çš„targetï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨prometheusä¸­æŸ¥è¯¢åˆ°å¯¹åº”çš„æ•°æ®äº†ã€‚\n2.å®ç°æ¥å…¥å¤–éƒ¨target å®ç°äº†æ¥å…¥å†…éƒ¨çš„targetï¼Œé‚£ä¹ˆï¼Œk8sé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡æƒ³è¦æ¥å…¥è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå½“ç„¶è¿˜æ˜¯é€šè¿‡ç›‘æ§k8sé›†ç¾¤å†…serviceçš„æ–¹å¼ï¼Œä¸æ˜¯serviceå¯¹åº”çš„æ˜¯ä¸€ä¸ªå¤–éƒ¨çš„endpointå¯¹è±¡ã€‚ä¸‹é¢æˆ‘ä»¬å°†ä»¥calm-serveræœåŠ¡ä¸ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•é€šè¿‡k8sçš„endpointå¤–éƒ¨å¯¹è±¡æ¥å…¥å¤–éƒ¨targetç›‘æ§ã€‚ é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªendpointå¯¹è±¡\n# calm-server-endpoint.yaml apiVersion: v1 kind: Endpoints metadata: name: calm-server-metrics subsets: - addresses: - ip: x.x.x.x ports: - name: metrics port: xxxx protocol: TCP # kubectl apply -f calm-server-endpoint.yaml æˆ‘ä»¬å°†ipå’Œportæ›¿æ¢æˆæˆ‘ä»¬çš„å¤–éƒ¨æœåŠ¡ï¼Œapplyåå°±åˆ›å»ºäº†ä¸€ä¸ªendpoint apiå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡kubectl get endpointsæŸ¥çœ‹\n[xxx@xxxxxxx]# kubectl get endpoints NAME ENDPOINTS AGE calm-server-metrics 10.41.13.17:6789 19d kubernetes 10.1.33.159:6443 92d push-gateway-prometheus-pushgateway 10.240.224.15:9091 19d è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯,endpointå¯¹è±¡æ˜¯ä¸åŒºåˆ†namespacesçš„ æ¥ç€ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªserviceï¼Œserviceçš„é€‰æ‹©å™¨é€‰æ‹©calm-server-metricsè¿™ä¸ªå¤–éƒ¨endpoint\n# calm-server-metrics-service.yaml apiVersion: v1 kind: Service metadata: name: calm-server-metrics labels: app: calm-server-metrics spec: type: ExternalName externalName: x.x.x.x clusterIP: \u0026#34;\u0026#34; ports: - name: metrics port: xxxx protocol: TCP targetPort: 6789 # kubectl apply -f calm-server-metrics-service.yaml æˆ‘ä»¬è¿™ä¸ªæ—¶å€™è®¿é—®è¿™ä¸ªæœåŠ¡ï¼Œå°±ç­‰äºè®¿é—®äº†å¤–éƒ¨çš„endpointï¼Œæ—¢å¤–éƒ¨æœåŠ¡ æˆ‘ä»¬å°±å¯ä»¥åƒä¸Šé¢åˆ›å»ºå†…éƒ¨æœåŠ¡çš„serviceMonitorä¸€æ ·ï¼Œåˆ›å»ºserviceMonitor apiå¯¹è±¡ä»è€Œæ›´æ–°prometheus targetåˆ—è¡¨äº†ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ä¿®æ”¹è¿™ä¸€ç³»åˆ—å…¨å®¶æ¡¶çš„é…ç½®å‘¢?æ¯”å¦‚prometheusçš„é…ç½®ï¼Œgrafanaçš„é…ç½®ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹smtpæŠ¥è­¦é…ç½®è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚æœæ˜¯éäº‘åŸç”Ÿç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ï¼Œä½†åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸­ä¸ä¸€æ ·ã€‚\nkube-prometheuså®˜æ–¹æ–‡æ¡£æ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨jsonnetå¯¹å®˜æ–¹åº“åšç¼–è¯‘ä¿®æ”¹ã€‚é‚£ä¹ˆå¦‚ä½•ç›´æ¥é€šè¿‡ä¿®æ”¹yamlçš„æ–¹å¼ä¿®æ”¹é…ç½®æ–‡ä»¶å‘¢ï¼Ÿä¸‹é¢å°†åˆ†åˆ«ä»‹ç»å¦‚ä½•ä¿®æ”¹å…¨å®¶æ¡¶ä¸­çš„å„ä¸ªé…ç½®æ–‡ä»¶ã€‚\n1.é¦–å…ˆæ˜¯prometheusçš„alert rulesï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹prometheus-rules.yamlæ–‡ä»¶ä¿®æ”¹ã€‚ 2.å…¶æ¬¡æ˜¯alertmanagerçš„config,æˆ‘ä»¬å¯ä»¥ä¿®æ”¹alertmanager-secret.yamlæ–‡ä»¶,æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªsecretå¯¹è±¡ï¼Œå†…å®¹ç»è¿‡äº†base64åŠ å¯†ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆå°†å†…å®¹è§£å¯†å†åšä¿®æ”¹ï¼Œä¿®æ”¹åå†åŠ å¯†æ›¿æ¢å³å¯ã€‚ 3.æœ€åæ˜¯grafanaçš„é…ç½®ä¿®æ”¹ï¼Œå‚è€ƒäº†grafanaå®˜æ–¹çš„docker imageä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä¿®æ”¹grafana-deployment.yamlæ–‡ä»¶ï¼Œä¸ºå…¶å¢åŠ ä¸€ä¸ªvolume,é…ç½®å¦‚ä¸‹\napiVersion: apps/v1beta2 kind: Deployment metadata: labels: app: grafana name: grafana namespace: monitoring spec: replicas: 1 selector: matchLabels: app: grafana template: metadata: labels: app: grafana spec: containers: - image: grafana/grafana:6.2.2 name: grafana ports: - containerPort: 3000 name: http readinessProbe: httpGet: path: /api/health port: http resources: limits: cpu: 200m memory: 200Mi requests: cpu: 100m memory: 100Mi volumeMounts: - mountPath: /var/lib/grafana name: grafana-storage readOnly: false - mountPath: /etc/grafana/provisioning/datasources name: grafana-datasources readOnly: false - mountPath: /etc/grafana/provisioning/dashboards name: grafana-dashboards readOnly: false - mountPath: /grafana-dashboard-definitions/0/apiserver name: grafana-dashboard-apiserver readOnly: false - mountPath: /grafana-dashboard-definitions/0/controller-manager name: grafana-dashboard-controller-manager readOnly: false - mountPath: /grafana-dashboard-definitions/0/k8s-cluster-rsrc-use name: grafana-dashboard-k8s-cluster-rsrc-use readOnly: false - mountPath: /grafana-dashboard-definitions/0/k8s-node-rsrc-use name: grafana-dashboard-k8s-node-rsrc-use readOnly: false - mountPath: /grafana-dashboard-definitions/0/k8s-resources-cluster name: grafana-dashboard-k8s-resources-cluster readOnly: false - mountPath: /grafana-dashboard-definitions/0/k8s-resources-namespace name: grafana-dashboard-k8s-resources-namespace readOnly: false - mountPath: /grafana-dashboard-definitions/0/k8s-resources-pod name: grafana-dashboard-k8s-resources-pod readOnly: false - mountPath: /grafana-dashboard-definitions/0/k8s-resources-workload name: grafana-dashboard-k8s-resources-workload readOnly: false - mountPath: /grafana-dashboard-definitions/0/k8s-resources-workloads-namespace name: grafana-dashboard-k8s-resources-workloads-namespace readOnly: false - mountPath: /grafana-dashboard-definitions/0/kubelet name: grafana-dashboard-kubelet readOnly: false - mountPath: /grafana-dashboard-definitions/0/nodes name: grafana-dashboard-nodes readOnly: false - mountPath: /grafana-dashboard-definitions/0/persistentvolumesusage name: grafana-dashboard-persistentvolumesusage readOnly: false - mountPath: /grafana-dashboard-definitions/0/pods name: grafana-dashboard-pods readOnly: false - mountPath: /grafana-dashboard-definitions/0/prometheus-remote-write name: grafana-dashboard-prometheus-remote-write readOnly: false - mountPath: /grafana-dashboard-definitions/0/prometheus name: grafana-dashboard-prometheus readOnly: false - mountPath: /grafana-dashboard-definitions/0/proxy name: grafana-dashboard-proxy readOnly: false - mountPath: /grafana-dashboard-definitions/0/scheduler name: grafana-dashboard-scheduler readOnly: false - mountPath: /grafana-dashboard-definitions/0/statefulset name: grafana-dashboard-statefulset readOnly: false - mountPath: /etc/grafana name: config-custom nodeSelector: beta.kubernetes.io/os: linux securityContext: runAsNonRoot: true runAsUser: 65534 serviceAccountName: grafana volumes: - emptyDir: {} name: grafana-storage - name: grafana-datasources secret: secretName: grafana-datasources - configMap: name: grafana-dashboards name: grafana-dashboards - configMap: name: grafana-dashboard-apiserver name: grafana-dashboard-apiserver - configMap: name: grafana-dashboard-controller-manager name: grafana-dashboard-controller-manager - configMap: name: grafana-dashboard-k8s-cluster-rsrc-use name: grafana-dashboard-k8s-cluster-rsrc-use - configMap: name: grafana-dashboard-k8s-node-rsrc-use name: grafana-dashboard-k8s-node-rsrc-use - configMap: name: grafana-dashboard-k8s-resources-cluster name: grafana-dashboard-k8s-resources-cluster - configMap: name: grafana-dashboard-k8s-resources-namespace name: grafana-dashboard-k8s-resources-namespace - configMap: name: grafana-dashboard-k8s-resources-pod name: grafana-dashboard-k8s-resources-pod - configMap: name: grafana-dashboard-k8s-resources-workload name: grafana-dashboard-k8s-resources-workload - configMap: name: grafana-dashboard-k8s-resources-workloads-namespace name: grafana-dashboard-k8s-resources-workloads-namespace - configMap: name: grafana-dashboard-kubelet name: grafana-dashboard-kubelet - configMap: name: grafana-dashboard-nodes name: grafana-dashboard-nodes - configMap: name: grafana-dashboard-persistentvolumesusage name: grafana-dashboard-persistentvolumesusage - configMap: name: grafana-dashboard-pods name: grafana-dashboard-pods - configMap: name: grafana-dashboard-prometheus-remote-write name: grafana-dashboard-prometheus-remote-write - configMap: name: grafana-dashboard-prometheus name: grafana-dashboard-prometheus - configMap: name: grafana-dashboard-proxy name: grafana-dashboard-proxy - configMap: name: grafana-dashboard-scheduler name: grafana-dashboard-scheduler - configMap: name: grafana-dashboard-statefulset name: grafana-dashboard-statefulset - configMap: name: grafana-config name: config-custom å…¶å®å°±æ˜¯å°†ä¸€ä¸ªå«grafana-configçš„configMapä½œä¸ºvolumeMountåˆ°/etc/grafanaä¸‹ã€‚ ç„¶åæˆ‘ä»¬åˆ›å»ºè¿™ä¸ªconfigMap\n# grafana-configmap.yaml apiVersion: v1 kind: ConfigMap metadata: name: grafana-config namespace: monitoring data: grafana.ini: | [smtp] enabled = true host = smtp.calmkart.com:465 user = calmkart@calmkart.com password = xxxxxxxxxx skip_verify = false from_address = calmkart@calmkart.com from_name = grafana # kubectl apply -f grafana-configmap.yaml è¿™æ ·å°±å¯ä»¥æ›¿æ¢æ‰é»˜è®¤çš„é…ç½®æ–‡ä»¶äº†ã€‚\nå¦å¤–è¿˜æœ‰å…³äºå¦‚ä½•ä¸ºgrafanaå¢åŠ pluginç­‰ç­‰è¯é¢˜ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„ç›¸å…³èµ„æ–™ã€‚ å°±ç®€å•ä»‹ç»åˆ°è¿™é‡Œå§ã€‚\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\næ›°..æ›° (2019-08-26 19:35) ç‰›é€¼çš„å½­è‘£ï¼Œç¢¾å‹æˆ‘ç­‰åº•å±‚åŠ³è‹¦å¤§ä¼—ï¼Œæˆ‘æ˜¯æœçš„ ","date":"2019-08-22T00:00:00Z","permalink":"/posts/2019/08/2019-08-22-%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8kube-prometheus/","title":"é…ç½®å’Œä½¿ç”¨kube-prometheus"},{"content":"grafanaçš„å®˜æ–¹æœ‰å¾ˆå¤šç”¨æˆ·æä¾›çš„dashboardæ ·æœ¬,å…¶ä¸­å…³äºdjangoçš„æœ‰\nhttps://grafana.com/grafana/dashboards/9528\nå¯¹åº”çš„django-metricæ˜¯https://github.com/korfuri/django-prometheus/\nä½†æ˜¯è¿™ä¸ªdashboardçš„é¡µé¢æ˜¯æœ‰é—®é¢˜çš„ã€‚é¡µé¢çš„é€‰æ‹©å™¨é€‰æ‹©çš„labelæ˜¯appï¼Œä½†æ˜¯prometheusé‡‡é›†åˆ°çš„metric labelæ˜¯serviceå’Œjobã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠdashboard jsonåšä¸€ä¸‹ä¿®æ”¹ã€‚\nä¿®æ”¹åçš„dashboard jsonå¦‚ä¸‹\n{ \u0026#34;annotations\u0026#34;: { \u0026#34;list\u0026#34;: [ { \u0026#34;builtIn\u0026#34;: 1, \u0026#34;datasource\u0026#34;: \u0026#34;-- Grafana --\u0026#34;, \u0026#34;enable\u0026#34;: true, \u0026#34;hide\u0026#34;: true, \u0026#34;iconColor\u0026#34;: \u0026#34;rgba(0, 211, 255, 1)\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Annotations \u0026amp; Alerts\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;dashboard\u0026#34; } ] }, \u0026#34;description\u0026#34;: \u0026#34;Django metrics dashboard using korfuri/django-prometheus Prometheus metrics exporter\u0026#34;, \u0026#34;editable\u0026#34;: true, \u0026#34;gnetId\u0026#34;: 9528, \u0026#34;graphTooltip\u0026#34;: 0, \u0026#34;id\u0026#34;: 21, \u0026#34;iteration\u0026#34;: 1565764572579, \u0026#34;links\u0026#34;: [], \u0026#34;panels\u0026#34;: [ { \u0026#34;cacheTimeout\u0026#34;: null, \u0026#34;colorBackground\u0026#34;: false, \u0026#34;colorValue\u0026#34;: false, \u0026#34;colors\u0026#34;: [ \u0026#34;#299c46\u0026#34;, \u0026#34;rgba(237, 129, 40, 0.89)\u0026#34;, \u0026#34;#d44a3a\u0026#34; ], \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;increase(v range-vector) calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. The increase is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if a counter increases only by integer increments.\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;gauge\u0026#34;: { \u0026#34;maxValue\u0026#34;: 100, \u0026#34;minValue\u0026#34;: 0, \u0026#34;show\u0026#34;: false, \u0026#34;thresholdLabels\u0026#34;: false, \u0026#34;thresholdMarkers\u0026#34;: true }, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 2, \u0026#34;w\u0026#34;: 12, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 0 }, \u0026#34;id\u0026#34;: 13, \u0026#34;interval\u0026#34;: null, \u0026#34;links\u0026#34;: [], \u0026#34;mappingType\u0026#34;: 1, \u0026#34;mappingTypes\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;value to text\u0026#34;, \u0026#34;value\u0026#34;: 1 }, { \u0026#34;name\u0026#34;: \u0026#34;range to text\u0026#34;, \u0026#34;value\u0026#34;: 2 } ], \u0026#34;maxDataPoints\u0026#34;: 100, \u0026#34;nullPointMode\u0026#34;: \u0026#34;connected\u0026#34;, \u0026#34;nullText\u0026#34;: null, \u0026#34;options\u0026#34;: {}, \u0026#34;postfix\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;postfixFontSize\u0026#34;: \u0026#34;50%\u0026#34;, \u0026#34;prefix\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;prefixFontSize\u0026#34;: \u0026#34;50%\u0026#34;, \u0026#34;rangeMaps\u0026#34;: [ { \u0026#34;from\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;N/A\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;null\u0026#34; } ], \u0026#34;sparkline\u0026#34;: { \u0026#34;fillColor\u0026#34;: \u0026#34;rgba(31, 118, 189, 0.18)\u0026#34;, \u0026#34;full\u0026#34;: false, \u0026#34;lineColor\u0026#34;: \u0026#34;rgb(31, 120, 193)\u0026#34;, \u0026#34;show\u0026#34;: false }, \u0026#34;tableColumn\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_http_requests_total_by_transport_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;}[1m]))\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;thresholds\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Total Requests\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;singlestat\u0026#34;, \u0026#34;valueFontSize\u0026#34;: \u0026#34;80%\u0026#34;, \u0026#34;valueMaps\u0026#34;: [ { \u0026#34;op\u0026#34;: \u0026#34;=\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;N/A\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;null\u0026#34; } ], \u0026#34;valueName\u0026#34;: \u0026#34;avg\u0026#34; }, { \u0026#34;cacheTimeout\u0026#34;: null, \u0026#34;colorBackground\u0026#34;: false, \u0026#34;colorValue\u0026#34;: false, \u0026#34;colors\u0026#34;: [ \u0026#34;#629e51\u0026#34;, \u0026#34;rgba(237, 129, 40, 0.89)\u0026#34;, \u0026#34;#d44a3a\u0026#34; ], \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;gauge\u0026#34;: { \u0026#34;maxValue\u0026#34;: 100, \u0026#34;minValue\u0026#34;: 0, \u0026#34;show\u0026#34;: false, \u0026#34;thresholdLabels\u0026#34;: false, \u0026#34;thresholdMarkers\u0026#34;: true }, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 2, \u0026#34;w\u0026#34;: 4, \u0026#34;x\u0026#34;: 12, \u0026#34;y\u0026#34;: 0 }, \u0026#34;id\u0026#34;: 15, \u0026#34;interval\u0026#34;: null, \u0026#34;links\u0026#34;: [], \u0026#34;mappingType\u0026#34;: 1, \u0026#34;mappingTypes\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;value to text\u0026#34;, \u0026#34;value\u0026#34;: 1 }, { \u0026#34;name\u0026#34;: \u0026#34;range to text\u0026#34;, \u0026#34;value\u0026#34;: 2 } ], \u0026#34;maxDataPoints\u0026#34;: 100, \u0026#34;nullPointMode\u0026#34;: \u0026#34;connected\u0026#34;, \u0026#34;nullText\u0026#34;: null, \u0026#34;options\u0026#34;: {}, \u0026#34;postfix\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;postfixFontSize\u0026#34;: \u0026#34;50%\u0026#34;, \u0026#34;prefix\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;prefixFontSize\u0026#34;: \u0026#34;50%\u0026#34;, \u0026#34;rangeMaps\u0026#34;: [ { \u0026#34;from\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;N/A\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;null\u0026#34; } ], \u0026#34;sparkline\u0026#34;: { \u0026#34;fillColor\u0026#34;: \u0026#34;rgba(31, 118, 189, 0.18)\u0026#34;, \u0026#34;full\u0026#34;: false, \u0026#34;lineColor\u0026#34;: \u0026#34;rgb(31, 120, 193)\u0026#34;, \u0026#34;show\u0026#34;: false }, \u0026#34;tableColumn\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_http_responses_total_by_status_total{status=~\\\u0026#34;2.+\\\u0026#34;,namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;}[1m]))\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;thresholds\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;2XX Responses\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;singlestat\u0026#34;, \u0026#34;valueFontSize\u0026#34;: \u0026#34;80%\u0026#34;, \u0026#34;valueMaps\u0026#34;: [ { \u0026#34;op\u0026#34;: \u0026#34;=\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;N/A\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;null\u0026#34; } ], \u0026#34;valueName\u0026#34;: \u0026#34;avg\u0026#34; }, { \u0026#34;cacheTimeout\u0026#34;: null, \u0026#34;colorBackground\u0026#34;: false, \u0026#34;colorValue\u0026#34;: false, \u0026#34;colors\u0026#34;: [ \u0026#34;#299c46\u0026#34;, \u0026#34;rgba(237, 129, 40, 0.89)\u0026#34;, \u0026#34;#d44a3a\u0026#34; ], \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;gauge\u0026#34;: { \u0026#34;maxValue\u0026#34;: 100, \u0026#34;minValue\u0026#34;: 0, \u0026#34;show\u0026#34;: false, \u0026#34;thresholdLabels\u0026#34;: false, \u0026#34;thresholdMarkers\u0026#34;: true }, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 2, \u0026#34;w\u0026#34;: 4, \u0026#34;x\u0026#34;: 16, \u0026#34;y\u0026#34;: 0 }, \u0026#34;id\u0026#34;: 16, \u0026#34;interval\u0026#34;: null, \u0026#34;links\u0026#34;: [], \u0026#34;mappingType\u0026#34;: 1, \u0026#34;mappingTypes\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;value to text\u0026#34;, \u0026#34;value\u0026#34;: 1 }, { \u0026#34;name\u0026#34;: \u0026#34;range to text\u0026#34;, \u0026#34;value\u0026#34;: 2 } ], \u0026#34;maxDataPoints\u0026#34;: 100, \u0026#34;nullPointMode\u0026#34;: \u0026#34;connected\u0026#34;, \u0026#34;nullText\u0026#34;: null, \u0026#34;options\u0026#34;: {}, \u0026#34;postfix\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;postfixFontSize\u0026#34;: \u0026#34;50%\u0026#34;, \u0026#34;prefix\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;prefixFontSize\u0026#34;: \u0026#34;50%\u0026#34;, \u0026#34;rangeMaps\u0026#34;: [ { \u0026#34;from\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;N/A\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;null\u0026#34; } ], \u0026#34;sparkline\u0026#34;: { \u0026#34;fillColor\u0026#34;: \u0026#34;rgba(31, 118, 189, 0.18)\u0026#34;, \u0026#34;full\u0026#34;: false, \u0026#34;lineColor\u0026#34;: \u0026#34;rgb(31, 120, 193)\u0026#34;, \u0026#34;show\u0026#34;: false }, \u0026#34;tableColumn\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_http_responses_total_by_status_total{status=~\\\u0026#34;4.+\\\u0026#34;,namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;}[1m]))\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;thresholds\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;4XX Responses\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;singlestat\u0026#34;, \u0026#34;valueFontSize\u0026#34;: \u0026#34;80%\u0026#34;, \u0026#34;valueMaps\u0026#34;: [ { \u0026#34;op\u0026#34;: \u0026#34;=\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;N/A\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;null\u0026#34; } ], \u0026#34;valueName\u0026#34;: \u0026#34;avg\u0026#34; }, { \u0026#34;cacheTimeout\u0026#34;: null, \u0026#34;colorBackground\u0026#34;: false, \u0026#34;colorValue\u0026#34;: false, \u0026#34;colors\u0026#34;: [ \u0026#34;#299c46\u0026#34;, \u0026#34;rgba(237, 129, 40, 0.89)\u0026#34;, \u0026#34;#d44a3a\u0026#34; ], \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;gauge\u0026#34;: { \u0026#34;maxValue\u0026#34;: 100, \u0026#34;minValue\u0026#34;: 0, \u0026#34;show\u0026#34;: false, \u0026#34;thresholdLabels\u0026#34;: false, \u0026#34;thresholdMarkers\u0026#34;: true }, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 2, \u0026#34;w\u0026#34;: 4, \u0026#34;x\u0026#34;: 20, \u0026#34;y\u0026#34;: 0 }, \u0026#34;id\u0026#34;: 17, \u0026#34;interval\u0026#34;: null, \u0026#34;links\u0026#34;: [], \u0026#34;mappingType\u0026#34;: 1, \u0026#34;mappingTypes\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;value to text\u0026#34;, \u0026#34;value\u0026#34;: 1 }, { \u0026#34;name\u0026#34;: \u0026#34;range to text\u0026#34;, \u0026#34;value\u0026#34;: 2 } ], \u0026#34;maxDataPoints\u0026#34;: 100, \u0026#34;nullPointMode\u0026#34;: \u0026#34;connected\u0026#34;, \u0026#34;nullText\u0026#34;: null, \u0026#34;options\u0026#34;: {}, \u0026#34;postfix\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;postfixFontSize\u0026#34;: \u0026#34;50%\u0026#34;, \u0026#34;prefix\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;prefixFontSize\u0026#34;: \u0026#34;50%\u0026#34;, \u0026#34;rangeMaps\u0026#34;: [ { \u0026#34;from\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;N/A\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;null\u0026#34; } ], \u0026#34;sparkline\u0026#34;: { \u0026#34;fillColor\u0026#34;: \u0026#34;rgba(31, 118, 189, 0.18)\u0026#34;, \u0026#34;full\u0026#34;: false, \u0026#34;lineColor\u0026#34;: \u0026#34;rgb(31, 120, 193)\u0026#34;, \u0026#34;show\u0026#34;: false }, \u0026#34;tableColumn\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_http_responses_total_by_status_total{status=~\\\u0026#34;5.+\\\u0026#34;,namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;}[1m]))\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;thresholds\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;5XX Responses\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;singlestat\u0026#34;, \u0026#34;valueFontSize\u0026#34;: \u0026#34;80%\u0026#34;, \u0026#34;valueMaps\u0026#34;: [ { \u0026#34;op\u0026#34;: \u0026#34;=\u0026#34;, \u0026#34;text\u0026#34;: \u0026#34;N/A\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;null\u0026#34; } ], \u0026#34;valueName\u0026#34;: \u0026#34;avg\u0026#34; }, { \u0026#34;aliasColors\u0026#34;: {}, \u0026#34;bars\u0026#34;: false, \u0026#34;dashLength\u0026#34;: 10, \u0026#34;dashes\u0026#34;: false, \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;fill\u0026#34;: 1, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 12, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 2 }, \u0026#34;id\u0026#34;: 2, \u0026#34;legend\u0026#34;: { \u0026#34;avg\u0026#34;: false, \u0026#34;current\u0026#34;: false, \u0026#34;max\u0026#34;: false, \u0026#34;min\u0026#34;: false, \u0026#34;show\u0026#34;: true, \u0026#34;total\u0026#34;: false, \u0026#34;values\u0026#34;: false }, \u0026#34;lines\u0026#34;: true, \u0026#34;linewidth\u0026#34;: 1, \u0026#34;links\u0026#34;: [], \u0026#34;nullPointMode\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;options\u0026#34;: {}, \u0026#34;percentage\u0026#34;: false, \u0026#34;pointradius\u0026#34;: 5, \u0026#34;points\u0026#34;: false, \u0026#34;renderer\u0026#34;: \u0026#34;flot\u0026#34;, \u0026#34;seriesOverrides\u0026#34;: [], \u0026#34;spaceLength\u0026#34;: 10, \u0026#34;stack\u0026#34;: false, \u0026#34;steppedLine\u0026#34;: false, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_http_requests_total_by_view_transport_method_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;,view!~\\\u0026#34;prometheus-django-metrics|healthcheck\\\u0026#34;}[1m])) by(method, view)\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;{{method}} /{{view}}\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;thresholds\u0026#34;: [], \u0026#34;timeFrom\u0026#34;: null, \u0026#34;timeRegions\u0026#34;: [], \u0026#34;timeShift\u0026#34;: null, \u0026#34;title\u0026#34;: \u0026#34;Requests\u0026#34;, \u0026#34;tooltip\u0026#34;: { \u0026#34;shared\u0026#34;: true, \u0026#34;sort\u0026#34;: 0, \u0026#34;value_type\u0026#34;: \u0026#34;individual\u0026#34; }, \u0026#34;type\u0026#34;: \u0026#34;graph\u0026#34;, \u0026#34;xaxis\u0026#34;: { \u0026#34;buckets\u0026#34;: null, \u0026#34;mode\u0026#34;: \u0026#34;time\u0026#34;, \u0026#34;name\u0026#34;: null, \u0026#34;show\u0026#34;: true, \u0026#34;values\u0026#34;: [] }, \u0026#34;yaxes\u0026#34;: [ { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true }, { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true } ], \u0026#34;yaxis\u0026#34;: { \u0026#34;align\u0026#34;: false, \u0026#34;alignLevel\u0026#34;: null } }, { \u0026#34;aliasColors\u0026#34;: {}, \u0026#34;bars\u0026#34;: false, \u0026#34;dashLength\u0026#34;: 10, \u0026#34;dashes\u0026#34;: false, \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;fill\u0026#34;: 1, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 12, \u0026#34;x\u0026#34;: 12, \u0026#34;y\u0026#34;: 2 }, \u0026#34;id\u0026#34;: 4, \u0026#34;legend\u0026#34;: { \u0026#34;avg\u0026#34;: false, \u0026#34;current\u0026#34;: false, \u0026#34;max\u0026#34;: false, \u0026#34;min\u0026#34;: false, \u0026#34;show\u0026#34;: true, \u0026#34;total\u0026#34;: false, \u0026#34;values\u0026#34;: false }, \u0026#34;lines\u0026#34;: true, \u0026#34;linewidth\u0026#34;: 1, \u0026#34;links\u0026#34;: [], \u0026#34;nullPointMode\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;options\u0026#34;: {}, \u0026#34;percentage\u0026#34;: false, \u0026#34;pointradius\u0026#34;: 5, \u0026#34;points\u0026#34;: false, \u0026#34;renderer\u0026#34;: \u0026#34;flot\u0026#34;, \u0026#34;seriesOverrides\u0026#34;: [], \u0026#34;spaceLength\u0026#34;: 10, \u0026#34;stack\u0026#34;: false, \u0026#34;steppedLine\u0026#34;: false, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;histogram_quantile(0.50, sum(rate(django_http_requests_latency_seconds_by_view_method_bucket{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;,view!~\\\u0026#34;prometheus-django-metrics|healthcheck\\\u0026#34;}[5m])) by (job, le))\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;interval\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;quantile=50\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; }, { \u0026#34;expr\u0026#34;: \u0026#34;histogram_quantile(0.95, sum(rate(django_http_requests_latency_seconds_by_view_method_bucket{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;,view!~\\\u0026#34;prometheus-django-metrics|healthcheck\\\u0026#34;}[5m])) by (job, le))\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;interval\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;quantile=95\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;B\u0026#34; }, { \u0026#34;expr\u0026#34;: \u0026#34;histogram_quantile(0.99, sum(rate(django_http_requests_latency_seconds_by_view_method_bucket{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;,view!~\\\u0026#34;prometheus-django-metrics|healthcheck\\\u0026#34;}[5m])) by (job, le))\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;interval\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;quantile=99\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;C\u0026#34; }, { \u0026#34;expr\u0026#34;: \u0026#34;histogram_quantile(0.999, sum(rate(django_http_requests_latency_seconds_by_view_method_bucket{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;,view!~\\\u0026#34;prometheus-django-metrics|healthcheck\\\u0026#34;}[5m])) by (job, le))\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;interval\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;quantile=99.9\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;D\u0026#34; } ], \u0026#34;thresholds\u0026#34;: [], \u0026#34;timeFrom\u0026#34;: null, \u0026#34;timeRegions\u0026#34;: [], \u0026#34;timeShift\u0026#34;: null, \u0026#34;title\u0026#34;: \u0026#34;Request Latency\u0026#34;, \u0026#34;tooltip\u0026#34;: { \u0026#34;shared\u0026#34;: true, \u0026#34;sort\u0026#34;: 0, \u0026#34;value_type\u0026#34;: \u0026#34;individual\u0026#34; }, \u0026#34;type\u0026#34;: \u0026#34;graph\u0026#34;, \u0026#34;xaxis\u0026#34;: { \u0026#34;buckets\u0026#34;: null, \u0026#34;mode\u0026#34;: \u0026#34;time\u0026#34;, \u0026#34;name\u0026#34;: null, \u0026#34;show\u0026#34;: true, \u0026#34;values\u0026#34;: [] }, \u0026#34;yaxes\u0026#34;: [ { \u0026#34;format\u0026#34;: \u0026#34;dtdurations\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true }, { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true } ], \u0026#34;yaxis\u0026#34;: { \u0026#34;align\u0026#34;: false, \u0026#34;alignLevel\u0026#34;: null } }, { \u0026#34;aliasColors\u0026#34;: { \u0026#34;api-beatstream-api\u0026#34;: \u0026#34;#1f78c1\u0026#34; }, \u0026#34;bars\u0026#34;: false, \u0026#34;dashLength\u0026#34;: 10, \u0026#34;dashes\u0026#34;: false, \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;fill\u0026#34;: 1, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 12, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 11 }, \u0026#34;id\u0026#34;: 7, \u0026#34;legend\u0026#34;: { \u0026#34;avg\u0026#34;: false, \u0026#34;current\u0026#34;: false, \u0026#34;max\u0026#34;: false, \u0026#34;min\u0026#34;: false, \u0026#34;show\u0026#34;: true, \u0026#34;total\u0026#34;: false, \u0026#34;values\u0026#34;: false }, \u0026#34;lines\u0026#34;: true, \u0026#34;linewidth\u0026#34;: 1, \u0026#34;links\u0026#34;: [], \u0026#34;nullPointMode\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;options\u0026#34;: {}, \u0026#34;percentage\u0026#34;: false, \u0026#34;pointradius\u0026#34;: 5, \u0026#34;points\u0026#34;: false, \u0026#34;renderer\u0026#34;: \u0026#34;flot\u0026#34;, \u0026#34;seriesOverrides\u0026#34;: [ {} ], \u0026#34;spaceLength\u0026#34;: 10, \u0026#34;stack\u0026#34;: false, \u0026#34;steppedLine\u0026#34;: false, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_http_responses_before_middlewares_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;, view!~\\\u0026#34;prometheus-django-metrics|healthcheck\\\u0026#34;}[1m])) by(job)\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;interval\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;{{job}}\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;thresholds\u0026#34;: [], \u0026#34;timeFrom\u0026#34;: null, \u0026#34;timeRegions\u0026#34;: [], \u0026#34;timeShift\u0026#34;: null, \u0026#34;title\u0026#34;: \u0026#34;Responses\u0026#34;, \u0026#34;tooltip\u0026#34;: { \u0026#34;shared\u0026#34;: true, \u0026#34;sort\u0026#34;: 0, \u0026#34;value_type\u0026#34;: \u0026#34;individual\u0026#34; }, \u0026#34;type\u0026#34;: \u0026#34;graph\u0026#34;, \u0026#34;xaxis\u0026#34;: { \u0026#34;buckets\u0026#34;: null, \u0026#34;mode\u0026#34;: \u0026#34;time\u0026#34;, \u0026#34;name\u0026#34;: null, \u0026#34;show\u0026#34;: true, \u0026#34;values\u0026#34;: [] }, \u0026#34;yaxes\u0026#34;: [ { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true }, { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true } ], \u0026#34;yaxis\u0026#34;: { \u0026#34;align\u0026#34;: false, \u0026#34;alignLevel\u0026#34;: null } }, { \u0026#34;aliasColors\u0026#34;: {}, \u0026#34;bars\u0026#34;: false, \u0026#34;dashLength\u0026#34;: 10, \u0026#34;dashes\u0026#34;: false, \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;fill\u0026#34;: 1, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 12, \u0026#34;x\u0026#34;: 12, \u0026#34;y\u0026#34;: 11 }, \u0026#34;id\u0026#34;: 11, \u0026#34;legend\u0026#34;: { \u0026#34;avg\u0026#34;: false, \u0026#34;current\u0026#34;: false, \u0026#34;max\u0026#34;: false, \u0026#34;min\u0026#34;: false, \u0026#34;show\u0026#34;: true, \u0026#34;total\u0026#34;: false, \u0026#34;values\u0026#34;: false }, \u0026#34;lines\u0026#34;: true, \u0026#34;linewidth\u0026#34;: 1, \u0026#34;links\u0026#34;: [], \u0026#34;nullPointMode\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;options\u0026#34;: {}, \u0026#34;percentage\u0026#34;: false, \u0026#34;pointradius\u0026#34;: 5, \u0026#34;points\u0026#34;: false, \u0026#34;renderer\u0026#34;: \u0026#34;flot\u0026#34;, \u0026#34;seriesOverrides\u0026#34;: [], \u0026#34;spaceLength\u0026#34;: 10, \u0026#34;stack\u0026#34;: false, \u0026#34;steppedLine\u0026#34;: false, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_http_responses_total_by_status_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;, view!~\\\u0026#34;prometheus-django-metrics|healthcheck\\\u0026#34;}[1m])) by(status)\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;{{status}}\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;thresholds\u0026#34;: [], \u0026#34;timeFrom\u0026#34;: null, \u0026#34;timeRegions\u0026#34;: [], \u0026#34;timeShift\u0026#34;: null, \u0026#34;title\u0026#34;: \u0026#34;Response Status\u0026#34;, \u0026#34;tooltip\u0026#34;: { \u0026#34;shared\u0026#34;: true, \u0026#34;sort\u0026#34;: 0, \u0026#34;value_type\u0026#34;: \u0026#34;individual\u0026#34; }, \u0026#34;type\u0026#34;: \u0026#34;graph\u0026#34;, \u0026#34;xaxis\u0026#34;: { \u0026#34;buckets\u0026#34;: null, \u0026#34;mode\u0026#34;: \u0026#34;time\u0026#34;, \u0026#34;name\u0026#34;: null, \u0026#34;show\u0026#34;: true, \u0026#34;values\u0026#34;: [] }, \u0026#34;yaxes\u0026#34;: [ { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true }, { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true } ], \u0026#34;yaxis\u0026#34;: { \u0026#34;align\u0026#34;: false, \u0026#34;alignLevel\u0026#34;: null } }, { \u0026#34;aliasColors\u0026#34;: { \u0026#34;mysql\u0026#34;: \u0026#34;#584477\u0026#34;, \u0026#34;postgresql\u0026#34;: \u0026#34;#0064a5\u0026#34; }, \u0026#34;bars\u0026#34;: false, \u0026#34;dashLength\u0026#34;: 10, \u0026#34;dashes\u0026#34;: false, \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;fill\u0026#34;: 1, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 5, \u0026#34;w\u0026#34;: 24, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 20 }, \u0026#34;id\u0026#34;: 9, \u0026#34;legend\u0026#34;: { \u0026#34;avg\u0026#34;: false, \u0026#34;current\u0026#34;: false, \u0026#34;max\u0026#34;: false, \u0026#34;min\u0026#34;: false, \u0026#34;show\u0026#34;: true, \u0026#34;total\u0026#34;: false, \u0026#34;values\u0026#34;: false }, \u0026#34;lines\u0026#34;: true, \u0026#34;linewidth\u0026#34;: 1, \u0026#34;links\u0026#34;: [], \u0026#34;nullPointMode\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;options\u0026#34;: {}, \u0026#34;percentage\u0026#34;: false, \u0026#34;pointradius\u0026#34;: 5, \u0026#34;points\u0026#34;: false, \u0026#34;renderer\u0026#34;: \u0026#34;flot\u0026#34;, \u0026#34;seriesOverrides\u0026#34;: [], \u0026#34;spaceLength\u0026#34;: 10, \u0026#34;stack\u0026#34;: false, \u0026#34;steppedLine\u0026#34;: false, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_db_execute_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;}[1m])) by (vendor)\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;{{vendor}}\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;thresholds\u0026#34;: [], \u0026#34;timeFrom\u0026#34;: null, \u0026#34;timeRegions\u0026#34;: [], \u0026#34;timeShift\u0026#34;: null, \u0026#34;title\u0026#34;: \u0026#34;Database Ops\u0026#34;, \u0026#34;tooltip\u0026#34;: { \u0026#34;shared\u0026#34;: true, \u0026#34;sort\u0026#34;: 0, \u0026#34;value_type\u0026#34;: \u0026#34;individual\u0026#34; }, \u0026#34;type\u0026#34;: \u0026#34;graph\u0026#34;, \u0026#34;xaxis\u0026#34;: { \u0026#34;buckets\u0026#34;: null, \u0026#34;mode\u0026#34;: \u0026#34;time\u0026#34;, \u0026#34;name\u0026#34;: null, \u0026#34;show\u0026#34;: true, \u0026#34;values\u0026#34;: [] }, \u0026#34;yaxes\u0026#34;: [ { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true }, { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true } ], \u0026#34;yaxis\u0026#34;: { \u0026#34;align\u0026#34;: false, \u0026#34;alignLevel\u0026#34;: null } }, { \u0026#34;aliasColors\u0026#34;: {}, \u0026#34;bars\u0026#34;: false, \u0026#34;dashLength\u0026#34;: 10, \u0026#34;dashes\u0026#34;: false, \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;fill\u0026#34;: 1, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 5, \u0026#34;w\u0026#34;: 24, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 25 }, \u0026#34;id\u0026#34;: 18, \u0026#34;legend\u0026#34;: { \u0026#34;alignAsTable\u0026#34;: true, \u0026#34;avg\u0026#34;: true, \u0026#34;current\u0026#34;: true, \u0026#34;hideEmpty\u0026#34;: false, \u0026#34;hideZero\u0026#34;: true, \u0026#34;max\u0026#34;: true, \u0026#34;min\u0026#34;: false, \u0026#34;rightSide\u0026#34;: true, \u0026#34;show\u0026#34;: true, \u0026#34;total\u0026#34;: false, \u0026#34;values\u0026#34;: true }, \u0026#34;lines\u0026#34;: true, \u0026#34;linewidth\u0026#34;: 1, \u0026#34;links\u0026#34;: [], \u0026#34;nullPointMode\u0026#34;: \u0026#34;null\u0026#34;, \u0026#34;options\u0026#34;: {}, \u0026#34;percentage\u0026#34;: false, \u0026#34;pointradius\u0026#34;: 5, \u0026#34;points\u0026#34;: false, \u0026#34;renderer\u0026#34;: \u0026#34;flot\u0026#34;, \u0026#34;seriesOverrides\u0026#34;: [], \u0026#34;spaceLength\u0026#34;: 10, \u0026#34;stack\u0026#34;: false, \u0026#34;steppedLine\u0026#34;: false, \u0026#34;targets\u0026#34;: [ { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_model_deletes_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;}[1m])) by (model)\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;[{{model}}] deletes\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; }, { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_model_inserts_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;}[1m])) by (model)\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;[{{model}}] inserts\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;B\u0026#34; }, { \u0026#34;expr\u0026#34;: \u0026#34;sum(irate(django_model_updates_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;, service=~\\\u0026#34;^$service$\\\u0026#34;}[1m])) by (model)\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;time_series\u0026#34;, \u0026#34;intervalFactor\u0026#34;: 1, \u0026#34;legendFormat\u0026#34;: \u0026#34;[{{model}}] updates\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;C\u0026#34; } ], \u0026#34;thresholds\u0026#34;: [], \u0026#34;timeFrom\u0026#34;: null, \u0026#34;timeRegions\u0026#34;: [], \u0026#34;timeShift\u0026#34;: null, \u0026#34;title\u0026#34;: \u0026#34;Models stats\u0026#34;, \u0026#34;tooltip\u0026#34;: { \u0026#34;shared\u0026#34;: true, \u0026#34;sort\u0026#34;: 0, \u0026#34;value_type\u0026#34;: \u0026#34;individual\u0026#34; }, \u0026#34;type\u0026#34;: \u0026#34;graph\u0026#34;, \u0026#34;xaxis\u0026#34;: { \u0026#34;buckets\u0026#34;: null, \u0026#34;mode\u0026#34;: \u0026#34;time\u0026#34;, \u0026#34;name\u0026#34;: null, \u0026#34;show\u0026#34;: true, \u0026#34;values\u0026#34;: [] }, \u0026#34;yaxes\u0026#34;: [ { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true }, { \u0026#34;format\u0026#34;: \u0026#34;short\u0026#34;, \u0026#34;label\u0026#34;: null, \u0026#34;logBase\u0026#34;: 1, \u0026#34;max\u0026#34;: null, \u0026#34;min\u0026#34;: null, \u0026#34;show\u0026#34;: true } ], \u0026#34;yaxis\u0026#34;: { \u0026#34;align\u0026#34;: false, \u0026#34;alignLevel\u0026#34;: null } } ], \u0026#34;refresh\u0026#34;: \u0026#34;10s\u0026#34;, \u0026#34;schemaVersion\u0026#34;: 18, \u0026#34;style\u0026#34;: \u0026#34;dark\u0026#34;, \u0026#34;tags\u0026#34;: [], \u0026#34;templating\u0026#34;: { \u0026#34;list\u0026#34;: [ { \u0026#34;current\u0026#34;: { \u0026#34;text\u0026#34;: \u0026#34;prometheus\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;prometheus\u0026#34; }, \u0026#34;hide\u0026#34;: 0, \u0026#34;includeAll\u0026#34;: false, \u0026#34;label\u0026#34;: null, \u0026#34;multi\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;datasource\u0026#34;, \u0026#34;options\u0026#34;: [], \u0026#34;query\u0026#34;: \u0026#34;prometheus\u0026#34;, \u0026#34;refresh\u0026#34;: 1, \u0026#34;regex\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;skipUrlSync\u0026#34;: false, \u0026#34;type\u0026#34;: \u0026#34;datasource\u0026#34; }, { \u0026#34;allValue\u0026#34;: \u0026#34;.*\u0026#34;, \u0026#34;current\u0026#34;: { \u0026#34;text\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;default\u0026#34; }, \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;definition\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;hide\u0026#34;: 0, \u0026#34;includeAll\u0026#34;: false, \u0026#34;label\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;multi\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;namespace\u0026#34;, \u0026#34;options\u0026#34;: [], \u0026#34;query\u0026#34;: \u0026#34;label_values(django_db_new_connections_total, namespace)\u0026#34;, \u0026#34;refresh\u0026#34;: 1, \u0026#34;regex\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;skipUrlSync\u0026#34;: false, \u0026#34;sort\u0026#34;: 1, \u0026#34;tagValuesQuery\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;tags\u0026#34;: [], \u0026#34;tagsQuery\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;query\u0026#34;, \u0026#34;useTags\u0026#34;: false }, { \u0026#34;allValue\u0026#34;: null, \u0026#34;current\u0026#34;: { \u0026#34;text\u0026#34;: \u0026#34;All\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;$__all\u0026#34; }, \u0026#34;datasource\u0026#34;: \u0026#34;$datasource\u0026#34;, \u0026#34;definition\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;hide\u0026#34;: 0, \u0026#34;includeAll\u0026#34;: true, \u0026#34;label\u0026#34;: \u0026#34;app\u0026#34;, \u0026#34;multi\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;service\u0026#34;, \u0026#34;options\u0026#34;: [], \u0026#34;query\u0026#34;: \u0026#34;label_values(django_db_new_connections_total{namespace=~\\\u0026#34;$namespace\\\u0026#34;}, service)\u0026#34;, \u0026#34;refresh\u0026#34;: 1, \u0026#34;regex\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;skipUrlSync\u0026#34;: false, \u0026#34;sort\u0026#34;: 0, \u0026#34;tagValuesQuery\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;tags\u0026#34;: [], \u0026#34;tagsQuery\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;query\u0026#34;, \u0026#34;useTags\u0026#34;: false } ] }, \u0026#34;time\u0026#34;: { \u0026#34;from\u0026#34;: \u0026#34;now-15m\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;now\u0026#34; }, \u0026#34;timepicker\u0026#34;: { \u0026#34;refresh_intervals\u0026#34;: [ \u0026#34;5s\u0026#34;, \u0026#34;10s\u0026#34;, \u0026#34;30s\u0026#34;, \u0026#34;1m\u0026#34;, \u0026#34;5m\u0026#34;, \u0026#34;15m\u0026#34;, \u0026#34;30m\u0026#34;, \u0026#34;1h\u0026#34;, \u0026#34;2h\u0026#34;, \u0026#34;1d\u0026#34; ], \u0026#34;time_options\u0026#34;: [ \u0026#34;5m\u0026#34;, \u0026#34;15m\u0026#34;, \u0026#34;1h\u0026#34;, \u0026#34;6h\u0026#34;, \u0026#34;12h\u0026#34;, \u0026#34;24h\u0026#34;, \u0026#34;2d\u0026#34;, \u0026#34;7d\u0026#34;, \u0026#34;30d\u0026#34; ] }, \u0026#34;timezone\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;a Django Prometheus\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;O6v4rMpizda\u0026#34;, \u0026#34;version\u0026#34;: 1 } ","date":"2019-08-14T00:00:00Z","permalink":"/posts/2019/08/2019-08-14-grafana-dashboard-django-bug%E4%BF%AE%E5%A4%8D/","title":"grafana dashboard django bugä¿®å¤"},{"content":"é¦–å…ˆæ‹‰ä¸ªç¥¨ [é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº-äº‘åŸç”Ÿåº”ç”¨å¤§èµ›] https://developer.aliyun.com/hub éº»çƒ¦ä¸åæ„Ÿæ‹‰ç¥¨çš„,æœ‰å…´è¶£æœ‰ç©ºçš„,ç»™æˆ‘æäº¤çš„ä¸‹é¢ä¸‰ä¸ªåº”ç”¨ç‚¹ä¸ªæ˜Ÿæ˜Ÿï¼Œå¤šè°¢äº†ã€‚(é˜¿é‡Œäº‘æ™®é€šè´¦å·å³å¯æŠ•ç¥¨,æ”¯ä»˜å®ç™»å½•äº¦å¯) åœ¨k8sçš„å®¹å™¨äº‘ç¯å¢ƒä¸­,åº”ç”¨çš„éƒ¨ç½²æ–¹å¼é€šå¸¸æ˜¯ç¼–å†™å¯¹åº”çš„apiå¯¹è±¡ç”³æ˜æ–‡ä»¶æ¥å®Œæˆ. æ¯”å¦‚æ¯”è¾ƒç®€å•çš„åº”ç”¨,å¦‚ç®€å•çš„djangoåº”ç”¨,æˆ‘ä»¬é€šå¸¸å°±éœ€è¦é¦–å…ˆç¼–å†™deploymentç”¨äºæ§åˆ¶replicaset-\u0026gt;podï¼Œç„¶åç¼–å†™serviceæ§åˆ¶deploymentï¼Œæœ€åç¼–å†™ingressåšæœåŠ¡æš´éœ². è€Œæ¯”è¾ƒå¤æ‚çš„åº”ç”¨,å¦‚prometheus,æˆ‘ä»¬é€šå¸¸å°±è¦ç”¨åˆ°ç”¨æˆ·å®šä¹‰apiå¯¹è±¡crd,ç„¶åç¼–å†™å¯¹åº”çš„å¾ªç¯å’Œæ§åˆ¶,æœ€åå®Œæˆä¸Šé¢çš„é‚£ä¸€å¥—éƒ¨ç½²æ–¹å¼.\næ˜¾ç„¶,è¿™æŒºå¤æ‚çš„,è€Œä¸”ç‰¹åˆ«å¤šçš„ä¸œè¥¿æ„Ÿè§‰éƒ½å¯ä»¥ç”¨æ¨¡æ¿ä¼ å˜é‡æ¥ä»£æ›¿.é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦éœ€è¦è‡ªå·±ç¼–å†™ä¸€ä¸ªç³»ç»Ÿç”¨ä»¥æ ¹æ®å‚æ•°è‡ªåŠ¨ç”Ÿæˆè¿™äº›å¤æ‚çš„yamlæ–‡ä»¶å‘¢?ç­”æ¡ˆåŸºæœ¬ä¸Šæ˜¯æ²¡å¿…è¦çš„(å½“ç„¶ä¸€åˆ‡ç‰¹æ®Šæƒ…å†µè¿˜æ˜¯éœ€è¦),æˆ‘ä»¬æœ‰helmæ¥å¸®æˆ‘ä»¬åšè¿™ä¸€åˆ‡.\nä½ å¯ä»¥å°†helmä¸k8sçš„å…³ç³»çœ‹ä½œyumä¹‹äºcentosçš„å…³ç³».helmå°†åº”ç”¨è¿›è¡Œæ‰“åŒ…,æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¡«å†™å¿…è¦çš„å‚æ•°ï¼Œè‡ªåŠ¨ç”Ÿæˆå’Œéƒ¨ç½²æ‰¹é‡çš„yamlæ–‡ä»¶ï¼Œä»è€Œå®ç°ä¸€é”®éƒ¨ç½²å¤æ‚çš„ç³»ç»Ÿ. æ¯”å¦‚promethuesåœ¨k8sä¸­çš„éƒ¨ç½²,å¦‚æœæˆ‘ä»¬ç”¨ç¼–å†™Yamlçš„æ–¹æ³•æ¥éƒ¨ç½²,å¾ˆå¯èƒ½å°±è¦ç¼–å†™æ•°åä¸ªyamlæ–‡ä»¶(åŒ…æ‹¬promethues,alertmanager,grafana,push-gatewayç­‰ç­‰),ä½†æˆ‘ä»¬å¦‚æœä½¿ç”¨helmï¼Œæˆ‘ä»¬å°±åªéœ€è¦ä¸€è¡Œå‘½ä»¤\nhelm install stable/prometheus-operator é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥æ€æ ·æ‰èƒ½åˆ¶ä½œhelmä¸­çš„chartè½¯ä»¶åŒ…ç”¨äºç»™ç”¨æˆ·è‡ªåŠ¨å®‰è£…å‘¢?é¦–å…ˆ,æˆ‘ä»¬éœ€è¦å®‰è£…helm,ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å³å¯. https://github.com/helm/helm/releases\nç„¶åæˆ‘ä»¬å¼€å§‹åˆ›å»ºä¸€ä¸ªhelmè½¯ä»¶åŒ…(project-nameå¯æ›¿æ¢)\nhelm create \u0026lt;project-name\u0026gt; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºäº†å¦‚ä¸‹æ–‡ä»¶å¤¹ å…¶ä¸­templateä¸‹å°±æ˜¯å„ä¸ªyamlæ–‡ä»¶çš„æ¨¡æ¿,è€Œvalues.yamlåˆ™æ˜¯å¯ä»¥å¡«å……è¿›å„ä¸ªyamlæ–‡ä»¶æ¨¡æ¿çš„å‚æ•°(ç”¨æˆ·å¯è°ƒèŠ‚). æˆ‘ä»¬è¦åšçš„å°±æ˜¯å¯¹values.yamlå’Œtemplateä¸‹å„æ¨¡æ¿åšä¿®æ”¹,ä»¥é€‚åº”å®é™…åº”ç”¨çš„éœ€æ±‚.\nå…¶ä¸­,templateçš„æ¨¡æ¿è¯­æ³•ç”¨çš„æ˜¯golangçš„templateè¯­æ³•ï¼Œå†åŠ ä¸Šsprigæ¨¡æ¿åº“å‡½æ•°(https://github.com/Masterminds/sprig)\nå½“æˆ‘ä»¬è®¾è®¡å¥½äº†ä¸€ä¸ªchartä¹‹å,æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æµ‹è¯•ç”Ÿæˆçš„yamlæ–‡ä»¶æ˜¯å¦ç¬¦åˆé¢„æœŸ\nhelm install --dry-run --debug ../\u0026lt;project-name\u0026gt; æˆ‘ä»¬å¯ä»¥é€šè¿‡-f values.yamlç»Ÿä¸€è®¾ç½®å‚æ•°,ä¹Ÿå¯ä»¥é€šè¿‡\u0026ndash;set å•ä¸€è®¾ç½®å‚æ•°\nå¦‚æœç¬¦åˆé¢„æœŸ,æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å®‰è£…äº†\nhelm install ../\u0026lt;project-name\u0026gt; æ›´å¤šçš„helmç›¸å…³çš„èµ„æ–™å¯ä»¥å‚è€ƒ helmç”¨æˆ·ä¸å¼€å‘è€…æŒ‡å—(ä¸­æ–‡ç‰ˆ)\nå†å²è¯„è®º (4 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nhuangguohuan (2019-08-15 14:29) å‘dalaoä½å¤´ï¼ŒæŠ•äº† calmkart (2019-08-15 19:11) å¤šè°¢å®‰å…¨ç‹ liuhuohua (2019-08-16 11:15) å–œæ¬¢çœ‹åšä¸»çš„æŠ€æœ¯æ–‡ç« ï¼Œç¥¨å·²æŠ• calmkart (2019-08-20 13:36) è°¢è°¢ ","date":"2019-08-14T00:00:00Z","permalink":"/posts/2019/08/2019-08-14-helm-chart%E7%9A%84%E5%88%B6%E4%BD%9C%E5%8F%8A%E4%BD%BF%E7%94%A8%E9%A1%BA%E4%BE%BF%E6%8B%89%E4%B8%AA%E7%A5%A8/","title":"helm chartçš„åˆ¶ä½œåŠä½¿ç”¨(é¡ºä¾¿æ‹‰ä¸ªç¥¨)"},{"content":"æœ€è¿‘å­¦äº†ä¸‹reacté‚£ä¸€å¥—ä¸œè¥¿ï¼Œä»reactçš„å®˜æ–¹æ–‡æ¡£å’Œå®˜æ–¹ç¤ºä¾‹å¼€å§‹çœ‹èµ·ï¼Œæ„Ÿè§‰å®˜æ–¹æ–‡æ¡£å†™å¾—ç›¸å½“è¯¦å®æ¼‚äº®ï¼Œç”±æµ…å…¥æ·±è®©äººå¾ˆå®¹æ˜“æ¥å—ã€‚ä½†æƒ³ç€å›½å†…å¯æ˜¯æœ‰antdè¿™ä¹ˆç‰›é€¼çš„è½®å­ï¼Œä½œä¸ºreactçš„UIç»„å¯æ˜¯ä¸–ç•Œç¬¬äºŒçš„å­˜åœ¨(staræ•°)ï¼Œè‚¯å®šè¦æ”¯æŒä¸€ä¸‹å­¦å­¦å•¦ï¼Œç„¶åå¼€å§‹äº†æè®©äººè‡ªé—­çš„ant designä¹‹æ—…ã€‚ ä»¥å‰å†™å‰ç«¯éƒ½æ˜¯ç”¨çš„ä¼ ç»Ÿçš„åç«¯æ¸²æŸ“templateæ–¹å¼ï¼Œç”¨äº†å¤§æ‰¹çš„jsæ’ä»¶ï¼Œå‰ç«¯çš„ä¸œè¥¿å°±jqueryä¸€æŠŠæ¢­ï¼Œå­¦reactè¿™æ ·çš„æ¡†æ¶çš„æ—¶å€™è¿˜æ˜¯å¾ˆæœ‰æ–°é²œæ„Ÿçš„ã€‚ant designå…ˆèµ°äº†ä¸€è¶Ÿå®˜æ–¹çš„å®è·µæ–‡æ¡£ï¼Œè¿‡ç¨‹ä¸­è·Ÿç€èµ°äº†ä¸€è¶Ÿumiå’Œdvaçš„æ–‡æ¡£ï¼Œä¸èƒ½è¯´å¾ˆæ‡‚ï¼Œä½†å¤§è‡´è¿˜æ˜¯çœ‹çš„æ˜ç™½çš„ï¼Œå…¨å®¶æ¡¶è¿™æ ·çš„ä¸œè¥¿å¥½ç”¨çš„è¯ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œç„¶åå¼€å§‹çœ‹antd proè¿™ä¸ªå®˜æ–¹çš„è„šæ‰‹æ¶ã€‚\nè¿™ä¸ªæ—¶å€™çªç„¶æƒ³èµ·ä»¥å‰è¿˜å…³æ³¨è¿‡åŒæ ·æ˜¯é˜¿é‡Œå‡ºçš„iceworké£å†°ï¼Œè§‰å¾—è¯´ä¸å®šèƒ½æå‡å¼€å‘æ•ˆç‡ï¼Œä¸‹äº†ä¸ªç©ç©ï¼ŒåŸºæœ¬ä¸Šæ²¡å‘ç°æœ‰ä»€ä¹ˆåµç”¨ã€‚è€Œä¸”ä¸åŒæ–‡æ¡£å’Œåº”ç”¨ä¸­å…‰åˆ›å»ºä¸€ä¸ªé¡¹ç›®çš„æ–¹å¼å°±å¾ˆäº”èŠ±å…«é—¨äº†ï¼Œantdå®˜æ–¹å®è·µæ–‡æ¡£ä¸€ä¸ªæ ·ï¼Œantd proä¸€ä¸ªæ ·ï¼Œiceworké£å†°ä¸€ä¸ªæ ·ï¼Œç”¨çš„ç»„ä»¶ä¹Ÿæœ‰äº›ä¸åŒï¼Œä½†åˆæœ‰äº›ä¸€è‡´çš„ï¼Œæ€»ä¹‹æ•´çš„äººç³Šæ¶‚ã€‚æˆ‘ä¹Ÿæ˜¯çœŸå¿ƒä¸æ‡‚å›½å†…æè¿™ä¹ˆå¤šåƒå¥‡ç™¾æ€ªçš„å‰ç«¯å·¥å…·å¹²å•¥ï¼Œæœ€åè¿˜æ˜¯ç”¨çš„antd proå®˜æ–¹æ–‡æ¡£çš„æ–¹å¼ã€‚\nè·Ÿç€antd proå®˜æ–¹æ–‡æ¡£è¿‡äº†ä¸€éï¼Œæ‰“ç®—å°±ç”¨æ™®é€šçš„BasicLayoutå¸ƒå±€ï¼Œä½†è¿™æ—¶å€™çªç„¶å‘ç°å®˜æ–¹æ–‡æ¡£é‡Œæ ¹æœ¬æ²¡æProLayoutå¸ƒå±€çš„apiå•¥çš„ã€‚æ¯”å¦‚ï¼Œæ€ä¹ˆåˆ æ‰å³ä¸Šè§’çš„å›½é™…åŒ–ï¼Ÿç¬¬ä¸€ååº”ï¼Œå…ˆæŸ¥æŸ¥è°·æ­Œï¼ŒæŸ¥åˆ°ä¸€å †issueè¯´è¦æ‰‹åŠ¨åˆ å…¨éƒ¨å¼•ç”¨çš„ä»£ç \u0026hellip;å¤ªç‰›äº†..æ„Ÿè§‰åˆæ˜¯è£…äº†ä¸€ä¸ªå…¨å®¶æ¡¶çš„æ„Ÿè§‰ã€‚è·‘å»ant-design-pro-layoutå®˜æ–¹githubçœ‹äº†ä¸‹apiè¯´æ˜ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯å•¥æ—¶å€™æ›´æ–°çš„ï¼Œå’Œæˆ‘æœ€æ–°åˆ›å»ºçš„é¡¹ç›®éƒ½ä¸ä¸€è‡´ã€‚æ¯”å¦‚æœ‰ä¸ªrightContentRenderï¼Œåœ¨å®˜æ–¹æ–‡æ¡£æ ¹æœ¬æŸ¥ä¸åˆ°è¿™åˆ°åº•æ˜¯ä¸ªå•¥ã€‚ç„¶åç»§ç»­è°·æ­Œï¼Œå“¦ï¼ŒæŸ¥åˆ°ä¸ªissueè¯´headerRenderç°åœ¨æ”¯æŒä¸¤ä¸ªå‚æ•°,rightContentRenderæ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå°±æ˜¯å³ä¸Šè§’çš„é‚£äº›é¬¼ä¸œè¥¿ã€‚\nç»ˆäºæŸ¥åˆ°äº†ï¼ŒåŸæ¥è¿™ä¸ªrightContentRenderå°±æ˜¯å³ä¸Šè§’åŠŸèƒ½æ ã€‚ç„¶åä»£ç é‡Œè¿™é‡Œæ˜¯å¡«å……äº†RightContentç»„ä»¶,å¼•ç”¨è‡ª\u0026quot;@/components/GlobalHeader/RightContent\u0026quot;,è·‘å»è¿™ä¸ªæ–‡ä»¶é‡Œçœ‹äº†çœ‹ï¼Œæœç„¶ã€‚æŠŠ\u0026quot;@/components/GlobalHeader/RightContent\u0026quot;ä¸­ä¸éœ€è¦çš„éƒ¨åˆ†åˆ æ‰ï¼Œå³ä¸Šè§’é‚£äº›ä¸œè¥¿å°±æ€»ç®—æ˜¯æ²¡äº†ã€‚\nç„¶åè¿™ä¸ªæ—¶å€™è¿›éšä¾¿å•¥è‡ªå·±å†™çš„é¡µé¢ï¼Œåªè¦ç”¨äº†ProLayoutåˆæ²¡æœ‰å†™å›½é™…åŒ–å†…å®¹å°±ä¼šç–¯ç‹‚errorï¼Œè¿™ä¸ªæ—¶å€™å»BasicLayout.jsxé‡ŒæŠŠæ‰€æœ‰formatmessageç›¸å…³å†…å®¹å…¨éƒ¨åˆ å®Œå°±è¡Œäº†ã€‚\né¦–å…ˆï¼Œè¿™ç§å‰åç«¯åˆ†ç¦»çš„å•é¡µå‰ç«¯å¼€å‘æ¡†æ¶ç¡®å®ä»¥å‰æ²¡ç”¨è¿‡ï¼Œæ˜¯ä¸ªæ–°æ‰‹ï¼Œä½†æ˜¯ç«™åœ¨æ–°æ‰‹è§†è§’ï¼Œantd proçš„å®˜æ–¹æ–‡æ¡£çœŸçš„å†™å¾—çƒ‚ã€‚è€Œä¸”ä½œä¸ºä¸€ä¸ªé¢œæ§ï¼Œå›½å†…çš„è¿™äº›å‰ç«¯UIè¿˜æ˜¯æ¯”å›½å¤–çš„è¦ä¸‘ï¼Œæ¯”å¦‚ä»¥å¾€ç”¨çš„bootstrapå°±æ˜¯å¾ˆæ¼‚äº®ï¼Œæ¯”å¦‚material uiä¹Ÿæ¼‚äº®ã€‚\næœ€åç»™reactçš„å®˜æ–¹å®è·µæ–‡æ¡£ç‚¹èµã€‚\nä¸€ç‚¹åˆå­¦è€…çš„å°è®°å½•ã€‚\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\ncarmer (2019-06-29 11:06) æ¥¼ä¸»ä¸ºå•¥ä¸ç”¨flutterå‘¢ï¼Œè²Œä¼¼æœ€è¿‘å¾ˆç«ï¼Œå¤§æœ‰ä¸€ç»Ÿå¤©ä¸‹ä¹‹åŠ¿ ","date":"2019-06-28T00:00:00Z","permalink":"/posts/2019/06/2019-06-28-ant-design-pro%E5%88%A0%E9%99%A4basiclayout%E5%9B%BD%E9%99%85%E5%8C%96-%E5%B8%AE%E5%8A%A9-%E9%A1%B6%E9%83%A8%E6%90%9C%E7%B4%A2/","title":"Ant design proåˆ é™¤BasicLayoutå›½é™…åŒ–/å¸®åŠ©/é¡¶éƒ¨æœç´¢"},{"content":"å‰é¢å‡ ç¯‡æ–‡ç« å·²ç»è°ˆè¿‡åœ¨k8sä¸­å¦‚ä½•å®ç°rook/cephæŒä¹…åŒ–å­˜å‚¨å’ŒæœåŠ¡å‘ç°/è´Ÿè½½å‡è¡¡/æœåŠ¡æš´éœ²ç­–ç•¥ï¼Œæ¥ä¸‹æ¥å‡ ç¯‡æ–‡ç« å°†ä»¥springbooté¡¹ç›®ä¸ºä¾‹ï¼Œè¯¦è§£å¦‚ä½•åˆ©ç”¨kuberneteså®¹å™¨ç¼–æ’å¹³å°å®ç°cicdæµæ°´çº¿(devops)ã€‚\næˆ‘ä»¬æ ¹æ®ä¸Šé¢å‡ ç¯‡æ–‡ç« å·²ç»æœ‰äº†ä¸€ä¸ªk8sé›†ç¾¤ï¼Œå¸¸è§çš„çš„cicdå·¥å…·æœ‰jenkinsï¼Œgitlab-ciå’Œdroneç­‰ç­‰ï¼Œä½†å› ä¸ºç§ç§åŸå› (æ¯”å¦‚gitlabciåªæ”¯æŒgitlabï¼Œdroneéœ€è¦å€ŸåŠ©å…¶ä»–gitä»“åº“çš„ç”¨æˆ·æƒé™ç³»ç»Ÿä¸æ”¯æŒåŸç”Ÿè£¸git)ï¼Œè¿™é‡Œæœ€ç»ˆè¿˜æ˜¯é€‰æ‹©äº†jenkinsè¿›è¡Œå®éªŒã€‚\né¦–å…ˆè¦è§£å†³çš„è‚¯å®šæ˜¯æµç¨‹ä¸Šçš„é—®é¢˜ï¼Œå°±æ˜¯æ‰€è°“çš„cicdæµç¨‹ï¼Œå‚è€ƒäº†ä¸€äº›æ¼”è®²pptçš„åšæ³•ï¼Œä¸è¿‡pptå˜›ï¼Œä½ æ‡‚çš„ï¼Œå›¾ç”»çš„è¿˜æ˜¯å¾ˆå¥½çœ‹ï¼Œä½†æ˜¯ä¹Ÿå•°é‡Œå…«å—¦çš„ï¼Œä¸å¤Ÿç®€æ´æ˜å¿«ï¼Œæœ‰äº›åœ°æ–¹æ˜æ˜å¾ˆç®€å•å´æ•…æ„è®²çš„å¾ˆé«˜æ·±è«æµ‹å¥½åƒå¾ˆå‰å®³çš„æ ·å­ï¼Œæ€»ä¹‹å°±æ˜¯çœ‹ç€çœ‹ç€å°±è§‰å¾—æœ‰ç‚¹å¥½ç¬‘ å¤§è‡´æµç¨‹å›¾æˆ‘å°±æ„æ€æ„æ€å§:\nç”¨æˆ·æäº¤ä»£ç  \u0026mdash;-\u0026gt; Jenkinsè§¦å‘æ„å»º \u0026mdash;-\u0026gt; ç¼–è¯‘æ‰“åŒ… \u0026mdash;-\u0026gt; å½’æ¡£æˆå“ \u0026mdash;-\u0026gt; åˆ¶ä½œé•œåƒ \u0026mdash;-\u0026gt;k8så‘å¸ƒ\nå…¶ä¸­æ„å»ºè§¦å‘è¿™ä¸€éƒ¨åˆ†å› ä¸ºæ˜¯ç”¨çš„å¤šåˆ†æ”¯æµæ°´çº¿ï¼Œè§‰å¾—è¿˜æ˜¯ç”¨è§¦å‘æ‰«æapiç”±ç”¨æˆ·åœ¨è¿ç»´å¹³å°ç‚¹å‡»ä¸€ä¸‹æ¯”è¾ƒå¥½ã€‚æ„å»ºå› ä¸ºæ˜¯ç”¨çš„åŸºäºk8sçš„jenkinsï¼Œæ‰€ä»¥åŒæ ·ç”¨äº†åŠ¨æ€çš„jenkins-slaveï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°æœ‰å·¥ä½œåˆ™è‡ªåŠ¨ç”Ÿæˆjenkins-slaveè¿›è¡Œç¼–è¯‘ï¼Œæ— å·¥ä½œåˆ™è‡ªåŠ¨é”€æ¯jenkins-slaveé‡Šæ”¾èµ„æºï¼Œä»è€Œå®ç°èµ„æºçš„æœ€å¤§åŒ–åˆ©ç”¨å’Œä¼¸ç¼©æ€§ã€‚\né¦–å…ˆåœ¨k8sä¸­éƒ¨ç½²jenkins 1. åˆ›å»ºjenkins-master-home pvc\n# vim jenkins-master-pvc.yaml apiVersion: v1 kind: PersistentVolumeClaim metadata: name: jenkins-master-home namespace: kube-ops labels: app: jenkins-master-home spec: storageClassName: rook-ceph-block accessModes: - ReadWriteOnce resources: requests: storage: 100Gi # kubectl apply -f jenkins-master-pvc.yaml 2. åˆ›å»º rbac\n# vim rbac.yaml apiVersion: v1 kind: ServiceAccount metadata: name: jenkins2 namespace: kube-ops --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: jenkins2 rules: - apiGroups: [\u0026#34;extensions\u0026#34;, \u0026#34;apps\u0026#34;] resources: [\u0026#34;deployments\u0026#34;] verbs: [\u0026#34;create\u0026#34;, \u0026#34;delete\u0026#34;, \u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;patch\u0026#34;, \u0026#34;update\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;services\u0026#34;] verbs: [\u0026#34;create\u0026#34;, \u0026#34;delete\u0026#34;, \u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;patch\u0026#34;, \u0026#34;update\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;pods\u0026#34;] verbs: [\u0026#34;create\u0026#34;,\u0026#34;delete\u0026#34;,\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;patch\u0026#34;,\u0026#34;update\u0026#34;,\u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;pods/exec\u0026#34;] verbs: [\u0026#34;create\u0026#34;,\u0026#34;delete\u0026#34;,\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;patch\u0026#34;,\u0026#34;update\u0026#34;,\u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;pods/log\u0026#34;] verbs: [\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;secrets\u0026#34;] verbs: [\u0026#34;get\u0026#34;] --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: jenkins2 roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: jenkins2 subjects: - kind: ServiceAccount name: jenkins2 namespace: kube-ops # kubectl apply -f rbac.yaml 3.åˆ›å»ºjenkins deploymentå’Œservice\n# vim jenkins.yaml --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: jenkins2-deployment namespace: kube-ops spec: template: metadata: labels: app: jenkins2 spec: terminationGracePeriodSeconds: 10 serviceAccountName: jenkins2 containers: - name: jenkins image: jenkins/jenkins:lts imagePullPolicy: IfNotPresent ports: - containerPort: 8080 name: web protocol: TCP - containerPort: 50000 name: agent protocol: TCP resources: limits: cpu: 4000m memory: 8Gi requests: cpu: 1000m memory: 2Gi livenessProbe: httpGet: path: /login port: 8080 initialDelaySeconds: 60 timeoutSeconds: 5 failureThreshold: 12 readinessProbe: httpGet: path: /login port: 8080 initialDelaySeconds: 60 timeoutSeconds: 5 failureThreshold: 12 volumeMounts: - name: jenkinshome subPath: jenkins2 mountPath: /var/jenkins_home env: - name: LIMITS_MEMORY valueFrom: resourceFieldRef: resource: limits.memory divisor: 1Mi - name: JAVA_OPTS value: -Xmx$(LIMITS_MEMORY)m -XshowSettings:vm -Dhudson.slaves.NodeProvisioner.initialDelay=0 -Dhudson.slaves.NodeProvisioner.MARGIN=50 -Dhudson.slaves.NodeProvisioner.MARGIN0=0.85 -Duser.timezone=Asia/Shanghai securityContext: fsGroup: 1000 volumes: - name: jenkinshome persistentVolumeClaim: claimName: jenkins-master-home --- apiVersion: v1 kind: Service metadata: name: jenkins2 namespace: kube-ops labels: app: jenkins2 spec: selector: app: jenkins2 type: ClusterIP ports: - name: web port: 8080 targetPort: web - name: agent port: 50000 targetPort: agent # kubectl apply -f jenkins.yaml è¿™ä¸ªæ—¶å€™jenkinså°±å·²ç»èµ·èµ·æ¥äº†ï¼Œæˆ‘ä»¬ç»™jenkinsçš„webuiæ·»åŠ ä¸€ä¸ªingressè´Ÿè½½å‡è¡¡å’ŒæœåŠ¡æš´éœ²\n# vim kube-ops-ingress.yaml apiVersion: extensions/v1beta1 kind: Ingress metadata: name: kube-ops-ingress annotations: nginx.ingress.kubernetes.io/ssl-redirect: \u0026#34;false\u0026#34; namespace: kube-ops spec: rules: - host: k8s-jenkins.example.cn http: paths: - path: / backend: serviceName: jenkins2 servicePort: 8080 # kubectl apply -f kube-ops-ingress.yaml è¿™æ—¶å€™å› ä¸ºingress serviceæ˜¯ç”¨çš„master nodeçš„externalIpï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ä¿®æ”¹dnsï¼Œå°†k8s-jenkins.example.cnåŸŸåæŒ‡å‘master nodeçš„externalIpï¼Œç„¶åç›´æ¥è®¿é—®k8s-jenkins.example.cnå°±å¯ä»¥è®¿é—®åˆ°jenkinsæœåŠ¡ã€‚(æœ‰é—®é¢˜å¯ä»¥æŸ¥çœ‹ä¸‹kubectl get ingress -o wide \u0026ndash;all-namespaces)\nç„¶åå®‰è£…å¸¸è§çš„æ’ä»¶ï¼Œè¿›å…¥jenkinsåè®°å¾—å†å®‰è£…å¦‚ä¸‹ä¸¤ä¸ªæ’ä»¶ blueOcean(æ–°ä¸€ä»£çš„æµæ°´çº¿UI)ï¼Œkubernetes(k8s slaveæ”¯æŒ)ï¼ŒMultibranch Scan Webhook Trigger(å¤šåˆ†ææµæ°´çº¿æ‰«æè§¦å‘å™¨)\nå®‰è£…å¥½ä¹‹åï¼Œè¿›å…¥è®¾ç½®ï¼Œæ‹‰åˆ°æœ€ä¸‹é¢ï¼Œé€‰æ‹©æ·»åŠ ä¸€ä¸ªäº‘(k8s) æŒ‰å¦‚ä¸Šé…ç½®ï¼Œåœ¨é¡µé¢æµ‹è¯•è¿æ¥k8sæ­£å¸¸å³å¯(jenkinsæœåŠ¡åè¿™é‡Œå«jenkins2ï¼ŒæŒ‰å®é™…ä¿®æ”¹)\nè‡³äºä¸‹é¢çš„æ˜¯å¦æ·»åŠ é•œåƒï¼Œæˆ‘æ¨èæ˜¯ä¸åœ¨è¿™é‡Œæ·»åŠ ï¼Œè€Œé€‰æ‹©ç”¨Yamlç›´æ¥ç¼–å†™æ·»åŠ ã€‚åŸå› æ˜¯ï¼Œè¿™é‡Œæ·»åŠ slave k8s pod tempalteçš„è¯ï¼Œslaveç¼–å·æ— æ³•åŠ¨æ€åŒ–ï¼Œä¼šå¯¼è‡´åä»¥åæ„å»ºä»»åŠ¡ç­‰å¾…å‰ä»»åŠ¡ï¼Œæ— æ³•å¤šslaveå¹¶è¡Œã€‚(å¾ˆå¤šæ–‡ç« ä¼šåœ¨è¿™é‡Œæ·»åŠ slave pod templateï¼Œç„¶åç”¨ä¸€ä¸ªè‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®åšä¾‹å­ï¼Œé‚£æ ¹æœ¬æ— æ³•åœ¨å®é™…ç¯å¢ƒä¸­ç”¨çš„)\nè¿™é‡Œè¿˜æœ‰ä¸ªå°å‘ï¼Œæ— è®ºæ˜¯yamlçš„slave k8s pod tempalteè¿˜æ˜¯åœ¨jenkinsè®¾ç½®é‡Œé¡µé¢æ·»åŠ çš„slave k8s pod templateï¼Œå¦‚æœæƒ³ä½¿ç”¨è‡ªå®šä¹‰slave imageçš„è¯ï¼Œcontainers: - name ä¸€å®šè¦å¡«å†™æˆ- name: jnlpï¼Œå¦åˆ™ä¼šä¸è¯»å–è‡ªå®šä¹‰slave imageè€Œé‡‡ç”¨å®˜æ–¹çš„docker-jnlp-slaveã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºè‡ªå·±çš„jenkins-jnlp-slaveå®¹å™¨ï¼Œå‚è€ƒå®˜æ–¹çš„docker-jnlp-slave Dockerfileå¦‚ä¸‹\nARG VERSION=0.0.1 ARG user=jenkins ARG group=jenkins ARG uid=1000 ARG gid=1000 ENV HOME /home/${user} RUN groupadd -g ${gid} ${group} RUN useradd -d $HOME -u ${uid} -g ${group} ${user} LABEL maintainer=\u0026#34;calmkart@calmkart.com\u0026#34; Description=\u0026#34;jenkins jnlp slave image\u0026#34; Vendor=\u0026#34;calmkart@calmkart.com\u0026#34; Version=\u0026#34;${VERSION}\u0026#34; ARG AGENT_WORKDIR=/home/${user}/agent RUN curl --create-dirs -fsSLo /usr/share/jenkins/slave.jar https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting/3.29/remoting-3.29.jar \\ \u0026amp;\u0026amp; chmod 755 /usr/share/jenkins \\ \u0026amp;\u0026amp; chmod 644 /usr/share/jenkins/slave.jar \\ \u0026amp;\u0026amp; rm -rf /etc/yum.repos.d/* COPY kubectl kubectl COPY jdk/ ./jdk COPY maven ./maven COPY jenkins-slave /usr/local/bin/jenkins-slave COPY CentOS-Base.repo /etc/yum.repos.d/ COPY epel.repo /etc/yum.repos.d/ RUN yum makecache \\ \u0026amp;\u0026amp; yum install -y unzip.x86_64 \\ \u0026amp;\u0026amp; chmod +x ./kubectl \\ \u0026amp;\u0026amp; chmod +x /usr/local/bin/jenkins-slave \\ \u0026amp;\u0026amp; mv ./kubectl /usr/local/bin/kubectl \\ \u0026amp;\u0026amp; /bin/bash maven/default/install_maven \\ \u0026amp;\u0026amp; /bin/bash jdk/default/install_jdk \\ \u0026amp;\u0026amp; yum install -y nodejs \\ \u0026amp;\u0026amp; yum install -y python36.x86_64 \\ \u0026amp;\u0026amp; yum install -y docker-ce.x86_64 \\ \u0026amp;\u0026amp; yum install -y git \\ \u0026amp;\u0026amp; yum install -y which USER ${user} ENV PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/maven/bin:/usr/java/jdk/bin RUN export PATH=$PATH:/opt/maven/bin:/usr/java/jdk/bin ENV AGENT_WORKDIR=${AGENT_WORKDIR} RUN mkdir /home/${user}/.jenkins \u0026amp;\u0026amp; mkdir -p ${AGENT_WORKDIR} VOLUME /home/${user}/.jenkins VOLUME ${AGENT_WORKDIR} WORKDIR /home/${user} ENTRYPOINT [\u0026#34;jenkins-slave\u0026#34;] è¿™é‡Œåˆ›å»ºçš„æ˜¯ä¸€ä¸ªåŸºäºcentosçš„jenkins jnlp slaveå®¹å™¨é•œåƒï¼Œå®‰è£…äº†python2,python3,nodejs,docker,kubectl,maven,gitç­‰å·¥å…·å’Œç¯å¢ƒã€‚\nå°†è¯¥é•œåƒbuildå¹¶ä¸Šä¼ åˆ°harborä»“åº“å³å¯åœ¨é¡¹ç›®çš„Jenkinsfileä¸­ä½¿ç”¨.\nä»¥ä¸‹æ˜¯å…·ä½“å¾…æ„å»ºé¡¹ç›®ä¸­jenkins jnlp slaveçš„pod templateä¿¡æ¯\n# vim jnlp-slave-declarative.yaml metadata: namespace: kube-ops spec: containers: - name: jnlp image: harbor.example.org/example/jenkins-jnlp-slave:v0.0.1 workingDir: /home/jenkins ttyEnabled: true privileged: false alwaysPullImage: false volumeMounts: - name: volume-0 mountPath: /var/run/docker.sock - name: volume-1 mountPath: /home/jenkins/.kube - name: volume-2 mountPath: /home/jenkins - name: volume-3 mountPath: /root/.m2 volumes: - name: volume-0 hostPath: path: /var/run/docker.sock type: \u0026#34;\u0026#34; - name: volume-1 hostPath: path: /root/.kube type: \u0026#34;\u0026#34; - name: volume-2 nfs: path: /home/shared/nfs/jenkins-home server: 10.1.33.159 - name: volume-3 nfs: path: /home/shared/nfs/maven-home server: 10.1.33.159 å…³äºè¿™ä¸ªslave k8s pod templateè¦è§£é‡Šä¸€äº›ä¸œè¥¿ï¼Œè¿™é‡ŒæŒ‚è½½äº†4ä¸ªvolumeåˆ°slaveä¸­ï¼Œåˆ†åˆ«æ˜¯\n1.åœ¨slaveä¸­è°ƒç”¨å®¿ä¸»æœºçš„dockerå‘½ä»¤,ç”¨äºæ„é€ å’Œä¸Šä¼ é•œåƒ /var/run/docker.sock -\u0026gt; /var/run/docker.sock\n2.åœ¨slaveä¸­è°ƒç”¨å®¿ä¸»æœºçš„kubectlå‘½ä»¤,ç”¨äºåœ¨k8sä¸­å‘å¸ƒé¡¹ç›®(åˆ›å»ºdeploymentå’Œservice) /root/.kube -\u0026gt; /home/jenkins/.kube\n3.æ­å»ºäº†ä¸€ä¸ªnfsç”¨äºå¤šä¸ªslaveå…±äº«workspace,é¿å…å¤šæ¬¡cloneä»£ç  /home/shared/nfs/jenkins-home -\u0026gt; /home/jenkins\n4.æ­å»ºäº†ä¸€ä¸ªnfsç”¨äºå¤šä¸ªslaveå…±äº«æœ¬åœ°mavenä»“åº“,é¿å…å¤šæ¬¡ä¸‹è½½jaråŒ…,åŒæ—¶ç»Ÿä¸€mavené…ç½® /home/shared/nfs/maven-home â€”\u0026gt; /root/.m2\nè¿™é‡Œä¸ºä»€ä¹ˆä¸ç”¨cephå‘¢ï¼ŸåŸå› å¾ˆç®€å•ï¼Œå› ä¸ºceph rbdå—å­˜å‚¨ä¸æ”¯æŒReadWriteManyï¼Œè€Œcephfså…±äº«å­˜å‚¨è™½ç„¶æ”¯æŒReadWriteManyä½†æ˜¯ä¸æ”¯æŒåˆ†åŒºã€‚æ‰€ä»¥è¿˜æ˜¯é‡‡ç”¨äº†æœ€ç®€å•çš„nfså®ç°å…±äº«å­˜å‚¨ã€‚\nåœ¨é¡¹ç›®çš„Jenkinsfileä¸­ç¼–å†™å¦‚ä¸‹agentå­—æ®µè°ƒç”¨è¯¥pod templateçš„slave\ndef label_tag = \u0026#34;slave-${UUID.randomUUID().toString()}\u0026#34; pipeline { agent { kubernetes { label label_tag yamlFile \u0026#39;jnlp-slave-declarative.yaml\u0026#39; } } } } è¿™æ˜¯ç”³æ˜å¼pipelineçš„ç”¨æ³•ä¸­æ¯”è¾ƒå¥½çš„å†™æ³•ï¼Œå› ä¸ºå¦‚æœä¸å•ç‹¬å†™ä¸€ä¸ªyamlçš„è¯æˆ‘è®°å¾—æ˜¯ä¸æ”¯æŒå¾ˆå¤šç»†èŠ‚è¯­æ³•çš„.ï¼ˆå…·ä½“ç»†èŠ‚å‚è€ƒjenkins kubernetes pluginæ’ä»¶è¯´æ˜ï¼‰\nåšåˆ°è¿™é‡Œä¹‹åï¼Œæˆ‘ä»¬æ‰«æå¤šåˆ†æ”¯æµæ°´çº¿ï¼Œå°±å¯ä»¥å‘ç°åˆ›å»ºä¸€ä¸ªæ–°slaveå¤„ç†æ„å»ºä»»åŠ¡ï¼Œæ„å»ºå®Œæˆåˆ™è‡ªåŠ¨é”€æ¯äº†ã€‚ ä½†è¿™è¿˜è¿œè¿œä¸å¤Ÿï¼Œå¾ˆå¤šç»†èŠ‚æ²¡æœ‰å¤„ç†ï¼Œä¸‹ç¯‡æ–‡ç« å†è¯¦è¿°ç¼–è¯‘å‘å¸ƒæ„æˆå’Œç”³æ˜å¼Pipeline Jenkinsfile,ä»¥åŠé¡¹ç›®Dockerfileé•œåƒè¯¦ç»†å†™æ³•ä¾‹å­ã€‚\nå†å²è¯„è®º (4 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nlsprit (2019-06-14 19:28) å¤§ç¥ï¼Œæˆ‘çŸ¥é“CIæ˜¯æŒç»­é›†æˆï¼ŒCDæ˜¯ä»€ä¹ˆå•Šï¼Ÿ calmkart (2019-06-17 13:25) continuous integration continuous deployment lizhengyi (2019-06-24 15:37) æ¥¼ä¸»æœ€è¿‘çœ‹æœºä¼šå—ï¼Œæˆ‘ä»¬ç»„æ­£åœ¨æ‹›è˜è¿ç»´å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸»è¦è´Ÿè´£å…¬å¸å‘å¸ƒç³»ç»Ÿå’Œç›‘æ§ç³»ç»Ÿçš„å¼€å‘å’Œç»´æŠ¤ï¼Œå…¬å¸å«çœé’±å¿«æŠ¥ï¼ŒåŠå…¬åœ°ç‚¹åœ¨åŒ—äºŒç¯ï¼Œåœ°é“5å·çº¿é›å’Œå®«ç«™é™„è¿‘ï¼Œè–ªèµ„å¾…é‡ä¸šç•Œä¸Šæ¸¸æ°´å¹³ï¼ŒæœŸå¾…æ‚¨çš„å›å¤ã€‚ calmkart (2019-06-26 15:06) ä¸å¥½æ„æ€,å¹´å†…æ²¡æœ‰æ¢å·¥ä½œçš„æ„å‘. ","date":"2019-06-13T00:00:00Z","permalink":"/posts/2019/06/2019-06-13-kubernetesjenkins%E5%AE%9E%E7%8E%B0%E7%8E%B0%E4%BB%A3cicd%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%B8%80/","title":"kubernetes+jenkinså®ç°ç°ä»£cicdæµæ°´çº¿(ä¸€)"},{"content":"æ­¤æ–‡å†™äºä¸€å¹´åŠåˆ°ä¸¤å¹´å‰ï¼Œå†™äº†ä¸€åŠå°±åœä½ï¼Œå­˜è¿‡è‰ç¨¿å°±ä¸æƒ³å‘äº†ã€‚è¿‡äº†è¿™ä¹ˆä¹…ï¼Œå¯¹ä¸€äº›ä¸œè¥¿çš„çœ‹æ³•ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œç°åœ¨å›å¤´çœ‹çœ‹è¿‡å»å†™çš„ä¸œè¥¿ï¼Œè§‰å¾—æŒºæœ‰è¶£çš„ï¼Œä¸å¦¨å‘å‡ºæ¥å§ã€‚(è¾ƒåˆç¨¿æœ‰å¾®è°ƒ)\nå…³äºè‡ªç”±æ„å¿—çš„å­˜åœ¨é—®é¢˜ï¼Œæ˜¯å“²å­¦çš„ä¸€ä¸ªåŸºæœ¬å‘½é¢˜ã€‚\nä½•è°“è‡ªç”±æ„å¿—ï¼Œç®€å•ä¸¾ä¾‹ï¼š å¦‚æœä¸¤ä¸ªäººï¼Œæ‹¥æœ‰å®Œå…¨ä¸€è‡´çš„åŸºå› ï¼Œå®Œå…¨ä¸€è‡´çš„å¤§è„‘ï¼Œå®Œå…¨ä¸€è‡´çš„èº«ä½“æ„æˆå’Œå¤–è§‚ï¼Œå¹¶ä¸”æ‹¥æœ‰å®Œå…¨ä¸€æ ·çš„ç»å†ã€‚é‚£ä¹ˆï¼Œåœ¨æŸä¸ªä¸€è‡´çš„æ—¶é—´èŠ‚ç‚¹ä¸Šï¼Œä»–ä»¬èƒ½å¤Ÿ(æœ‰æƒåŠ›)é€‰æ‹©ä¸€ä¸ªäººåƒè›‹ç³•ï¼Œè€Œå¦ä¸€ä¸ªäººåƒæ¡ƒå­å—ï¼Ÿ\næœ‰ä¸¤ä¸ªå›ç­”ï¼š\n1.ä¸èƒ½(å”¯ç‰©çš„-ä¸–ç•Œå¯çŸ¥è®ºçš„-å†³å®šè®ºçš„) è‹¥å›ç­”æ˜¯ä¸èƒ½ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸¤ä¸ªäººå› ä¸ºæ‹¥æœ‰äº†å®Œå…¨ä¸€æ ·çš„ç‰©ç†å±æ€§ï¼Œæ‰€ä»¥ä¹Ÿä¼šæ°¸è¿œåšå‡ºåŒæ ·çš„é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºæ˜¯è¿™ä¸¤ä¸ªäººä¸­çš„å“ªä¸€ä¸ªï¼Œä»ç‰©è´¨[æˆ‘]å‡ºç°å¼€å§‹ï¼Œä¸€ç”Ÿçš„è¡Œä¸ºéƒ½æ˜¯å†³å®šå¥½äº†çš„ï¼Œä»–æ²¡æœ‰æƒåŠ›é€‰æ‹©ã€‚è™½ç„¶ä»–é¢å‰æœ‰ä¸€ä»½è›‹ç³•è¿˜æœ‰ä¸€ä¸ªæ¡ƒå­ï¼Œä»–ä»¥ä¸ºè‡ªå·±å¯ä»¥é€‰æ‹©åƒæ‰è›‹ç³•ï¼Œæˆ–è€…æ¡ƒå­ï¼Œå…¶å®çœŸæ­£çš„çœŸç›¸æ˜¯ä»–æ ¹æœ¬æ²¡æ³•åšå‡ºè‡ªå·±çš„é€‰æ‹©ã€‚æ–¯è¯ºå®¾èçš„å¾ˆå‡ºåçš„ä¸€å¥è¯\u0026quot;è¢«æ‰”å‡ºå»çš„çŸ³å¤´ä¹Ÿä»¥ä¸ºè‡ªå·±èƒ½å¤Ÿå†³å®šè‡ªå·±çš„è½ç‚¹å’Œè½¨è¿¹\u0026quot;\u0026ndash;äººä»¬æ„è¯†åˆ°è‡ªå·±çš„\u0026quot;æ„å¿—\u0026quot;ï¼Œå°±è®¤ä¸ºè‡ªå·±è‡ªç”±äº†ï¼Œå´ä»æœªçŸ¥æ™“è‡ªå·±æ„å¿—çš„æ¥æºã€‚è‡ªç”±æ„å¿—å°±åƒè¢«æ‰”å‡ºå»çš„çŸ³å¤´ä»¥ä¸ºæ˜¯è‡ªå·±é€‰æ‹©äº†è‡ªå·±çš„è½ç‚¹å’Œè½¨è¿¹ä¸€æ ·ä¸è¿‡æ˜¯ä¸ªå¹»è±¡ã€‚ å¦å®šè‡ªç”±æ„å¿—å¸¦æ¥çš„é—®é¢˜å¾ˆå¤šï¼š å‡å¦‚Aå› ä¸ºæ²¡é’±å¸æ¯’è€ŒæŠ¢åŠ«æ€å®³äº†Bï¼ŒAå¯ä»¥ä»¥æ­¤è¾©æŠ¤:\u0026ldquo;æˆ‘å¹¶æ²¡æœ‰é€‰æ‹©ï¼Œæˆ‘åªèƒ½è¿™æ ·åšã€‚æ¢æˆä½ ä»¬æ— è®ºå“ªä½æˆä¸ºæˆ‘ï¼Œä¹Ÿä¼šä¸€æ ·åšã€‚ä½ ä»¬ä¸å¯èƒ½å› ä¸ºæœ‰äººåœ¨æ²™æ¼ ä¸­å¤±æ°´ä¸§ç”Ÿè€Œè´£æ€ªæ²™æ¼ å§ï¼Ÿ\u0026rdquo;\n2.èƒ½(å”¯å¿ƒçš„-ä¸–ç•Œä¸å¯çŸ¥è®ºçš„-éå†³å®šè®ºçš„)\næ˜¾ç„¶ï¼Œä¸Šé¢æåˆ°çš„ç›¸å®¹è®ºçš„è§‚ç‚¹çš„å›ç­”æ˜¯\u0026quot;èƒ½\u0026quot;ã€‚åªè¦å›ç­”æ˜¯èƒ½ï¼Œé‚£ä¹ˆç‹¬ç«‹äºç‰©è´¨å¤–çš„è‡ªç”±æ„å¿—æ—¢æ˜¯å­˜åœ¨çš„ã€‚\nå½“ç„¶ï¼Œä¸Šé¢æåˆ°çš„åªæ˜¯å®Œå…¨å¦å®šè‡ªç”±æ„å¿—çš„å¼ºå†³å®šè®º(éç›¸å®¹è®º)çš„è§‚ç‚¹ã€‚åŒæ—¶ï¼Œè¿˜æœ‰ä¸€ç§å¼±å†³å®šè®ºçš„è§‚ç‚¹ï¼Œè¿™ç§è§‚ç‚¹è®¤ä¸ºï¼Œå†³å®šè®ºä¸è‡ªç”±æ„å¿—æ˜¯ä¸å†²çªçš„ï¼Œåˆå«ç›¸å®¹è®ºã€‚ä»–ä»¬è®¤ä¸ºï¼Œè™½ç„¶äººä»¬æ‰€æœ‰çš„ç‰©è´¨ç‰©ç†çŠ¶æ€ä¼šé™åˆ¶äººä»¬çš„è¡ŒåŠ¨ï¼Œä½†å¹¶ä¸ä¼šå†³å®šäººä»¬çš„è¡ŒåŠ¨ã€‚ç‰©ç†å½±å“äººè€Œä¸èƒ½å†³å®šäººï¼Œä¸¾ä¸ªä¾‹å­å°±åƒäººä»¬å¯ä»¥è‡ªç”±é€‰æ‹©æ˜¯è·‘ç€å»ä¸Šå­¦ï¼Œæˆ–è€…éª‘è½¦å»ä¸Šå­¦ï¼Œä½†æ— æ³•é€‰æ‹©åŒæ‰‹ä¸€æ‹å°±é£èµ·æ¥ç„¶åé£ç€ä¸Šå­¦ã€‚\nè¿™é‡Œè¿˜æ¶‰åŠåˆ°ä¸€ä¸ªå…³äºå……è¶³æ ¹æ®ç‡çš„å†…å®¹\u0026ndash;æ—¢ä¸ºä»€ä¹ˆå¯èƒ½è®¤ä¸ºä¸¤ä¸ªäººä¼šåšå‡ºåŒæ ·çš„é€‰æ‹©å‘¢?å› ä¸º\u0026lt;å› æœå…³ç³»\u0026gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯¹äºäº‹ä»¶çš„ç»“æœæ€»å¯ä»¥æ‰¾å¯»è®©å…¶å‘ç”Ÿçš„åŸå› (è¯¦æƒ…å¯ä»¥å‚è€ƒ[è®ºå……è¶³æ ¹æ®å¾‹çš„å››é‡æ ¹])ï¼Œå¦‚æœä¸€ä¸ªäº‹ä»¶æ²¡æœ‰ä»»ä½•åŸå› (æ˜¯ç›²ç›®çš„)ï¼Œé‚£ä¹ˆä»–ä¸ä¼šå‘ç”Ÿã€‚è€Œè‹¥ä»–ä»¬å¯ä»¥åšå‡ºä¸åŒçš„é€‰æ‹©ï¼Œé‚£ä¹ˆè‡ªç”±æ„å¿—ï¼Œå°±æ‰¾ä¸åˆ°è¿™æ ·æˆ–è€…é‚£æ ·ä¸€ä¸ªä½¿ä¹‹åšåˆ°çš„åŸå› (æ ¹æ®)ã€‚æ‰€ä»¥ï¼Œæ˜¾ç„¶çš„è¿™é‡Œå¸¦æ¥äº†ä¸€ä¸ªç–‘é—®ï¼Œ\u0026ldquo;å……è¶³æ ¹æ®å¾‹\u0026rdquo;(åŸå› å¯¼è‡´ç»“æœ)æ˜¯æ™®éå­˜åœ¨çš„ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šé€‚ç”¨èŒƒå›´çš„ï¼Ÿ\nè¿™ä¸ªé—®é¢˜æ˜¾ç„¶æ˜¯éå¸¸é‡è¦çš„ï¼Œæ—¢è‹¥\u0026quot;å……è¶³æ ¹æ®å¾‹\u0026quot;(åŸå› å¯¼è‡´ç»“æœ)æ˜¯å­˜åœ¨çš„ï¼Œé‚£ä¹ˆç§‘å­¦æ‰æ˜¯å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå“²å­¦æ‰æ˜¯å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå¯çŸ¥è®ºæ‰æ˜¯å­˜åœ¨çš„ã€‚å€˜è‹¥åœ¨æŸç§åœºæ™¯ä¸‹\u0026quot;å……è¶³æ ¹æ®å¾‹\u0026quot;ä¸å­˜åœ¨(æ—¢ç»“æœä¸ç”±åŸå› å¯¼è‡´ï¼Œç»“æœæ˜¯ç›²ç›®çš„)ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œç§‘å­¦åœ¨è¿™é‡Œä¹Ÿå¤±å»äº†æ•ˆåŠ›ï¼Œå¹¶ä¸”è¿™ä¸ªåœºæ™¯ä¸­ä¸€åˆ‡çš†ä¸å¯çŸ¥ã€‚\næ€€ç–‘è®ºè€…å°±æ˜¯ç«™åœ¨åé¢æ€€ç–‘æ˜¯å¦å­˜åœ¨ç§‘å­¦(æ—¢å› æœå¾‹ï¼ŒåŸå› å¯¼è‡´ç»“æœ)ï¼Œæ¯”å¦‚ä¼‘è°Ÿå°±è®¤ä¸ºï¼Œè‡ªç„¶ç§‘å­¦ä¸­å› æœå…³ç³»çš„æ ¹æ®ä¸æ˜¯ç†æ€§ï¼Œè€Œæ˜¯ç»éªŒã€‚ä»–è®¤ä¸ºï¼Œä¾æ®æ„Ÿè§‰å’Œå’Œåçœå¾—æ¥çš„æ‰€æœ‰å°è±¡ï¼Œæˆ‘ä»¬åªèƒ½å‘ç°æ‰€è°“çš„å› æœå…³ç³»ä¸è¿‡æ˜¯ä¸€ç§æ¥è¿‘å…³ç³»å’ŒæŒç»­å…³ç³»ã€‚åœ¨ã€Šäººç±»ç†è§£ç ”ç©¶ã€‹ä¸­ï¼Œä¼‘è°Ÿå¯¹å› æœæ¨ç†æå‡ºäº†è¯˜éš¾ã€‚ä¼‘è°Ÿè®¤ä¸ºï¼Œå®è¯ç§‘å­¦çš„ã€Œä¸€åˆ‡ç†è®ºä¼¼ä¹éƒ½å»ºç«‹åœ¨å› æœå…³ç³»ä¸Šã€ã€‚äº‹å®ä¹Ÿçš„ç¡®å¦‚æ­¤ï¼šåœ¨å¦‚ç‰©ç†å­¦è¿™æ ·çš„è‡ªç„¶ç§‘å­¦ä¸­ï¼Œæ— è®ºæ˜¯åšå®éªŒè¿˜æ˜¯å½’çº³ï¼Œæ— ä¸éœ€è¦å› æœæ€§çš„ä½“ç³»ã€‚é‚£ä¹ˆï¼Œå› æœå…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿä¼‘è°Ÿæ—¢åå¯¹æœºæ¢°å”¯ç‰©ä¸»ä¹‰ç”¨ã€ŒåŠ›ã€æ¥è¯´æ˜å› æœæ€§çš„åŸºç¡€ï¼Œä¹Ÿåå¯¹ç¬›å¡å°”ã€è´å…‹è±ç­‰äººç¥å­¦å”¯å¿ƒä¸»ä¹‰çš„å› æœè§‚ã€‚åœ¨ä»–çœ‹æ¥ï¼Œå› æœå…³ç³»çš„çŸ¥è¯†æ˜¯ä»ç»éªŒå¾—æ¥çš„ï¼Œè€Œä¸èƒ½æ¥è‡ªå…ˆå¤©çš„é€»è¾‘æ¨æ¼”ã€‚ç»éªŒåªèµ‹äºˆæˆ‘ä»¬é›¶æ˜Ÿçš„äº‹å®ï¼Œç»éªŒæœ¬èº«ä¸èƒ½æä¾›å› æœè”ç³»è§‚å¿µçš„æ™®éå¿…ç„¶æ€§ã€‚ç»éªŒçš„ç§¯ç´¯åªèƒ½ä½¿ç›¸ä¼¼çš„å¯¹è±¡å¢å¤šï¼Œè€Œä¸èƒ½æ–­è¨€ç»éªŒè¿‡çš„äº‹ç‰©ä¸æœªç»éªŒè¿‡çš„äº‹ç‰©ä¹‹é—´å…·æœ‰å¿…ç„¶æ€§ã€‚\nä¼‘è°Ÿä¸€ä¸ªè‘—åçš„è®ºè¯å°±æ˜¯å…³äºå› æœæ€§çš„è®ºè¯ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬é€šå¸¸æ‰€è®²çš„å¤ªé˜³æ™’çƒ­äº†çŸ³å¤´ï¼Œå¤ªé˜³æ˜¯çŸ³å¤´çƒ­çš„åŸå› ï¼ŒçŸ³å¤´çƒ­æ˜¯å¤ªé˜³æ™’çš„ç»“æœï¼Œä¸€ç‚¹éƒ½ä¸æ€€ç–‘ï¼Œæˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬æŠŠæ¡åˆ°äº†å®¢è§‚ç‰©è´¨ä¸–ç•Œçš„å› æœå¾‹â€”â€”â€”å› æœå…³ç³»ã€‚ä½†æ˜¯ä¼‘è°Ÿç»è¿‡ä¸¥æ ¼çš„åˆ†æï¼Œè®¤ä¸ºè¿™ç§è¯´æ³•æ˜¯ä¸æ­£ç¡®çš„ã€‚å¦‚æœè¦å®äº‹æ±‚æ˜¯åœ°çœ‹ï¼Œä¹Ÿå°±æ˜¯æŠŠç»éªŒæ´¾çš„åŸåˆ™è´¯å½»åˆ°åº•ï¼Œæˆ‘ä»¬å°±åªèƒ½çœ‹åˆ°å¤ªé˜³æ™’æ˜¯ä¸€ä¸ªäº‹å®ï¼ŒçŸ³å¤´çƒ­æ˜¯å¦å¤–ä¸€ä¸ªäº‹å®ï¼Œè™½ç„¶å¤ªé˜³æ™’åœ¨å‰ï¼ŒçŸ³å¤´çƒ­åœ¨åï¼Œä½†æ˜¯ä½ æ€ä¹ˆçŸ¥é“å¤ªé˜³æ™’æ˜¯çŸ³å¤´çƒ­çš„åŸå› ã€çŸ³å¤´çƒ­æ˜¯å¤ªé˜³æ™’çš„ç»“æœå‘¢ï¼Ÿæˆ‘ä»¬çœ‹åˆ°çš„çŸ³å¤´ã€å¤ªé˜³éƒ½æ˜¯äº‹å®ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°åŸå› å’Œç»“æœè¿™æ ·çš„æ¦‚å¿µï¼ŒåŸå› å’Œç»“æœã€å› æœæ€§è¿™éƒ½æ˜¯æŠ½è±¡æ¦‚å¿µï¼Œé‚£ä½ å‡­ä»€ä¹ˆè¯´å®¢è§‚ä¸–ç•Œæœ‰ä¸€ä¸ªåŸå› å’Œç»“æœï¼Ÿè¿™æ˜¯ä¼‘è°Ÿçš„åˆ†æã€‚\næˆ‘ä»¬å¹³æ—¶æ€»æ˜¯è¯´æœ‰åŸå› ã€ç»“æœï¼Œåœ¨è‡ªç„¶ç•Œä¸­åˆ°å¤„å¯»æ±‚å› æœå…³ç³»ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿä¼‘è°Ÿä¸æ»¡è¶³äºä»…ä»…æŒ‡å‡ºæˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°å› æœå…³ç³»ï¼Œè¿˜è¿›ä¸€æ­¥æŒ‡å‡ºæˆ‘ä»¬æ‰€è¯´çš„è¿™ä¸ªå› æœå…³ç³»æ˜¯æ€ä¹ˆæ¥çš„ã€‚æˆ‘ä»¬æ€ä¹ˆä¼šæŠŠé‚£äº›æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°çš„ä¸œè¥¿è¯¯è®¤ä¸ºæ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ä¸œè¥¿å‘¢ï¼Ÿä»–çš„è®ºè¯æ˜¯è¿™æ ·çš„ï¼šç”±äºå°è±¡å¤šæ¬¡é‡å¤ï¼Œçœ‹åˆ°å¤ªé˜³æ™’åœ¨å‰çŸ³å¤´çƒ­åœ¨åï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¢«ç§°ä½œåŸå› çš„åœ¨å‰ï¼Œä¸€ä¸ªè¢«ç§°ä½œç»“æœçš„åœ¨åï¼Œè¿™æ ·çš„ç°è±¡åå¤å‡ºç°ï¼Œåœ¨æˆ‘ä»¬çš„å¤´è„‘é‡Œå°±å½¢æˆäº†ä¸€ç§ä¹ æƒ¯æ€§çš„è”æƒ³ã€‚å½“çœ‹åˆ°å¤ªé˜³å‡ºæ¥çš„æ—¶å€™ï¼Œå½“æ„Ÿè§‰åˆ°çƒ­çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šäº§ç”Ÿä¸€ç§ä¹ æƒ¯æ€§çš„è”æƒ³ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°çŸ³å¤´æ™šä¸Šå†·äº†ï¼Œä¸­åˆåˆæ…¢æ…¢å˜çƒ­äº†ï¼Œæˆ‘ä»¬å°±ä¹ æƒ¯æ€§åœ°æƒ³åˆ°ä¸€å®šæœ‰ä¸€ç§åŸå› ä½¿å®ƒè¿™æ ·ï¼Œè€Œå¤ªé˜³æ™’å°±æ˜¯ç»å¸¸ä¼´éšç€çŸ³å¤´çƒ­çš„ä¸€ä¸ªäº‹å®ã€‚å½“æˆ‘ä»¬æ¯ä¸€æ¬¡ä¹ æƒ¯æ€§åœ°å¯»æ±‚åŸå› å’Œç»“æœæ—¶ï¼Œæˆ‘ä»¬éƒ½èƒ½æ‰¾åˆ°ï¼Œå¤šæ¬¡æˆåŠŸçš„å°è¯•ä½¿æˆ‘ä»¬å½¢æˆä¸€ç§ä¹ æƒ¯ï¼Œè®¤ä¸ºå¤ªé˜³æ™’æ˜¯çŸ³å¤´çƒ­çš„åŸå› ã€‚\næ—¢ç„¶å› æœå…³ç³»è¿™æ ·çš„æ¦‚å¿µæ˜¯æˆ‘ä»¬é€šè¿‡ä¹ æƒ¯æ€§çš„è”æƒ³å½¢æˆèµ·æ¥çš„ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæœ‰æŸç§æ•ˆåŠ›çš„è¯ï¼Œä¹Ÿåªæœ‰ä¸»è§‚çš„æ•ˆåŠ›ï¼Œè€Œæ²¡æœ‰å®¢è§‚çš„æ•ˆåŠ›ã€‚å®ƒä¸æ˜¯ä¸€ç§å®¢è§‚è§„å¾‹ï¼Œåªæ˜¯æˆ‘ä»¬ä¸»è§‚çš„ä¹ æƒ¯è”æƒ³è€Œå·²ï¼Œåªæ˜¯ä¸€ç§å¿ƒç†ä¸Šçš„äº‹å®è€Œä¸æ˜¯ä¸€ç§å®¢è§‚çš„äº‹å®ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¼‘è°Ÿå°±æŠŠå®¢è§‚çš„å› æœæ€§å³å› æœå¾‹ç»™è§£æ„äº†ã€‚åƒå› æœæ€§è¿™æ ·æˆ‘ä»¬ç§°ä¹‹ä¸ºè§„å¾‹çš„è”ç³»å®é™…ä¸Šæ²¡æœ‰å¿…ç„¶æ€§ï¼Œåªæœ‰ä¸€ç§æˆ–ç„¶æ€§ã€‚å°±æ˜¯å¤šåŠä¼šè¿™æ ·çš„ï¼Œå¤ªé˜³æ™’å¤šåŠä¼šä½¿çŸ³å¤´çƒ­ï¼ŒçŸ³å¤´çƒ­å¤šåŠä¼šæ˜¯å¤ªé˜³æ™’çš„ç»“æœï¼Œä½†é‚£æ˜¯ä¸ä¸€å®šçš„ã€‚æˆ‘ä»¬æŠŠå®ƒç§°ä¹‹ä¸ºå› æœå…³ç³»ï¼Œä½†å¾ˆå¯èƒ½äº‹å®ä¸Šä¸æ˜¯è¿™æ ·çš„ã€‚\nä¼‘è°Ÿçš„è¯´æ³•æœ‰ä»–çš„é“ç†ï¼Œå¤ªé˜³æ™’ä¸ä¸€å®šæ˜¯çŸ³å¤´çƒ­çš„åŸå› ï¼ŒçŸ³å¤´çƒ­ä¹Ÿæœ‰å¾ˆå¤šåŸå› ï¼Œå°½ç®¡å¤ªé˜³åœ¨æ™’ï¼Œä½†å¾ˆå¯èƒ½çŸ³å¤´çƒ­æ˜¯å› ä¸ºåˆ«çš„åŸå› ï¼Œæ¯”å¦‚æœ‰äººç”¨ç«æŠŠå®ƒçƒ§çƒ­äº†ï¼Œæˆ–è€…è¯´ç”¨å¼€æ°´æŠŠå®ƒçƒ«çƒ­äº†ï¼Œç­‰ç­‰ã€‚ä½†æ˜¯åƒçƒ§çƒ­çŸ³å¤´å’Œå¼€æ°´çƒ«çƒ­çŸ³å¤´è¿™ç§äº‹ä¸å¸¸è§ï¼Œæœ€å¸¸è§å°±æ˜¯å¤ªé˜³æ™’çƒ­çŸ³å¤´ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°çŸ³å¤´çƒ­åˆçœ‹åˆ°å¤ªé˜³å‡ºæ¥ï¼Œå°±ä¹ æƒ¯åœ°è”æƒ³åˆ°æ˜¯å¤ªé˜³æ™’çƒ­äº†çŸ³å¤´ã€‚ä½†ç»è¿‡ä¼‘è°Ÿçš„è§£é‡Šï¼Œè¿™æ ·ä¸€ç§å› æœæ€§çš„å®¢è§‚å¿…ç„¶æ€§å°±ä¸å­˜åœ¨äº†ã€‚ä¸¥æ ¼è¯´æ¥ï¼Œæˆ‘ä»¬åªèƒ½è¯´åœ¨å‰æˆ‘ä»¬çœ‹åˆ°å¤ªé˜³æ™’ï¼Œåœ¨åçœ‹åˆ°çŸ³å¤´çƒ­ï¼Œä½†æ˜¯æˆ‘ä»¬ç»å¯¹ä¸èƒ½è¯´æ˜¯å¤ªé˜³æ™’çƒ­äº†çŸ³å¤´ï¼Œæˆ–è€…è¯´çŸ³å¤´çƒ­æ˜¯å› ä¸ºå¤ªé˜³æ™’ã€‚å› ä¸ºä¸€ä¸ªåœ¨å‰ä¸€ä¸ªåœ¨åè¿™ç§æƒ…å†µå¤šå¾—å¾ˆï¼Œå‡­ä»€ä¹ˆè¯´åœ¨å‰çš„å°±æ˜¯åœ¨åçš„åŸå› ï¼Ÿåœ¨æ­¤ä¹‹å‰ä¸ç­‰äºæ˜¯å› ä¸ºæ­¤ï¼Œåªæ˜¯åœ¨æ—¶é—´ä¸Šåœ¨æ­¤ä¹‹å‰è€Œå·²ï¼Œå®ƒä¸ä¸€å®šæ˜¯å‘ç”Ÿåœ¨åé¢çš„äº‹æƒ…çš„åŸå› ã€‚\nè¿™æ˜¯ä¼‘è°Ÿçš„ä¸€ä¸ªéå¸¸æœ‰åŠ›çš„æ‰¹åˆ¤ã€‚ä»–å¯¹ä¸€åˆ‡å› æœæ€§éƒ½æŠ±æœ‰ä¸€ç§æ€€ç–‘æ€åº¦ã€‚å½“ç„¶ï¼Œä»–ä¸å¦è®¤æœ‰å®¢è§‚è§„å¾‹ï¼Œä»–åªæ˜¯è¯´æˆ‘ä»¬ä¸çŸ¥é“ï¼Œæ²¡æœ‰çœ‹åˆ°ã€‚ä¼‘è°Ÿæ˜¯éå¸¸å®äº‹æ±‚æ˜¯çš„ï¼Œä»–æŠŠè‡ªå·±ç§°ä½œæ˜¯â€œå®åœ¨è®ºè€…â€ï¼šæˆ‘æ˜¯å®åœ¨è®ºè€…ï¼Œæœ‰ä¸€è¯´ä¸€ï¼Œæœ‰äºŒè¯´äºŒã€‚æˆ‘çœ‹åˆ°ä»€ä¹ˆæˆ‘å°±è¯´ä»€ä¹ˆï¼Œæ²¡æœ‰çœ‹åˆ°çš„æˆ‘å°±ä¸è¯´ï¼Œæ—¢ä¸è‚¯å®šä¹Ÿä¸å¦å®šã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œæˆ‘ä»¬æ‰€è¯´çš„å› æœæ€§ï¼Œæ˜¯æ ¹æºäºæˆ‘ä»¬å¿ƒç†ä¸Šçš„ä¸€ç§éœ€è¦ï¼Œä¸€ç§ä¹ æƒ¯æ€§çš„è”æƒ³ï¼Œé•¿æœŸè¿™æ ·ï¼Œæˆ‘ä»¬ä¹ æƒ¯äº†ã€‚å®ƒå¯¹äºæˆ‘ä»¬æŠŠæ¡äº‹ç‰©éå¸¸æ–¹ä¾¿ï¼Œå®ƒä½¿æˆ‘ä»¬çš„çŸ¥è¯†æ˜¾å¾—å¥½åƒäº•äº•æœ‰æ¡ï¼Œå¦‚æ­¤è€Œå·²ã€‚\nä¸‹é¢æ¥èŠèŠåº·å¾·å¯¹æ­¤çš„çœ‹æ³•ï¼Œåº·å¾·çš„è®¤è¯†è®ºä¸­æŠŠä¸–ç•Œæœ¬æºä¸€åˆ†ä¸ºäºŒï¼Œæ—¢\u0026quot;è¡¨è±¡\u0026quot;å’Œ\u0026quot;ç‰©è‡ªä½“\u0026quot;ã€‚æˆ‘æ¥å¤§è‡´è§£é‡Šä¸€ä¸‹è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªå¸¸è§çš„å“²å­¦é—®é¢˜,\u0026ldquo;ä½ æ€ä¹ˆçŸ¥é“ä½ çœ¼ä¸­çš„çº¢è‰²(ä½“éªŒ)æ˜¯åˆ«äººçœ¼ä¸­çš„çº¢è‰²(ä½“éªŒ)å‘¢ï¼Ÿ\u0026quot;ã€‚ä½ ä¹Ÿè®¸å¯ä»¥è¯´\u0026quot;åƒè¡€é‚£æ ·çº¢\u0026rdquo;(ä½“éªŒ),ä½†åˆ«äººçš„è¡€åœ¨åˆ«äººçœ¼ä¸­æ˜¯è“è‰²çš„(ä½“éªŒ)ï¼Œä½†ä»–ä¸€ç›´ç§°ä¹‹ä¸ºçº¢è‰²å‘¢ï¼Ÿä½ ç”šè‡³è¿˜å¯ä»¥è¯´ï¼Œ\u0026ldquo;çº¢è‰²\u0026quot;ä¼šäººäº¢å¥‹ï¼Œ\u0026ldquo;è“è‰²\u0026quot;ä¼šè®©äººå®‰é™ï¼Œè€Œæ— è®ºè¿™ä¸ªäººæ˜¯è°ã€‚ä½†è¿™ç©¶ç«Ÿä¹Ÿåªæ˜¯ä½ çš„ä½“éªŒè€Œå·²ï¼Œåœ¨åˆ«äººçš„ä½“éªŒä¸­å¯èƒ½å°±æ˜¯ä½ ä½“éªŒä¸­çš„\u0026quot;è“è‰²\u0026quot;è®©åˆ«äººäº¢å¥‹å‘¢äº†ã€‚\nä»ä¸Šé¢è¿™ä¸ªä¾‹å­å°±ç®€å•çš„å¾—å‡ºï¼Œ\u0026ldquo;ä½“éªŒ\u0026quot;å’Œ\u0026quot;å®ä½“\u0026quot;å¹¶ä¸æ˜¯ä¸€å›äº‹ã€‚äººä»¬æ€»æ˜¯ç”¨è‡ªå·±çš„æ„Ÿå®˜å’Œå…ˆéªŒçš„æ—¶ç©ºè§‚å¿µä»¥åŠç†æ€§å»æ„ŸçŸ¥\u0026quot;å®ä½“\u0026rdquo;ï¼Œä»–ä»¬çš„æ„Ÿå®˜å’Œå…ˆéªŒçš„æ—¶ç©ºè§‚å¿µæœ¬èº«å°±æ˜¯ç¬¦åˆå……è¶³æ ¹æ®å¾‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç†è§£çš„\u0026quot;ä¸–ç•Œ\u0026quot;æœ¬èº«å°±æ˜¯ç”±ç†æ€§é€»è¾‘å’Œå› æœæ„æˆçš„ï¼Œæ‰€ä»¥ä¹Ÿå¿…ç„¶æ˜¯æœ‰æ™®éè§„å¾‹å’Œå› æœå…³ç³»çš„ã€‚ç„¶è€Œ\u0026quot;å®ä½“\u0026quot;æœ¬èº«åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œè¿™æ˜¯ä¸å¯çŸ¥çš„\u0026ndash;æ—¢æˆ‘ä»¬åªèƒ½å¾—åˆ°è§†è§‰\u0026quot;çº¢\u0026rdquo;ï¼Œæ„Ÿå—\u0026quot;çº¢\u0026rdquo;ï¼Œæ³¢é•¿\u0026quot;çº¢\u0026quot;,ä½†æˆ‘ä»¬æ°¸è¿œæ— æ³•çŸ¥é“ä»€ä¹ˆæ‰æ˜¯çœŸæ­£çš„\u0026quot;çº¢\u0026quot;ã€‚\nåº·å¾·å°†\u0026quot;ä½“éªŒ\u0026quot;ç§°ä½œ\u0026quot;è¡¨è±¡\u0026quot;ï¼Œå°†\u0026quot;å®ä½“\u0026quot;ç§°ä½œ\u0026quot;ç‰©è‡ªä½“\u0026quot;ã€‚ç‰©è‡ªä½“å¯ä»¥è®¤è¯†ä¸€åˆ‡ï¼Œå´ä¸èƒ½è¢«ä¸€åˆ‡æ‰€è®¤è¯†ã€‚\u0026mdash;-\u0026ldquo;äººé€šè¿‡æ„Ÿå®˜ç›´è§‰æŠŠå¤–ç‰©(ç‰©è‡ªä½“)æä¾›çš„ææ–™è¡¨ç°æˆæ„Ÿè§‰å¯¹è±¡â€•â€•çº¢ç»¿è½¯ç¡¬ç­‰ï¼Œé€šè¿‡å…ˆéªŒçš„æ—¶ç©ºè§‚å¿µç”±æ„Ÿè§‰å¯¹è±¡æ„æˆäº‹ç‰©çš„è¡¨è±¡â€•â€•æ¯”å¦‚ä¸€é¢—æ ‘çš„è¡¨è±¡ï¼Œé€šè¿‡ç†æ€§â€•â€•å…ˆéªŒç†æ€§â€•â€•æŠŠè®¸å¤šè¡¨è±¡æ”¾åœ¨ä¸€èµ·æ„æˆç°è±¡ç•Œã€‚æ®æ­¤ï¼Œæˆ‘ä»¬æ‰€äº†è§£çš„è‡ªç„¶ç•Œå®é™…ä¸Šå°±æ˜¯ç°è±¡ç•Œæˆ–è¡¨è±¡æ„æˆçš„ä¸–ç•Œã€‚è‡ªç„¶ç•Œæœ‰å› æœå…³ç³»ï¼Œæœ‰æ™®éå¿…ç„¶è§„å¾‹ï¼Œå®ƒä»¬æ— éœ€å½’çº³è¯æ˜ï¼Œå› ä¸ºè‡ªç„¶ç•Œæ˜¯å…ˆéªŒç†æ€§æŒ‰ç…§è¿™äº›æ³•åˆ™æ„æˆçš„ã€‚ æ‰€ä»¥æˆ‘ä»¬çŸ¥é“çš„è‡ªç„¶ç•Œéƒ½æ˜¯ç°è±¡ç•Œæˆ–è€…è¯´è¡¨è±¡ä¸–ç•Œä¸­çš„ä¸œè¥¿ï¼Œè€Œç‰©è‡ªä½“æ˜¯ä»€ä¹ˆæ ·å­ï¼Œè¿™æ˜¯ä¸å¯çŸ¥çš„ã€‚è¿™å°±æ˜¯è‘—åçš„å…³äºä¸–ç•Œæœ¬åŸçš„äºŒå…ƒè®ºã€‚\u0026rdquo;\næ‰€ä»¥ï¼Œ\u0026ldquo;å……è¶³æ ¹æ®å¾‹\u0026rdquo;(å› æœè§„å¾‹)å¯¹äºç‰©è‡ªä½“å°±æ— æ•ˆäº†ã€‚æ—¢ \u0026ldquo;å……è¶³æ ¹æ®å¾‹\u0026rdquo;(å› æœè§„å¾‹ï¼Œç§‘å­¦)åªå¯¹è¡¨è±¡(ä½“éªŒ)äº§ç”Ÿä½œç”¨ï¼Œè€Œå¯¹äº§ç”Ÿè¡¨è±¡(ä½“éªŒ)çš„ç‰©è‡ªä½“(å®ä½“ï¼Œè®¤è¯†ä¸€åˆ‡ä¸è¢«ä¸€åˆ‡æ‰€è®¤è¯†)å¤±æ•ˆã€‚\né‚£ä¹ˆç‰©è‡ªä½“çš„æˆ‘çš„ä¸»ä½“æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå”æœ¬åç»™å‡ºå®ƒä½œä¸ºå†…éƒ¨ä¸»è§‚çš„ä¸€é¢(ä¸»ä½“æ—¢å®¢ä½“)-æ„å¿—(ã€Šä½œä¸º_æ„å¿—å’Œè¡¨è±¡çš„ä¸–ç•Œ_ã€‹)ã€‚\næœªå®Œï¼Œä¹Ÿè®¸å¾…ç»­(æ–‡ä¸­ä¼‘è°Ÿéƒ¨åˆ†æ‘˜æŠ„äº†ä¸€äº›é‚“æ™“èŠ’æ•™æˆè°ˆçº¯ç²¹ç†æ€§æ‰¹åˆ¤çš„æ¼”è®²,æ ‡æ³¨ä¸‹)\u0026hellip;.\nå†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nhuan (2019-06-12 10:58) åº·å¾·çš„æœ‰ç‚¹éš¾ç†è§£ lsprit (2019-06-12 12:12) åº·å¾·çš„è¿˜å¥½å§ï¼Œå”æœ¬åçš„ä¸€äº›è§‚ç‚¹å€’æ˜¯å¾ˆæœ‰è§åœ°ï¼Œå°¤å…¶æ˜¯ç”Ÿå­˜æ„å¿—è½®ï¼Œç¡®å®å¾ˆç‰›é€¼ ","date":"2019-06-06T00:00:00Z","permalink":"/posts/2019/06/2019-06-06-%E8%B0%88%E8%87%AA%E7%94%B1%E6%84%8F%E5%BF%97/","title":"è°ˆè‡ªç”±æ„å¿—"},{"content":"ä¼ ç»Ÿçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸€èˆ¬æ˜¯:\nå®¢æˆ·ç«¯ -\u0026gt; dns -\u0026gt; 4å±‚åº“åœ¨å‡è¡¡(HA) -\u0026gt; 7å±‚è´Ÿè½½å‡è¡¡ -\u0026gt; å…·ä½“çš„åç«¯æœåŠ¡\nè¿™ç§æ–¹å¼å¤„ç†æœåŠ¡å‘ç°å’ŒåŠ¨æ€é…ç½®æ¯”è¾ƒéš¾æ,æ¯”å¦‚åç«¯æœåŠ¡åŠ¨æ€æ‰©ç¼©å®¹ä»€ä¹ˆçš„ã€‚ ä¸€å¼€å§‹çš„åšæ³•è‚¯å®šæ˜¯OPäººå·¥ç»´æŠ¤7å±‚è´Ÿè½½å‡è¡¡é›†ç¾¤é…ç½®ï¼Œä»¥nginxä¸ºä¾‹ï¼Œç”¨gitä»“åº“ä¹‹ç±»çš„åšäººå·¥æœåŠ¡å‘ç°å’Œå˜æ›´ã€‚è¿™æ ·å¾ˆæ˜¾ç„¶æ˜¯ä¸ç§‘å­¦çš„ã€‚ç„¶åå°±ä¼šå¼€å§‹å¸Œæœ›ç”¨ç§ç§è‡ªåŠ¨åŒ–çš„æ‰‹æ®µå»å¤„ç†æœåŠ¡å‘ç°ï¼Œæ¯”å¦‚å¾®åšçš„nginx-upsync-module,æ¯”å¦‚nginx-luaï¼Œæ¯”å¦‚openrestyï¼Œæ¯”å¦‚etcd+confdç­‰ç§ç§æ‰‹æ®µå®ç°æœåŠ¡å‘ç°å’Œè‡ªåŠ¨åŒ–é…ç½®ï¼Œä½†è¿˜æ˜¯æœ‰å¾ˆå¤šç‘•ç–µï¼Œæ¯”å¦‚etcd+confdæ¯æ¬¡ä¿®æ”¹upstreamçš„æœåŠ¡åç«¯å°±è¦reload nginxï¼Œnginxçš„ç­–ç•¥ä¼šæ–°å¼€xä¸ªworkerï¼Œå®¹æ˜“é€ æˆæ€§èƒ½é—®é¢˜ç”šè‡³æœºå™¨é¡¶ä¸ä½ã€‚è€Œä¸”vmæœåŠ¡æœºå™¨çš„é€»è¾‘å’ŒupstreamæŒ‚é’©ä¹Ÿæœ‰é—®é¢˜ï¼Œæ€»ä¹‹ï¼Œéº»çƒ¦çš„å¾ˆã€‚\nè€Œkuberneteså¤„ç†è¿™ä¸€å¥—æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡çš„æ–¹æ³•å°±æŒºå¥½ç”¨çš„ï¼Œæ¯”å¦‚æ¥ä¸‹æ¥ä¼šå®è·µçš„è¿™ä¸€å¥—nginx-ingress+externalIP+dnsçš„æ–¹å¼å°±å¾ˆç›´è§‚è€Œä¸”æ–¹ä¾¿è‡ªåŠ¨åŒ–æµç¨‹ï¼Œå¤§è‡´ç­–ç•¥å¦‚ä¸‹:\nå®¢æˆ·ç«¯ -\u0026gt; dns -\u0026gt; k8s-nginx-ingress-service(in ExternalIP) -\u0026gt; ingress-obj -\u0026gt; service -\u0026gt; pod\nkubernetesé›†ç¾¤ä¸­å…·ä½“å·¥ä½œçš„podæ˜¯ç”±serviceåšè´Ÿè½½å‡è¡¡å’ŒæœåŠ¡å‘ç°çš„ï¼Œè€Œserviceçš„å¤–éƒ¨å‘ç°ç­–ç•¥é€šå¸¸æœ‰NodePortï¼ŒKube-proxyä»¥åŠIngressã€‚å¯¹äºå†…éƒ¨æœåŠ¡æš´éœ²ç»™å¤–éƒ¨ï¼ŒNodePortåŸºæœ¬ä¸Šæ˜¯ä¸å¥½ç”¨çš„ï¼Œå› ä¸ºæœ¬æ¥Portå°±æœ‰é™ï¼Œè€Œä¸”å¦‚æœæ˜¯webæœåŠ¡(80,443)ï¼Œéœ€è¦æ¥dnsçš„ï¼Œå¼€åœ¨30000+ç«¯å£ä»¥ä¸Šï¼Œè¿˜å¾—åœ¨å¤–éƒ¨åšä¸€ä¸ªå››å±‚è´Ÿè½½å‡è¡¡ï¼Œè¿™æ ·å°±å¾ˆçƒ¦ã€‚Kube-proxyç”¨åœ¨è°ƒè¯•ç¯å¢ƒè¿˜è¡Œï¼ŒåŒæ ·æœ‰ä»¥ä¸Šé—®é¢˜ï¼Œæ‰€ä»¥Ingressæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\nnginx-ingressé‡‡ç”¨äº†nginx-luaæ¨¡å—å®ç°upstreamåŠ¨æ€ä¿®æ­£ï¼Œæ— éœ€reload nginxï¼Œå¯ä»¥è§£å†³ä¸Šè¿°æåˆ°çš„2x workerå¯¼è‡´æ€§èƒ½ä¸‹é™é—®é¢˜ã€‚ä¸”ç»“åˆäº†serviceçš„podsè‡ªåŠ¨å‘ç°(coredns)ï¼Œè½»æ¾ç®€å•çš„å®Œæˆå¾ˆå¤šè¿‡å»å¾ˆéº»çƒ¦çš„ä»»åŠ¡ã€‚\né¦–å…ˆåœ¨ä¸Šç¯‡blogé‡Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªk8sé›†ç¾¤ï¼Œç„¶åæˆ‘ä»¬åˆ›å»ºingress-nginxç›¸å…³çš„apiå¯¹è±¡\nwget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/mandatory.yaml kubectl apply -f mandatory.yaml #ä¼šåˆ›å»ºå¥½ç›¸åº”çš„ingress-nginx controllerå’Œrbacç›¸å…³api [root@xxxxxxxx ingress-nginx]# kubectl get pods -n ingress-nginx NAME READY STATUS RESTARTS AGE nginx-ingress-controller-5694ccb578-hwj2j 1/1 Running 0 3h11m ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªingressçš„serviceï¼Œç”¨ExternalIPçš„æ–¹å¼æš´éœ²ç»™é›†ç¾¤å¤–éƒ¨\nvim externalIp-ingress-service.yaml apiVersion: v1 kind: Service metadata: name: ingress-nginx namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx spec: ports: - name: http port: 80 protocol: TCP - name: https port: 443 protocol: TCP selector: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx externalIPs: #è¿™é‡Œå¡«å†™ä½ çš„k8s masterip - 10.1.33.159 #å°†åˆ›å»ºå‡ºå¦‚ä¸‹æœåŠ¡ [root@xxxxxxxxxxxx ingress-nginx]# kubectl get service -n ingress-nginx NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE ingress-nginx ClusterIP 10.96.139.222 10.1.33.159 80/TCP,443/TCP 3h12m æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºå…·ä½“çš„ingresså¯¹è±¡äº†\nvim rook-ceph-ingress.yaml apiVersion: extensions/v1beta1 kind: Ingress metadata: name: rook-ceph-ingress annotations: nginx.ingress.kubernetes.io/ssl-redirect: \u0026#34;false\u0026#34; #è¦æš´éœ²çš„serviceå¯¹åº”çš„å‘½åç©ºé—´ namespace: rook-ceph spec: rules: #è¿™é‡ŒæŒ‰éœ€é…ç½®,å°±æ˜¯nginxçš„é…ç½®æ–¹æ³•,å…·ä½“æŸ¥ä¸‹ingress-nginxçš„é¡¹ç›®æ–‡æ¡£ - host: k8s-ceph-dashboard.calmkart.com http: paths: - path: / backend: serviceName: rook-ceph-mgr-dashboard servicePort: 8443 kubectl apply -f rook-ceph-ingress.yaml #è¿™ä¸ªingresså°†è‡ªåŠ¨å‘ç°rook-cephå‘½åç©ºé—´ä¸­çš„rook-ceph-mgr-dashboardæœåŠ¡ï¼Œå¹¶å°†ä¹‹ä½œè´Ÿè½½å‡è¡¡å¯¹å¤–æš´éœ² [root@xxxxxxxxxxx ingress]# kubectl get service -n rook-ceph NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE rook-ceph-mgr ClusterIP 10.99.37.148 9283/TCP 3h48m rook-ceph-mgr-dashboard ClusterIP 10.110.163.110 8443/TCP 3h48m rook-ceph-mon-a ClusterIP 10.103.5.55 6789/TCP,3300/TCP 3h49m rook-ceph-mon-b ClusterIP 10.104.22.199 6789/TCP,3300/TCP 3h49m rook-ceph-mon-c ClusterIP 10.110.80.82 6789/TCP,3300/TCP 3h49m ç„¶åæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ingressçŠ¶æ€\n[root@xxxxxxxxxx ingress]# kubectl get ingress -n rook-ceph NAME HOSTS ADDRESS PORTS AGE rook-ceph-ingress k8s-ceph-dashboard.calmkart.com 10.1.33.159 80 170m è¿™æ ·å°±æ²¡é—®é¢˜äº† æœ€åæˆ‘ä»¬æŠŠdnsè®°å½•k8s-ceph-dashboard.calmkart.comæŒ‡å‘10.1.33.159\næå®šã€‚\nå†å²è¯„è®º (8 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nduboops (2019-05-25 18:19) æ¥¼ä¸»é‡‡ç”¨çš„K8sè´Ÿè½½å‡è¡¡ç­–ç•¥åœ¨æ€§èƒ½ä¸Šä¼šä¼˜äºä¼ ç»Ÿçš„å‡è¡¡ç­–ç•¥ä¹ˆï¼Ÿ calmkart (2019-05-29 17:05) æˆ‘è¿™ä¸ªä¾‹å­é‡ŒåŸºæœ¬ä¸Šä¸ä¼šï¼Œå› ä¸ºå®é™…ä¸Šéƒ½æ˜¯ç”¨çš„nginxä½œè´Ÿè½½å‡è¡¡.ä½†åœ¨å†…éƒ¨corednsçš„æ€§èƒ½ä¸Šå¯èƒ½ä¼šæœ‰ä¸€äº›æå‡.ä¸è¿‡ç½‘ç»œç¯å¢ƒä¸­çš„æ€§èƒ½ç“¶é¢ˆä¸€èˆ¬ä¸ä¼šå‡ºåœ¨è´Ÿè½½å‡è¡¡å±‚. hukerlet (2019-06-10 20:50) çœ‹äº†æ¥¼ä¸»çš„æ–‡ç« ï¼Œæ„Ÿè§‰æ‚¨ä»äº‹çš„å·¥ä½œæ˜¯åšåŸºç¡€æ¶æ„ä¹ˆï¼Œå¥½äº›æ–‡ç« å†™çš„çœŸå¥½ï¼Œæ„Ÿè§‰æ‚¨å¯¹k8sç ”ç©¶çš„å¾ˆé€å½»ã€‚å°å¼Ÿåˆšä»äº‹è¿ç»´å·¥ä½œæ²¡å¤šä¹…ï¼Œæœ€è¿‘å·¥ä½œä¸­ç”¨åˆ°äº†å®¹å™¨ï¼Œä½†å¯¹è¿™æ–¹é¢æ˜¯ä¸€çŸ¥åŠè§£ï¼Œä¸çŸ¥é“æ‚¨èƒ½å¦æŠ½ç©ºå†™äº›dockeræ–¹é¢çš„æ–‡ç« å‘¢ï¼Œæ„Ÿæ¿€ä¸å°½ã€‚ calmkart (2019-06-11 11:05) è¯»ä¹¦å§ï¼Œå…¥é—¨ã€Šæ¯å¤©5åˆ†é’Ÿç©è½¬dockerã€‹ï¼Œè¿›é˜¶ã€ŠDockerå®¹å™¨ä¸å®¹å™¨äº‘(ç¬¬äºŒç‰ˆ)ã€‹ linda_zhang (2019-06-27 16:20) åšä¸»å¥½ï¼Œæˆ‘æ˜¯äº’åŠ¨å‡ºç‰ˆçš„çº¦ç¨¿ç¼–è¾‘ï¼Œæœ‰å¹¸é˜…è¯»åˆ°æ‚¨åšå®¢ä¸Šçš„æ–‡ç« ï¼Œæ„Ÿè§‰æ‚¨çš„æ–‡ç« å†…å®¹åå‘å…¥è®°å½•æ•´ç†åœ¨å·¥ä½œä¸­ç¢°åˆ°çš„æ¡ˆä¾‹ï¼Œå†…å®¹è´¨é‡ä¸ŠæŒºä¸é”™çš„ï¼Œè¦æ˜¯åŠ ä»¥æ•´ç†æƒ³å¿…è´¨é‡ä¼šæ›´èƒœä¸€ç­¹ï¼Œä¸çŸ¥é“æ‚¨æœ‰æ²¡æœ‰è€ƒè™‘è¿‡å°†åšå®¢æ–‡ç« å†æ¬¡å½’çº³æ•´ç†ä¸‹ï¼Œå¹¶æ–°å¢ç›¸å…³ç« èŠ‚ï¼Œé›†ç»“å‡ºç‰ˆå‘¢ï¼Œäº’åŠ¨å‡ºç‰ˆç¤¾ä¸»è¦æ˜¯é¢å‘å¹¿å¤§äº’è”ç½‘è¯»è€…æ¨å‡ºç›¸å…³æŠ€æœ¯ä¹¦ç±ï¼Œç›®å‰å¹´å‘è¡Œå†Œæ•°è¶…è¿‡ç™¾ä¸‡ï¼Œåœ¨äº’è”ç½‘è¯»è€…ä¸­æœ‰è¾ƒå¤§çš„å½±å“åŠ›ã€‚æœŸå¾…åšä¸»æ‹¨å†—å›å¤ï¼Œè¯¦å™å…·ä½“äº‹å®œã€‚æˆ‘çš„é‚®ç®±ï¼š329647550#qq.com (æ³¨ï¼šå‘é€é‚®ä»¶æ—¶è¯·å°†#å·è½¬ä¸º@) xiaohua (2019-07-09 19:55) æ¥¼ä¸»ï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜æƒ³å‘æ‚¨è¯·æ•™ä¸‹ï¼Œæˆ‘ä¸ªäººæƒ³å¾€æŸä¸€ä¸ªæŠ€æœ¯æ–¹å‘å»å‘å±•ï¼Œæ¯”å¦‚æˆä¸ºk8sä¸“å®¶ã€æˆ–è€…mysqlä¸“å®¶ï¼Œä½†æ˜¯æ„Ÿè§‰åªé’»ç ”ä¸€ä¸ªæ–¹å‘ä¼šä¸ä¼šä»¥åçš„è·¯ä¼šå¾ˆçª„ï¼Œä¸çŸ¥é“æ‚¨æ€ä¹ˆçœ‹ã€‚ calmkart (2019-07-16 11:11) çœ‹æ˜¯å“ªç§é’»ç ”äº†.è®²é“ç†ä¸€ä¸ªæŸå•æ–¹é¢çš„ä¸“å®¶,å…¶ä»–æ–¹é¢ä¹Ÿä¸ä¼šè¯´å®Œå…¨ä¸ä¼š.é¢å­¦ç‰‡ç²¾å§. xiaohua (2019-07-17 11:43) å—¯å—¯ï¼Œæ‚¨è¯´çš„å¯¹ï¼Œæˆ‘ä¹Ÿè§‰å¾—å¾€ä¸“å®¶å‘å±•åº”è¯¥è§¦ç±»æ—é€šï¼Œç²¾é€šä¸€ç‚¹ï¼Œä¹Ÿè¦äº†è§£å…¶ä»–çš„ï¼Œè¦ä¸ç„¶å°±æ˜¯ç©ºä¸­æ¥¼é˜äº†ï¼Œè°¢è°¢æ‚¨çš„å»ºè®® ","date":"2019-05-25T00:00:00Z","permalink":"/posts/2019/05/2019-05-25-kubernetes%E9%9B%86%E7%BE%A4%E4%B8%AD%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E5%A4%96%E9%83%A8%E5%8F%91%E7%8E%B0/","title":"kubernetesé›†ç¾¤ä¸­æœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œå¤–éƒ¨å‘ç°"},{"content":"k8sä¸­podçš„å­˜å‚¨åœ¨éå•èŠ‚ç‚¹æ˜¯ä¸æ”¯æŒhostpathçš„ï¼Œéƒ½å¾—ç”¨å„ç§åˆ†å¸ƒå¼å­˜å‚¨æ¥å®ç°.æ¯ä¸ªpvcå¯¹åº”çš„pvæ‰‹å·¥åˆ›å»ºä¹Ÿå¾ˆä¸ç°å®,è¯•äº†ä¸‹rook-cephåˆ†å¸ƒå¼å­˜å‚¨çš„ææ³•ï¼Œæ„Ÿè§‰ä¸é”™.å…¶ä¸­ä¹Ÿè¿˜æ˜¯é‡åˆ°äº†å¾ˆå¤šå‘,è¿™é‡Œç¨å¾®è®°å½•ä¸€ä¸‹.\né¦–å…ˆæœ‰ä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„k8sé›†ç¾¤ é¦–å…ˆåˆ›å»ºrook-ceph-common\nwget https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/common.yaml kubectl apply -f common.yaml ç„¶ååˆ›å»ºrook-ceph-operator\nwget https://raw.githubusercontent.com/rook/rook/release-1.0/cluster/examples/kubernetes/ceph/operator.yaml kubectl apply -f operator.yaml ä»¥ä¸Šä¸¤æ­¥åŸºæœ¬ä¸Šä¸ä¼šå‡ºå•¥é—®é¢˜,æ ‡å‡†é…ç½® æ¥ä¸‹æ¥åˆ›å»ºclusterçš„é—®é¢˜æ¯”è¾ƒå¤š,è´´ä¸Šæˆ‘çš„é…ç½®\nvim cluster.yaml apiVersion: ceph.rook.io/v1 kind: CephCluster metadata: name: rook-ceph namespace: rook-ceph spec: cephVersion: image: ceph/ceph:v14.2.1-20190430 allowUnsupported: true #è®¾ç½®dataè·¯å¾„åˆ°è‡ªå·±è§„åˆ’çš„è·¯å¾„ dataDirHostPath: /home/shared/rook mon: count: 3 allowMultiplePerNode: true dashboard: enabled: true port: 8443 urlPrefix: / #å…³é—­https ssl: false network: #å¦‚è¦åœ¨k8sé›†ç¾¤å¤–ä½¿ç”¨,è¿™é‡Œå¯ä»¥æ‰“å¼€ hostNetwork: false rbdMirroring: workers: 0 storage: #å…¨èŠ‚ç‚¹ä½¿ç”¨ useAllNodes: true useAllDevices: false deviceFilter: config: osdsPerDevice: \u0026#34;1\u0026#34; directories: - path: /home/shared/rook kubectl apply -f cluster.yaml æŸ¥çœ‹éƒ¨ç½²æƒ…å†µ è¿™æ ·å°±åŸºæœ¬ä¸Šæ²¡é—®é¢˜äº†,k8sä¸­çš„æ¯ä¸ªNodeä¼šå¯ä¸¤ä¸ªpod(rook-ceph-agentå’Œrook-discover),å¹¶ä¸”mgrå’Œosdéƒ½æ²¡é—®é¢˜ã€‚ ç„¶åç»™ceph-dashboardæä¾›NodePortçš„å¤–éƒ¨è®¿é—®service\nvim dashboard-external-http.yaml apiVersion: v1 kind: Service metadata: name: rook-ceph-mgr-dashboard-external-https namespace: rook-ceph labels: app: rook-ceph-mgr rook_cluster: rook-ceph spec: ports: - name: dashboard port: 8443 protocol: TCP targetPort: 8443 selector: app: rook-ceph-mgr rook_cluster: rook-ceph sessionAffinity: None type: NodePort kubectl apply -f dashboard-external-https.yaml ç„¶åæŸ¥çœ‹ä¸‹serviceçš„æƒ…å†µ,æ˜¯å¦æ­£å¸¸ è¿™æ ·å°±å¯¹äº†,å¯ä»¥è®¿é—®ä¸€ä¸‹http://:ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯èƒ½è¿›ceph-dashboard\nä¸€èˆ¬æƒ…å†µä¸‹é—®é¢˜ä¸å¤§,æŸ¥çœ‹adminçš„é»˜è®¤å¯†ç \nkubectl -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath=\u0026#34;{[\u0026#39;data\u0026#39;][\u0026#39;password\u0026#39;]}\u0026#34; | base64 --decode \u0026amp;\u0026amp; echo ä½†æ˜¯adminç™»é™†è¿›å»äº†ä¹‹åï¼Œè‚¯å®šä¼šç–¯ç‹‚500é”™è¯¯ï¼ŒæŸ¥äº†ä¸‹å®˜æ–¹çš„issueï¼Œè¿™é‡Œæœ‰bugã€‚\nè§£å†³åŠæ³•æ˜¯: åœ¨dashboardé‡Œåˆ›å»ºä¸€ä¸ªæ–°roleè§’è‰²(å³ä¸Šè§’ç”¨æˆ·ç®¡ç†,roles)ï¼ŒæŠŠæƒé™å…¨é’©ä¸Šï¼Œç„¶åå»æ‰iscsiçš„æ‰€æœ‰æƒé™ã€‚ æ¥ç€åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·,ç»‘å®šè¿™ä¸ªæ–°çš„roleè§’è‰²,æœ€åç”¨æ–°ç”¨æˆ·ç™»é™†\næ¥ç€åˆ›å»ºpoolå’Œstorageç”¨äºè‡ªåŠ¨ç”ŸæˆpvcåŒ¹é…çš„pv\nvim storageclass.yaml apiVersion: ceph.rook.io/v1 kind: CephBlockPool metadata: name: replicapool namespace: rook-ceph spec: replicated: size: 2 --- apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: rook-ceph-block provisioner: ceph.rook.io/block parameters: blockPool: replicapool clusterNamespace: rook-ceph fstype: xfs kubectl apply -f storagecalss.yaml åˆ›å»ºpoolå’Œstorageä¹‹åé€šè¿‡dashboardæˆ–è€…å‘½ä»¤ kubectl get cephcluster -n rook-ceph æŸ¥çœ‹ä¸€ä¸‹é›†ç¾¤æ˜¯å¦healthï¼Œå¦‚æœæ˜¯healthå°±æ²¡æ¯›ç—…äº†\næœ€åæµ‹è¯•ä¸€ä¸‹ç”³è¯·ä¸€ä¸ªpvcçœ‹çœ‹æ˜¯å¦ä¼šè‡ªåŠ¨ç”Ÿæˆpvä¸ä¹‹ç»‘å®š\napiVersion: v1 kind: PersistentVolumeClaim metadata: name: jenkins-home namespace: kube-ops labels: app: jenkins-home spec: storageClassName: rook-ceph-block accessModes: - ReadWriteOnce resources: requests: storage: 20Gi å¯è§ï¼Œç®¡ç”¨äº†.\nå¤–åŠ ä¸€äº›å°tips:\nå¦‚æœrook-cephé…ç½®æœ‰è¯¯éœ€è¦è¿˜åŸé‡æ–°é…ç½®,ä¸€å®šè¦éµå¾ªå®˜æ–¹çš„æ¸…ç†æ­¥éª¤ https://rook.github.io/docs/rook/v1.0/ceph-teardown.html åˆ‡è®°è¦åˆ é™¤æ‰æ‰€æœ‰k8sçš„nodeä¸Šé…ç½®çš„dataæ–‡ä»¶å¤¹,ä¸ç„¶ä¼šå¯¼è‡´æ–°é›†ç¾¤æ— æ³•åˆå§‹åŒ–.\nåˆ›å»ºä¸å‡ºpodå¾ˆå¤šéƒ½æ˜¯æƒé™åŸå› æˆ–è€…nodeæ— æ³•è°ƒåº¦,éœ€è¦æ£€æŸ¥ä¸‹rbacæƒé™è®¾ç½®æˆ–è€…å„ä¸ªnodeçš„æƒ…å†µ.\næœ€åé™„ä¸Šrooké¡¹ç›®çš„githubåœ°å€: https://github.com/rook/rook\nå†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nhuan (2019-05-28 16:30) å¤§ä½¬åˆå¼€å§‹æK8Sï¼Œæˆ‘è¦è·Ÿç€å­¦ä¹ å­¦ä¹  calmkart (2019-05-29 17:06) å­¦å­¦å­¦,å»ºè®®ä¹°è¯¾,æå®¢æ—¶é—´å¼ ç£Šåšå£«çš„æ·±å…¥å‰–æk8så¾ˆå¥½ ","date":"2019-05-24T00:00:00Z","permalink":"/posts/2019/05/2019-05-24-kubernetes%E6%90%AD%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8rook-ceph%E7%9A%84pv%E5%AD%98%E5%82%A8/","title":"kubernetesæ­å»ºå¹¶ä½¿ç”¨rook/cephçš„pvå­˜å‚¨"},{"content":"ABæµ‹è¯•çš„æµé‡å¤åˆ¶å·¥å…·ä»¥å‰æœ‰tcpdumpå•¥çš„ï¼Œè®²é“ç†ä¸å¥½ç”¨ï¼Œå•°é‡Œå…«å—¦çš„ï¼Œä¸é«˜æ˜ï¼Œæ‡‚å¾—éƒ½æ‡‚ã€‚æ‰€ä»¥ç”¨ä¸€æ¬¾å¥½ç”¨çš„æ–°è´§ï¼Œgoreplayã€‚ githubåœ°å€:\nhttps://github.com/buger/goreplay\nå…ˆä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶åˆ°æœºå™¨ä¸Šï¼Œä½¿ç”¨æ–¹æ³•åŠå…¶ç®€å•\n#å‡è®¾æœ‰ä¸¤å°æœºå™¨,æœºå™¨åæ˜¯vm1å’Œvm2,éœ€è¦å°†vm1çš„8900ä¸Šçš„è¯·æ±‚æµé‡å¤åˆ¶åˆ°vm2çš„8900ä¸Š,å¹¶ä¸”é™åˆ¶ä¸ºgetè¯·æ±‚,ç„¶åå°†æµé‡ç¼©å°ä¸ºåŸæ¥çš„10%ï¼Œå¹¶å°†vm2çš„8900ä¸Šæ”¶åˆ°çš„è¯·æ±‚å’Œè¿”å›è¾“å‡ºåˆ°æ–‡ä»¶é‡Œï¼Œå¦‚ä¸‹æ“ä½œå³å¯ #vm1 ./gor --input-raw :8900 --output-http=\u0026#34;http://vm2:8900|10%\u0026#34; --http-allow-method GET #vm2 ./gor --input-raw :8900 --output-http-track-response --input-raw-track-response --output-file=goreplay_response.log ä»¥ä¸Šæµç¨‹æ˜¯ç”¨goreplayå°†vm1ä¸­8900ç«¯å£ä¸Šçš„è¯·æ±‚æµé‡æ•è·ï¼Œç­›é€‰å‡ºGETè¯·æ±‚ï¼Œç¼©å°åˆ°10%æµé‡è½¬å‘ç»™vm2 ç„¶åå†vm2ä¸Šç”¨goreplayå°†vm2ä¸­8900ç«¯å£ä¸Šçš„è¯·æ±‚æµé‡å’Œè¿”å›æµé‡æ•è·ï¼Œè¾“å‡ºè¿›æ–‡ä»¶goreplay_response.logä¸­\nä»è€Œå®ç°ABæµ‹è¯•\næ“ä½œæµç¨‹éå¸¸ç®€å•è½»æ¾ï¼Œè¿˜æœ‰æ›´å¤šè¯¦ç»†çš„é…ç½®å‚æ•°é…ç½®é¡¹ï¼Œæœ‰éœ€è¦å¯ä»¥æŸ¥æŸ¥æ–‡æ¡£ï¼Œéšæ‰‹è®°å½•ä¸‹ã€‚\nå†å²è¯„è®º (3 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nkulumer (2019-05-10 14:27) æ‚¨å¥½ï¼Œæˆ‘ä»¬ç»„æœ€è¿‘åœ¨è°ƒç ”æµé‡å›æ”¾çš„æ¡†æ¶ï¼Œè¯·é—®æ‚¨æœ‰æ²¡æœ‰æ¨èçš„åœ¨ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒçš„å‘¢ calmkart (2019-05-11 15:16) æ¨èä¸¤ç§æ–¹å¼ 1.nginx+mirror module è¿™ç§æ–¹å¼é€šè¿‡nginxåšæµé‡é•œåƒ 2.goreplay kulumer (2019-05-15 12:09) è°¢è°¢æ‚¨ï¼Œåˆšéƒ¨ç½²è¯•ç”¨äº†goreplay, ç”¨æ¥åšæµé‡å›æ”¾æ•ˆæœç¡®å®ä¸é”™ ï¼ŒğŸ‘ ","date":"2019-05-09T00:00:00Z","permalink":"/posts/2019/05/2019-05-09-goreplay%E5%AE%9E%E7%8E%B0%E6%B5%81%E9%87%8F%E5%A4%8D%E5%88%B6%E7%9A%84ab%E6%B5%8B%E8%AF%95/","title":"goreplayå®ç°æµé‡å¤åˆ¶çš„ABæµ‹è¯•"},{"content":"åŸç†å…¶å®æŒºç®€å•çš„,æ‡‚å¾—éƒ½æ‡‚,ä¸å¤šè¯´äº†.é…ç½®è¿‡ç¨‹ä¹Ÿç®€å•,æ‡’çš„è®°ç»†èŠ‚äº†,ç•™ä¸ªå›¾å¤‡ä¸ªä»½.(æ–‡ç« æ— å†…å®¹) å†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nguooer (2019-04-24 19:25) æ‚¨ä¹Ÿæ˜¯å‰é¦–ä¸€ä¸­æ¯•ä¸šçš„ï¼Ÿ calmkart (2019-04-26 16:47) ...ä½ è°å•Šï¼Ÿ ","date":"2019-04-22T00:00:00Z","permalink":"/posts/2019/04/2019-04-22-stunnelsniproxydns%E5%8A%AB%E6%8C%81%E5%AE%9E%E7%8E%B0%E7%BF%BB%E5%A2%99/","title":"stunnel+sniproxy+dnsåŠ«æŒå®ç°ç¿»å¢™"},{"content":"æœ€è¿‘åœ¨å­¦é™¶è¾‰çš„Nginxæ ¸å¿ƒçŸ¥è¯†100è®²,å¬åˆ°postreadé˜¶æ®µçš„æ—¶å€™,é¡ºæ‰‹ç”¨realipæ¨¡å—å¼„äº†ä¸ªå°ä¸œè¥¿,ç”¨æ¥è·å–è‡ªå·±çš„å‡ºå£ip.\nåœ°å€myip.calmkart.com\n# curlæˆ–è®¿é—®myip.calmkart.comå³å¯ï¼Œå°†è¿”å›ä½ çš„å‡ºå£ip curl myip.calmkart.com ç±»ä¼¼ifconfig.meï¼Œä¸ç»†è¯´äº†ï¼Œå°ä¸œè¥¿ï¼Œç•™ä¸ªå­˜æ ¹ã€‚\nå†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\ncidia (2019-04-17 10:39) å¤§å“¥ï¼Œè¿™ä¸ªç½‘ç«™æœ‰æ—¶å€™æ‰“å¼€é€Ÿåº¦å¥½æ…¢ï¼Œè¦åˆ·æ–°åŠå¤©æ‰è¡Œï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œæˆ‘çš„ç½‘ç»œç”¨çš„å¹¿å·è”é€šå®½å¸¦ calmkart (2019-04-17 11:43) å¯ä»¥æµ‹è¯•ä¸‹ç½‘ç»œè¿æ¥è¯•è¯•,æœ€è¿‘è¿™å‡ å¤©åˆšæŠŠæœåŠ¡å™¨ä»æ´›æ‰çŸ¶è¿åˆ°æ—¥æœ¬. ","date":"2019-04-02T00:00:00Z","permalink":"/posts/2019/04/2019-04-02-myip-calmkart-com%E8%8E%B7%E5%8F%96%E8%87%AA%E5%B7%B1%E7%9A%84%E5%87%BA%E5%8F%A3ip/","title":"myip.calmkart.comè·å–è‡ªå·±çš„å‡ºå£ip"},{"content":"æœ‰å¥½å‡ ä¸ªæœˆæ²¡æœ‰å†™blogäº†ï¼ŒåŸå› ä¹ŸæŒºå¤šçš„ã€‚é¦–å…ˆè¿‡å¹´å˜›ï¼Œä¸€ç›´æœ‰ç‚¹æ‡’æ•£ï¼Œç„¶åæ•´å¤©å†™ä¸šåŠ¡ä»£ç åˆæ— èŠåˆå¿™ï¼Œå®é™…å¯è®°å½•çš„ä¸œè¥¿æœ¬æ¥ä¹Ÿä¸å¤šï¼Œåˆæ‡’çš„è®°ã€‚ä¸€äº›æ–°å·¥å…·å•¥çš„ï¼Œæ„Ÿè§‰è®°äº†ä¹Ÿæ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œåæ­£éƒ½è®°è„‘å­é‡Œäº†ã€‚æœ€è¿‘è¯»äº†ä¸€äº›ç»å…¸æ¡†æ¶æºç ï¼Œå­¦äº†ä¸€äº›æºç è¯¾ç¨‹ï¼Œä¹ŸæŒºæœ‰ä¸€äº›æ”¶è·ï¼Œä¸è¿‡è¿™æ ·çš„ä¸œè¥¿æ›´å–œæ¬¢è®°å®ä½“ç¬”è®°ä¸€äº›ã€‚ç»¼ä¸Šï¼Œæ€»è€Œè¨€ä¹‹æŒºä¹…æ²¡è®°blogäº†ã€‚\næœ€è¿‘Beijingçš„ä¼Ÿå¤§é•¿åŸä¹Ÿæ˜¯è¶Šæ¥è¶Šç‹ äº†ï¼Œæˆ‘çš„ssä»ä¸€å¼€å§‹çš„ç¨³å®šï¼Œå±…ç„¶å˜å¾—ä¸èƒ½ç”¨äº†ã€‚æ¯æ¬¡éƒ½æ˜¯åˆšå¼€å§‹èƒ½æœ‰è¿æ¥ä¿¡æ¯ï¼Œç„¶åä¸€å°ä¼šä¹‹åï¼Œç›´æ¥telnetéƒ½ä¸é€šäº†ï¼ŒåŒ…æ‹¬22å’Œssçš„ç«¯å£éƒ½æ–­äº†ã€‚æ¢äº†å‡ åä¸ªipä¹Ÿä¸ç®¡ç”¨ï¼Œportæ¢äº†æ— æ•°ä¸ªï¼Œä¹Ÿä¸ç®¡ç”¨ã€‚\nç‰¹åˆ«æ˜¯è¿™å‡ å‘¨å› ä¸ºè´«ç©·çš„åŸå› è¢«è¿«æ¬å®¶ï¼Œç§Ÿåˆ°äº†ä¸€ä¸ªé¸Ÿä¸æ‹‰å±çš„åœ°æ–¹ï¼Œè¿è”é€šéƒ½æ²¡å¾—åŠï¼Œéå¾—åŠå•¥é•¿åŸå®½å¸¦ï¼Œä¸€å¬è¿™åå­—å°±ä¸æ˜¯å•¥å¥½é¸Ÿï¼Œæœç„¶ï¼Œæœ‰äº†the great wallï¼Œä½ æƒ³æ¢å¤´å‡ºå»çœ‹çœ‹ï¼Œä¸å¯èƒ½çš„ã€‚\nä½†å¹³æ—¶ä¸‹ç­å’Œå‘¨æœ«ä¼‘æ¯çš„æ—¶å€™æ²¡æ³•ç¿»å¢™å®åœ¨æ˜¯å¤ªç—›è‹¦äº†ï¼Œæˆ‘å°è¯•äº†å¾ˆå¤šç§åŠæ³•ä¹‹åï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªç›¸å¯¹å¥½çš„æ–¹å¼è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯è¿™ç¯‡blogçš„ä¸»é¢˜äº†ï¼ŒWireGuard VPNã€‚\nwireguardæ˜¯ä¸€ç§æ¯”è¾ƒæ–°çš„vpnï¼ŒåŸºäºudpï¼Œé€Ÿåº¦å¯ä»¥è¯´ç§’æ€å…¶ä»–vpn(å®æµ‹ä½“éªŒ)ï¼Œä½“éªŒå‡ ä¹ä¸é€Šè‰²äºssã€‚\nå¹¶ä¸”wireguardé…ç½®ç®€å•ï¼Œå®¢æˆ·ç«¯æ˜“ç”¨ï¼Œè¢«é›†æˆè¿›äº†linuxå†…æ ¸ï¼Œä¹Ÿè®¸å¯ä»¥è¯´æ¯”sså®‰å…¨(è¿™ç‚¹æˆ‘ä¸ç¡®å®šï¼Œä½†æ˜¯æˆ‘çš„æœåŠ¡å™¨ç¡®å®ssè¢«å…¨é¢å°æ€ï¼Œä½†æ˜¯wireguardç”¨èµ·æ¥è½»æ¾æ„‰å¿«)ã€‚\næ‰€ä»¥ï¼Œå¾ˆæ¨èç°åœ¨ç”¨ä¸äº†ssçš„æœ‹å‹è¯•è¯•è¿™ä¸ªæ–°ä¸œè¥¿ï¼Œä¸‹é¢å¼€å§‹é…ç½®è¿‡ç¨‹ã€‚\né¦–å…ˆé…ç½®æœåŠ¡ç«¯\n#æ¨èä½¿ç”¨ä¸€é”®å®‰è£…è„šæœ¬,githubåœ°å€ https://github.com/l-n-s/wireguard-install #è¿‡ç¨‹ wget https://raw.githubusercontent.com/l-n-s/wireguard-install/master/wireguard-install.sh -O wireguard-install.sh bash wireguard-install.sh #ç„¶åè¾“å…¥ä¸‹ç¡®å®šå•¥çš„ï¼ˆdnsè®°å¾—é€‰æ‹©googleçš„8.8.8.8,4.4.4.4ï¼Œæ¯”è¾ƒé è°±ï¼‰ï¼Œä½ ä»¥ä¸ºä¸€åˆ‡å°±okäº†ï¼Œç„¶è€Œä¸€èˆ¬å¹¶ä¸æ˜¯ï¼Œä½ ä¼šæŠ¥é”™ï¼Œè¯´å•¥æœåŠ¡æ²¡èµ·æ¥ã€‚ #ä½ ç”¨systemctl status wg-quick@wg0.serviceæŸ¥çœ‹ä¸€ä¸‹åˆ°åº•é™¤äº†å•¥é—®é¢˜ï¼Œå‘ç°æ˜¯ip link add dev wg0 type wireguardå‘½ä»¤èµ·ä¸æ¥ #å†æ¬¡å°è¯•æ‰‹åŠ¨ip link add dev wg0 type wireguardï¼Œå‘ç°æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°wireguardç±»å‹çš„ç½‘å¡è®¾å¤‡å #æŸ¥è¯¢äº†ä¸€ä¸‹ï¼ŒåŸæ¥æ˜¯linuxå†…æ ¸ç‰ˆæœ¬å’Œlinux-headersçš„é—®é¢˜ï¼Œé‚£ä¹ˆå¥½åŠäº†ï¼Œå…ˆæ›´æ–°ä¸‹å†…æ ¸ç‰ˆæœ¬å§ apt-get install linux-image-4.9.0.8-amd64 #ç„¶ååˆ é™¤æ—§ç‰ˆæœ¬çš„linuxå†…æ ¸ apt-get remove linux-image-4.x.x.x-amd64 #æ¥ç€è®°å¾—å®‰è£…å¥½å¯¹åº”ç‰ˆæœ¬çš„linux-headers apt-get install linux-headers-4.9.0.8-amd64 #ç„¶åé‡å¯ reboot #é‡å¯å®Œæˆåæ‰‹åŠ¨å¯åŠ¨wireguardç½‘å¡ ip link add dev wg0 type wireguard #å‘ç°å¯åŠ¨æˆåŠŸ,è¿™å°±å¾ˆæ£’æ£’äº† #ç°åœ¨é‡å¯æœåŠ¡å§ systemctl restart wg-quick@wg0.service #æŸ¥çœ‹æœåŠ¡çŠ¶æ€ systemctl status wg-quick@wg0.service #å¾ˆæ£’æ£’ï¼ŒåˆæˆåŠŸäº†ï¼Œä½ å¾—åˆ°å®ƒäº† #ç„¶åç”Ÿæˆå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ wg showconf wg0 #å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶å°†è‡ªåŠ¨ç”Ÿæˆä¸º/etc/wireguard/wg0.conf æœåŠ¡ç«¯è¿™å°±å·²ç»é…ç½®å®Œæ¯•äº†ï¼Œæ¥ç€é…ç½®å®¢æˆ·ç«¯(å®¢æˆ·ç«¯ç”¨çš„Tunsafeï¼Œä¸‹è½½åœ¨æ–‡æœ«)\n#å°†å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸‹è½½åˆ°è‡ªå·±çš„æœºå™¨ä¸Š(å®¢æˆ·ç«¯),è§‚å¯Ÿä¸‹é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œå…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œå°±æ˜¯ç”¨rsaå…¬ç§é’¥åŠ å¯†é€šä¿¡è€Œå·²ã€‚ #åœ¨å®¢æˆ·ç«¯ä¿®æ”¹é…ç½®æ–‡ä»¶ [Peer] #æ·»åŠ  Endpoint = [æœåŠ¡ç«¯ipåœ°å€]:[æœåŠ¡ç«¯é…ç½®çš„ipç«¯å£å·] #é…ç½®æ–‡ä»¶ä¹Ÿæå®šäº†ã€‚ #å®¢æˆ·ç«¯ä½¿ç”¨TunSafeï¼Œè®°å¾—ä½¿ç”¨å‰éœ€è¦å…ˆå®‰è£…ç¯å¢ƒé…ç½® #ç‚¹å‡»import,å¯¼å…¥ä¸‹è½½ä¸‹æ¥çš„é…ç½®æ–‡ä»¶ #ç„¶åç‚¹å‡»connectå³å¯ enjoy it æ€»çš„æ¥è¯´ï¼Œç”¨äº†ä¹Ÿä¸€æ®µæ—¶é—´äº†ï¼Œwireguardçš„ç¨³å®šæ€§å’Œå¯é æ€§è¿˜æ˜¯å¾ˆæ£’çš„ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰äº›ç¼ºç‚¹ã€‚\næ¯”å¦‚å› ä¸ºæ˜¯vpnæ‰€ä»¥æ²¡æ³•åƒssä¸€æ ·é’ˆå¯¹æµé‡åšåˆ†æµï¼Œéƒ½æ˜¯ç”¨çš„å…¨å±€æµé‡ã€‚å…¶æ¬¡ï¼Œwireguardæ˜¯ç”¨çš„rsaå…¬ç§é’¥åšåŠ å¯†çš„ï¼Œå•é…ç½®åªé’ˆå¯¹å•ç”¨æˆ·ï¼Œéœ€è¦å¤šäººè¿æ¥éœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®å¤šç”¨æˆ·ï¼Œä¹Ÿä¸æ˜¯é‚£ä¹ˆæ–¹ä¾¿ï¼Œè€Œä¸”æµé‡ç®¡ç†å•¥çš„å¥½åƒä¹Ÿæ²¡å•¥ç°æˆçš„ä¸œè¥¿ã€‚è€Œä¸”é€Ÿåº¦ç¡®å®è¿˜æ˜¯é€Šè‰²äºssçš„ã€‚(å½“ç„¶ï¼Œssç°åœ¨çš„å°é”åŠ›åº¦å¤ªå¤§å•¦ã€‚)\nå¥½çš„ï¼Œå°±åˆ°è¿™é‡Œäº†ã€‚\né™„ä¸Štunsafeå®¢æˆ·ç«¯ï¼Œæ–¹ä¾¿ä¸Šä¸äº†tunsafeå®˜ç½‘çš„æœ‹å‹(è®°å¾—å…ˆå®‰è£…å…¶ä¸­çš„tsç¯å¢ƒ)\nTunSafe\nå†å²è¯„è®º (5 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nliuxing (2019-04-10 16:10) å¤§ç¥ï¼Œè¯·é—®ä¸‹è‹¹æœç¬”è®°æœ¬æ€ä¹ˆç”¨è¿™ä¸ªè½¯ä»¶ç¿»å¢™å•Šï¼Ÿ calmkart (2019-04-14 11:21) æœåŠ¡ç«¯é…å¥½äº†åŒæ ·ç”¨tunsafeå®¢æˆ·ç«¯å°±è¡Œäº†å•Š,tunsafeå®¢æˆ·ç«¯æœ‰MACç‰ˆæœ¬çš„ huan (2019-04-29 17:01) å­¦ä¹ äº†ï¼Œå¹¸å¥½æˆ‘è¿œç¦»å¸éƒ½ calmkart (2019-04-30 10:50) å®‰å…¨ç‹ï¼Ÿè´µå¸åº”è¯¥å°±æ˜¯ç”¨çš„stunnel+sniproxy+dnsåŠ«æŒç¿»å¢™çš„,è®²é“ç†è¿˜æ˜¯ä¸å¤ªå®‰å…¨ huan (2019-05-09 09:49) æ²¡é‚£ä¹ˆé«˜ç«¯ï¼Œç›´æ¥æ˜¯è°ƒæ•´å‡ºå£çš„è·¯ç”±åˆ°é¦™æ¸¯çº¿è·¯ã€‚ æˆ‘æœ€è¿‘éƒ½æ˜¯v2rayï¼Œæ„Ÿè§‰ä¹Ÿå¾ˆç¨³ï¼Œè¢«å°äº†å°±è¯•ä¸‹wireguard ","date":"2019-04-01T00:00:00Z","permalink":"/posts/2019/04/2019-04-01-wireguard%E7%AA%81%E7%A0%B4beijing-greatwall/","title":"WireGuardçªç ´BeiJing GreatWall"},{"content":"æœ€è¿‘æœ‰ä¸€æ‰¹æ—§æœåŠ¡å™¨å¾…ç”¨ï¼Œæ²¡æœ‰ç”¨iaasï¼Œæ‰“ç®—æŠŠdockerå½“vmæ¥ç”¨ï¼Œè¿˜æƒ³é‡‡ç”¨k8sçš„ç¼–æ’æ–¹æ¡ˆã€‚è¿™æ ·ç”¨æˆ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡ipç›´è¿dockerï¼Œå°±åƒè™šæ‹Ÿæœºä¸€æ ·ã€‚\nåŸç”Ÿçš„dockerç½‘ç»œæ–¹æ¡ˆæ˜¯ä¸è¡Œçš„ï¼Œäºæ˜¯é‡‡ç”¨äº†macvlanç½‘ç»œæ’ä»¶å®ç°äº†k8sæ‰å¹³äºŒå±‚ç½‘ç»œã€‚ä¸‹é¢è®°å½•ä¸€ä¸‹å®ç°è¿‡ç¨‹ã€‚\né¦–å…ˆè‚¯å®šæ˜¯è£…dockeräº†\n#å¸è½½æ—§çš„docker yum remove -y docker #è¿™é‡Œæˆ‘æ˜¯ç”¨è‡ªå·±æ­çš„ç§äººä»“åº“å’Œè‡ªå®šä¹‰çš„dockerå®‰è£…åŒ…,å„ä½å¯é…Œæƒ… yum install -y docker-ce.x86_64 systemctl start docker systemctl enable docker å…³é—­é˜²ç«å¢™,å…³é—­swap\nsystemctl stop firewalld systemctl disable firewalld setenforce 0 sed -i \u0026#39;s/^SELINUX=enforcing$/SELINUX=permissive/\u0026#39; /etc/selinux/config swapoff -a é…ç½®k8så›½å†…æº,è®¾ç½®ç³»ç»Ÿbridgeå‚æ•°\n# æ·»åŠ kubenetesæº cat \u0026lt; /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF #è°ƒç³»ç»Ÿå‚æ•° cat \u0026lt; /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system ç”¨å›½å†…æºä¸‹è½½k8sç›¸å…³é•œåƒï¼Œé‡æ–°æ‰“tagæˆk8s.gcr.io(å°±ç®—å¯ä»¥ç¿»å¢™ï¼Œè¿™ä¸€æ­¥ä¹Ÿå¯ä»¥åŠ é€Ÿå¾ˆå¤š)\n#dockeré•œåƒæ¢å›½å†… cat \u0026lt; ~/get_image.sh #!/bin/bash images=( kube-apiserver:v1.13.1 kube-controller-manager:v1.13.1 kube-scheduler:v1.13.1 kube-proxy:v1.13.1 pause:3.1 etcd:3.2.24 coredns:1.2.6 ) for imageName in ${images[@]} ; do docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName k8s.gcr.io/$imageName done EOF #ä¸‹è½½é•œåƒ bash ~/get_image.sh ä¸‹è½½cniç½‘ç»œæ’ä»¶åŒ… https://github.com/containernetworking/plugins/releases å½“å‰0.7.4ç‰ˆä¸‹è½½åœ°å€æ˜¯ https://github.com/containernetworking/plugins/releases/download/v0.7.4/cni-plugins-amd64-v0.7.4.tgz\nmkdir -p /opt/cni/bin/ cd /opt/cni/bin wget https://github.com/containernetworking/plugins/releases/download/v0.7.4/cni-plugins-amd64-v0.7.4.tgz tar xzvf cni-plugins-amd64-v0.7.4.tgz å®‰è£…k8så…¨å®¶æ¡¶\nyum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes systemctl enable kubelet \u0026amp;\u0026amp; systemctl start kubelet kubeadmåšk8såˆå§‹åŒ–,è®°å½•nodeç”¨æ¥joinçš„tokenè¿æ¥(å½“ç„¶ç”¨crtä¹Ÿè¡Œ)\nkubeadm init æœ€åé…ç½®ç½‘ç»œæ’ä»¶macvlan\nmkdir -p /etc/cni/net.d vim /etc/cni/net.d/10-macvlan.conf #ç”¨host-localçš„é…æ³•,å„é…ç½®é¡¹å¾ˆç®€å•ä¸è¯¦è¿° { \u0026#34;name\u0026#34;: \u0026#34;macvlannet\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;macvlan\u0026#34;, \u0026#34;master\u0026#34;: \u0026#34;br0\u0026#34;, \u0026#34;ipam\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;host-local\u0026#34;, \u0026#34;subnet\u0026#34;: \u0026#34;10.52.101.0/24\u0026#34;, \u0026#34;rangeStart\u0026#34;: \u0026#34;10.52.101.40\u0026#34;, \u0026#34;rangeEnd\u0026#34;: \u0026#34;10.52.101.250\u0026#34;, \u0026#34;gateway\u0026#34;: \u0026#34;10.52.101.254\u0026#34;, \u0026#34;routes\u0026#34;: [ { \u0026#34;dst\u0026#34;: \u0026#34;0.0.0.0/0\u0026#34; } ] } } #ç”¨dhcpçš„é…æ³• { \u0026#34;name\u0026#34;: \u0026#34;macvlannet\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;macvlan\u0026#34;, \u0026#34;master\u0026#34;: \u0026#34;br0\u0026#34;, \u0026#34;ipam\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;dhcp\u0026#34;, } } #ç‰¹åˆ«è´´å£«----\u0026gt;åœ¨ä½¿ç”¨DHCPæ’ä»¶ä¹‹å‰ï¼Œéœ€è¦å…ˆå¯åŠ¨dhcp daemon /opt/cni/bin/dhcp daemon \u0026amp; çœ‹ä¸‹ä¸»èŠ‚ç‚¹æ˜¯å¦ok\n#å…ˆå‚è€ƒå®˜æ–¹æ–‡æ¡£é…ä¸‹ç¯å¢ƒå˜é‡å•¥çš„ #To make kubectl work for your non-root user, run these commands, which are also part of the kubeadm init output: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config #Alternatively, if you are the root user, you can run: export KUBECONFIG=/etc/kubernetes/admin.conf #æŸ¥çœ‹ä¸»èŠ‚ç‚¹æ˜¯å¦ready kubectl get nodes #æŸ¥çœ‹å„ä¸ªpodsæƒ…å†µ kubectl get pods --all-namespaces #å¦‚æœæœ‰é—®é¢˜,å°±ç”¨describeè‡ªå·±æŸ¥æŸ¥å§,ä¸€èˆ¬éƒ½ä¸éš¾è§£å†³ kubectl describe pod è®©masterä¹Ÿå¯ä»¥è¿è¡Œpod\nkubectl taint nodes --all node-role.kubernetes.io/master- ç„¶åéšä¾¿å¼„ä¸ªpodè¯•è¯•ç®¡ç”¨äº†æ²¡\n#ç¼–è¾‘yaml vim pod-macvlan.yaml apiVersion: v1 kind: Pod metadata: name: nginx-macvlan labels: app: web annotations: cni: \u0026#34;macvlan\u0026#34; spec: containers: - name: key-value-store image: nginx:latest imagePullPolicy: IfNotPresent ports: - containerPort: 6379 #åˆ›å»ºpod kubectl create -f pod-macvlan.yaml #æŸ¥çœ‹ä¸‹podæƒ…å†µ kubectl get pods -o wide ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ²¡é—®é¢˜ï¼Œpodå·²ç»å’Œå®¿ä¸»æœºåœ¨åŒä¸€ä¸ª2å±‚ç½‘ç»œäº†ï¼ŒåŒ2å±‚çš„å…¶ä»–ç½‘ç»œä¹Ÿå¯ä»¥åˆ°è¯¥podç›´é€šã€‚ è¿™æ—¶å€™å°±å¯ä»¥ç›´æ¥æŠŠpodå½“vmç”¨äº†,å’Œæ¡¥æ¥çš„vmå‡ ä¹æ²¡å•¥åŒºåˆ«ã€‚\næœ€åæŠŠå…¶ä»–æœºå™¨ä½œä¸ºnodeåŠ å…¥k8sé›†ç¾¤ä¸­\né‡å¤ä¸Šé¢æ­¥éª¤ é™¤äº†kubeadm init æ¢æˆ #ä¸¾ä¾‹ kubeadm join 10.52.101.28:6443 --token b7eber.9e26oenyos7j17v8 --discovery-token-ca-cert-hash sha256:9faeb9f6ce6281d2ae149c9424ec34297e6809ce1f88c920281f1e5da8b1b1f8 ä¹‹å¤–ï¼Œå…¶ä»–ä¸ç”¨å˜åŒ–å•¥ã€‚(ç¡®å®å¤špulläº†å‡ ä¸ªkubeapiå•¥çš„é•œåƒï¼Œä¸è¿‡æ— æ‰€è°“äº†ï¼Œä¸pullä¹Ÿè¡Œ) æœ€ç»ˆç»“æœ nodes pods æµ‹è¯•æŸä¸€ä¸ªpod æœ¬æœºç›´æ¥ipè®¿é—®pod ok,æå®š,æ‰“å®Œæ”¶å·¥\nå†å²è¯„è®º (13 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nhuanguo (2019-01-10 20:22) ç»™å¤§ä½¬ç‚¹èµ ( æ›°..æ›° ) (2019-01-22 21:01) å¤§ä½¬ï¼Œpscè¿˜ç¼ºä¿å®‰å—ï¼Ÿ 1 (2019-02-17 22:04) å¤§ä½¬ï¼Œpscè¿˜ç¼ºä¿å®‰å—ï¼Ÿ wardenlym (2019-03-14 14:36) å¸®å¤§å¿™äº†.jpg wardenlym (2019-03-14 15:34) kubeadm init æ—¶å€™ä¸éœ€è¦åŠ ä»»ä½•å‚æ•°å—ï¼Ÿå®ƒæ˜¯æ€ä¹ˆèƒ½è¯†åˆ«å‡ºæ¥ç”¨çš„æ˜¯macvlançš„å‘¢ è¯·æ•™ calmkart (2019-03-14 19:22) k8sçš„ç½‘ç»œæ’ä»¶éœ€è¦é…ç½®å•Š,è¦å†™é…ç½®æ–‡ä»¶.k8sä¼šè‡ªå·±è¯».è€Œä¸”éšæ—¶å¯ä»¥æ¢çš„. WEICHANG (2019-08-06 16:47) è¯·é—®ä¸‹ï¼Œè¿™ä¸ªæµç¨‹ä½ é‚£è¾¹èƒ½è·‘é€šå—ï¼Ÿ bro (2019-03-15 10:40) è¯·é—®ä¸‹k8sç½‘ç»œæ’ä»¶å¯ä»¥çƒ­é…ç½®ä¹ˆï¼Œåœ¨ä¸åœæœçš„æƒ…å†µä¸‹ï¼Ÿ calmkart (2019-03-17 21:33) å¯ä»¥ carmer (2019-04-01 19:22) è€å“¥å“¥ï¼Œä½ æœ‰githubåœ°å€ä¹ˆï¼Œè®©å°å¼Ÿstarä¸‹å•Š calmkart (2019-04-01 19:30) https://github.com/calmkart æ¬¢è¿å…³æ³¨ï¼Œæ¬¢è¿star WEICHANG (2019-08-06 17:50) åšä¸»ï¼Œæˆ‘è¿™è¾¹initåˆå§‹åŒ–é›†ç¾¤çš„æ—¶å€™ï¼ŒcorednsèŠ‚ç‚¹èµ·ä¸æ¥ï¼š0/1 nodes are available: 1 node(s) had taints that the pod didn't tolerate. resetäº†å¾ˆå¤šæ¬¡éƒ½æ˜¯è¿™æ ·ã€‚ã€‚ã€‚è¯·é—®ä¸‹æœ‰ä»€ä¹ˆç‰¹åˆ«éœ€è¦æ³¨æ„çš„åœ°æ–¹å—ã€‚ã€‚ã€‚æäº†ä¸¤å¤©äº†ï¼Œç»æœ›.jpg calmkart (2019-08-09 15:25) ä½ masterèŠ‚ç‚¹æœ‰taintsä½†æ˜¯podsé€‰æ‹©å™¨æ²¡æœ‰tolerateå¯¼è‡´è°ƒåº¦å™¨æ‰¾ä¸åˆ°å¯ä»¥è°ƒåº¦çš„èŠ‚ç‚¹. è¯•ç€æŠŠmasterèŠ‚ç‚¹çš„æ±¡ç‚¹å»æ‰è¯•è¯•å‘¢ kubectl taint nodes --all node-role.kubernetes.io/master- ","date":"2018-12-29T00:00:00Z","permalink":"/posts/2018/12/2018-12-29-macvlan%E5%AE%9E%E7%8E%B0k8s%E6%89%81%E5%B9%B32%E5%B1%82%E7%BD%91%E7%BB%9C/","title":"macvlanå®ç°k8sæ‰å¹³2å±‚ç½‘ç»œ"},{"content":"æœ€è¿‘ä¸€ç›´åœ¨å¿™,æ²¡ç©ºå†™blog.åˆšå¥½ä»Šå¤©å†™å‰ç«¯çš„æ—¶å€™ç¢°åˆ°ä¸€ä¸ªæŒºæœ‰æ„æ€çš„é—®é¢˜,è®°å½•ä¸€ä¸‹.\né—®é¢˜æè¿°:åœ¨bootstrapçš„modalæ¡†é‡Œpopoveræ²¡ååº”.\nå‰§æƒ…æ˜¯è¿™æ ·çš„,è¦å¼„ä¸€ä¸ªtimelineä¸€æ ·çš„åŠ¨æ€stepå›¾,æ‰¾äº†ä¸€åœˆé™¤äº†å¾ˆå¤šwizardæ’ä»¶ä¹‹å¤–åªæœ‰ä¸€ä¸ªystepå¯ç”¨.æ‰“ç®—æŠŠystepçš„æµç¨‹å›¾æ”¾åœ¨boostrapæ¨¡æ€æ¡†é‡Œ,æ”¾è¿›å»åˆå§‹åŒ–ystepä¹‹å,å‘ç°åŸºæœ¬cssæ²¡é—®é¢˜,å°±æ˜¯popoverå¼¹å‡ºæ¡†å¤±æ•ˆäº†(èµ·ç æ˜¯è§†è§‰ä¸Šå¤±æ•ˆäº†). ç¬¬ä¸€ååº”,æ˜¯ä¸æ˜¯popoveræ²¡åˆå§‹åŒ–,é©¬ä¸ŠåŠ ä¸Š\n$(\u0026#34;[data-toggle=\u0026#39;popover\u0026#39;]\u0026#34;).popover(); æ²¡ä»»ä½•ä½œç”¨ã€‚\nç„¶ååœ¨æµè§ˆå™¨ä¸­è°ƒè¯•,å‘ç°é€‰æ‹©$(\u0026quot;[data-toggle=\u0026lsquo;popover\u0026rsquo;]\u0026quot;)éƒ½æ˜¯æ²¡é—®é¢˜çš„,æŸ¥äº†focusäº‹ä»¶,ä¹Ÿæ˜¯æœ‰ç»‘å®šçš„.\nå¾ˆå¥‡æ€ª,æ€€ç–‘æ˜¯ä¸æ˜¯ystepæ’ä»¶æœ‰å•¥é—®é¢˜,äºæ˜¯æŠŠdivä»æ¨¡æ€æ¡†é‡Œå¼„äº†å‡ºæ¥,å‘ç°popoverå¼¹çª—æ¢å¤æ­£å¸¸.\nè¿™æ—¶å€™å¼€å§‹æƒ³åˆ°æ˜¯ä¸æ˜¯z-indexçš„å±‚è¦†ç›–å‡ºäº†é—®é¢˜,å› ä¸ºä¹‹å‰ç”¨bootboxæ’ä»¶ç”Ÿæˆå„ç§modalçš„æ—¶å€™æ€»å’Œæ‰‹å†™çš„modalæœ‰å±‚å å†²çª,æœæ–­å¼ºåŠ css(bootstapé»˜è®¤çš„modal z-indexå¤§æ¦‚æ˜¯2050å·¦å³)\n\u0026lt;style\u0026gt; .popover { z-index: 2099; } \u0026lt;/style\u0026gt; ç¬é—´ç®¡ç”¨äº†,é—®é¢˜è§£å†³.\n","date":"2018-12-26T00:00:00Z","permalink":"/posts/2018/12/2018-12-26-%E4%B8%80%E4%B8%AA%E5%85%B3%E4%BA%8Ez-index%E7%9A%84%E5%B0%8F%E9%97%AE%E9%A2%98/","title":"ä¸€ä¸ªå…³äºz-indexçš„å°é—®é¢˜"},{"content":"æœ€è¿‘éœ€è¦ä»æµ·é‡æ•°æ®ä¸­è·å–å‡å€¼,æ–¹å·®,æ ‡å‡†å·®\næ˜¾ç„¶ç›´æ¥è¯»å¦‚å†…å­˜ä¸­æŒ‰å…¬å¼åšè‚¯å®šæ˜¯ggçš„,äºæ˜¯è€ƒè™‘æ˜¯å¦å¯ä»¥å¢é‡è®¡ç®—\næœ€ç»ˆå†™äº†ä¸€ä¸ªå¢é‡è®¡ç®—æµ·é‡æ•°æ®å‡å€¼æ–¹å·®æ ‡å‡†å·®çš„pythoné€šç”¨ç±»\nå‚è€ƒäº†ä»¥ä¸‹å…¬å¼æ¨å¯¼:\nä»£ç å¦‚ä¸‹:\n# -*- coding: utf-8 -*- from __future__ import division import numpy class incre_std_avg(): \u0026#39;\u0026#39;\u0026#39; å¢é‡è®¡ç®—æµ·é‡æ•°æ®å¹³å‡å€¼å’Œæ ‡å‡†å·®,æ–¹å·® 1.æ•°æ® obj.avgä¸ºå¹³å‡å€¼ obj.stdä¸ºæ ‡å‡†å·® obj.nä¸ºæ•°æ®ä¸ªæ•° å¯¹è±¡åˆå§‹åŒ–æ—¶éœ€è¦æŒ‡å®šå†å²å¹³å‡å€¼,å†å²æ ‡å‡†å·®å’Œå†å²æ•°æ®ä¸ªæ•°(åˆå§‹æ•°æ®é›†ä¸ºç©ºåˆ™å¯ä¸å¡«å†™) 2.æ–¹æ³• obj.incre_in_list()æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå¾…è®¡ç®—çš„æ•°æ®list,è¿›è¡Œå¢é‡è®¡ç®—,è·å¾—æ–°çš„avg,stdå’Œn(æµ·é‡æ•°æ®è¯·å¾ªç¯ä½¿ç”¨è¯¥æ–¹æ³•) obj.incre_in_value()æ–¹æ³•ä¼ å…¥ä¸€ä¸ªå¾…è®¡ç®—çš„æ–°æ•°æ®,è¿›è¡Œå¢é‡è®¡ç®—,è·å¾—æ–°çš„avg,stdå’Œn(æµ·é‡æ•°æ®è¯·å°†æ¯ä¸ªæ–°å‚æ•°å¾ªç¯å¸¦å…¥è¯¥æ–¹æ³•) \u0026#39;\u0026#39;\u0026#39; def __init__(self, h_avg=0, h_std=0, n=0): self.avg = h_avg self.std = h_std self.n = n def incre_in_list(self, new_list): avg_new = numpy.mean(new_list) incre_avg = (self.n*self.avg+len(new_list)*avg_new) / \\ (self.n+len(new_list)) std_new = numpy.std(new_list) incre_std = numpy.sqrt((self.n*(self.std**2+(incre_avg-self.avg)**2)+len(new_list) * (std_new**2+(incre_avg-avg_new)**2))/(self.n+len(new_list))) self.avg = incre_avg self.std = incre_std self.n += len(new_list) def incre_in_value(self, value): incre_avg = (self.n*self.avg+value)/(self.n+1) incre_std = numpy.sqrt((self.n*(self.std**2+(incre_avg-self.avg) ** 2)+(incre_avg-value)**2)/(self.n+1)) self.avg = incre_avg self.std = incre_std self.n += 1 if __name__ == \u0026#34;__main__\u0026#34;: c = incre_std_avg() c.incre_in_value(0.05) print c.avg print c.std print c.n c.incre_in_value(0.02) c.incre_in_list([0.5, 0.2, 0.3]) print c.avg print c.std print c.n ","date":"2018-10-12T00:00:00Z","permalink":"/posts/2018/10/2018-10-12-%E5%A2%9E%E9%87%8F%E8%AE%A1%E7%AE%97%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%9D%87%E5%80%BC%E6%96%B9%E5%B7%AE%E6%A0%87%E5%87%86%E5%B7%AE/","title":"å¢é‡è®¡ç®—æµ·é‡æ•°æ®å‡å€¼,æ–¹å·®,æ ‡å‡†å·®"},{"content":"æœ€è¿‘å†™äº†ä¸€ä¸ªå•ç‚¹ç™»å½•ç³»ç»Ÿ,è¿™é‡Œåšä¸€äº›æ€»ç»“.\ngithubåœ°å€:(æ¬¢è¿æ¥starä¸€å‘^_^) https://github.com/calmkart/Django-sso-server\n1.æµç¨‹åŸç† \u0026lt;1\u0026gt;.ç³»ç»Ÿç®¡ç†æµç¨‹ ç®¡ç†å‘˜åœ¨åˆå§‹åŒ–ç³»ç»Ÿæ—¶ï¼Œå¡«å†™ldapç›¸å…³è®¾ç½®ä»¥åŠç®¡ç†å‘˜è´¦å·ç›¸å…³è®¾ç½®ï¼Œä¹‹åç®¡ç†å‘˜è´¦å·å¯ä»¥åœ¨ç®¡ç†å‘˜åå°è°ƒæ•´ç›¸å…³é…ç½® å…¶ä¸­: a.ç³»ç»Ÿåˆå§‹åŒ–æ—¶å°†è‡ªåŠ¨ç”Ÿæˆrsaå…¬ç§é’¥,ç³»ç»Ÿä¸­æ‰€æœ‰æ¶‰åŠçš„å¯†ç ,éƒ½ä¼šç»è¿‡aesåŠ å¯†å­˜æ”¾åœ¨æ•°æ®åº“ä¸­,åŒ…æ‹¬rsaç§é’¥ä¹Ÿä¼šç»è¿‡aesåŠ å¯†å­˜æ”¾ b.åœ¨å–ç”¨å¯†ç æ—¶å°†è°ƒç”¨aesè§£å¯†,åŠ å¯†çš„saltå†™åœ¨äº†common/crypto.pyä¸­,ä¹Ÿå¯ä»¥è‡ªå·±æ›¿æ¢\n\u0026lt;2\u0026gt;.ç”¨æˆ·æµç¨‹ ç”¨æˆ·ç™»å½•ssoç³»ç»Ÿï¼ŒéªŒè¯ldapè´¦å·æˆåŠŸåï¼Œå°†ç”¨æˆ·ä¿¡æ¯ä»¥\nnow = time.time() user_info = \u0026#34;{0}|||||{1}\u0026#34;.format(ldap_username, now) çš„å½¢å¼,é€šè¿‡rsaå…¬é’¥åŠ å¯†å†™å…¥cookieä¸­ï¼Œkeyä¸ºsso_user\nresponse.set_cookie(\u0026#39;sso_user\u0026#39;, rsa.crypto( public_key, user_info), domain=options.objects.all()[0].cookie_domain) å…¶ä»–éœ€è¦æ¥å…¥ssoç³»ç»Ÿçš„å­ç³»ç»Ÿå¯ä»¥é€šè¿‡ssoç³»ç»Ÿçš„apiï¼Œæ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ä»¥ç™»å½•\nurl: /api/auth method: POST post_json_data: {\u0026#34;sso_user\u0026#34;:cookie} return: {\u0026#34;status\u0026#34;:True/False, \u0026#34;msg\u0026#34;:username} æœ¬ssoç³»ç»Ÿå·²æä¾›äº†ç›¸å…³è£…é¥°å™¨ï¼Œå¯åœ¨ç®¡ç†åå°-æ·»åŠ ç«™ç‚¹çš„å¸®åŠ©æ æŸ¥çœ‹\nimport requests def auth_login(func): \u0026#39;\u0026#39;\u0026#39; è£…é¥°å™¨,ç”¨äºéœ€è¦ç™»å½•çš„views functions,å°†è¯»å–cookieå¹¶è°ƒç”¨ssoçš„apiè·å–username ä¹Ÿå¯æ‰‹åŠ¨ç¼–å†™ç›¸å…³è£…é¥°å™¨ ssoç³»ç»Ÿçš„ç™»å½•é‰´æƒapiä¸º\u0026#34;http://ssoåŸŸå/api/auth\u0026#34;(å¦‚\u0026#34;http://sso.calmkart.com/api/auth\u0026#34;) ç”¨POSTæ–¹æ³•ä»¥jsonå½¢å¼å°†sso_cookieä¼ ç»™ä¸Šè¿°api, è¿”å›{\u0026#34;status\u0026#34;:True, \u0026#34;msg\u0026#34;:{username}}åˆ™ç™»å½•æˆåŠŸ å¦åˆ™{\u0026#34;status\u0026#34;:False, \u0026#34;msg\u0026#34;:{exception}}åˆ™ç™»å½•å¤±è´¥ \u0026#39;\u0026#39;\u0026#39; def _auth(request): cookie = request.COOKIES.get(\u0026#34;sso_user\u0026#34;, \u0026#34;\u0026#34;) if cookie==\u0026#34;\u0026#34;: return HttpResponseRedirect(\u0026#34;{http://ssoç«™åŸŸå/}\u0026#34;) r = request.post(\u0026#34;{http://ssoç«™åŸŸå/api/auth}\u0026#34;,data={\u0026#34;sso_cookie\u0026#34;:cookie}) if r.json()[\u0026#34;status\u0026#34;]==False: return HttpResponseRedirect(\u0026#34;{http://ssoç«™åŸŸå}\u0026#34;) else: username = r.json()[\u0026#34;msg\u0026#34;] if username == \u0026#34;\u0026#34; or username == \u0026#34;error\u0026#34;: return HttpResponseRedirect(\u0026#34;{http://ssoç«™åŸŸå/}\u0026#34;) else: return func(request, username) return _auth ç”¨æˆ·æ‹¥æœ‰cookieåç™»é™†ç³»ç»Ÿï¼Œç³»ç»Ÿå°†è§£cookieï¼Œå¹¶è·å–å½“å‰æ—¶é—´ï¼Œè‹¥æ—¶é—´ä¸è¶…è¿‡æœ€å¤§æ—¶é—´ï¼Œåˆ™è¿”å›username\n\u0026lt;3\u0026gt;.ä¼ä¸šæ‰«ç ç™»é™†æµç¨‹ åœ¨ç®¡ç†åå°é…ç½®ä¼ä¸šå¾®ä¿¡æ‰«ç ç™»é™†ç›¸å…³å‚æ•°ï¼Œé€šè¿‡ä¼ä¸šå¾®ä¿¡ç›¸å…³js apiï¼Œç”ŸæˆäºŒç»´ç ï¼Œç”¨æˆ·æ‰«ç åï¼Œä¼ä¸šå¾®ä¿¡åå°å°†ç”¨æˆ·è¯·æ±‚é‡å®šå‘åˆ°/api/wxloginÂ (method:get)ä¸Šï¼Œå¹¶åŠ ä¸Šæºå¸¦æœ‰ç”¨æˆ·usernameä¿¡æ¯çš„codeå‚æ•°ï¼ŒæˆåŠŸåˆ™å†™cookieã€‚\n2.commonç›¸å…³æ¨¡å—åŸç† å‚è§æœ¬blogå…¶ä»–åšæ–‡\n\u0026lt;1\u0026gt;å…³äºdjangoçš„å›¾ç‰‡éªŒè¯ç  \u0026lt;2\u0026gt;å…³äºpythonæ“ä½œldap \u0026lt;3\u0026gt;å…³äºpythonæ“ä½œrsa,aesåŠ è§£å¯† å†å²è¯„è®º (9 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nwzzzx (2019-03-04 15:01) è¯·é—®idapæ˜¯å•¥å“¦ï¼Œç™¾åº¦è°·æ­Œéƒ½çœ‹ä¸æ‡‚ calmkart (2019-03-07 10:55) ldap https://zh.wikipedia.org/zh-hans/%E8%BD%BB%E5%9E%8B%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E5%8D%8F%E8%AE%AE ( æ›°..æ›° ) (2019-04-18 17:23) ç‰›é€¼è½°è½°çš„å½­è‘£ï¼Œä¸çŸ¥é“pscè¿˜æ‹›ä¸æ‹›å®ä¹ ç”Ÿï¼Œæ±‚å¤§ä½¬èµå£é¥­åƒå•Š calmkart (2019-04-19 11:23) å½­è‘£å¿«é¥¿æ­»äº†ï¼Œæ€»è£è°¢è¡Œè¡Œå¥½å§ lixueming (2019-06-01 15:23) å¤§ç¥å¥½ï¼Œæˆ‘æ˜¯19å±Šçš„åº”å±Šç”Ÿï¼Œä»Šå¹´æ ¡æ‹›æ‹¿äº†äº›offerï¼Œéƒ½æ˜¯è·ŸPythonç›¸å…³çš„ï¼Œæˆ‘å¯¹Pythonçš„ç†Ÿæ‚‰ç¨‹åº¦åªæ˜¯ä¼šç”¨ï¼Œç®—ä¸ä¸Šå¾ˆäº†è§£ï¼Œæ¯”è¾ƒçº ç»“çš„æ˜¯ï¼Œä¸€ä¸ªofferæ˜¯åè¿ç»´å¼€å‘ï¼Œä¸€ä¸ªæ˜¯åšå¹¿å‘Šç³»ç»Ÿä¸šåŠ¡ç ”å‘ï¼Œä¸çŸ¥é“è¿™2ä¸ªæ–¹å‘ä»¥åçš„å‘å±•æ€ä¹ˆæ ·ï¼Œä¼šä¸ä¼šæœ‰ä»€ä¹ˆå‘å‘¢ï¼Œçƒ¦è¯·å¤§ç¥æŒ‡ç‚¹ä¸‹ï¼Œä¸èƒœæ„Ÿæ¿€ï¼ calmkart (2019-06-03 10:35) çœ‹å…¬å¸,pythonçš„ä¸šåŠ¡å¼€å‘å…¶å®é¢ä¸å¤ªå¹¿,ä½†åœ¨ç®—æ³•æ–¹é¢åº”ç”¨æ¯”è¾ƒå¤š. çº¯ä¸šåŠ¡å¼€å‘å†™æ¥å†™å»å†™ä¹…äº†å¾ˆçƒ¦,ä½†æ˜¯è¿å¼€ä¹Ÿæœ‰å¾ˆå¤šæ–¹å‘,æ€»çš„æ¥è¯´å¦‚æœæ˜¯ä¸€èˆ¬è¿ç»´å‰æ™¯æ˜¯è‚¯å®šä¸å¦‚å¼€å‘çš„ è¦æ˜¯èƒ½åšæ›´æœ‰æŠ€æœ¯å«é‡çš„ä¸œè¥¿,æ¯”å¦‚paasäº‘,æˆ–è€…å»googleä¹‹ç±»çš„sre,è‚¯å®šæ¯”ä¸€èˆ¬å¼€å‘è¦å¼ºå¾ˆå¤š. è¿å¼€çš„ä½¿å‘½å…¶å®å°±æ˜¯é©äº†ä¼ ç»Ÿopçš„å‘½,å¼€å‘æ—¢è¿ç»´ã€‚ è¯­è¨€ä¹Ÿä¸æ˜¯å¤ªé‡è¦,python/c/c++/js/goè‚¯å®šéƒ½è¦ä¼šçš„. åº”å±Šè¿˜æ˜¯æ›´å¤šè€ƒè™‘å…¬å¸å§. è·¯è¿‡ (2019-06-16 20:39) è¿™ä¸ªä¸åŒåŸŸåå¯ä»¥æ”¯æŒå—ï¼Œ æ¯”å¦‚ sso.abc.com å’Œ client.efg.comä¹‹é—´å¯ä»¥å®ç°å— calmkart (2019-06-17 13:21) è¿™ä¸ªé¡¹ç›®çš„å®ç°æ–¹å¼æ˜¯åŸºäºcookieæºå¸¦ä¿¡æ¯çš„ï¼Œæ‰€ä»¥ä¸æ”¯æŒè·¨åŸŸç™»é™†ï¼Œè¦æ”¯æŒè·¨åŸŸéœ€è¦ç”¨å…¶ä»–æ‰‹æ®µå®ç°ã€‚ è·¯è¿‡ (2019-06-17 20:35) å¥½çš„ï¼Œè°¢è°¢ã€‚ æˆ‘è¿˜æ˜¯å°è¯•èµ°è·³è½¬æŠŠtokenå¸¦è¿‡å»å†éªŒè¯ã€‚ ","date":"2018-09-28T00:00:00Z","permalink":"/posts/2018/09/2018-09-28-django-sso-server%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7%E5%8F%8B%E5%A5%BD%E7%9A%84%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F/","title":"Django sso server(ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„çš„å•ç‚¹ç™»å½•ç³»ç»Ÿ)"},{"content":"å°è£…äº†ä¸€ä¸ªpythonçš„ldapå¸¸ç”¨æ“ä½œç±»\né¦–å…ˆpipè£…åº“\npip install python-ldap ç„¶åå¼€å§‹ä»£ç éƒ¨åˆ†\n# -*- coding:utf-8 -*- from __future__ import absolute_import import binascii import hashlib from base64 import b64encode import ldap import ldap.modlist as modlist from common.common import log class MyLdap(): def __init__(self,ldap_host=None,base_dn=None,user=None,password=None): self.base_dn = base_dn self.ldap_host = ldap_host self.user = user self.password = password try: self.ldapconn = ldap.initialize(ldap_host) self.ldapconn.simple_bind(user,password) except ldap.LDAPError,e: log().error(str(e)) print e @property def status(self): \u0026#39;\u0026#39;\u0026#39; éªŒè¯åˆå§‹åŒ–ldapè´¦å·å¯†ç ,ä»¥åŠldapåœ°å€æ˜¯å¦æ­£ç¡® \u0026#39;\u0026#39;\u0026#39; ldap_client = ldap.initialize(self.ldap_host) try: ldap_client.simple_bind_s(self.user, self.password) ldap_client.unbind_s() return {\u0026#34;status\u0026#34;:True} except Exception as e: log().error(str(e)) return {\u0026#34;status\u0026#34;:False, \u0026#34;msg\u0026#34;:\u0026#34;ldapåˆå§‹åŒ–ç®¡ç†å‘˜è´¦å·å¯†ç æˆ–ldapåœ°å€æœ‰è¯¯,è¯¦æƒ…:{0}\u0026#34;.format(str(e))} def _ldap_search_dn(self,uid=None): obj = self.ldapconn obj.protocal_version = ldap.VERSION3 searchScope = ldap.SCOPE_SUBTREE retrieveAttributes = None searchFilter = \u0026#34;cn=\u0026#34; + uid try: ldap_result_id = obj.search(self.base_dn, searchScope, searchFilter, retrieveAttributes) result_type, result_data = obj.result(ldap_result_id, 0) if result_type == ldap.RES_SEARCH_ENTRY: return result_data[0][0] else: return None except ldap.LDAPError, e: log().error(str(e)) def ldap_get_user(self,uid=None): \u0026#39;\u0026#39;\u0026#39; è·å–ldapç”¨æˆ·è¯¦æƒ…,å¤±è´¥è¿”None \u0026#39;\u0026#39;\u0026#39; obj = self.ldapconn obj.protocal_version = ldap.VERSION3 searchScope = ldap.SCOPE_SUBTREE retrieveAttributes = None searchFilter = \u0026#34;cn=\u0026#34; + uid try: ldap_result_id = obj.search(self.base_dn, searchScope, searchFilter, retrieveAttributes) result_type, result_data = obj.result(ldap_result_id, 0) if result_type == ldap.RES_SEARCH_ENTRY: username = result_data[0][1][\u0026#39;cn\u0026#39;][0] mail = result_data[0][1][\u0026#39;mail\u0026#39;][0] displayName = result_data[0][1][\u0026#39;displayName\u0026#39;][0] sn = result_data[0][1][\u0026#39;sn\u0026#39;][0] result = {\u0026#39;username\u0026#39;:username,\u0026#39;mail\u0026#39;:mail,\u0026#39;displayName\u0026#39;:displayName, \u0026#39;sn\u0026#39;:sn} return result else: return None except ldap.LDAPError, e: log().error(str(e)) def ldap_get(self,uid=None,passwd=None): \u0026#39;\u0026#39;\u0026#39; éªŒè¯ldapè´¦å·å¯†ç ,æˆåŠŸè¿”True,å¤±è´¥è¿”False \u0026#39;\u0026#39;\u0026#39; target_cn = self._ldap_search_dn(uid) if not target_cn: return False try: client = ldap.initialize(self.ldap_host) client.simple_bind_s(target_cn,passwd) client.unbind_s() return True except ldap.LDAPError,e: log().error(str(e)) return False def cnupdatepass(self, cn, passwd): \u0026#39;\u0026#39;\u0026#39; æ›´æ”¹ldapå¯†ç ,æˆåŠŸè¿”True,å¤±è´¥è¿”error \u0026#39;\u0026#39;\u0026#39; dn=\u0026#39;cn={0},{1}\u0026#39;.format(cn, self.base_dn) try: result=self.ldapconn.search_s(dn, ldap.SCOPE_SUBTREE, \u0026#39;cn=%s\u0026#39; % cn) oldpass=result[0][1][\u0026#39;userPassword\u0026#39;] oldwifipass=result[0][1][\u0026#39;sambaNTPassword\u0026#39;] newpass=\u0026#39;{MD5}\u0026#39; + b64encode(hashlib.md5(passwd).digest()) wifipass=binascii.hexlify(hashlib.new(\u0026#39;md4\u0026#39;, passwd.encode(\u0026#39;utf-16le\u0026#39;)).digest()) old={\u0026#39;userPassword\u0026#39;:oldpass,\u0026#39;sambaNTPassword\u0026#39;: oldwifipass} new={\u0026#34;sambaNTPassword\u0026#34;: [wifipass],\u0026#34;userPassword\u0026#34;:[newpass]} mlist = modlist.modifyModlist(old, new) self.ldapconn.modify_s(dn, mlist) return {\u0026#34;status\u0026#34;:True} except ldap.LDAPError as e: log().error(str(e)) return {\u0026#34;status\u0026#34;:False, \u0026#34;msg\u0026#34;:\u0026#34;ldapæ›´æ”¹å¯†ç é”™è¯¯,è¯¦æƒ…: {0}\u0026#34;.format(str(e))} ä½¿ç”¨æ—¶\nldap_client = MyLdap(ldap_url, base_dn, admin, password) ä»£ç æ³¨é‡Šå·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†æ„Ÿè§‰,ä¸å†å†™è¯¦æƒ…äº†,æœ¬æ–‡åšä¸ªå¤‡å¿˜\n","date":"2018-09-28T00:00:00Z","permalink":"/posts/2018/09/2018-09-28-python%E6%93%8D%E4%BD%9Cldap/","title":"pythonæ“ä½œldap"},{"content":"å°è£…äº†ä¸€ä¸ªpythonçš„æ“ä½œrsaå’Œaesçš„åŠ è§£å¯†ç±»\né¦–å…ˆpipè£…åº“\npip install pycrypto ç„¶åä»£ç å¦‚ä¸‹\n# -*- coding:utf-8 -*- import base64 from Crypto import Random from Crypto.Hash import SHA from Crypto.Cipher import PKCS1_v1_5 as Cipher_pkcs1_v1_5 from Crypto.Signature import PKCS1_v1_5 as Signature_pkcs1_v1_5 from Crypto.PublicKey import RSA from Crypto.Cipher import AES from binascii import b2a_hex, a2b_hex #AESåŠ è§£å¯†,ç”¨äºæœ¬åœ°åŠ å¯†æ•°æ®åº“å¯†ç å’Œrsa private key aes_salt = \u0026#34;opquweoijuqowieh\u0026#34; class Aes(): def __init__(self, key=aes_salt): self.key = key self.mode = AES.MODE_CBC def encrypt(self, text): cryptor = AES.new(self.key, self.mode, b\u0026#39;0000000000000000\u0026#39;) length = 16 count = len(text) if count \u0026lt; length: add = (length-count) text = text + (\u0026#39;\\0\u0026#39; * add) elif count \u0026gt; length: add = (length-(count % length)) text = text + (\u0026#39;\\0\u0026#39; * add) self.ciphertext = cryptor.encrypt(text) return b2a_hex(self.ciphertext) def decrypt(self, text): cryptor = AES.new(self.key, self.mode, b\u0026#39;0000000000000000\u0026#39;) plain_text = cryptor.decrypt(a2b_hex(text)) return plain_text.rstrip(\u0026#39;\\0\u0026#39;) #rsaåŠ è§£å¯†,ç”¨äºcookieçš„åŠ è§£å¯† class Rsa(): def __init__(self): self.random_generator = Random.new().read def gen_rsa_keys(self): rsa = RSA.generate(1024, self.random_generator) private_pem = rsa.exportKey() public_pem = rsa.publickey().exportKey() return (private_pem, public_pem) def crypto(self, public_key, text): rsakey = RSA.importKey(public_key) cipher = Cipher_pkcs1_v1_5.new(rsakey) crypto_text = base64.b64encode(cipher.encrypt(text)) return crypto_text def decrypt(self, private_key, text): rsakey = RSA.importKey(private_key) cipher = Cipher_pkcs1_v1_5.new(rsakey) decrypt_text = cipher.decrypt(base64.b64decode( text), self.random_generator) return decrypt_text if __name__ == \u0026#39;__main__\u0026#39;: rsa = Rsa() aes = Aes() (pri,pub)=rsa.gen_rsa_keys() jm = rsa.crypto(pub, \u0026#34;pengng|||||123908123.123123\u0026#34;) print rsa.decrypt(pri, jm) è°ƒç”¨æ–¹æ³•\nrsa = Rsa() aes = Aes() ä»£ç æ³¨é‡Šå†™å¾—éå¸¸è¯¦ç»†ï¼Œç»†èŠ‚å°±ä¸èµ˜è¿°äº†ï¼Œåšä¸ªå¤‡å¿˜\n","date":"2018-09-28T00:00:00Z","permalink":"/posts/2018/09/2018-09-28-python%E6%93%8D%E4%BD%9Crsa%E5%92%8Caes%E5%8A%A0%E8%A7%A3%E5%AF%86/","title":"pythonæ“ä½œrsaå’ŒaesåŠ è§£å¯†"},{"content":"githubä¸Šé¡¹ç›®ç»Ÿè®¡æ˜¯ä»¥æœ€å¤šçš„è¯­è¨€ä½œä¸ºé¡¹ç›®è¯­è¨€,æœ‰æ—¶å€™æœ‰ç‚¹ä¸ºéš¾å¼ºè¿«ç—‡. ä»¥ä¸‹æ–¹æ³•å¯ä»¥æ”¹å˜ç»Ÿè®¡çš„è¯­è¨€,ä¸€ç‚¹å°ç¬”è®°\n#åˆ›å»º.gitattributesæ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•,å†…å®¹å¦‚ä¸‹ *.css linguist-language=Python *.less linguist-language=Python *.js linguist-language=Python *.html linguist-language=Python æå®š!\n","date":"2018-09-25T00:00:00Z","permalink":"/posts/2018/09/2018-09-25-%E4%BF%AE%E6%94%B9nginx%E9%A1%B9%E7%9B%AE%E6%89%80%E5%B1%9E%E8%AF%AD%E8%A8%80/","title":"ä¿®æ”¹githubé¡¹ç›®æ‰€å±è¯­è¨€"},{"content":"æœ€è¿‘åœ¨åšä¸€ä¸ªå¥½ç©çš„é€šç”¨djangoå•ç‚¹ç™»å½•ç³»ç»Ÿï¼Œç™»å½•ç³»ç»Ÿå°‘ä¸äº†éªŒè¯ç ï¼Œå‚è€ƒäº†ä¸€ä¸‹åˆ«äººçš„åšæ³•å’Œå¼€æºé¡¹ç›®ï¼Œæ€»ç»“ä¸€ä¸‹ã€‚\nç»“æœå¦‚ä¸‹ï¼š\nä¸»è¦æ€è·¯æµç¨‹æ˜¯ï¼Œåç«¯æ ¹æ®éšæœºç ç»˜å›¾ï¼Œç„¶ååšæ··æ·†(æˆ‘è¿™é‡Œå‡ ä¹æ²¡åšæ¨¡ç³Šä¹‹ç±»çš„æ··æ·†)ï¼Œæœ€åå°†éšæœºéªŒè¯ç å†™è¿›åç«¯sessioné‡Œï¼Œå‰ç«¯è·å–å›¾åƒåï¼Œæäº¤æ—¶ä¸sessioné‡Œçš„éªŒè¯ç åšæ¯”è¾ƒã€‚æµç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¤§è‡´ä»£ç å¦‚ä¸‹ã€‚\n1.captcha_handle.py\ncaptcha_handle.py #ç”¨äºç”Ÿæˆéšæœºå­—ç¬¦ä¸²ä»¥åŠç”ŸæˆéªŒè¯ç å›¾ç‰‡ # -*- coding:utf-8 -*- import random,string from PIL import Image,ImageDraw,ImageFont,ImageFilter #ç”Ÿæˆéšæœºå­—ç¬¦ä¸² def _getRandomChar(): #stringæ¨¡å—åŒ…å«å„ç§å­—ç¬¦ä¸²ï¼Œä»¥ä¸‹ä¸ºå°å†™å­—æ¯åŠ æ•°å­— ran = string.ascii_lowercase+string.digits char = \u0026#39;\u0026#39; for i in range(4): char += random.choice(ran) return char #è¿”å›ä¸€ä¸ªéšæœºçš„RGBé¢œè‰² def _getRandomColor(): return (random.randint(50,150),random.randint(50,150),random.randint(50,150)) def create_captcha(): #åˆ›å»ºå›¾ç‰‡ï¼Œæ¨¡å¼ï¼Œå¤§å°ï¼ŒèƒŒæ™¯è‰² img = Image.new(\u0026#39;RGB\u0026#39;, (120,30), (255,255,255)) #åˆ›å»ºç”»å¸ƒ draw = ImageDraw.Draw(img) #è®¾ç½®å­—ä½“ font = ImageFont.truetype(\u0026#39;Arial.ttf\u0026#39;, 25) code = _getRandomChar() #å°†ç”Ÿæˆçš„å­—ç¬¦ç”»åœ¨ç”»å¸ƒä¸Š for t in range(4): draw.text((30*t+5,0),code[t],_getRandomColor(),font) #ç”Ÿæˆå¹²æ‰°ç‚¹ for _ in range(random.randint(0,50)): #ä½ç½®ï¼Œé¢œè‰² draw.point((random.randint(0, 120), random.randint(0, 30)),fill=_getRandomColor()) #ä½¿ç”¨æ¨¡ç³Šæ»¤é•œä½¿å›¾ç‰‡æ¨¡ç³Š # img = img.filter(ImageFilter.BLUR) #ä¿å­˜ #img.save(\u0026#39;\u0026#39;.join(code)+\u0026#39;.jpg\u0026#39;,\u0026#39;jpeg\u0026#39;) return img,code if __name__ == \u0026#39;__main__\u0026#39;: create_code() 2.views.py\nviews.py #è§†å›¾ï¼Œç”ŸæˆéªŒè¯ç å›¾ç‰‡å’Œcodeï¼Œè¿”å›å›¾ç‰‡ï¼Œcodeå­˜è¿›session class get_captcha(View): def get(self, request): \u0026#39;\u0026#39;\u0026#39; ç”ŸæˆéªŒè¯ç å›¾ç‰‡å’ŒéªŒè¯ç code,è¿”å›éªŒè¯ç å›¾ç‰‡,å¹¶ä»¥å½¢å¼å°†éªŒè¯ç å­˜æ”¾åœ¨sessioné‡Œ \u0026#39;\u0026#39;\u0026#39; try: f = BytesIO() img, code = create_captcha() request.session[\u0026#34;captcha\u0026#34;] = code img.save(f,\u0026#39;PNG\u0026#39;) return HttpResponse(f.getvalue()) except Exception as e: log().error(str(e)) 3.login.html\n{# html #} \u0026lt;div class=\u0026#34;col-xs-4\u0026#34;\u0026gt; \u0026lt;img id=\u0026#34;captcha_img\u0026#34; src=\u0026#34;{% url \u0026#39;get_captcha\u0026#39; %}\u0026#34; onclick=\u0026#34;refresh_captcha()\u0026#34; style=\u0026#34;margin-top: 28px;\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;help-block\u0026#34; onclick=\u0026#34;refresh_captcha()\u0026#34;\u0026gt; çœ‹ä¸æ¸…æ¥š?æ¢ä¸€å¼ ! \u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; {# js #} \u0026lt;script\u0026gt; //åˆ·æ–°éªŒè¯ç  function refresh_captcha() { $(\u0026#34;#captcha_img\u0026#34;).attr(\u0026#34;src\u0026#34;,$(\u0026#34;#captcha_img\u0026#34;)[0].src + \u0026#39;?\u0026#39;); }; \u0026lt;/script\u0026gt; 4.url.py\nurl(r\u0026#39;^get_captcha/$\u0026#39;,cas_views.get_captcha.as_view(), name=\u0026#34;get_captcha\u0026#34;), 5.views.py\n#æ ¡éªŒéªŒè¯ç æ˜¯å¦æ­£ç¡® if request.session[\u0026#34;captcha\u0026#34;].lower() != captcha.lower(): return JsonResponse({\u0026#34;status\u0026#34;:False, \u0026#34;msg\u0026#34;:\u0026#34;éªŒè¯ç é”™è¯¯!\u0026#34;}) ä¸€äº›ä»£ç æ˜¯å‚è€ƒç½‘ç»œä¸Šå…¶ä»–å¼€æºä»£ç ï¼Œä¸è¿‡å…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œç†Ÿæ‚‰request.sessionå°±å·®ä¸å¤šäº†ã€‚åšä¸ªè®°å½•ã€‚\n","date":"2018-09-18T00:00:00Z","permalink":"/posts/2018/09/2018-09-18-django%E7%94%9F%E6%88%90%E7%99%BB%E5%BD%95%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81/","title":"djangoç”Ÿæˆå›¾ç‰‡éªŒè¯ç "},{"content":"ä¸€ç‚¹å…³äºdjangoç±»è§†å›¾è£…é¥°å™¨çš„å°ç¬”è®°ã€‚\ndjangoç±»è§†å›¾æ˜¯å¾ˆå¸¸ç”¨çš„ï¼Œå¯¹äºä¼ ç»Ÿçš„å‡½æ•°è§†å›¾æ¥è¯´ï¼Œè£…é¥°å™¨å¯ä»¥ç›´æ¥è£…é¥°å‡½æ•°ï¼Œä½†ç±»è§†å›¾ï¼Œè£…é¥°å™¨æ— æ³•ç›´æ¥è£…é¥°ç±»æ–¹æ³•ã€‚\næ¯”è¾ƒäº†å‡ ç§å¸¸è§çš„è§£å†³æ–¹æ³•,ä¸ªäººè§‰å¾—æ¯”è¾ƒä¼˜é›…çš„è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\nfrom django.shortcuts import render from django.utils.decorators import method_decorator from django.views.decorators.csrf import csrf_exempt from django.views.generic import View @method_decorator(csrf_exempt, name=\u0026#34;dispatch\u0026#34;) class login(View): @method_decorator(auth_login) def get(self, request, username): #....func... return render(request, \u0026#39;login.html\u0026#39;, {\u0026#34;displayName\u0026#34;:username, \u0026#34;admin_flag\u0026#34;:admin_flag}) æ—¢å¦‚ä»¥ä¸Šä»£ç ï¼Œå°†è£…é¥°å™¨å‡½æ•°ä¼ ç»™method_decoratoræ–¹æ³•ï¼Œç›´æ¥ä¿®é¥°è§†å›¾ç±»æ–¹æ³•ã€‚\nä¹Ÿå¯ç›´æ¥ä¿®é¥°è§†å›¾ç±»ï¼Œå¯¹äºéœ€è¦ä¿®é¥°çš„æ–¹æ³•ï¼Œç”¨nameå‚æ•°çš„å½¢å¼ä¼ å…¥method_decoratorä¸­å³å¯ï¼Œä½†æ„Ÿè§‰ä¸å¤Ÿä¼˜é›…ã€‚\nfrom django.shortcuts import render from django.utils.decorators import method_decorator from django.views.decorators.csrf import csrf_exempt from django.views.generic import View @method_decorator(csrf_exempt, name=\u0026#34;dispatch\u0026#34;) @method_decorator(auth_login, name=\u0026#34;get\u0026#34;) class login(View): def get(self, request, username): #....func... return render(request, \u0026#39;login.html\u0026#39;, {\u0026#34;displayName\u0026#34;:username, \u0026#34;admin_flag\u0026#34;:admin_flag}) éœ€è¦ç¨å¾®æ³¨æ„çš„æ˜¯ï¼Œcsrf_exemptè·¨ç«™æ’é™¤è£…é¥°å™¨ï¼Œåªèƒ½ä¿®é¥°åœ¨ç±»è§†å›¾çš„dispatchæ–¹æ³•ä¸Šï¼Œæ—¢åŸå§‹å†™æ³•å¦‚ä¸‹ï¼š\nclass login(View): @method_decorator(csrf_exempt) def dispatch(self, request, *args, **kwargs): return super(login,self).dispatch(request,*args,**kwargs) def get(self, request, username): #....func... return render(request, \u0026#39;login.html\u0026#39;, {\u0026#34;displayName\u0026#34;:username, \u0026#34;admin_flag\u0026#34;:admin_flag}) ä½†å…¶å®ç›´æ¥ç”¨ç±»æ–¹æ³•è£…é¥°å™¨è£…é¥°è§†å›¾ç±»ï¼Œä¼ å…¥å‚æ•°name=dispatchå°±è¡Œäº†ï¼Œä¸éœ€è¦é‡å†™dispatchæ–¹æ³•ã€‚\næ—¢å¦‚ä¸Šæ–‡ã€‚\nå†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\n( æ›°..æ›° ) (2018-09-19 16:06) å¤§ä½¬ï¼Œå¤§ä½¬ï¼Œè¿™ç»å¯¹æ˜¯å¤§ä½¬ calmkart (2018-09-20 19:02) æ€»è£è°¢ä½ è¯´å¤§ä½¬å°±å¤§ä½¬å¥½å§ ","date":"2018-09-18T00:00:00Z","permalink":"/posts/2018/09/2018-09-18-django%E7%B1%BB%E8%A7%86%E5%9B%BE%E8%A3%85%E9%A5%B0%E5%99%A8/","title":"djangoç±»è§†å›¾è£…é¥°å™¨"},{"content":"é»˜è®¤çš„django-adminä¸­ç”¨æˆ·çš„modelsæƒé™åªæœ‰ä¸‰ä¸ª,åˆ†åˆ«æ˜¯(Can change, Can add, Can delete),æ˜¾ç„¶çš„,å¯¹äºç»å¤§éƒ¨åˆ†crudå·¥ç¨‹å¸ˆ(^_^)è€Œè¨€,ä¸€çœ¼çœ‹è¿‡å»å°±å°‘äº†äº›ä»€ä¹ˆ,æ²¡é”™,å°‘äº†å¾ˆå…³é”®çš„Can viewæƒé™.\nå½“ç„¶django-adminçš„ç”¨æˆ·æƒé™æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„,éœ€è¦æ”¹permissionçš„meta,è¿™é‡Œä¸ç»†è¿°,å‘ç°ä¸€ä¸ªç®€å•å¥½ç”¨çš„django app,å¯ä»¥ç›´æ¥æ·»åŠ Can viewæƒé™,ç¾æ»‹æ»‹.\næœ€ç»ˆæ•ˆæœå¦‚ä¸‹ æ’ä»¶æ˜¯: django-admin-view-permission åœ°å€ https://github.com/ctxis/django-admin-view-permission ä½¿ç”¨æ–¹å¼åŠå…¶ç®€å•\n#pipå®‰è£…æ’ä»¶ pip install django-admin-view-permission #å°†appæ³¨å†Œ,è®°å¾—ä¸€å®šæ³¨å†Œåœ¨django.contrib.adminä¹‹å‰ INSTALLED_APPS = [ \u0026#39;admin_view_permission\u0026#39;, \u0026#39;django.contrib.admin\u0026#39;, ... ] #æ›´æ–°æ•°æ®åº“ python manage.py migrate å³å¯ #å¦‚éœ€è¦åªå¯¹ä¸€äº›æ•°æ®åº“ç®¡ç”¨,å¯ä»¥ ADMIN_VIEW_PERMISSION_MODELS = [ \u0026#39;auth.User\u0026#39;, ... ] çš„ç¡®æ˜¯ä¸ªå¥½ä¸œè¥¿å•Š,å…æ‰äº†æ‰‹å†™è¿™ç§æœ¬åº”å°±æœ‰çš„æƒé™.åˆ†äº«ä¸€ä¸‹.\n","date":"2018-09-06T00:00:00Z","permalink":"/posts/2018/09/2018-09-06-%E4%B8%BAdjango-admin%E7%9A%84userpermission%E6%B7%BB%E5%8A%A0read-onlycan-view%E6%9D%83%E9%99%90/","title":"ä¸ºdjango-adminçš„userpermissionæ·»åŠ read only(can view)æƒé™"},{"content":"é€šå¸¸æœºå™¨ä¸Šä¿å­˜çš„keyéƒ½æ˜¯è¯»å–~/.ssh/authorized_keysæ–‡ä»¶æ¥è·å–çš„,è¿™æ ·çš„è¯å°±ä¸å¥½åšåˆ°åŠ¨æ€è°ƒæ•´å’Œæ§åˆ¶æƒé™.\nopenssh6.2ç‰ˆæœ¬ä»¥ä¸Šæ–°å¢åŠ äº†AuthorizedKeysCommandé€‰é¡¹åŠŸèƒ½,å¯ä»¥è·å–åŠ¨æ€keysåˆ—è¡¨\nPort 22 Protocol 2 SyslogFacility AUTH LogLevel INFO #PermitRootLogin no RSAAuthentication yes PubkeyAuthentication yes AuthorizedKeysFile .ssh/authorized_keys # To disable tunneled clear text passwords, change to no here! PasswordAuthentication no # Change to no to disable s/key passwords ChallengeResponseAuthentication no UsePAM yes AllowTcpForwarding no X11UseLocalhost no UseDNS no Subsystem sftp /usr/libexec/openssh/sftp-server AuthorizedKeysCommand /etc/get_key.sh AuthorizedKeysCommandUser root ä¸€ä¸ªå…¸å‹çš„sshdé…ç½®å¦‚ä¸Š,å…¶ä¸­AuthorizedKeysCommandé€‰é¡¹çš„ä½œç”¨æ˜¯åœ¨æ¯æ¬¡ç™»å½•æ—¶éƒ½è°ƒç”¨æŒ‡å®šçš„è„šæœ¬ï¼Œå¹¶ä»¥è„šæœ¬å½“å‰çš„è¾“å‡ºä½œä¸ºkeysåˆ—è¡¨.å½“è„šæœ¬çš„è¾“å‡ºä¸ºç©ºæ—¶,å†è°ƒç”¨æœ¬åœ°authorized_keysæ–‡ä»¶ä¸­çš„keysåˆ—è¡¨éªŒè¯.\nä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨æ–¹å¼æ˜¯,å°†sshå…¬é’¥æ”¾åœ¨ä¸€ä¸ªç»Ÿä¸€çš„é‰´æƒæœåŠ¡å™¨ä¸Š,ä¸cmdbä¸­çš„æœåŠ¡å™¨èµ„æºåˆ—è¡¨åšåŒ¹é…,é€šè¿‡http restapiè¿”å›æœåŠ¡å™¨å…è®¸ç™»å½•çš„å…¬é’¥åˆ—è¡¨,åœ¨æœåŠ¡å™¨ä¸Šé€šè¿‡get_key.shè¿›è¡Œè¯»å–.å½“è¯»å–ä¸ºç©ºæ—¶ï¼Œä½¿ç”¨æœ¬åœ°authorized_keysï¼Œä¸€èˆ¬ä¸ºæƒé™ç”¨æˆ·.\nè¿™æ ·å°±å¯ä»¥å¾ˆå¥½çš„å®ç°æœåŠ¡å™¨æˆæƒï¼Œç»„æˆæƒä»¥åŠè·³æ¿æœºç›¸å…³åŠŸèƒ½.(æœ¬åœ°keyè½¬å‘é€šè¿‡è·³æ¿æœºè¿æ¥æœåŠ¡å™¨çš„æƒ…å†µ,å°±å¯ä»¥åšåˆ°æƒé™é›†ä¸­ä¸é‰´æƒäº†)\n","date":"2018-08-22T00:00:00Z","permalink":"/posts/2018/08/2018-08-22-sshd%E7%9A%84authorizedkeyscommand%E9%80%89%E9%A1%B9/","title":"sshdçš„AuthorizedKeysCommandé€‰é¡¹"},{"content":"é€šè¿‡ä¸€ç‚¹ç»†å¾®ä»£ç çš„ä¿®æ”¹,å°†æŸç³»ç»Ÿé¦–é¡µè½½å…¥æ—¶é—´ç¼©çŸ­äº†10å€æœ‰ä½™.\nç³»ç»Ÿé¦–é¡µå¤§è‡´è¿™æ ·\né€»è¾‘æ˜¯è¯»å–åå°çš„æ‰€æœ‰æœåŠ¡åˆ—è¡¨,åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™,æœ‰æƒé™åˆ™äº¤ç»™å‰ç«¯ç”¨ztreeæ˜¾ç¤º,å¹¶å¯è¿›è¡Œéƒ¨ç½²æ“ä½œ,ä½†å› ä¸ºæœåŠ¡å¤ªå¤š,éå†æœåŠ¡ååˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™åå°è€—æ—¶å¤ªé•¿,ç”¨chromeæŸ¥äº†ä¸‹,åå°æ•°æ®å¤„ç†è´¹æ—¶2000ms,è¿™æ ·é¦–é¡µå°±è½½å…¥çš„å¤ªæ…¢äº†.\nç¬¬ä¸€æ­¥,æŸ¥ä»£ç ,åŸå§‹ä»£ç å¦‚ä¸‹:\n@login_required def services(request): user = request.user _online_apps = App.objects.filter(app_env=\u0026#39;online\u0026#39;) _test_apps = App.objects.filter(app_env=\u0026#39;test\u0026#39;) _dev_apps = App.objects.filter(app_env=\u0026#39;dev\u0026#39;) online_apps = [a for a in _online_apps if user.has_perm(\u0026#39;deploy_perm\u0026#39;, a) or is_admin_by_group(user.username)] test_apps = [a for a in _test_apps if user.has_perm(\u0026#39;deploy_perm\u0026#39;, a) or is_admin_by_group(user.username)] dev_apps = [a for a in _dev_apps if user.has_perm(\u0026#39;deploy_perm\u0026#39;, a) or is_admin_by_group(user.username)] online_apps_name = [{\u0026#39;name\u0026#39;:app.app_name, \u0026#39;id\u0026#39;:app.id} for app in online_apps] test_apps_name = [{\u0026#39;name\u0026#39;:app.app_name, \u0026#39;id\u0026#39;:app.id} for app in test_apps] dev_apps_name = [{\u0026#39;name\u0026#39;:app.app_name, \u0026#39;id\u0026#39;:app.id} for app in dev_apps] nodes = [ {\u0026#39;name\u0026#39;:\u0026#39;online\u0026#39;, \u0026#39;open\u0026#39;:\u0026#39;true\u0026#39;, \u0026#39;children\u0026#39;:online_apps_name }, {\u0026#39;name\u0026#39;:\u0026#39;test\u0026#39;, \u0026#39;open\u0026#39;:\u0026#39;false\u0026#39;, \u0026#39;children\u0026#39;:test_apps_name }, {\u0026#39;name\u0026#39;:\u0026#39;dev\u0026#39;, \u0026#39;open\u0026#39;:\u0026#39;false\u0026#39;, \u0026#39;children\u0026#39;:dev_apps_name } ]; return render(request, \u0026#39;services/services.html\u0026#39;, {\u0026#39;nodes\u0026#39;: json.dumps(nodes)}) ä¹Ÿæ²¡ä»€ä¹ˆå¤æ‚çš„,å°±æ˜¯django models + django-guardianæƒé™æ§åˆ¶,ç„¶åè¿”å›æ•°æ®ç»™ztreeç”Ÿæˆæ ‘ç»“æ„.\nåˆæ­¥è®¾æƒ³æ˜¯å› ä¸ºåˆ—è¡¨ç”Ÿæˆå¼å¤ªå¤šå¯¼è‡´é€Ÿåº¦æ…¢,å†™æµ‹è¯•ä»£ç åšæµ‹è¯•\npython manage.py shell \u0026gt;\u0026gt;\u0026gt; import time \u0026gt;\u0026gt;\u0026gt; from django.contrib.auth.models import User \u0026gt;\u0026gt;\u0026gt; from services.views import new_service \u0026gt;\u0026gt;\u0026gt; def test(user): ... start = time.time() ... new_service(user) ... stop = time.time() ... print stop-start ... \u0026gt;\u0026gt;\u0026gt; pengng = User.objects.get(name=\u0026#39;pengng\u0026#39;) \u0026gt;\u0026gt;\u0026gt; test(pengng) 1.93502497673 \u0026gt;\u0026gt;\u0026gt; test(pengng) 1.89282894135 \u0026gt;\u0026gt;\u0026gt; test(pengng) 2.14076519012 \u0026gt;\u0026gt;\u0026gt; test(pengng) 1.85515809059 \u0026gt;\u0026gt;\u0026gt; test(pengng) 1.91108703613 å‘ç°å¤„ç†æ—¶é—´å¤§è‡´åœ¨1.8-1.9sä¹‹é—´,ç„¶åç›´æ¥å°†ä¸Šè¿°åŸå§‹ä»£ç ç¬¬ä¸€æ­¥æ‹†äº†å‡ºæ¥\n#ä»…æµ‹è¯•è¿™ä¸€æ­¥ online_apps = [a for a in _online_apps if user.has_perm(\u0026#39;deploy_perm\u0026#39;, a) or is_admin_by_group(user.username)] #å‘ç°æ—¶é—´åœ¨1.2ç§’å·¦å³ \u0026gt;\u0026gt;\u0026gt; test(pengng) 1.25127100945 \u0026gt;\u0026gt;\u0026gt; test(pengng) 1.27178192139 \u0026gt;\u0026gt;\u0026gt; test(pengng) 1.22848701477 \u0026gt;\u0026gt;\u0026gt; test(pengng) 1.25300002098 ç»§ç»­åˆ†æ‹†,å‘ç°æ˜¯è¿™ä¸ªuser.has_perm(\u0026lsquo;deploy_perm\u0026rsquo;,a)çš„guardianè·å–æƒé™æ¶ˆè€—äº†å¤§é‡çš„æ—¶é—´ ç„¶åæƒ³èµ·è¿™ä¸ªç³»ç»Ÿé‡Œæƒé™éƒ½æ˜¯ä»¥groupæ¥èµ‹æƒçš„,è·å–ç”¨æˆ·å¯¹äºæœåŠ¡çš„æƒé™è¦å…ˆç»è¿‡ç»„å†åˆ°æœåŠ¡,å…ˆéå†æœåŠ¡å†å•ç‹¬æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦æœ‰è¯¥ç»„æƒé™å¯¼è‡´é‡å¤éå†å¤ªå¤š,å…¶å®ç›´æ¥è·å–ç”¨æˆ·å¯¹åº”çš„æ‰€æœ‰æ‹¥æœ‰æƒé™çš„æœåŠ¡å¯¹è±¡å³å¯(get_objects_for_user()æ–¹æ³•),å°è¯•ä¿®æ”¹ä»£ç \n@login_required def services(request): user = request.user if is_admin_by_group(user.username): online_apps_name = [{\u0026#39;name\u0026#39;: a.app_name, \u0026#39;id\u0026#39;: a.id} for a in App.objects.filter(app_env=\u0026#39;online\u0026#39;)] test_apps_name = [{\u0026#39;name\u0026#39;: a.app_name, \u0026#39;id\u0026#39;: a.id} for a in App.objects.filter(app_env=\u0026#39;test\u0026#39;)] dev_apps_name = [{\u0026#39;name\u0026#39;: a.app_name, \u0026#39;id\u0026#39;: a.id} for a in App.objects.filter(app_env=\u0026#39;dev\u0026#39;)] else: online_apps_name = [{\u0026#39;name\u0026#39;: a.app_name, \u0026#39;id\u0026#39;: a.id} for a in get_objects_for_user( user, \u0026#39;deploy_perm\u0026#39;, klass=App) if a.app_env == \u0026#34;online\u0026#34;] test_apps_name = [{\u0026#39;name\u0026#39;: a.app_name, \u0026#39;id\u0026#39;: a.id} for a in get_objects_for_user( user, \u0026#39;deploy_perm\u0026#39;, klass=App) if a.app_env == \u0026#34;test\u0026#34;] dev_apps_name = [{\u0026#39;name\u0026#39;: a.app_name, \u0026#39;id\u0026#39;: a.id} for a in get_objects_for_user( user, \u0026#39;deploy_perm\u0026#39;, klass=App) if a.app_env == \u0026#34;dev\u0026#34;] nodes = [ {\u0026#39;name\u0026#39;: \u0026#39;online\u0026#39;, \u0026#39;open\u0026#39;: \u0026#39;true\u0026#39;, \u0026#39;children\u0026#39;: online_apps_name }, {\u0026#39;name\u0026#39;: \u0026#39;test\u0026#39;, \u0026#39;open\u0026#39;: \u0026#39;false\u0026#39;, \u0026#39;children\u0026#39;: test_apps_name }, {\u0026#39;name\u0026#39;: \u0026#39;dev\u0026#39;, \u0026#39;open\u0026#39;: \u0026#39;false\u0026#39;, \u0026#39;children\u0026#39;: dev_apps_name } ] return render(request, \u0026#39;services/services.html\u0026#39;, {\u0026#39;nodes\u0026#39;: json.dumps(nodes)}) ç„¶åé‡è½½æ–‡ä»¶\n\u0026gt;\u0026gt;\u0026gt; reload(services.views) \u0026lt;module \u0026#39;services.views\u0026#39; from \u0026#39;/home/**/***/services/views.py\u0026#39;\u0026gt; \u0026gt;\u0026gt;\u0026gt; test(pengng) 0.0817279815674 \u0026gt;\u0026gt;\u0026gt; test(pengng) 0.0788700580597 \u0026gt;\u0026gt;\u0026gt; test(pengng) 0.0756318569183 ç«‹ç«¿è§å½±,ç¬é—´ä»2ç§’é™ä½åˆ°äº†0.08ç§’å·¦å³ æ”¶å·¥\nå†å²è¯„è®º (5 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nå®‰å…¨é»„ (2018-08-06 11:56) ç»™å¤§ä½¬é€’æ§Ÿæ¦” calmkart (2018-08-13 15:03) å®‰å…¨ç‹ç‰›ç˜ªï¼å®‰å…¨ç‹è¯·å¸¦æˆ‘é£ï¼ æ¨ç¡• (2018-08-09 17:23) å¤§å“¥å–å†°å¯ä¹ï¼Œpscå¿«æ”¶äº†æˆ‘å•Š calmkart (2018-08-13 15:03) å°±ç­‰ç€xscä¸Šå¸‚äº† åƒç“œç¾¤ä¼— (2018-11-07 10:31) æ‚¨çš„æ–‡ç« å†™å¾—çœŸå¥½ï¼Œç»™å¤§ä½¬å€’æ©™æ± ","date":"2018-08-02T00:00:00Z","permalink":"/posts/2018/08/2018-08-02-%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%AB%8B%E7%AB%BF%E8%A7%81%E5%BD%B1%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/","title":"è®°ä¸€æ¬¡ç«‹ç«¿è§å½±çš„æ€§èƒ½ä¼˜åŒ–"},{"content":"ä»¥tengineä¸ºä¾‹ï¼Œè®°å½•æ·»åŠ yumè‡ªç”¨æ‰“åŒ…è¿‡ç¨‹.\né¦–å…ˆ,ä¸‹è½½tengine\nwget https://github.com/alibaba/tengine/archive/tengine-2.2.2.tar.gz tar xzvf tengine-2.2.2.tar.gz cd tengine-tengine-2.2.2/ ç„¶åå®‰è£…æ‰“åŒ…å·¥å…·fpm\nyum -y install ruby rubygems ruby-devel rpm-build gem sources -a http://ruby.taobao.org/ gem install fpm ç¼–è¯‘å®‰è£…åˆ°å…¶ä»–æ–‡ä»¶å¤¹ä¸‹\n./configure --prefix=/home/maintain/nginx --conf-path=/home/shared/nginx/conf/nginx.conf --pid-path=/home/shared/nginx/logs/nginx.pid --error-log-path=/home/shared/nginx/logs/error.log --with-http_ssl_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_gzip_static_module --with-http_stub_status_module --with-http_v2_module --with-http_realip_module --add-module=ngx_cache_purge-2.3 make mkdir /tmp/installdir make install DESTDIR=/tmp/installdir/ æ‰“åŒ…æˆrpmåŒ…\ncd /tmp/installdir/ fpm -s dir -t rpm -n tengine -v 2.2.0 --iteration 1.el6 -C /tmp/installdir/ -p /root æ‰“å‡ºæ¥çš„åŒ…ä¼šåœ¨/rootæ–‡ä»¶å¤¹ä¸‹\nç„¶åå°†rpmå®‰è£…åŒ…ä¸Šä¼ åˆ°è‡ªå»ºyumä»“åº“,åˆ·æ–°ä»“åº“\ncreaterepo --update {{ path }} å®¢æˆ·ç«¯åˆ·æ–°centos yumç¼“å­˜å³å¯\n","date":"2018-07-23T00:00:00Z","permalink":"/posts/2018/07/2018-07-23-yum%E6%BA%90%E5%88%9B%E5%BB%BA%E5%92%8C%E6%9B%B4%E6%96%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8C%85/","title":"yumæºåˆ›å»ºå’Œæ›´æ–°è‡ªå·±çš„åŒ…"},{"content":"æœ€è¿‘åšçš„ä¸€ä¸ªå°webç³»ç»Ÿï¼Œä¸»è¦çš„æ€è·¯æ˜¯ï¼Œæ€æ ·æ‰èƒ½å°†nginxé›†ç¾¤çš„æµ·é‡é…ç½®æ–‡ä»¶,åŒ…æ‹¬serverå’ŒupstreamåŠlocationç­‰å®Œå…¨å¯¹è±¡åŒ– æƒ³åšçš„ä¸œè¥¿å°±ç±»ä¼¼äºhttpdnsï¼Œå°†nginxçš„æµ·é‡é…ç½®æ–‡ä»¶å¯¹è±¡åŒ–ï¼Œæˆ–è€…è€ƒè™‘èƒ½ä¸èƒ½æ•°æ®åº“åŒ– ç°åœ¨çš„åŠŸèƒ½åªæ˜¯è§£ææ‰€æœ‰nginxé…ç½®æ–‡ä»¶,è‡ªåŠ¨è¯»å–upstreamåˆ—è¡¨å’Œlocationä¸­proxy_pass,ç„¶ååšè¿æ¥æ€§è¿½è¸ª å½“ç„¶,è¿½è¸ªåˆ—è¡¨ä¹Ÿå¯è‡ªå®šä¹‰æ·»åŠ ,åœ¨adminåå°é…ç½®å³å¯ æœ€ç»ˆæ•ˆæœå›¾ gitåœ°å€ https://github.com/calmkart/check_port\n#å¤§è‡´éƒ¨ç½²è¿‡ç¨‹ pip install -r pip.text #åˆ›å»ºcheckportæ•°æ®åº“ #ä¿®æ”¹settings.pyä¸­çš„æ•°æ®åº“é…ç½® python manage.py makemigrations python manage.py migrate #å®‰è£…redis,ä¿®æ”¹settings.pyä¸­çš„redisé…ç½® #ä¿®æ”¹readnginxçš„handle.pyå’Œhandle_test.pyä¸­çš„CONFIG_PATHä»¥åŠGIT_PATH(ç”¨äºè‡ªåŠ¨è§£æå’Œæ›´æ–°nginxé…ç½®) #ç”¨supervisorå¯åŠ¨ç³»ç»Ÿ supervisord -c checkport/supervisord.conf #æ­¤å¤–,floweréœ€è¦ç”¨nginxåšè½¬å‘,å‚è€ƒé…ç½®æ–‡ä»¶å¦‚ä¸‹ location ~ ^/flower/? { rewrite ^/flower/?(.*)$ /$1 break; sub_filter \u0026#39;=\u0026#34;/\u0026#39; \u0026#39;=\u0026#34;/flower/\u0026#39;; sub_filter_last_modified on; sub_filter_once off; # proxy_pass http://unix:/tmp/flower.sock:/; proxy_pass http://xxxxxxxxxxxxxxxx; proxy_redirect off; proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_http_version 1.1; } å…¶ä¸­ä¸‰ç§å¸¸è§æ“ä½œä¸º: 1.å°†nginxé…ç½®æ–‡ä»¶åˆ—è¡¨pullåˆ°æœ€æ–° 2.è‡ªåŠ¨è¯»å–å’Œè§£ænginxé…ç½®æ–‡ä»¶,å¹¶å°†è·å–çš„upstreamä»¥åŠproxy_passåˆ—è¡¨å†™è¿›æ•°æ®åº“ 3.æ¢æµ‹æ•°æ®åº“ä¸­æ‰€æœ‰éœ€è¦æ¢æµ‹çš„IP:PORTå¯¹è±¡å®ä¾‹ å¯åœ¨åå°ç®¡ç†-\u0026gt;æ•°æ®æ›´æ–°ä¸­æ‰‹åŠ¨æŒ‰é”®æ›´æ–° ä¹Ÿå¯åœ¨adminåå°é…ç½®Periodic tasksçš„celery beatå®šæ—¶ä»»åŠ¡ å…¶ä¸­: 1.readnginx.tasks.git_pull_config ä»»åŠ¡æ›´æ–°nginxé…ç½®æ–‡ä»¶ä»“åº“ 2.pubstatus.tasks.get_status ä»»åŠ¡è·å–æ‰€æœ‰IP:PORTå¯¹è±¡çŠ¶æ€ 3.readnginx.tasks.read_nginx ä»»åŠ¡åº¦è¯»å–nginxé…ç½®æ–‡ä»¶å¹¶è§£æ,æ›´æ–°æ•°æ®åº“IP:PORTå¯¹è±¡åˆ—è¡¨ å¯æ ¹æ®éœ€æ±‚è®¾ç½®å®šæ—¶ä»»åŠ¡å‘¨æœŸ é€šè¿‡floweråå°å¯ä»¥æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæƒ…å†µ è‡ªå®šä¹‰è¿½è¸ªcheckportçš„IP:PORTåˆ—è¡¨é€šè¿‡adminåå°æ·»åŠ instanceå³å¯å®ç° ","date":"2018-07-23T00:00:00Z","permalink":"/posts/2018/07/2018-07-23-%E4%B8%80%E4%B8%AA%E8%87%AA%E8%A7%A3%E6%9E%90nginx-upstream%E5%92%8Clocation%E5%B9%B6%E6%A3%80%E6%B5%8B%E8%BF%9E%E9%80%9A%E6%80%A7%E7%9A%84web%E7%B3%BB%E7%BB%9F/","title":"ä¸€ä¸ªè‡ªè§£ænginx upstreamå’Œlocationå¹¶æ£€æµ‹è¿é€šæ€§çš„webç³»ç»Ÿ"},{"content":"saltçš„webui,å®˜æ–¹çš„æ˜¯halite,ä½†å·²ç»è¢«æ”¾å¼ƒäº†ï¼Œä¸ç»´æŠ¤å¾ˆä¹…äº† å°è¯•è¿‡å…¶ä»–å‡ ä¸ªstaræ¯”è¾ƒçš„å¼€æºå®ç°,æ¯”å¦‚saltpad,ä½†è¦ä¹ˆå°±æ˜¯bugæ»¡å¤©é£,è¦ä¹ˆå°±æ˜¯æŠ€èƒ½æ ˆä¸ç¬¦éš¾ä»¥äºŒæ¬¡å¼€å‘ æœ€åå‘ç°äº†ä¸€ä¸ªå¼€æºå®ç°å«saltshakerçš„ä¸é”™,æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ å®˜æ–¹é¡¹ç›®åœ°å€ https://github.com/yueyongyue/saltshaker éƒ¨ç½²æ–‡æ¡£è§ install.txt\nå¤§è‡´æ€»ç»“è¿‡ç¨‹å¦‚ä¸‹,éè¯¦æƒ….\ngit clone https://github.com/yueyongyue/saltshaker.git pip install virtualenv virtualenv env source env/bin/activate yum install salt-api.noarch salt-api --version pip install cherrypy==3.8.0 useradd -M -s /sbin/nologin admin passwd admin vim /etc/salt/master.d/saltapi.conf systemctl restart salt-master.service systemctl restart salt-api.service systemctl status salt-api.service systemctl status salt-master.service lsof -i:50075 pip install Django==1.8.4 pip install django-crontab yum install python-devel.x86_64 yum install mysql-devel yum install MySQL-python yum install gcc pip install mysql-python æŸ¥æºç ï¼Œæ”¹dashboard/viewsé‡Œindexå‡½æ•°checkportçš„ç«¯å£ å‡ ä¸ªå®¹æ˜“è¸©å‘çš„åœ°æ–¹:\n1.centos7.4ç”¨pipå®‰è£…mysql-pythonçš„æ—¶å€™ï¼Œéœ€è¦å…ˆå®‰è£…python-devel,mysql-devel,MySQL-python,gcc,å¦åˆ™ä¼šæŠ¥é”™\n2.supervisorè¦è‡ªå·±è£…ï¼Œç›¸å…³é…ç½®è‡ªå·±å†™ä¸€ä¸‹ï¼Œä¹Ÿå®¹æ˜“\n3.å¦‚æœsalt-apiç­‰å‡ ä¸ªéƒ¨ä»¶æ²¡æœ‰è¿è¡Œåœ¨é»˜è®¤ç«¯å£ï¼Œé‚£ä¹ˆå¯åŠ¨saltshakerååœ¨é¦–é¡µä¼šæ˜¾ç¤ºdownçš„çŠ¶æ€ï¼Œéœ€è¦ä¿®æ”¹dashboard/views.pyé‡Œçš„indexå‡½æ•°checkporté‡Œçš„ç«¯å£å·.\n4.å¦‚æœsalt-masterç‰ˆæœ¬æ¯”è¾ƒé«˜(å¤§äº2015.x)ï¼Œå®˜æ–¹yumæºçš„salt-apiå°±æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„ç‰ˆæœ¬äº†ï¼Œéœ€è¦è‡ªå·±ä¸‹è½½salt-apiçš„æ–°åŒ…ï¼Œæˆ‘æ˜¯è‡ªå»ºçš„yumæºï¼Œç„¶å\ncreaterepo \u0026lt;path\u0026gt; createrepo --update \u0026lt;path\u0026gt; æ›´æ–°ä»“åº“ä¿¡æ¯ï¼Œå®‰è£…æœ€æ–°çš„åŒ…\n5.django crontabåœ¨settings.pyé‡Œè¢«æ³¨é‡Šæ‰äº†3ä¸ªï¼Œå¾—æŠŠæ³¨é‡Šå»æ‰ï¼Œç„¶åæŠŠæ‰€æœ‰django crontabè·‘èµ·æ¥.\næœ€åï¼Œè¿™ä¸ªä¸œè¥¿æ„Ÿè§‰ä¹Ÿä¸æ˜¯å¾ˆå®Œå–„å¥½ç”¨ï¼Œä¸è¿‡æ˜¯djangoçš„ï¼ŒäºŒæ¬¡å¼€å‘ä¹Ÿå¾ˆå®¹æ˜“ï¼Œæœ‰æœºä¼šå†è‡ªå·±æ¥æ”¹æ”¹ã€‚\n","date":"2018-07-06T00:00:00Z","permalink":"/posts/2018/07/2018-07-06-saltshaker-%E4%B8%80%E4%B8%AAsalt%E7%9A%84webui/","title":"saltshaker--ä¸€ä¸ªsaltçš„webui"},{"content":"æœ€è¿‘æœ‰äº›djangoå®šæ—¶ä»»åŠ¡è¦è·‘ï¼Œåˆæ‡’çš„åšå¼‚æ­¥celery worker tasksäº†ï¼Œå°±æ˜¯æ™®é€šçš„åŒæ­¥ä»»åŠ¡ï¼Œç”¨çš„django crontabï¼Œå…¶ä¸­djangoç”¨çš„æ˜¯gunicorn-\u0026gt;nginxçš„éƒ¨ç½²æ–¹å¼ã€‚ä½†å‡ å¤©ä¸‹æ¥ï¼Œå‘ç°ä»»åŠ¡æ€»æ˜¯æ‰§è¡Œåˆ°ä¸€åŠå°±åœäº†ï¼Œæ’é”™å‘ç°ä¸€ä¸ªå¶å°”ä¼šå‡ºç°çš„å‘\n\u0026hellip;\næ£€æµ‹åˆ°ç”¨curlè¯·æ±‚æ¥å£ï¼Œæ¯åˆ°31ç§’å°±åœæ­¢ï¼Œåç»­åŒæ­¥ä»»åŠ¡ä¸å†ç»§ç»­\næ£€æŸ¥gonicornå‚æ•°ï¼Œå‘ç°é»˜è®¤çš„timeoutå€¼ä¸º30sï¼Œæ—¢å®¢æˆ·ç«¯è¯·æ±‚30såè¶…æ—¶\ngunicornå¯åŠ¨å‚æ•°åŠ ä¸ŠÂ -t 120\né—®é¢˜è§£å†³\n\u0026hellip;\nå†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nwuyan (2019-07-29 16:34) gunicornå¯åŠ¨å‚æ•°åŠ ä¸Š -t 120 æ˜¯è¡¨ç¤º120sè¶…æ—¶å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œä¼šä¸ä¼šæ‰§è¡Œåˆ°120så°±åœäº†ï¼Œè¿˜æ˜¯æ²¡æœ‰è§£å†³æ ¹æœ¬é—®é¢˜å§ï¼Ÿ calmkart (2019-08-09 15:26) æœ¬æ¥å°±æ˜¯ä¸ªç®€å•çš„å®šæ—¶ä»»åŠ¡,è¦æƒ³å½»åº•è§£å†³é—®é¢˜ç”¨celeryåšå¼‚æ­¥é˜Ÿåˆ—å¤„ç†å•Š ","date":"2018-06-15T00:00:00Z","permalink":"/posts/2018/06/2018-06-15-gunicorn%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%90%8C%E6%AD%A5%E4%BB%BB%E5%8A%A1%E7%9A%84%E5%9D%91/","title":"gunicornä¸­ä¸€ä¸ªåŒæ­¥ä»»åŠ¡çš„å‘"},{"content":"è®°å½•ä¸€äº›djangoå¸¸è§åŠŸèƒ½çš„ç”¨æ³•ã€‚ è¿™æ¬¡ä¸»è¦å…³æ³¨ç‚¹æ˜¯crontabå®šæ—¶ä»»åŠ¡,django/pythonçš„å¼‚å¸¸æ•è·,ä»¥åŠdjango/pythonçš„æ‰“å°logåŠŸèƒ½\nä¸€.crontabå®šæ—¶ä»»åŠ¡ é¦–å…ˆå®‰è£…djanto-crontabæ¨¡å—\npip install django-crontab ç„¶ååœ¨djangoé¡¹ç›®çš„settings.pyé‡Œæ·»åŠ django-crontabæ¨¡å—\nINSTALLED_APPS = [ ..., \u0026#39;django_crontab\u0026#39;, ] ç„¶åç¼–å†™ç›¸å…³çš„cronå®šæ—¶ä»»åŠ¡ç¨‹åºï¼Œä¸€èˆ¬æ”¾åœ¨project/app/viewsé‡Œï¼Œå‘½åä¸ºcron.py\næ¥ç€åœ¨settings.pyé‡Œæ·»åŠ å®šæ—¶ä»»åŠ¡\nCRONJOBS = [ (\u0026#39;0 12 1 * *\u0026#39;, \u0026#39;app.views.cron.cron1\u0026#39;), (\u0026#39;0 12 * * 1-5\u0026#39;, \u0026#39;app.views.cron.cron2\u0026#39;), ] å®šæ—¶è®¾ç½®å‚æ•°ä¸º (åˆ† å°æ—¶ æ—¥ æœˆ æ˜ŸæœŸ),å…·ä½“å¯å‚è€ƒgoogleèµ„æ–™\nç„¶åå¸¸è§çš„æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹:\n#æŸ¥çœ‹å®šæ—¶ä»»åŠ¡ python manage.py crontab show #æ·»åŠ å®šæ—¶ä»»åŠ¡(ä¿®æ”¹å®šæ—¶ä»»åŠ¡) python manage.py crontab add #åˆ é™¤å®šæ—¶ä»»åŠ¡ python manage.py crontab remove #æ‰§è¡Œä¸€æ¬¡å®šæ—¶ä»»åŠ¡ python manage.py crontab run {å®šæ—¶ä»»åŠ¡id} ç‰¹åˆ«æ³¨æ„:crontabçš„logåœ°å€ä¸€å®šè¦å†™ç»å¯¹è·¯å¾„\näºŒ.django/pythonçš„é”™è¯¯æ•è· 1.åŸºç¡€è¯­æ³• try: pass except: pass 2.å¸¸è§å¼‚å¸¸ç±»å‹ AttributeError è¯•å›¾è®¿é—®ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰çš„æ ‘å½¢ï¼Œæ¯”å¦‚foo.x,ä½†fooæ²¡æœ‰å±æ€§x IOError è¾“å…¥è¾“å‡ºå¼‚å¸¸ï¼›åŸºæœ¬æ˜¯æ— æ³•æ‰“å¼€æ–‡ä»¶é”™è¯¯ ImportErrorÂ æ— æ³•å¼•å…¥æ¨¡å—æˆ–è€…åŒ…ï¼›åŸºæœ¬ä¸Šæ˜¯è·¯å¾„é—®é¢˜æˆ–è€…åç§°é”™è¯¯ IndentationError è¯­æ³•é”™è¯¯ï¼›ä»£ç æ²¡æœ‰æ­£ç¡®çš„å¯¹é½ IndexError: ä¸‹æ ‡ç´¢å¼•è¶…å‡ºåºåˆ—è¾¹ç•Œï¼Œæ¯”å¦‚å½“xåªæœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œå´è¯•å›¾è®¿é—®x[5] KeyError è¯•å›¾è®¿é—®å­—å…¸é‡Œä¸å­˜åœ¨çš„é”® NameError ä½¿ç”¨ä¸€ä¸ªè¿˜æœªèµ‹å€¼çš„å˜é‡ SyntaxError ä»£ç éæ³•ï¼Œ TypeErrorÂ ä¼ å…¥å¯¹è±¡ç±»å‹ä¸è¦æ±‚çš„ä¸ç¬¦åˆ ValueErrorÂ ä¼ ç»™å‡½æ•°çš„å‚æ•°ç±»å‹ä¸æ­£ç¡®,æ¯”å¦‚ç»™int()å‡½æ•°ä¼ å…¥å­—ç¬¦ä¸²å½¢ 3.é€šç”¨é”™è¯¯ç±»å‹ Exception\nè¯­æ³•:\nexcept Exception: æˆ–è€…:\nexcept Exception as e: 4.tracebackè·å–å¼‚å¸¸è¯¦æƒ… import traceback #è¿”å›é”™è¯¯å­—ç¬¦ä¸² traceback.format_exc() #æ‰“å°é”™è¯¯å­—ç¬¦ä¸² traceback.print_exc() #é…åˆloggingæ¨¡å—ä½¿ç”¨ logging.getLogger().error(traceback.format_exc()) ä¸‰.django/pythonçš„logæ‰“å° \u0026hellip;\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nå´ä¼Ÿåº· (2018-06-08 17:24) æ¥¼ä¸»ä½ å¥½ï¼Œè¯·é—®ä¸‹å¦‚æœå¼‚å¸¸æ²¡æœ‰è¢«æ•è·ï¼Œä¾‹å¦‚å¿˜è®°å®šä¹‰è¿™ç§ç±»å‹çš„å¼‚å¸¸ï¼Œè¯¥æ€ä¹ˆé¿å…è¿™ç§æƒ…å†µçš„æŠ¥é”™å•Šï¼Œä¸èƒœæ„Ÿæ¿€ ","date":"2018-05-28T00:00:00Z","permalink":"/posts/2018/05/2018-05-28-django%E7%AC%94%E8%AE%B0crontab%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7%E5%92%8C%E6%89%93%E5%8D%B0log/","title":"[djangoç¬”è®°]crontab,å¼‚å¸¸æ•è·å’Œæ‰“å°log"},{"content":"æœåŠ¡ç«¯ä¸»è¦å°±æ˜¯ç”¨çš„nginx-upload-moduleå’Œnginx-fancyindexä¸¤ä¸ªnginxæ¨¡å—åšæ¥æ”¶ï¼Œç„¶åpythonåç«¯åšå¤„ç† ç„¶åå®¢æˆ·ç«¯çš„ç¼–å†™åˆ†ä¸ºä¸¤éƒ¨åˆ†,ä¸€éƒ¨åˆ†æ˜¯pythonå®¢æˆ·ç«¯,ç”¨çš„requestsåº“,å¦ä¸€éƒ¨åˆ†æ˜¯webå®¢æˆ·ç«¯,ç”¨çš„æ˜¯Huploadifyæ¡†æ¶\nç»“æœå¤§è‡´å¦‚ä¸‹: å¤§è‡´ç”»ä¸€ä¸‹å‰åç«¯ç»“æ„\nclient.py \u0026ndash;\u0026gt; nginx-upload-module(temp) \u0026ndash;\u0026gt;python module\nnginx-upload-page \u0026ndash;\u0026gt; nginx-upload-module(temp) \u0026mdash;\u0026gt; python module è¯¦æƒ…æ¯”è¾ƒç®€å•,ä¸ç»†è¿°.\næºä»£ç gitåœ°å€: https://github.com/calmkart/nginx_upload https://github.com/calmkart/nginx_upload_page\n","date":"2018-04-24T00:00:00Z","permalink":"/posts/2018/04/2018-04-24-%E5%88%A9%E7%94%A8nginx_upload_module%E6%90%AD%E5%BB%BAhttp%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/","title":"åˆ©ç”¨nginx_upload_moduleæ­å»ºhttpæ–‡ä»¶æœåŠ¡å™¨"},{"content":"åœ¨ä½¿ç”¨supervisor/gosuvç­‰è¿›ç¨‹æ§åˆ¶ç¨‹åºæ§åˆ¶django/flaskè¿›ç¨‹æ—¶ï¼Œå¸¸å¸¸ä¼šå‡ºç°ä¸€ä¸ª\u0026quot;BUG\u0026quot;\u0026mdash;\u0026mdash;è¾“å…¥supervisor restart {app}/gosuv stop/start {app}åï¼Œç»å¸¸ä¼šå‡ºç°django/flaské‡å¯å¤±è´¥ï¼Œå› ä¸ºç«¯å£å·²å ç”¨çš„é”™è¯¯ã€‚\nè¿™é‡Œæˆ‘ä»¬å¸¸å¸¸æƒ³åˆ°ï¼Œå…ˆæŠŠç«¯å£å…³æ‰ä¸å°±å¯ä»¥äº†ï¼Ÿç»å¸¸åœ¨ä»£ç ä¸­åŠ å…¥å¦‚ä¸‹å‘½ä»¤ï¼š(å¦‚æœç¨‹åºæ˜¯djangoæˆ–è€…flaskï¼Œå ç”¨çš„ç«¯å£æ˜¯82ç«¯å£)\nimport subprocess import os pid = os.popen(\u0026#34;lsof -i:82|grep python|awk \u0026#39;{print $2}\u0026#39;\u0026#34;).read() if len(pid): subprocess.check_output(\u0026#34;kill -9 \u0026#34;+str(int(pid)), shell=True) #æ³¨æ„ï¼Œè¿™é‡Œä¸€å®šè¦ç”¨subprocessåº“æ¥killè¿›ç¨‹ã€‚ç”¨os.systemè¿è¡Œkill -9æˆ–os.kill()éƒ½ä¼šå¯¼è‡´æ–°è¿›ç¨‹äº§ç”Ÿ è¿™æ ·è™½ç„¶å¯è¡Œï¼Œä½†æ˜¯æ¯”è¾ƒéº»çƒ¦ã€‚å…¶å®å ç”¨ç«¯å£çš„åŸå› æ˜¯flask/djangoæœåŠ¡å™¨è‡ªåŠ¨reloadé€ æˆçš„ï¼Œåªéœ€è¦åœ¨supervisor/gosuvçš„å¯åŠ¨æŒ‡ä»¤é‡Œï¼ŒåŠ ä¸Š\u0026ndash;noreloadå‚æ•°å°±ä¸ä¼šäº§ç”Ÿè¿™ä¸ª\u0026quot;BUG\u0026quot;äº†ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š\n#åŸæ¥å¯åŠ¨æŒ‡ä»¤ python manage.py runserver 0.0.0.0:82 #æ›´æ–°å¯åŠ¨æŒ‡ä»¤ python manage.py runserver 0.0.0.0:82 --noreload æå®š\n","date":"2018-02-11T00:00:00Z","permalink":"/posts/2018/02/2018-02-11-%E5%85%B3%E4%BA%8Esupervisor-gosuv%E7%AD%89%E6%8E%A7%E5%88%B6django-flask%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B0%8F%E8%B4%B4%E5%A3%AB/","title":"å…³äºsupervisor/gosuvç­‰æ§åˆ¶django/flaskè¿›ç¨‹çš„å°è´´å£«"},{"content":"sentryæ˜¯ä¸€æ¬¾ä¸“ç”¨äºæ•æ‰é¡¹ç›®é”™è¯¯ä¿¡æ¯çš„åˆ†å¸ƒå¼å¼€æºè½¯ä»¶ï¼Œå¯ä»¥è½»æ¾çš„æ•æ‰åˆ°ä¸åŒé¡¹ç›®çš„é”™è¯¯ä¿¡æ¯å¹¶æ±‡æ€»ï¼Œæ–¹ä¾¿å®æ—¶æŸ¥çœ‹ä¸Šä¸‹æ–‡æ’é”™ä»¥åŠæŠ¥è­¦ç­‰ã€‚ æœ€ç»ˆæ•ˆæœå›¾å¦‚ä¸‹ï¼š é¦–å…ˆï¼Œsentryå’ŒELKçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œè™½ç„¶éƒ½åŸºäºLOGçš„è¿½è¸ªï¼Œä½†sentryä¸»è¦å…³æ³¨é”™è¯¯çš„æ•è·å’Œä¸Šä¸‹æ–‡é‡å‡ºç°æŠ¥è­¦ï¼Œè€ŒELKä¸»è¦å…³æ³¨æ—¥å¿—çš„å¤„ç†ã€‚\n1.sentryçš„éƒ¨ç½² å®˜æ–¹æ–‡æ¡£ https://docs.sentry.io/ å¤§è‡´æ¥è¯´ï¼Œä¸»è¦åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\n#å®‰è£…postgresql apt-get install postgresql apt-get install postgresql-contrib #å®‰è£…celeryï¼Œredis pip install celery apt-get install redis-server #å®‰è£…éœ€è¦çš„åŒ… apt-get install python-setuptools python-dev libxslt1-dev gcc libffi-dev libjpeg-dev libxml2-dev libxslt-dev libyaml-dev libpq-dev #å®‰è£…sentryï¼Œæ¨èä½¿ç”¨venvç¯å¢ƒ pip install sentry #ç”Ÿæˆé…ç½®æ–‡ä»¶,ä¹Ÿå¯åˆ¶å®šé…ç½®æ–‡ä»¶è·¯å¾„ #sentryÂ initÂ /etc/sentry sentry init #é…ç½®æ•°æ®åº“ sudo -u postgres psql create user admin with password \u0026#39;admin\u0026#39;; create database sentry owner admin; grant all privileges on database sentry to admin; #æå‡è¯¥ç”¨æˆ·superuseræƒé™ alterÂ role admin superuser; #ä¿®æ”¹sentryçš„ç›¸å…³é…ç½®ï¼Œé…ç½®æ•°æ®åº“ç›¸å…³è®¾ç½®ï¼Œä¸ä¸Šæ•°æ®åº“è®¾ç½®ç›¸ç¬¦åˆ vi /root/.sentry/sentry.conf.py #åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¯ä»¥åˆ¶å®šé…ç½®æ–‡ä»¶è·¯å¾„ä¹Ÿå¯é»˜è®¤ #SENTRY_CONF=/etc/sentryÂ sentryÂ upgrade sentry upgrade #æ·»åŠ celeryç”¨rootç”¨æˆ·è·‘çš„ç¯å¢ƒå˜é‡ export C_FORCE_ROOT=\u0026#34;true\u0026#34; #æœ€ååˆ›å»ºç”¨æˆ· sentry createuser åœ¨upgradeè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œæ ¹æ®å…·ä½“é”™è¯¯ç±»å‹åˆ¤æ–­å¦‚ä½•æ’é”™ï¼Œç„¶ååˆ æ‰æ•°æ®åº“åé‡å»ºæ•°æ®åº“ï¼Œå†upgradeå³å¯ï¼Œä¸€èˆ¬éƒ½æ˜¯æ•°æ®åº“æƒé™é—®é¢˜ã€‚\n2.sentryçš„ä½¿ç”¨ ä¸»è¦è¦è·‘3ä¸ªä»»åŠ¡ï¼Œå¦‚ä¸‹\n#SENTRY_CONF=/etc/sentry sentry run web sentry run web #SENTRY_CONF=/etc/sentry sentry run worker sentry run worker #SENTRY_CONF=/etc/sentry sentry run cron sentry run cron æˆ‘åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ˜¯ç”¨gosuvæ¥è·‘çš„ï¼Œæ•ˆæœå¦‚å›¾ï¼š å…¶ä¸­è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä»»åŠ¡ç›´æ¥ç”¨\nsentry run web è¿™æ ·æ¥è·‘çš„è¯ï¼Œä¼šæ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦é…ç½®æˆå¦‚ä¸‹ç»“æ„ï¼š åŒæ—¶ï¼Œè¿˜è·‘äº†ä¸€ä¸ªç”¨äºæµ‹è¯•ç›‘æ§æ•è·é”™è¯¯çš„flaskç¨‹åºï¼Œå…¶ä¸­ç”¨åˆ°äº†venvï¼Œæ‰€ä»¥gosuvä¹Ÿå¥½ï¼Œsupervisorä¹Ÿå¥½ï¼Œéƒ½éœ€è¦åšæˆå¦‚ä¸‹è®¾ç½®\n#æ‰¾åˆ°venvçš„è™šæ‹Ÿç¯å¢ƒï¼Œç”¨è™šæ‹Ÿç¯å¢ƒçš„binè¿è¡Œé¡¹ç›® ./venv/bin/python runserver.py 3.sentry webçš„åº”ç”¨å’Œé…ç½® é»˜è®¤èµ·çš„sentry webå ç”¨çš„æ˜¯9000ç«¯å£ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ä¿®æ”¹ç«¯å£å·ã€‚ ç™»é™†ip:9000ï¼Œè¾“å…¥åˆšæ‰è®¾ç½®çš„é‚®ç®±è´¦å·å¯†ç è¿›å…¥sentryï¼Œå¡«ä¸€ä¸‹ç›¸å…³è®¾ç½® ç‚¹å‡»å³ä¸Šè§’new project,é€‰æ‹©ä½ éœ€è¦ç›‘æ§é”™è¯¯çš„å¯¹è±¡ï¼Œè¿™é‡Œé€‰æ‹©flaskï¼Œç„¶åä¼šå‡ºç° ä¸»è¦å…³æ³¨è¿™ä¸ªDSN keyï¼Œåœ¨å·²æœ‰çš„é¡¹ç›®å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ ç„¶åé¦–å…ˆåœ¨å®¢æˆ·ç«¯å®‰è£…maven[flask]\npip install raven[flask] æœ€ååœ¨flaskç¨‹åºé‡Œæ·»åŠ å¦‚ä¸‹\n#__init__.pyé‡Œè®¾ç½®appï¼Œæ•…æ·»åŠ å¦‚ä¸‹ from raven.contrib.flask import Sentry sentry = Sentry(app, dsn=\u0026#39;http://f1010071f12c47768dc6b5a4700d9c2e:5643252bcc70471eb5232a632f3ea133@10.32.80.118:9000//2\u0026#39; ) #views.pyé‡Œæ·»åŠ å¦‚ä¸‹ fromÂ flask_securityÂ importÂ login_required,Â current_user fromÂ helloÂ importÂ app fromÂ helloÂ importÂ sentry @app.route(\u0026#39;/error\u0026#39;) defÂ error(): try: 1/0 exceptÂ ZeroDivisionError: sentry.captureException() returnÂ \u0026#39;error\u0026#39; @app.route(\u0026#39;/raise\u0026#39;) defÂ auto_raise(): raiseÂ IndexError @app.route(\u0026#39;/log\u0026#39;) defÂ log(): sentry.captureMessage(\u0026#39;hello,Â world!\u0026#39;) returnÂ \u0026#39;logging\u0026#39; ç±»ä¼¼å¦‚å›¾ç»“æ„ï¼š ç„¶åå°±å¯ä»¥åœ¨sentryä¸­å³æ—¶æ•æ‰åˆ°å¯¹åº”çš„é”™è¯¯å’Œloggingäº†\n","date":"2018-01-25T00:00:00Z","permalink":"/posts/2018/01/2018-01-25-%E9%83%A8%E7%BD%B2sentry%E6%8D%95%E8%8E%B7%E9%A1%B9%E7%9B%AE%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF/","title":"éƒ¨ç½²sentryæ•è·é¡¹ç›®é”™è¯¯ä¿¡æ¯"},{"content":"linuxè¿›ç¨‹ç®¡ç†å™¨supervisoræ˜¯ä¼šç»å¸¸è¢«ç”¨åˆ°çš„ï¼Œä½†æœåŠ¡å™¨å¤šäº†ä¹‹åï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„è¿›ç¨‹ä¹Ÿä¸æ–¹ä¾¿ç®¡ç†ã€‚åŒæ—¶ï¼Œsupervisorè‡ªå¸¦çš„webç•Œé¢æ¯”è¾ƒç®€é™‹ï¼Œæ‰€ä»¥å°è¯•äº†ä¸€ä¸‹å®˜ç½‘æ¨èçš„ä¸€äº›ç¬¬ä¸‰æ–¹å¼€æºè½¯ä»¶ï¼Œæ¨èä¸€ä¸‹è¿™ä¸ªcesiã€‚ æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š [ ](http://www.calmkart.com/wp-content/uploads/2018/01/2.jpg)\n1.é¦–å…ˆæ˜¯å…³äºsupervisor é€šè¿‡aptæˆ–pipå®‰è£…éƒ½å¯ä»¥\napt-get install supervisor #pip install supervisor echo_supervisord_conf \u0026gt; /etc/supervisor/supervisord.conf å…³äºsupervisoré…ç½®æ–‡ä»¶\n[unix_http_server] #è¿™é‡Œé…ç½®æ˜¯å¦ç”¨unix socketé€šä¿¡æ¥è®©supervisorä¸supervisorctlåšé€šä¿¡ [inet_http_server] #è¿™é‡Œæ˜¯ç”¨çš„httpçš„æ–¹å¼åšé€šä¿¡ [supervisorctl] #è¿™é‡Œé€‰æ‹©supervisorctlåˆ°åº•ç”¨ä»¥ä¸Šä¸¤ç§ä¸­çš„å“ªç§æ–¹å¼æ¥ä¸supervisoré€šä¿¡ï¼Œé€‰æ‹©ä¸€ç§å³å¯ï¼Œè®°å¾—å¡«å†™å¯†ç  [program:pro_name] stdout_logfile = {path} redirect_stderr = true ;è®©stderrä¹Ÿå†™å…¥stdoutä¸­ å¸¸ç”¨æ“ä½œ\nsupervisorctl reload #é‡å¯åŠ è½½supervisoré…ç½®æ–‡ä»¶ supervisorctl update #åªå¢åŠ æ–°å¢çš„é…ç½®æ–‡ä»¶ 2.å…³äºcesi\né¡¹ç›®åœ°å€ï¼šhttps://github.com/Gamegos/cesi å®‰è£…cesi\napt-get install sqlite3 python python-flask git clone https://github.com/Gamegos/cesi cd cesi sqlite3 ./userinfo.db \u0026lt; userinfo.sql cp cesi.conf /etc/cesi.conf é…ç½®cesi.conf,æˆ‘çš„é…ç½®å¦‚ä¸‹ï¼Œä¸€çœ‹å°±æ‡‚äº†\n[node:118] username = *** password = *** host = 127.0.0.1 port = 9001 [node:calmkart] username = *** password = *** host = 45.76.71.69 port = 9001 [node:121] username = *** password = *** host = *.*.*.121 port = 9001 [environment:my_env] members = 118,calmkart,121 [cesi] database = /root/cesi/userinfo.db activity_log = /var/log/cesi.log host = 0.0.0.0 ç”¨supervisorè¿è¡Œcesi,é…ç½®æ–‡ä»¶å¦‚ä¸‹\n[program:cesi] directory = /root/cesi/cesi/ command = python web.py autostart = true startsecs = 5 autorestart = true startretries = 3 user = root redirect_stderr = true stdout_logfile = /var/log/cesi1.log å¼€å¯ä»»åŠ¡\nsupervisorctl start cesi é»˜è®¤è´¦å·å¯†ç ï¼šadmin,admin ç«¯å£éœ€è¦æ”¹çš„è‡ªå·±å»web.pyé‡Œé¢æ”¹ you get it\næœ¬æµ‹è¯•æœåœ°å€ï¼š http://cesi.calmkart.com æ­¤å¤–ï¼Œå…¶ä»–å¸¸ç”¨çš„supervisorç›¸å…³ç¬¬ä¸‰æ–¹å·¥å…·è¿˜æœ‰ suponoff gosuv\nå†å²è¯„è®º (3 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nqhh0205 (2018-07-18 23:00) ä½ å¥½ï¼Œcesi æ”¯æŒç®¡ç†å¤šä¸ªæœåŠ¡å™¨çš„è¿›ç¨‹å—ï¼Ÿæˆ‘çœ‹ä½ æˆªå›¾è²Œä¼¼æ”¯æŒç®¡ç†å¤šä¸ªæœåŠ¡å™¨çš„ã€‚æˆ‘ç”¨é»˜è®¤çš„supervisor web UIï¼Œä¸æ”¯æŒç®¡ç†å¤šä¸ªæœåŠ¡å™¨çš„supervisorã€‚ qhh0205 (2018-07-18 23:26) sorryï¼Œåˆšæ²¡ä»”ç»†çœ‹ï¼Œæ˜¯æ”¯æŒçš„ potoo (2019-05-19 16:49) ä½ å¥½ï¼Œæˆ‘çœ‹ä½ æä¾›çš„[æµ‹è¯•åœ°å€](http://cesi.calmkart.com)çš„ web æ•ˆæœä¸ä¸€æ ·ï¼Œæ˜¯ä½ è‡ªå·±ä¿®æ”¹äº†å—? ä½ å¯ä»¥è¯´ä¸‹ä¿®æ”¹çš„æ–¹æ³•å—ï¼Ÿ æˆ‘ä¹Ÿåœ¨ç”¨ cesiï¼Œä½†æ˜¯ cesi ç§»åŠ¨ç«¯é¡µé¢æ˜¾ç¤ºæœ‰é—®é¢˜ï¼Œæƒ³è‡ªå·±ä¿®æ”¹ä¸‹é¡µé¢ï¼Œä½†æ˜¯ä¸çŸ¥é“åœ¨å“ªé‡Œä¿®æ”¹ã€‚ ","date":"2018-01-11T00:00:00Z","permalink":"/posts/2018/01/2018-01-11-supervisor%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86web%E5%B7%A5%E5%85%B7cesi/","title":"supervisoré›†ä¸­åŒ–ç®¡ç†webå·¥å…·cesi"},{"content":"éœ€è¦å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œå¯¹äºä»¥ä¸ªdjango appï¼Œéœ€è¦å¯¹å…¶ä¸­çš„ä¸€äº›restful apiåšIPè®¿é—®é™åˆ¶ï¼Œè¿™æ ·å®ç°èµ·æ¥æœ€æ–¹ä¾¿çš„æ˜¯åœ¨middlewareä¸­å†™é€»è¾‘ã€‚\nå…³äºdjangoä¸­é—´ä»¶çš„è¯´æ˜ï¼š http://usyiyi.cn/translate/Django_111/topics/http/middleware.html http://python.usyiyi.cn/translate/django_182/topics/http/middleware.html\nåœ¨django appå¾—middleware.pyä¸­æ·»åŠ å¦‚ä¸‹ä»£ç \nfrom django.http import HttpResponse class checkIPMiddleware(object): def process_request(self, request): root_func = request.path.split(\u0026#34;/\u0026#34;)[1] api_flag = True if root_func==\u0026#34;api\u0026#34; else False if api_flag: ip = request.META.get(\u0026#34;HTTP_X_REAL_IP\u0026#34;, request.META.get(\u0026#34;REMOTE_ADDR\u0026#34;)) if (ip==\u0026#34;10.10.10.10\u0026#34; or ip==\u0026#34;11.11.11.11\u0026#34;): return None else: return HttpReponse(\u0026#34;you are not allowed\u0026#34;) return None å…³äºrequestå¯¹è±¡å†…å®¹ï¼Œè¯¦æƒ…å¦‚ä¸‹(æœ¬ä»£ç é™åˆ¶çš„æ˜¯æ‰€æœ‰/api/åçš„è®¿é—®)ï¼š http://python.usyiyi.cn/translate/django_182/ref/request-response.html\nå…³äºè·å–ç”¨æˆ·IPï¼Œåœ¨æ²¡æœ‰åå‘ä»£ç†çš„æƒ…å†µä¸‹å¯ä»¥è·å–httpå¤´ä¸­çš„REMOTE_ADDRå­—æ®µï¼Œç”¨request.METAå¯¹è±¡æ¥è·å– å½“æœ‰Nginxç­‰åå‘ä»£ç†çš„æ—¶å€™ï¼Œå°±ä¼šè·å–åˆ°æœ¬æœºIPï¼Œæ‰€ä»¥éœ€è¦åœ¨nginxåå‘ä»£ç†æ—¶ï¼Œå°†ç”¨æˆ·åŸIPè®°å½•ä¸‹æ¥å†™å…¥HTTPå¤´ä¸­ æ—¢é…ç½®nginxé…ç½®å¦‚ä¸‹(/site-enable/default):\nlocation .... { proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_set_header X-NginX-Proxy true; } æœ€ååœ¨settings.pyä¸­å°†è¿™ä¸ªclassæ·»åŠ è¿›å»\nMIDDLEWARE_CLASSES = [ \u0026#39;appname.middleware.checkIPMiddleware\u0026#39; ] é‡å¯djangoä¹‹åï¼Œåˆ™/apiåçš„restful apiåªå…è®¸10.10.10.10å’Œ11.11.11.11è®¿é—®ï¼Œå…¶ä»–æ—¶å€™å°±ä¼šè¿”å›\u0026quot;you are not allowed\u0026quot;\n","date":"2017-12-27T00:00:00Z","permalink":"/posts/2017/12/2017-12-27-django%E4%BD%BF%E7%94%A8middleware%E5%AE%9E%E7%8E%B0views%E7%9A%84%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6/","title":"djangoä½¿ç”¨middlewareå®ç°viewsçš„è®¿é—®é™åˆ¶"},{"content":"zabbix restful apiè¯´æ˜è§å®˜ç½‘æ–‡æ¡£ https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/apiinfo\nä½¿ç”¨äº†githubä¸Šå°è£…å¥½çš„python zabbix api,å…å»äº†è‡ªå·±é€ è½®å­çš„è¿‡ç¨‹ https://github.com/lukecyca/pyzabbix\nè¿™ä¸ªå°è£…çš„python zabbix apiå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ç”¨ç¼ºçœçš„ç±»__getattr__()æ–¹æ³•ï¼Œè°ƒç”¨zabbixçš„restful api\né¦–å…ˆç”¨pipå®‰è£…pyzabbix\npip install pyzabbix å…·ä½“å®ç°è·å–trendå’Œhistoryä»£ç å¦‚ä¸‹:\n#---coding:utf-8--- from pyzabbix import ZabbixAPI import time class get_net(object): url = \u0026#34;\u0026#34; username = None password = None def __init__(self, server, user, passwd): self.url = \u0026#34;http://\u0026#34;+server+\u0026#34;/zabbix\u0026#34; self.username = user self.password = passwd def get_trend(self, info_list): z = ZabbixAPI(self.url) z.login(self.username,self.password) for info in info_list: hosts = z.host.get(filter={\u0026#34;host\u0026#34;:info[\u0026#34;ip\u0026#34;]}) if hosts: host_id = hosts[0][\u0026#34;hostid\u0026#34;] print host_id items = z.item.get(hostids=host_id,filter={\u0026#34;key_\u0026#34;:\u0026#34;ifHCOutOctets[\u0026#34;+info[\u0026#34;interface\u0026#34;]+\u0026#34;]\u0026#34;})[0] if items: item_id = items[\u0026#34;itemid\u0026#34;] trend = z.trend.get(itemids=item_id) for td in trend: clock = self.get_clock(td[\u0026#39;clock\u0026#39;]) if (\u0026#34;20:00\u0026#34; in clock) or (\u0026#34;21:00\u0026#34; in clock) or (\u0026#34;22:00\u0026#34; in clock): print clock+\u0026#34; \u0026#34;+str(int(td[\u0026#34;value_avg\u0026#34;])*8/1048576) f = open(info[\u0026#34;name\u0026#34;],\u0026#34;a\u0026#34;) f.write(clock+\u0026#34; \u0026#34;+str(int(td[\u0026#34;value_avg\u0026#34;])*8/1048576)) f.write(\u0026#34;\\n\u0026#34;) f.close() def get_history(self, info_list): z = ZabbixAPI(self.url) z.login(self.username,self.password) for info in info_list: hosts = z.host.get(filter={\u0026#34;host\u0026#34;:info[\u0026#34;ip\u0026#34;]}) if hosts: host_id = hosts[0][\u0026#34;hostid\u0026#34;] print host_id items = z.item.get(hostids=host_id,filter={\u0026#34;key_\u0026#34;:\u0026#34;ifHCOutOctets[\u0026#34;+info[\u0026#34;interface\u0026#34;]+\u0026#34;]\u0026#34;})[0] if items: item_id = items[\u0026#34;itemid\u0026#34;] history = z.history.get(itemids=item_id,time_from=1512129600) r_t = [] print history for hs in history: clock = self.get_clock(hs[\u0026#39;clock\u0026#39;]) if (\u0026#34;20:\u0026#34; in clock) or (\u0026#34;21:\u0026#34; in clock) or (\u0026#34;22:\u0026#34; in clock): print clock+\u0026#34; \u0026#34;+str(int(hs[\u0026#34;value\u0026#34;])/1048576) r_t.append(clock+\u0026#34; \u0026#34;+str(int(hs[\u0026#34;value\u0026#34;])/1048576)) r_t_str = \u0026#34;\\n\u0026#34;.join(r_t) f = open(\u0026#34;test_history\u0026#34;,\u0026#34;a\u0026#34;) f.write(r_t_str) f.close() def get_clock(self, value): clock = time.localtime(int(value)) format = \u0026#39;%Y-%m-%d %H:%M\u0026#39; return time.strftime(format,clock) #test = get_net(\u0026#34;zabbixæœåŠ¡å™¨IP\u0026#34;, \u0026#34;user\u0026#34;, \u0026#34;pass\u0026#34;) #test.get_trend([{\u0026#34;ip\u0026#34;:\u0026#34;æœºå™¨IP\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;æŸæœºå™¨\u0026#34;,\u0026#34;interface\u0026#34;:\u0026#34;æŸæ¥å£å\u0026#34;}]) #test.get_trend(infoåˆ—è¡¨ï¼Œæ ¼å¼å¦‚ä¸Š) #test.get_history([{\u0026#34;ip\u0026#34;:\u0026#34;æœºå™¨IP\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;æŸæœºå™¨\u0026#34;,\u0026#34;interface\u0026#34;:\u0026#34;æŸæ¥å£å\u0026#34;}]) #test.get_history(infoåˆ—è¡¨ï¼Œæ ¼å¼å¦‚ä¸Š) æ³¨ï¼š å…¶ä¸­get_clock()å‡½æ•°ç”¨äºåšlinuxæ—¶é—´æˆ³è½¬æ¢ã€‚\n","date":"2017-12-27T00:00:00Z","permalink":"/posts/2017/12/2017-12-27-%E4%BD%BF%E7%94%A8zabbix-api%E6%8F%90%E5%8F%96%E8%B6%8B%E5%8A%BFtrend%E5%92%8C%E5%8E%86%E5%8F%B2history%E6%95%B0%E6%8D%AE/","title":"ä½¿ç”¨zabbix apiæå–è¶‹åŠ¿(trend)å’Œå†å²(history)æ•°æ®"},{"content":"åœ¨salt masterä¸­ä¸ºå„ä¸ªminionè¿è¡Œå„ç§å‘½ä»¤ï¼Œå½“è¾“å…¥å‘½ä»¤ä¸­æ˜¾å¼å¸¦æœ‰è´¦å·å¯†ç æ—¶ï¼Œå¯ä»¥åœ¨masterç«¯é€šè¿‡ salt.runners.jobs.last_run() salt.runners.jobs.list_job() salt.runners.jobs.list_jobs() salt.runners.jobs.list_jobs_filter() ç­‰ç§ç§æ–¹æ³•æŸ¥çœ‹åˆ°è´¦å·å¯†ç ï¼Œè¿™æ ·å°±ä¼šæœ‰å®‰å…¨é£é™©ã€‚ æ‰€ä»¥ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹saltæºç çš„æ–¹å¼å®ç°å¯¹æ˜¾ç¤ºå¯†ç çš„è®°å½•åŠ å¯†ã€‚æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾ï¼š ä¿®æ”¹æ–¹æ³•å¾ˆç®€å•ï¼Œé¦–å…ˆæ‰¾åˆ°ç³»ç»Ÿä¸­çš„saltæ–‡ä»¶å¤¹ï¼Œæœ¬æµ‹è¯•æœºåœ¨\n/usr/lib/python2.7/dist-packages/salt/ ä¿®æ”¹./runners/jobs.pyæ–‡ä»¶\n#æ·»åŠ å‡½æ•°,è¿™é‡Œä¸»è¦æ˜¯æ­£åˆ™åŒ¹é…ï¼Œå¯ä»¥åŒ¹é…æ›´å¤šçš„passé€‰é¡¹ï¼Œå®ç°æ›´å¤šçš„éšè—å¯†ç  import re def encry_pass(target): result = re.sub(r\u0026#34;(?\u0026lt;=--password )\\w+\u0026#34;, \u0026#34;*\u0026#34;, target) return result å¹¶åœ¨list_job()å‡½æ•°ï¼Œlist_jobs()å‡½æ•°ï¼Œlist_jobs_filter()å‡½æ•°ï¼Œprint_job()å‡½æ•°æœ«å°¾åˆ†åˆ«åŠ å…¥å¦‚ä¸‹ä»£ç \n#list_job() ret = eval(encry_pass(str(ret))) #å¢åŠ æ­¤è¡Œ return ret #list_jobs() mret = eval(encry_pass(str(mret))) #å¢åŠ æ­¤è¡Œ return mret #list_jobs_filter() ret = eval(encry_pass(str(ret))) #å¢åŠ æ­¤è¡Œ return ret #print_job() ret = eval(encry_pass(str(ret))) #å¢åŠ æ­¤è¡Œ return ret æå®š\nä¸€ç‚¹å°è¡¥å……ï¼š ä¸ºä»€ä¹ˆè¦ç”¨\nret = eval(encry_pass(str(ret))) å› ä¸ºretæ˜¯dictç±»å‹ï¼Œå¾—å…ˆæŠŠdictç±»å‹è½¬æ¢æˆstrç±»å‹å†å†™å…¥encry_pass()æ­£åˆ™åŒ¹é…å‡½æ•°çš„å‚æ•°é‡Œï¼Œç„¶åencry_pass()æ­£åˆ™åŒ¹é…å‡½æ•°è¿”å›ä¸€ä¸ªstrå¯¹è±¡ï¼Œè€Œretéœ€è¦çš„æ˜¯dictå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦å†ç”¨eval()è½¬å›æ¥,ä¹Ÿå°±æ˜¯ ret(dict)\u0026mdash;-\u0026gt;str(ret)\u0026mdash;\u0026ndash;\u0026gt;ret(str)\u0026mdash;\u0026ndash;\u0026gt;result(str)\u0026mdash;\u0026ndash;\u0026gt;eval(result)\u0026mdash;\u0026ndash;\u0026gt;result(dict)\u0026mdash;\u0026ndash;\u0026gt;ret(dict)\n","date":"2017-12-18T00:00:00Z","permalink":"/posts/2017/12/2017-12-18-%E4%BF%AE%E6%94%B9salt%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0jobs-list_jobs%E5%8A%A0%E5%AF%86%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/","title":"ä¿®æ”¹saltæºç å®ç°jobs.list_jobsåŠ å¯†è´¦å·å¯†ç "},{"content":"åŸå§‹çš„nginxæ–‡ä»¶æœåŠ¡å™¨autoindexåŠŸèƒ½éå¸¸å•ä¸€ï¼Œä¹Ÿä¸å¤Ÿç¾è§‚ï¼Œè¿æŒ‰æ—¶é—´æˆ–è€…æ–‡ä»¶å¤§å°æ’åºåŠŸèƒ½éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥é€šè¿‡nginxæ’ä»¶å’Œä¿®æ”¹æºç çš„æ–¹å¼ä¸ºå…¶å¢åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½ã€‚ æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š\nç”¨åˆ°çš„æ’ä»¶ä¸ºfile-md5å’Œngx-fancyindexï¼Œnginxç‰ˆæœ¬æ˜¯1.6.2\ngit clone https://github.com/cfsego/file-md5.git git clone https://github.com/aperezdc/ngx-fancyindex.git wget https://github.com/nginx/nginx/archive/release-1.6.2.tar.gz ä¿®æ”¹/ngx-fancyindex/template.hæ–‡ä»¶\n//æ’å…¥script \u0026#34;\u0026lt;script src=\\\u0026#34;https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js\\\u0026#34;\u0026gt;\u0026#34; \u0026#34;\u0026lt;/script\u0026gt;\u0026#34; \u0026#34;\u0026lt;script src=\\\u0026#34;/static/md5.js\\\u0026#34;\u0026gt;\u0026#34; \u0026#34;\u0026lt;/script\u0026gt;\u0026#34; //ä¿®æ”¹é¡µé¢è¡¨æ ¼å®½åº¦ \u0026#34;\u0026lt;tr\u0026gt;\u0026#34; \u0026#34;\u0026lt;th style=\\\u0026#34;width:30%\\\u0026#34;\u0026gt;\u0026lt;a href=\\\u0026#34;?C=N\u0026amp;O=A\\\u0026#34;\u0026gt;File Name\u0026lt;/a\u0026gt;\u0026amp;nbsp;\u0026lt;a href=\\\u0026#34;?C=N\u0026amp;O=D\\\u0026#34;\u0026gt;\u0026amp;nbsp;\u0026amp;darr;\u0026amp;nbsp;\u0026lt;/a\u0026gt;\u0026lt;/th\u0026gt;\u0026#34; \u0026#34;\u0026lt;th style=\\\u0026#34;width:35%\\\u0026#34;\u0026gt;\u0026lt;a href=\\\u0026#34;?C=S\u0026amp;O=A\\\u0026#34;\u0026gt;File Size\u0026lt;/a\u0026gt;\u0026amp;nbsp;\u0026lt;a href=\\\u0026#34;?C=S\u0026amp;O=D\\\u0026#34;\u0026gt;\u0026amp;nbsp;\u0026amp;darr;\u0026amp;nbsp;\u0026lt;/a\u0026gt;\u0026lt;/th\u0026gt;\u0026#34; \u0026#34;\u0026lt;th style=\\\u0026#34;width:25%\\\u0026#34;\u0026gt;\u0026lt;a href=\\\u0026#34;?C=M\u0026amp;O=A\\\u0026#34;\u0026gt;Date\u0026lt;/a\u0026gt;\u0026amp;nbsp;\u0026lt;a href=\\\u0026#34;?C=M\u0026amp;O=D\\\u0026#34;\u0026gt;\u0026amp;nbsp;\u0026amp;darr;\u0026amp;nbsp;\u0026lt;/a\u0026gt;\u0026lt;/th\u0026gt;\u0026#34; \u0026#34;\u0026lt;/tr\u0026gt;\u0026#34; æ¥ç€æ‰§è¡Œ\ncd ./nginx-release-1.6.2 ./auto/configure --prefix=/usr/local/nginx --with-pcre --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module --add-module=../file-md5-master --add-module=../ngx-fancyindex make ç„¶åä¿®æ”¹nginxé…ç½®æ–‡ä»¶\nvi /etc/nginx/site-enable/default ########################### æ›´å¤šfancyindexæ’ä»¶é…ç½®é€‰é¡¹å‚è€ƒ http://www.ttlsa.com/nginx/nginx-module-ngx-fancyindex/ https://www.nginx.com/resources/wiki/modules/fancy_index/#directives ########################### root /var/www; //æ”¹ä¸ºéœ€è¦è·¯å¾„ï¼Œæµ‹è¯•æœºä¸­æ˜¯/var/www/ location / { 36 # First attempt to serve request as file, then 37 # as directory, then fall back to displaying a 404. 38 fancyindex on; 39 fancyindex_exact_size off; 40 fancyindex_ignore \u0026#34;static\u0026#34;; 41 add_header Content-MD5 $file_md5; 42 } åœ¨éœ€è¦åˆ†äº«çš„è·¯å¾„åˆ›å»ºæ–‡ä»¶./static/md5.jsï¼Œæµ‹è¯•æœºä¸­æ˜¯/var/www/\nmkdir /var/www/static vi /var/www/static/md5.js $(document).ready(function(){ var current_index = 1; function get_md5(){ if(current_index==$(\u0026#34;tr\u0026#34;).length){ return; } var url = $(\u0026#34;tr\u0026#34;)[current_index].childNodes[0].childNodes[0].href; $.ajax({ url: url, type: \u0026#34;HEAD\u0026#34;, complete: function(jqXHR, textStatus) { var file_size = $(\u0026#34;tr\u0026#34;)[current_index].childNodes[1].childNodes[0].data; var md5 = jqXHR.getResponseHeader(\u0026#34;Content-MD5\u0026#34;); console.log(jqXHR.getAllResponseHeaders()); if(md5!=null \u0026amp;\u0026amp; file_size!=\u0026#34;-\u0026#34;){ $(\u0026#34;tr\u0026#34;)[current_index].childNodes[1].innerHTML += (\u0026#34;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp\u0026#34;+\u0026#34;[md5:\u0026#34;+md5+\u0026#34;]\u0026#34;); } current_index++; get_md5(); } }); } get_md5(); }); ç„¶ååœ¨nginx-release-1.6.2ç›®å½•ä¸‹\nkillall nginx cd ./objs ./nginx -c /etc/nginx/nginx.conf å³å¯\nå…³äºmd5.jsåŸç†çš„ä¸€äº›å°è¯´æ˜ï¼š file-md5æ¨¡å—æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå¿…é¡»é€šè¿‡æ‰‹åŠ¨ç¼–è¯‘å®‰è£…ã€‚ åŠŸèƒ½æ˜¯å°†æ–‡ä»¶md5å€¼æ’å…¥æ–‡ä»¶çš„httpå¤´çš„Content-MD5å­—æ®µä¸­ï¼Œæ•ˆæœå¦‚å›¾\nåœ¨ngx-fancyindexæºç ä¸­ï¼Œè°ƒç”¨md5.jsçš„jsè„šæœ¬ï¼Œä»å‰ç«¯é€šè¿‡jquery ajaxè¯»å–æ‰€æœ‰æ–‡ä»¶httpå¤´é‡çš„Content-MD5å­—æ®µï¼Œå†å†™å…¥é¡µé¢ä¸­ã€‚\nå› ä¸ºajaxæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡æ™®é€šçš„forå¾ªç¯æˆ–è€…èµ‹å€¼ç»™å…¨å±€å˜é‡çš„æ–¹å¼è¿è¡Œï¼Œæ‰€ä»¥è¦ç”¨é€’å½’+å›è°ƒå‡½æ•°çš„æ–¹å¼ï¼Œæ‰èƒ½è¾¾æˆæ­£ç¡®çš„æ•ˆæœã€‚\nè®¾ç½®é€’å½’ç»ˆæ­¢æ¡ä»¶current_index==$(\u0026ldquo;tr\u0026rdquo;).lengthï¼Œå¾ªç¯éå†æ‰€æœ‰çš„æ–‡ä»¶è¿æ¥ï¼Œæå–httpå¤´ä¸­çš„md5å€¼å†™å…¥é¡µé¢ä¸­å³å¯ã€‚\nä½†æ€§èƒ½è¿˜æ˜¯æœ‰äº›é—®é¢˜çš„ï¼Œæœ‰äº›å¤§æ–‡ä»¶çš„è®¡ç®—æ¯”è¾ƒæµªè´¹æ—¶é—´ã€‚è¿™é‡Œå·²ç»å°†ajaxçš„è¯·æ±‚typeæ¢æˆäº†HEADç±»å‹ï¼Œå› ä¸ºä¸å†è¯·æ±‚æ–‡ä»¶ä¸»ä½“ï¼Œæ‰€ä»¥è¯·æ±‚é€Ÿåº¦æ˜¯GETç±»å‹çš„10å€ä»¥ä¸Šã€‚\næ‰€æœ‰æ–‡ä»¶gitåœ°å€ï¼š https://github.com/calmkart/nginx_autoindex- ç¼–è¯‘å¥½çš„nginxå¯æ‰§è¡Œæ–‡ä»¶ï¼š https://github.com/calmkart/nginx_autoindex-/archive/0.1.tar.gz\n","date":"2017-12-18T00:00:00Z","permalink":"/posts/2017/12/2017-12-18-%E5%A2%9E%E5%BC%BAnginx%E7%9A%84autoindex%E5%8A%9F%E8%83%BD%E6%96%87%E4%BB%B6%E6%8E%92%E5%BA%8F%E6%96%87%E4%BB%B6md5%E5%80%BC/","title":"å¢å¼ºnginxçš„autoindexåŠŸèƒ½(æ–‡ä»¶æ’åºï¼Œæ–‡ä»¶MD5å€¼)"},{"content":"NFSæœåŠ¡ç”¨äºæ–‡ä»¶åˆ†äº«å’Œæ–‡ä»¶åŒæ­¥ï¼ŒåŠŸèƒ½å°±ä¸æè¿°äº†ï¼Œæ¶æ„æ˜¯C/Sçš„æ¨¡å¼\nä¸€.ç®€å•é…ç½®\n1.æœåŠ¡ç«¯\napt install nfs-kernel-server vi /etc/exports ########æ·»åŠ å¦‚ä¸‹####### /opt/nfs *(ro,sync,no_subtree_check) #NFSå…±äº«è·¯å¾„ IP(åªè¯»ï¼ŒåŒæ­¥ï¼Œä¸æ£€æŸ¥çˆ¶ç›®å½•) service nfs-kernel-server restart service rpcbind restart æµ‹è¯•ï¼šshowmount -e\n2.å®¢æˆ·ç«¯\napt-get install nfs-common mount è¿œç¨‹nfs_ip:/è·¯å¾„ /æœ¬åœ°è·¯å¾„ äºŒ.NFSæœåŠ¡ç«¯å£æ§åˆ¶\næœåŠ¡ç«¯é…ç½®ï¼š\n# /etc/default/nfs-common STATDOPTS=\u0026#34;--port 32765 --outgoing-port 32766\u0026#34; # /etc/default/nfs-kernel-server RPCMOUNTDOPTS=\u0026#34;-p 32767\u0026#34; # /etc/default/quota RPCRQUOTADOPTS=\u0026#34;-p 32769\u0026#34; # /etc/sysctl.conf fs.nfs.nfs_callback_tcpport = 32764 fs.nfs.nlm_tcpport = 32768 fs.nfs.nlm_udpport = 32768 sysctl --system service nfs-kernel-server restart service rpcbind restart åˆ™å¯ä»¥å°†æœåŠ¡ç«¯ç«¯å£é™åˆ¶ä¸º:\n2049,111,32764-32769 TCP/UDP\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nå­™æ˜Š (2017-12-05 16:49) æˆ‘æ—¥ï¼Œå½­æ€»å±Œç‚¸äº† ","date":"2017-12-05T00:00:00Z","permalink":"/posts/2017/12/2017-12-05-nfs%E6%90%AD%E5%BB%BA%E5%8F%8A%E7%AB%AF%E5%8F%A3%E5%AE%89%E5%85%A8%E6%8E%A7%E5%88%B6/","title":"NFSæ­å»ºåŠç«¯å£å®‰å…¨æ§åˆ¶"},{"content":"saltstackå¯ç”¨äºæ‰¹é‡ç®¡ç†é›†ç¾¤,ç”¨çš„æ˜¯c/sæ¶æ„ï¼Œmasterç®¡ç†å¤šä¸ªminion\næµ‹è¯•ç³»ç»Ÿï¼šdebian8.7\nä¸€.å®‰è£…master\n1.æ·»åŠ apt key\nwget -O - https://repo.saltstack.com/apt/debian/8/amd64/latest/SALTSTACK-GPG-KEY.pub | sudo apt-key add - 2.å°†saltstackæºæ·»åŠ è¿›aptæº\nvi /etc/apt/sources.list #æ·»åŠ saltstackæº deb http://repo.saltstack.com/apt/debian/8/amd64/latest jessie main 3.æ›´æ–°apt\napt-get update 4.å®‰è£…masterç«¯ç›¸å…³ç»„ä»¶\napt-get install salt-api apt-get install salt-cloud apt-get install salt-master apt-get install salt-minion apt-get install salt-ssh apt-get install salt-syndic 5.é…ç½®master\nvi /etc/salt/master ####################å¸¸è§é…ç½®å¦‚ä¸‹#################### #æŒ‡å®šmasterï¼Œå†’å·åæœ‰ä¸€ä¸ªç©ºæ ¼ user: root #è‡ªåŠ¨æ¥æ”¶minion auto_accept: True #-------ä»¥ä¸‹ä¸ºå¯é€‰-------------- #è‡ªåŠ¨æ¥æ”¶minion auto_accept: True #saltçš„è¿è¡Œçº¿ç¨‹ï¼Œå¼€çš„çº¿ç¨‹è¶Šå¤šä¸€èˆ¬å¤„ç†çš„é€Ÿåº¦è¶Šå¿«ï¼Œä½†ä¸€èˆ¬ä¸è¦è¶…è¿‡CPUçš„ä¸ªæ•° worker_threads: 10 # masterçš„ç®¡ç†ç«¯å£ publish_port : 4505 # masterè·Ÿminionçš„é€šè®¯ç«¯å£ï¼Œç”¨äºæ–‡ä»¶æœåŠ¡ï¼Œè®¤è¯ï¼Œæ¥å—è¿”å›ç»“æœç­‰ ret_port : 4506 # å¦‚æœè¿™ä¸ªmasterè¿è¡Œçš„salt-syndicè¿æ¥åˆ°äº†ä¸€ä¸ªæ›´é«˜å±‚çº§çš„master,é‚£ä¹ˆè¿™ä¸ªå‚æ•°éœ€è¦é…ç½®æˆè¿æ¥åˆ°çš„è¿™ä¸ªé«˜å±‚çº§masterçš„ç›‘å¬ç«¯å£ syndic_master_port : 4506 # æŒ‡å®špidæ–‡ä»¶ä½ç½® pidfile: /var/run/salt-master.pid # saltstack å¯ä»¥æ§åˆ¶çš„æ–‡ä»¶ç³»ç»Ÿçš„å¼€å§‹ä½ç½® root_dir: / # æ—¥å¿—æ–‡ä»¶åœ°å€ log_file: /var/log/salt_master.log # åˆ†ç»„è®¾ç½® nodegroups: group_all: \u0026#39;*\u0026#39; # salt stateæ‰§è¡Œæ—¶å€™çš„æ ¹ç›®å½• file_roots: base: - /srv/salt/ # è®¾ç½®pillar çš„æ ¹ç›®å½• pillar_roots: base: - /srv/pillar 6.å¯åŠ¨master\nsystemctl start salt-master äºŒ.å®‰è£…minion\n1.å®‰è£…salt-minion\napt-get install salt-minion 2.é…ç½®minionç›¸å…³ä¿¡æ¯\nvi /etc/salt/minion ###################ä»¥ä¸‹ä¸ºå¸¸è§è®¾ç½®########################### #æŒ‡å®šmasterï¼Œå†’å·åæœ‰ä¸€ä¸ªç©ºæ ¼ master: 10.32.80.121 #-------ä»¥ä¸‹ä¸ºå¯é€‰-------------- # minionçš„è¯†åˆ«IDï¼Œå¯ä»¥æ˜¯IPï¼ŒåŸŸåï¼Œæˆ–æ˜¯å¯ä»¥é€šè¿‡DNSè§£æçš„å­—ç¬¦ä¸² id: xx # saltè¿è¡Œçš„ç”¨æˆ·æƒé™ user: root # masterçš„è¯†åˆ«IDï¼Œå¯ä»¥æ˜¯IPï¼ŒåŸŸåï¼Œæˆ–æ˜¯å¯ä»¥é€šè¿‡DNSè§£æçš„å­—ç¬¦ä¸² master : ip # masteré€šè®¯ç«¯å£ master_port: 4506 # å¤‡ä»½æ¨¡å¼ï¼Œminionæ˜¯æœ¬åœ°å¤‡ä»½ï¼Œå½“è¿›è¡Œæ–‡ä»¶ç®¡ç†æ—¶çš„æ–‡ä»¶å¤‡ä»½æ¨¡å¼ backup_mode: minion # æ‰§è¡Œsalt-callæ—¶å€™çš„è¾“å‡ºæ–¹å¼ output: nested # minionç­‰å¾…masteræ¥å—è®¤è¯çš„æ—¶é—´ acceptance_wait_time: 10 # å¤±è´¥é‡è¿æ¬¡æ•°ï¼Œ0è¡¨ç¤ºæ— é™æ¬¡ï¼Œéé›¶ä¼šä¸æ–­å°è¯•åˆ°è®¾ç½®å€¼ååœæ­¢å°è¯• acceptance_wait_time_max: 0 # é‡æ–°è®¤è¯å»¶è¿Ÿæ—¶é—´ï¼Œå¯ä»¥é¿å…å› ä¸ºmasterçš„keyæ”¹å˜å¯¼è‡´minionéœ€è¦é‡æ–°è®¤è¯çš„syné£æš´ random_reauth_delay: 60 # æ—¥å¿—æ–‡ä»¶ä½ç½® log_file: /var/logs/salt_minion.log # æ–‡ä»¶è·¯å¾„åŸºæœ¬ä½ç½® file_roots: base: - /etc/salt/minion/file # pillaråŸºæœ¬ä½ç½® pillar_roots: base: - /data/salt/minion/pillar 3.å¯åŠ¨minion\nsystemctl start salt-minion ä¸‰.é€šè¿‡masterç®¡ç†minion\n1.é…ç½®key\n#æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„key salt-key #æ³¨å†Œæ‰€æœ‰key salt-key -A #æ³¨å†ŒæŸä¸ªkey salt-key -a minion_id #åˆ é™¤å…¨éƒ¨key salt-key -D #åˆ é™¤æŸä¸ªkey salt-key -d minion_id 2.æµ‹è¯•æ˜¯å¦è¿é€š\n#æµ‹è¯•æ‰€æœ‰minionçš„è¿é€šæ€§ salt \u0026#39;*\u0026#39; test.ping #æµ‹è¯•æŸä¸ªminionçš„è¿é€šæ€§ salt \u0026#39;minion_id\u0026#39; test.ping 3.å¸¸ç”¨å‘½ä»¤\n#salt cmd.runç”¨äºè®©minionæ‰¹é‡æ‰§è¡Œå‘½ä»¤ salt \u0026#39;*\u0026#39; cmd.run \u0026#39;ifconfig\u0026#39; salt \u0026#39;minion_id\u0026#39; cmd.run \u0026#39;ifconfig\u0026#39; #salt-run manageæŸ¥çœ‹minioniä¿¡æ¯ salt-run manage.status #æŸ¥çœ‹æ‰€æœ‰minionçŠ¶æ€ salt-run manage.down ##æŸ¥çœ‹downæ‰çš„minion salt-run manage.up ##æŸ¥çœ‹upçš„minion #salt-keyç®¡ç†å¯†é’¥ salt-key [options] salt-key -L ##æŸ¥çœ‹æ‰€æœ‰minion-key salt-key -a \u0026lt;key-name\u0026gt; ##æ¥å—æŸä¸ªminion-key salt-key -d \u0026lt;key-name\u0026gt; ##åˆ é™¤æŸä¸ªminion-key salt-key -A ##æ¥å—æ‰€æœ‰çš„minion-key salt-key -D ##åˆ é™¤æ‰€æœ‰çš„minion-key #salt-callåœ¨minionä¸Šæ‰§è¡ŒæŸå‘½ä»¤ salt-call [options] \u0026lt;function\u0026gt; [arguments] salt-call test.ping ##è‡ªå·±æ‰§è¡Œtest.pingå‘½ä»¤ salt-call cmd.run \u0026#39;ifconfig\u0026#39; ##è‡ªå·±æ‰§è¡Œcmd.runå‡½æ•° #salt-cpåˆ†å‘æ–‡ä»¶ç»™minion(ä¸æ”¯æŒç›®å½•åˆ†å‘) salt-cp \u0026#39;*\u0026#39; testfile.html /tmp #æŠŠtestfile.htmlå‘é€åˆ°æ‰€æœ‰minionçš„/tmpæ–‡ä»¶å¤¹ salt-cp \u0026#39;test*\u0026#39; index.html /tmp/a.html #æŠŠindex.htmlå‘é€åˆ°æ‰€æœ‰test*çš„minionå¹¶é‡å‘½åä¸º/tmp/a.html #ç›®æ ‡minionåˆ†ç»„ ä¿®æ”¹/etc/salt/master nodegroups: testgroup1: \u0026#39;L@test82.salt.cn,test83.salt.cn\u0026#39; testgroup2: \u0026#39;192.168.2.84\u0026#39; #-Nä¸ºåˆ†ç»„å‘½ä»¤ç¬¦ salt -N testgroup1 test.ping #åˆ†ç»„åˆ†ä¸ºå¤šç§ç±»å‹ï¼š G -- é’ˆå¯¹ Grains åšå•ä¸ªåŒ¹é…ï¼Œä¾‹å¦‚ï¼šG@os:Ubuntu E -- é’ˆå¯¹ minion é’ˆå¯¹æ­£åˆ™è¡¨è¾¾å¼åšåŒ¹é…ï¼Œä¾‹å¦‚ï¼šE@web\\d+.(dev|qa|prod).loc P -- é’ˆå¯¹ Grains åšæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œä¾‹å¦‚ï¼šP@os:(RedHat|Fedora|CentOS) L -- é’ˆå¯¹ minion åšåˆ—è¡¨åŒ¹é…ï¼Œä¾‹å¦‚ï¼šL@minion1.example.com,minion3.domain.com or bl*.domain.com I -- é’ˆå¯¹ Pillar åšå•ä¸ªåŒ¹é…ï¼Œä¾‹å¦‚ï¼šI@pdata:foobar S -- é’ˆå¯¹å­ç½‘æˆ–æ˜¯ IP åšåŒ¹é…ï¼Œä¾‹å¦‚ï¼šS@192.168.1.0/24 or S@192.168.1.100 R -- é’ˆå¯¹å®¢æˆ·ç«¯èŒƒå›´åšåŒ¹é…ï¼Œä¾‹å¦‚ï¼š R@%foo.bar ","date":"2017-11-29T00:00:00Z","permalink":"/posts/2017/11/2017-11-29-saltstack%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/","title":"saltstackçš„å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨"},{"content":"######Nginxé…ç½®æ–‡ä»¶nginx.confä¸­æ–‡è¯¦è§£##### #å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ user www www; #nginxè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä¸ºç­‰äºCPUæ€»æ ¸å¿ƒæ•°ã€‚ worker_processes 8; #å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[ debug | info | notice | warn | error | crit ] error_log /usr/local/nginx/logs/error.log info; #è¿›ç¨‹pidæ–‡ä»¶ pid /usr/local/nginx/logs/nginx.pid; #æŒ‡å®šè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æè¿°ç¬¦ï¼šæ•°ç›® #å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™ #è¿™ä¸ªæŒ‡ä»¤æ˜¯æŒ‡å½“ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ulimit -n çš„å€¼ä¿æŒä¸€è‡´ã€‚ #ç°åœ¨åœ¨linux 2.6å†…æ ¸ä¸‹å¼€å¯æ–‡ä»¶æ‰“å¼€æ•°ä¸º65535ï¼Œworker_rlimit_nofileå°±ç›¸åº”åº”è¯¥å¡«å†™65535ã€‚ #è¿™æ˜¯å› ä¸ºnginxè°ƒåº¦æ—¶åˆ†é…è¯·æ±‚åˆ°è¿›ç¨‹å¹¶ä¸æ˜¯é‚£ä¹ˆçš„å‡è¡¡ï¼Œæ‰€ä»¥å‡å¦‚å¡«å†™10240ï¼Œæ€»å¹¶å‘é‡è¾¾åˆ°3-4ä¸‡æ—¶å°±æœ‰è¿›ç¨‹å¯èƒ½è¶…è¿‡10240äº†ï¼Œè¿™æ—¶ä¼šè¿”å›502é”™è¯¯ã€‚ worker_rlimit_nofile 65535; events { #å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹ #æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œlinuxå»ºè®®epollï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚ #è¡¥å……è¯´æ˜ï¼š #ä¸apacheç›¸ç±»ï¼Œnginxé’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸åŒçš„äº‹ä»¶æ¨¡å‹ #Aï¼‰æ ‡å‡†äº‹ä»¶æ¨¡å‹ #Selectã€pollå±äºæ ‡å‡†äº‹ä»¶æ¨¡å‹ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿä¸å­˜åœ¨æ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œnginxä¼šé€‰æ‹©selectæˆ–poll #Bï¼‰é«˜æ•ˆäº‹ä»¶æ¨¡å‹ #Kqueueï¼šä½¿ç”¨äºFreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 å’Œ MacOS X.ä½¿ç”¨åŒå¤„ç†å™¨çš„MacOS Xç³»ç»Ÿä½¿ç”¨kqueueå¯èƒ½ä¼šé€ æˆå†…æ ¸å´©æºƒã€‚ #Epollï¼šä½¿ç”¨äºLinuxå†…æ ¸2.6ç‰ˆæœ¬åŠä»¥åçš„ç³»ç»Ÿã€‚ #/dev/pollï¼šä½¿ç”¨äºSolaris 7 11/99+ï¼ŒHP/UX 11.22+ (eventport)ï¼ŒIRIX 6.5.15+ å’Œ Tru64 UNIX 5.1A+ã€‚ #Eventportï¼šä½¿ç”¨äºSolaris 10ã€‚ ä¸ºäº†é˜²æ­¢å‡ºç°å†…æ ¸å´©æºƒçš„é—®é¢˜ï¼Œ æœ‰å¿…è¦å®‰è£…å®‰å…¨è¡¥ä¸ã€‚ use epoll; #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰ #æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨ï¼Œå°½é‡å¤§ï¼Œä½†æ˜¯åˆ«æŠŠcpuè·‘åˆ°100%å°±è¡Œã€‚æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤šè¿æ¥æ•°ï¼Œç†è®ºä¸Šæ¯å°nginxæœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ä¸ºã€‚ worker_connections 65535; #keepaliveè¶…æ—¶æ—¶é—´ã€‚ keepalive_timeout 60; #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚å¤´çš„å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚ #åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZE å–å¾—ã€‚ #[root@web001 ~]# getconf PAGESIZE #4096 #ä½†ä¹Ÿæœ‰client_header_buffer_sizeè¶…è¿‡4kçš„æƒ…å†µï¼Œä½†æ˜¯client_header_buffer_sizeè¯¥å€¼å¿…é¡»è®¾ç½®ä¸ºâ€œç³»ç»Ÿåˆ†é¡µå¤§å°â€çš„æ•´å€æ•°ã€‚ client_header_buffer_size 4k; #è¿™ä¸ªå°†ä¸ºæ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ï¼ŒmaxæŒ‡å®šç¼“å­˜æ•°é‡ï¼Œå»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactiveæ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚ open_file_cache max=65535 inactive=60s; #è¿™ä¸ªæ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯ã€‚ #è¯­æ³•:open_file_cache_valid time é»˜è®¤å€¼:open_file_cache_valid 60 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†ä½•æ—¶éœ€è¦æ£€æŸ¥open_file_cacheä¸­ç¼“å­˜é¡¹ç›®çš„æœ‰æ•ˆä¿¡æ¯. open_file_cache_valid 80s; #open_file_cacheæŒ‡ä»¤ä¸­çš„inactiveå‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸€ç›´æ˜¯åœ¨ç¼“å­˜ä¸­æ‰“å¼€çš„ï¼Œå¦‚ä¸Šä¾‹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶åœ¨inactiveæ—¶é—´å†…ä¸€æ¬¡æ²¡è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ç§»é™¤ã€‚ #è¯­æ³•:open_file_cache_min_uses number é»˜è®¤å€¼:open_file_cache_min_uses 1 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†åœ¨open_file_cacheæŒ‡ä»¤æ— æ•ˆçš„å‚æ•°ä¸­ä¸€å®šçš„æ—¶é—´èŒƒå›´å†…å¯ä»¥ä½¿ç”¨çš„æœ€å°æ–‡ä»¶æ•°,å¦‚æœä½¿ç”¨æ›´å¤§çš„å€¼,æ–‡ä»¶æè¿°ç¬¦åœ¨cacheä¸­æ€»æ˜¯æ‰“å¼€çŠ¶æ€. open_file_cache_min_uses 1; #è¯­æ³•:open_file_cache_errors on | off é»˜è®¤å€¼:open_file_cache_errors off ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šæ˜¯å¦åœ¨æœç´¢ä¸€ä¸ªæ–‡ä»¶æ˜¯è®°å½•cacheé”™è¯¯. open_file_cache_errors on; } #è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒ http { #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ include mime.types; #é»˜è®¤æ–‡ä»¶ç±»å‹ default_type application/octet-stream; #é»˜è®¤ç¼–ç  #charset utf-8; #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å° #ä¿å­˜æœåŠ¡å™¨åå­—çš„hashè¡¨æ˜¯ç”±æŒ‡ä»¤server_names_hash_max_size å’Œserver_names_hash_bucket_sizeæ‰€æ§åˆ¶çš„ã€‚å‚æ•°hash bucket sizeæ€»æ˜¯ç­‰äºhashè¡¨çš„å¤§å°ï¼Œå¹¶ä¸”æ˜¯ä¸€è·¯å¤„ç†å™¨ç¼“å­˜å¤§å°çš„å€æ•°ã€‚åœ¨å‡å°‘äº†åœ¨å†…å­˜ä¸­çš„å­˜å–æ¬¡æ•°åï¼Œä½¿åœ¨å¤„ç†å™¨ä¸­åŠ é€ŸæŸ¥æ‰¾hashè¡¨é”®å€¼æˆä¸ºå¯èƒ½ã€‚å¦‚æœhash bucket sizeç­‰äºä¸€è·¯å¤„ç†å™¨ç¼“å­˜çš„å¤§å°ï¼Œé‚£ä¹ˆåœ¨æŸ¥æ‰¾é”®çš„æ—¶å€™ï¼Œæœ€åçš„æƒ…å†µä¸‹åœ¨å†…å­˜ä¸­æŸ¥æ‰¾çš„æ¬¡æ•°ä¸º2ã€‚ç¬¬ä¸€æ¬¡æ˜¯ç¡®å®šå­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œç¬¬äºŒæ¬¡æ˜¯åœ¨å­˜å‚¨å•å…ƒä¸­æŸ¥æ‰¾é”® å€¼ã€‚å› æ­¤ï¼Œå¦‚æœNginxç»™å‡ºéœ€è¦å¢å¤§hash max size æˆ– hash bucket sizeçš„æç¤ºï¼Œé‚£ä¹ˆé¦–è¦çš„æ˜¯å¢å¤§å‰ä¸€ä¸ªå‚æ•°çš„å¤§å°. server_names_hash_bucket_size 128; #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚çš„å¤´éƒ¨å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZEå–å¾—ã€‚ client_header_buffer_size 32k; #å®¢æˆ·è¯·æ±‚å¤´ç¼“å†²å¤§å°ã€‚nginxé»˜è®¤ä¼šç”¨client_header_buffer_sizeè¿™ä¸ªbufferæ¥è¯»å–headerå€¼ï¼Œå¦‚æœheaderè¿‡å¤§ï¼Œå®ƒä¼šä½¿ç”¨large_client_header_buffersæ¥è¯»å–ã€‚ large_client_header_buffers 4 64k; #è®¾å®šé€šè¿‡nginxä¸Šä¼ æ–‡ä»¶çš„å¤§å° client_max_body_size 8m; #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼ŒsendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfileå‡½æ•°æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚æ³¨æ„ï¼šå¦‚æœå›¾ç‰‡æ˜¾ç¤ºä¸æ­£å¸¸æŠŠè¿™ä¸ªæ”¹æˆoffã€‚ #sendfileæŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿuptimeã€‚ sendfile on; #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚ autoindex on; #æ­¤é€‰é¡¹å…è®¸æˆ–ç¦æ­¢ä½¿ç”¨sockeçš„TCP_CORKçš„é€‰é¡¹ï¼Œæ­¤é€‰é¡¹ä»…åœ¨ä½¿ç”¨sendfileçš„æ—¶å€™ä½¿ç”¨ tcp_nopush on; tcp_nodelay on; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ keepalive_timeout 120; #FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚ fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k; #gzipæ¨¡å—è®¾ç½® gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡º gzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å° gzip_buffers 4 16k; #å‹ç¼©ç¼“å†²åŒº gzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰ gzip_comp_level 2; #å‹ç¼©ç­‰çº§ gzip_types text/plain application/x-javascript text/css application/xml; #å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«textmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚ gzip_vary on; #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨ #limit_zone crawler $binary_remote_addr 10m; #è´Ÿè½½å‡è¡¡é…ç½® upstream jh.w3cschool.cn { #upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚ server 192.168.80.121:80 weight=3; server 192.168.80.122:80 weight=2; server 192.168.80.123:80 weight=3; #nginxçš„upstreamç›®å‰æ”¯æŒ4ç§æ–¹å¼çš„åˆ†é… #1ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ #æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ #2ã€weight #æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ #ä¾‹å¦‚ï¼š #upstream bakend { # server 192.168.0.14 weight=10; # server 192.168.0.15 weight=10; #} #2ã€ip_hash #æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚ #ä¾‹å¦‚ï¼š #upstream bakend { # ip_hash; # server 192.168.0.14:88; # server 192.168.0.15:80; #} #3ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰ #æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ #upstream backend { # server server1; # server server2; # fair; #} #4ã€url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰ #æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ #ä¾‹ï¼šåœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³• #upstream backend { # server squid1:3128; # server squid2:3128; # hash $request_uri; # hash_method crc32; #} #tips: #upstream bakend{#å®šä¹‰è´Ÿè½½å‡è¡¡è®¾å¤‡çš„IpåŠè®¾å¤‡çŠ¶æ€}{ # ip_hash; # server 127.0.0.1:9090 down; # server 127.0.0.1:8080 weight=2; # server 127.0.0.1:6060; # server 127.0.0.1:7070 backup; #} #åœ¨éœ€è¦ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„serverä¸­å¢åŠ  proxy_pass http://bakend/; #æ¯ä¸ªè®¾å¤‡çš„çŠ¶æ€è®¾ç½®ä¸º: #1.downè¡¨ç¤ºå•å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½ #2.weightä¸ºweightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚ #3.max_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º1.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstreamæ¨¡å—å®šä¹‰çš„é”™è¯¯ #4.fail_timeout:max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚ #5.backupï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ã€‚æ‰€ä»¥è¿™å°æœºå™¨å‹åŠ›ä¼šæœ€è½»ã€‚ #nginxæ”¯æŒåŒæ—¶è®¾ç½®å¤šç»„çš„è´Ÿè½½å‡è¡¡ï¼Œç”¨æ¥ç»™ä¸ç”¨çš„serveræ¥ä½¿ç”¨ã€‚ #client_body_in_file_onlyè®¾ç½®ä¸ºOn å¯ä»¥è®²client postè¿‡æ¥çš„æ•°æ®è®°å½•åˆ°æ–‡ä»¶ä¸­ç”¨æ¥åšdebug #client_body_temp_pathè®¾ç½®è®°å½•æ–‡ä»¶çš„ç›®å½• å¯ä»¥è®¾ç½®æœ€å¤š3å±‚ç›®å½• #locationå¯¹URLè¿›è¡ŒåŒ¹é….å¯ä»¥è¿›è¡Œé‡å®šå‘æˆ–è€…è¿›è¡Œæ–°çš„ä»£ç† è´Ÿè½½å‡è¡¡ } #è™šæ‹Ÿä¸»æœºçš„é…ç½® server { #ç›‘å¬ç«¯å£ listen 80; #åŸŸåå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€ server_name www.w3cschool.cn w3cschool.cn; index index.html index.htm index.php; root /data/www/w3cschool; #å¯¹******è¿›è¡Œè´Ÿè½½å‡è¡¡ location ~ .*.(php|php5)?$ { fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; include fastcgi.conf; } #å›¾ç‰‡ç¼“å­˜æ—¶é—´è®¾ç½® location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$ { expires 10d; } #JSå’ŒCSSç¼“å­˜æ—¶é—´è®¾ç½® location ~ .*.(js|css)?$ { expires 1h; } #æ—¥å¿—æ ¼å¼è®¾å®š #$remote_addrä¸$http_x_forwarded_forç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼› #$remote_userï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼› #$time_localï¼š ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼› #$requestï¼š ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼› #$statusï¼š ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼Œ #$body_bytes_sent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼› #$http_refererï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼› #$http_user_agentï¼šè®°å½•å®¢æˆ·æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼› #é€šå¸¸webæœåŠ¡å™¨æ”¾åœ¨åå‘ä»£ç†çš„åé¢ï¼Œè¿™æ ·å°±ä¸èƒ½è·å–åˆ°å®¢æˆ·çš„IPåœ°å€äº†ï¼Œé€šè¿‡$remote_addæ‹¿åˆ°çš„IPåœ°å€æ˜¯åå‘ä»£ç†æœåŠ¡å™¨çš„iPåœ°å€ã€‚åå‘ä»£ç†æœåŠ¡å™¨åœ¨è½¬å‘è¯·æ±‚çš„httpå¤´ä¿¡æ¯ä¸­ï¼Œå¯ä»¥å¢åŠ x_forwarded_forä¿¡æ¯ï¼Œç”¨ä»¥è®°å½•åŸæœ‰å®¢æˆ·ç«¯çš„IPåœ°å€å’ŒåŸæ¥å®¢æˆ·ç«¯çš„è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€ã€‚ log_format access \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; $http_x_forwarded_for\u0026#39;; #å®šä¹‰æœ¬è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿— access_log /usr/local/nginx/logs/host.access.log main; access_log /usr/local/nginx/logs/host.access.404.log log404; #å¯¹ \u0026#34;/\u0026#34; å¯ç”¨åå‘ä»£ç† location / { proxy_pass http://127.0.0.1:88; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®ï¼Œå¯é€‰ã€‚ proxy_set_header Host $host; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•° client_max_body_size 10m; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ #å¦‚æœæŠŠå®ƒè®¾ç½®ä¸ºæ¯”è¾ƒå¤§çš„æ•°å€¼ï¼Œä¾‹å¦‚256kï¼Œé‚£ä¹ˆï¼Œæ— è®ºä½¿ç”¨firefoxè¿˜æ˜¯IEæµè§ˆå™¨ï¼Œæ¥æäº¤ä»»æ„å°äº256kçš„å›¾ç‰‡ï¼Œéƒ½å¾ˆæ­£å¸¸ã€‚å¦‚æœæ³¨é‡Šè¯¥æŒ‡ä»¤ï¼Œä½¿ç”¨é»˜è®¤çš„client_body_buffer_sizeè®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿé¡µé¢å¤§å°çš„ä¸¤å€ï¼Œ8kæˆ–è€…16kï¼Œé—®é¢˜å°±å‡ºç°äº†ã€‚ #æ— è®ºä½¿ç”¨firefox4.0è¿˜æ˜¯IE8.0ï¼Œæäº¤ä¸€ä¸ªæ¯”è¾ƒå¤§ï¼Œ200kå·¦å³çš„å›¾ç‰‡ï¼Œéƒ½è¿”å›500 Internal Server Erroré”™è¯¯ client_body_buffer_size 128k; #è¡¨ç¤ºä½¿nginxé˜»æ­¢HTTPåº”ç­”ä»£ç ä¸º400æˆ–è€…æ›´é«˜çš„åº”ç­”ã€‚ proxy_intercept_errors on; #åç«¯æœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é—´_å‘èµ·æ¡æ‰‹ç­‰å€™å“åº”è¶…æ—¶æ—¶é—´ #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶) proxy_connect_timeout 90; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶) #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´_å°±æ˜¯åœ¨è§„å®šæ—¶é—´ä¹‹å†…åç«¯æœåŠ¡å™¨å¿…é¡»ä¼ å®Œæ‰€æœ‰çš„æ•°æ® proxy_send_timeout 90; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶) #è¿æ¥æˆåŠŸå_ç­‰å€™åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´_å…¶å®å·²ç»è¿›å…¥åç«¯çš„æ’é˜Ÿä¹‹ä¸­ç­‰å€™å¤„ç†ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯åç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ—¶é—´ï¼‰ proxy_read_timeout 90; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° #è®¾ç½®ä»è¢«ä»£ç†æœåŠ¡å™¨è¯»å–çš„ç¬¬ä¸€éƒ¨åˆ†åº”ç­”çš„ç¼“å†²åŒºå¤§å°ï¼Œé€šå¸¸æƒ…å†µä¸‹è¿™éƒ¨åˆ†åº”ç­”ä¸­åŒ…å«ä¸€ä¸ªå°çš„åº”ç­”å¤´ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼çš„å¤§å°ä¸ºæŒ‡ä»¤proxy_buffersä¸­æŒ‡å®šçš„ä¸€ä¸ªç¼“å†²åŒºçš„å¤§å°ï¼Œä¸è¿‡å¯ä»¥å°†å…¶è®¾ç½®ä¸ºæ›´å° proxy_buffer_size 4k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è®¾ç½® #è®¾ç½®ç”¨äºè¯»å–åº”ç­”ï¼ˆæ¥è‡ªè¢«ä»£ç†æœåŠ¡å™¨ï¼‰çš„ç¼“å†²åŒºæ•°ç›®å’Œå¤§å°ï¼Œé»˜è®¤æƒ…å†µä¹Ÿä¸ºåˆ†é¡µå¤§å°ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒå¯èƒ½æ˜¯4kæˆ–è€…8k proxy_buffers 4 32k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰ proxy_busy_buffers_size 64k; #è®¾ç½®åœ¨å†™å…¥proxy_temp_pathæ—¶æ•°æ®çš„å¤§å°ï¼Œé¢„é˜²ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åœ¨ä¼ é€’æ–‡ä»¶æ—¶é˜»å¡å¤ªé•¿ #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼  proxy_temp_file_write_size 64k; } #è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€ location /NginxStatus { stub_status on; access_log on; auth_basic \u0026#34;NginxStatus\u0026#34;; auth_basic_user_file confpasswd; #htpasswdæ–‡ä»¶çš„å†…å®¹å¯ä»¥ç”¨apacheæä¾›çš„htpasswdå·¥å…·æ¥äº§ç”Ÿã€‚ } #æœ¬åœ°åŠ¨é™åˆ†ç¦»åå‘ä»£ç†é…ç½® #æ‰€æœ‰jspçš„é¡µé¢å‡äº¤ç”±tomcatæˆ–resinå¤„ç† location ~ .(jsp|jspx|do)?$ { proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8080; } #æ‰€æœ‰é™æ€æ–‡ä»¶ç”±nginxç›´æ¥è¯»å–ä¸ç»è¿‡tomcatæˆ–resin location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt| pdf|xls|mp3|wma)$ { expires 15d; } location ~ .*.(js|css)?$ { expires 1h; } } } ######Nginxé…ç½®æ–‡ä»¶nginx.confä¸­æ–‡è¯¦è§£##### ","date":"2017-11-21T00:00:00Z","permalink":"/posts/2017/11/2017-11-21-nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6nginx-conf%E4%B8%AD%E6%96%87%E8%AF%A6%E8%A7%A3/","title":"nginxé…ç½®æ–‡ä»¶nginx.confä¸­æ–‡è¯¦è§£"},{"content":"1.vimè¯­æ³•é«˜äº®æ’ä»¶molokai\ncd ~/.vim/ mkdir ./colors cd ./colos wget https://raw.githubusercontent.com/tomasr/molokai/master/colors/molokai.vim echo colorscheme molokai \u0026gt;\u0026gt; ~/.vimrc 2.nginxè¯­æ³•é«˜äº®æ’ä»¶nginx.vim\nmkdir -pv ~/.vim/syntax cd ~/.vim/syntax wget -O nginx.vim http://www.vim.org/scripts/download_script.php?src_id=19394 echo \u0026#34;au BufRead,BufNewFile /etc/nginx/*,/usr/local/nginx/conf/* if \u0026amp;ft == \u0026#39;\u0026#39; | setfiletype nginx | endif \u0026#34; \u0026gt;\u0026gt; ~/.vim/filetype.vim ","date":"2017-11-20T00:00:00Z","permalink":"/posts/2017/11/2017-11-20-vim-nginx%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%E6%8F%92%E4%BB%B6/","title":"vim/nginxè¯­æ³•é«˜äº®æ’ä»¶"},{"content":"æœ¬ç«™phpMyAdminæµ‹è¯•åœ°å€ï¼š\nwww.calmkart.com/phpMyAdmin\n1.åœ¨phpMyAdminå®˜æ–¹ç½‘ç«™ä¸‹è½½æœ€æ–°ç‰ˆæœ¬è½¯ä»¶\n2.unzipè§£å‹ï¼Œæ–‡ä»¶å¤¹æ”¹åä¸ºphpMyAdmin\n3.æŠŠconfig.sample.inc.phpå¤åˆ¶ä¸€ä»½ä¸ºconfig.inc.php\n4.ä¿®æ”¹ä»¥ä¸‹ä¸¤å¤„\n$cfg[â€˜Serversâ€™][$i][â€˜controluserâ€™] = â€˜æ‚¨çš„æ•°æ®åº“åç§°â€™; $cfg[â€˜Serversâ€™][$i][â€˜controlpassâ€™] = â€˜æ‚¨çš„æ•°æ®åº“å¯†ç â€™; æ³¨æ„ï¼š\nrootç”¨æˆ·è¦ç”¨sudoæ‰€ä»¥æ— æƒé™ç™»é™†ï¼Œè¿™æ—¶å€™æ¨èä¸“é—¨è®¾ç½®ä¸€ä¸ªphpmyadminç”¨æˆ·ç”¨äºç®¡ç†\nmysql -uroot -p CREATE USER \u0026#39;phpmyadmin\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;some_pass\u0026#39;; GRANT ALL PRIVILEGES ON *.* TO \u0026#39;phpmyadmin\u0026#39;@\u0026#39;localhost\u0026#39; WITH GRANT OPTION; FLUSH PRIVILEGES; 5.æŠŠphpMyAdminæ–‡ä»¶å¤¹å¤åˆ¶åˆ°nginxé…ç½®çš„serverä¸»ç›®å½•ï¼Œæˆ‘è¿™é‡Œæ˜¯/var/www/html/\n6.è®¿é—®http://åŸŸå/phpMyAdminå³å¯\n","date":"2017-11-20T00:00:00Z","permalink":"/posts/2017/11/2017-11-20-%E7%94%A8phpmyadmin%E5%9C%A8%E7%BA%BF%E7%AE%A1%E7%90%86mysql%E6%95%B0%E6%8D%AE%E5%BA%93/","title":"ç”¨phpMyAdminåœ¨çº¿ç®¡ç†mysqlæ•°æ®åº“"},{"content":"16.å¼‚å¸¸å¤„ç† æ•è·æ‰€æœ‰å¼‚å¸¸ï¼š\nexcept Exception as e: print e try/except/finallyè¯­å¥:\ntry: #é¦–å…ˆæ‰§è¡Œ pass except: #å¼‚å¸¸çš„è¯æ‰§è¡Œ pass finally: #æ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œåœ¨æœ€åéƒ½æ‰§è¡Œ pass try/elseè¯­å¥ï¼š\ntry: #é¦–å…ˆæ‰§è¡Œ pass else: #å¼‚å¸¸çš„è¯æ‰§è¡Œ,ä¸”ä¸è¢«æ•è·å¼‚å¸¸ pass finally: #æ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œåœ¨æœ€åéƒ½æ‰§è¡Œ pass 17.ç®€æ˜“webserver python2:\npython -m SimpleHTTPServer 8888 #åœ¨å½“å‰æ–‡ä»¶å¤¹å»ºç«‹ç®€æ˜“httpæœåŠ¡å™¨ï¼Œç«¯å£ä¸º8888 python3:\npython -m http.server 8888 #åœ¨å½“å‰æ–‡ä»¶å¤¹å»ºç«‹ç®€æ˜“httpæœåŠ¡å™¨ï¼Œç«¯å£ä¸º8888 æ³¨æ„ï¼Œåœ¨python2ä¸­SimpleHTTPServeræ˜¯å¤„ç†GETå’ŒHEADè¯·æ±‚çš„ï¼Œè€ŒCGIHTTPServerå¤„ç†POSTè¯·æ±‚ã€‚\n18.pprint å¯ä»¥ç”¨äºæ‰“å°dictç­‰æ•°æ®ç»“æ„ï¼Œæ¯”è¾ƒæ¼‚äº®\nfrom pprint import pprint pprint({a:1,b:2}) 19.for/elseä»å¥ elseä»…åœ¨forå¾ªç¯æ­£å¸¸ç»“æŸæ—¶æ‰ä¼šæ‰§è¡Œï¼Œå½“forå¾ªç¯è¢«breakæ—¶ï¼Œä¸æ‰§è¡Œelse\nä¸¾ä¾‹è¯´æ˜ï¼š\nfor item in container: if search_something(item): # Found it! process(item) break else: # Didn\u0026#39;t find anything.. not_found_in_container() 20.ç”¨withå—è‡ªåŠ¨é‡Šæ”¾å¥æŸ„ withå—å¯åœ¨æœ‰å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾å¥æŸ„\nwith open(\u0026#39;a.txt\u0026#39;,\u0026#39;r+\u0026#39;) as f: #æ‰“å¼€æˆåŠŸæ‰ä¼šè·å¾—å¥æŸ„ï¼Œæœ‰å¼‚å¸¸åˆ™è‡ªåŠ¨é‡Šæ”¾ file = f.read() ç”¨io.openå¯åˆ¶å®šç¼–ç æ–¹å¼ï¼š\nimport io with io.open(\u0026#39;a.txt\u0026#39;, \u0026#39;w\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;) as f: f.write(.......) è€Œç›´æ¥ä½¿ç”¨open(),do,close()çš„æ–¹å¼ï¼Œå¯èƒ½å› ä¸ºå„ç§errorè€Œå¯¼è‡´æ²¡æœ‰é‡Šæ”¾èµ„æºã€‚\n21.åç¨‹ ä¸ç”Ÿæˆå™¨æœ‰ç‚¹åƒï¼Œä½†ç”Ÿæˆå™¨æ˜¯è¿”å›å¯è¿­ä»£å¯¹è±¡çš„ç”Ÿäº§è€…ï¼Œè€Œæºç¨‹æ˜¯æ¥å—å‚æ•°çš„æ¶ˆè´¹è€…ã€‚\ndef grep(pattern): print(\u0026#34;Searching for\u0026#34;, pattern) while True: line = (yield) if pattern in line: print(line) æˆ‘ä»¬é€šè¿‡sendæ–¹æ³•ä¼ é€ç»™åç¨‹æ•°æ®ï¼Œç„¶åç”¨close()æ–¹æ³•æ¥å…³é—­\nsearch = grep(\u0026#39;coroutine\u0026#39;) next(search) #output: Searching for coroutine search.send(\u0026#34;I love you\u0026#34;) search.send(\u0026#34;Don\u0026#39;t you love me?\u0026#34;) search.send(\u0026#34;I love coroutine instead!\u0026#34;) #output: I love coroutine instead! search = grep(\u0026#39;coroutine\u0026#39;) search.close() ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(1) ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(2)\n","date":"2017-11-16T00:00:00Z","permalink":"/posts/2017/11/2017-11-16-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B03/","title":"ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(3)"},{"content":"1.*argsä¸**kwargsä¼ å‚(ä¸å®šé•¿ä¼ å‚) å…¶ä¸­*argsæ˜¯åˆ—è¡¨ä¼ å‚,**kwargsæ˜¯å­—å…¸ä¼ å‚\nä½¿ç”¨ä¸¾ä¾‹ï¼š\nfunction(fargs, *args, **kwargs) å¯ä»¥ç”¨function(1)ï¼Œfunction([1,2])ï¼Œfunction({a:1})è°ƒç”¨å‡½æ•°ï¼Œéƒ½æ²¡é—®é¢˜ã€‚\n2.ç”Ÿæˆå™¨yield å¯ç†è§£ä¸ºåªèƒ½è¢«è¿­ä»£ä¸€æ¬¡çš„è¿­ä»£å™¨ï¼Œå¯ä»¥èŠ‚çœå†…å­˜\nä½¿ç”¨ä¸¾ä¾‹ï¼š\ndef generation_function(): for i in range(10): yield i for item in generation_function(): #generation_functionæ˜¯ç”Ÿæˆå™¨ï¼Œå¯è¢«è¿­ä»£çš„ print item #è¾“å‡ºæ˜¯0-\u0026gt;9ï¼Œä½†å¹¶ä¸éœ€è¦å»ºç«‹ä¸€ä¸ªlistï¼ŒèŠ‚çœäº†å†…å­˜ 3.åŒ¿åå‡½æ•° lambdaï¼Œå¯å‡å°‘æ— éœ€é‡å¤å‡½æ•°\næ ¼å¼ï¼šlambda å‚æ•°:æ“ä½œ\nä½¿ç”¨ä¸¾ä¾‹ï¼š\nlambda x : x+1 4.map() å°†functionåº”ç”¨äºåé¢å‚æ•°çš„æ‰€æœ‰LISTå…ƒç´ ä¸­ï¼Œè¿”å›ç»“æœã€‚(python2è¿”å›list,python3è¿”å›è¿­ä»£å™¨)\nmap(function, list) ä¹Ÿæ”¯æŒå¤šå‚æ•°:\nmap(function, list1, list2, list3....) å¸¸ç»“åˆlambdaåŒ¿åå‡½æ•°ä¸€èµ·ä½¿ç”¨\nä½¿ç”¨ä¸¾ä¾‹ï¼š\nitems=[1,2,3,4,5] print map(lambda x : x**2, items) è¾“å‡º[1,4,9,16,25]\nmapçš„æœ¬è´¨æ—¢å°†ä¸€ä¸ªå‡½æ•°æ˜ å°„åˆ°è‹¥å¹²åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ ä¸Šã€‚\n5.filter() è¿‡æ»¤listä¸­çš„å…ƒç´ ï¼Œè¿”å›ç¬¦åˆæ¡ä»¶å…ƒç´ çš„list\nä½¿ç”¨ä¸¾ä¾‹ï¼š\nnumber_list = range(-5,5) less_than_zero = filter(lambda x : x\u0026lt;0, number_list) è¾“å‡º[-5,-4,-3,-2,-1]\n6.reduce() from functools import reduce) product = reduce((lambda x,y:x*y),[1,2,3,4]) è¾“å‡º24\n7.set é›†åˆæ—¢ä¸èƒ½åŒ…å«é‡å¤å€¼(å…¶ä»–è¡Œä¸ºä¸listç›¸ä¼¼)\nè¯­æ³•ï¼šset(list)\näº¤é›†ï¼š\nprint (set1.intersection(set2)) å·®é›†ï¼š\nprint (set1.difference(set2)) 8.ä¸‰å…ƒè¿ç®—ç¬¦ ä½¿ç”¨ä¸¾ä¾‹ï¼š\nis_fat = True state = \u0026#34;fat\u0026#34; if is_fat else \u0026#34;not fat\u0026#34; ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(2) ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(3)\n","date":"2017-11-15T00:00:00Z","permalink":"/posts/2017/11/2017-11-15-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B01/","title":"ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(1)"},{"content":"9.è£…é¥°å™¨ æ—¢å°†å‡½æ•°ä¼ å‚ç»™è£…é¥°å™¨å‡½æ•°ï¼Œåœ¨å‡½æ•°æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä½œæŸäº›é€šç”¨æ“ä½œã€‚\nè®°å¾—è¦ç”¨@wrapså¤åˆ¶å‡½æ•°åç§°(name)ï¼Œç­‰ç­‰å±æ€§\nä½¿ç”¨ä¸¾ä¾‹ï¼š\nfrom functools import wraps def requires_auth(f): @wraps(f) def decorated(*args, **kwargs): auth = request.authorization if not auth or not check_auth(auth.username, auth.password): #è‹¥æœªç™»å½•ï¼Œè¿”å›401 authenticate() return f(*args, **kwargs) return decorated 10.å¯å˜æ•°æ®ç±»å‹å’Œä¸å¯å˜æ•°æ®ç±»å‹ å¯å˜æ•°æ®ç±»å‹ï¼šlist,dict\nä¸å¯å˜æ•°æ®ç±»å‹ï¼šint,float,string,tuple\nå¯å˜ä¸å¯å˜ï¼ŒæŒ‡çš„æ˜¯å˜é‡æŒ‡å‘çš„å€¼ï¼šå¯å˜ï¼Œå°±æ˜¯è¯´å¯ä»¥æ”¹å˜æŒ‡å‘çš„å€¼è€Œåœ°å€ä¸å˜ã€‚ä¸å¯å˜ï¼Œå°±æ˜¯è¯´æ”¹å˜å˜é‡çš„å€¼å¿…ç„¶æ”¹å˜åœ°å€ã€‚\npythonä¸­çš„èµ‹å€¼(=)ï¼Œå°±æ˜¯å·¦ä¾§å¾—åˆ°å³ä¾§å†…å­˜çš„å¼•ç”¨ã€‚\nä¸¾ä¾‹è¯´æ˜ï¼š\na = [1] print a #----\u0026gt;[1] b = a b.append(2) print a #-----\u0026gt;[1,2] å› ä¸ºlistä¸ºå¯å˜æ•°æ®ç±»å‹ï¼Œè€Œaå’ŒbæŒ‡å‘åŒä¸€ç‰‡å†…å­˜ã€‚å½“å¯¹båš+=æ“ä½œæ—¶ï¼Œåªæ˜¯å‘åæ‰©å……å†…å­˜å†…å®¹ï¼Œè€Œä¸ä¼šä¿®æ”¹å†…å­˜ä½ç½®ã€‚æ‰€ä»¥aä¹Ÿæ”¹å˜äº†ã€‚\nåŒæ—¶è¦æ³¨æ„ï¼Œpythonå‡½æ•°è¢«å®šä¹‰æ—¶ï¼Œé»˜è®¤å‚æ•°åªä¼šè¢«è®¡ç®—ä¸€æ¬¡ï¼Œä¸ä¼šæ¯æ¬¡éƒ½è®¡ç®—ã€‚æ‰€ä»¥ï¼Œé»˜è®¤å‚æ•°æœ€å¥½ä¸è¦ç”¨å¯å˜æ•°æ®ç±»å‹ï¼Œå°±ç®—è¦ç”¨ï¼Œä¹Ÿè¦æ³¨æ„åœ¨ä¹‹åä¸è¦å¯¹å…¶åšä¿®æ”¹ã€‚\n11.slots åœ¨ç±»çš„å®šä¹‰ä¸­ä½¿ç”¨__slots__=[\u0026ldquo;name\u0026rdquo;,\u0026ldquo;age\u0026rdquo;]ï¼Œåˆ™åªæœ‰__slots__è¿™ä¸ªsetä¸­çš„å±æ€§å¯ä»¥è¢«åˆ†é…å†…å­˜ï¼Œä¸åœ¨å…¶ä¸­çš„ä¸å¯è¢«åˆ†é…å†…å­˜ã€‚\n12.å®¹å™¨collections 1.defaultdict\nè°ƒç”¨ä¸å­˜åœ¨çš„keyæ—¶ï¼Œä¼šç”¨é»˜è®¤çš„å·¥å‚æ–¹æ³•ä½œä¸ºkeyé»˜è®¤å€¼.\nä¸¾ä¾‹è¯´æ˜ï¼š\nfrom collections import defaultdic favourite_colors = defaultdict(list) for name,color in colors: favourite_colors[name].append(color) #é»˜è®¤ç”¨nameè¿™ä¸ªlistä½œä¸ºKEY 2.counterè®¡æ•°å™¨\nfrom collections import counter c= counter(...)#ä¸ºå†…éƒ¨å…ƒç´ è®¡æ•° favs = counter(name for name,color in colors) #ä¸ºnameè®¡æ•°,ä»¥dictè¿”å› 3.dequeåŒå‘é“¾è¡¨\nfrom collections import deque 4.namedtupleå‘½åå…ƒç»„\nfrom collections import namedtuple animal = namedtuple(\u0026#39;animal\u0026#39;, \u0026#39;name age type\u0026#39;) perry = animal(name=\u0026#34;perry\u0026#34;, age=31, type=\u0026#34;cat\u0026#34;) #å¯ä»¥è®¿é—®perry.nameè¿™æ ·è®¿é—®å±æ€§ print perry.name #è¾“å‡ºperry #å¯å°†å‘½åå…ƒç»„è½¬æ¢ä¸ºdictï¼Œç”¨_asdict()æ–¹æ³• perry._asdict() 13.dir() è¿”å›å¯¹è±¡æ‰€æœ‰å±æ€§å’Œæ–¹æ³•\nä¸¾ä¾‹ï¼š\na = [1,2,3] print dir(a) 14.type()å’Œid() type()è¿”å›å¯¹è±¡ç±»å‹ï¼Œid()è¿”å›ä¸åŒç§ç±»å¯¹è±¡å”¯ä¸€ID\n15.æ¨å¯¼å¼ 1.åˆ—è¡¨æ¨å¯¼å¼\né€šè¿‡forå’Œifç”Ÿæˆlist\nä¸¾ä¾‹è¯´æ˜ï¼š\nm=[i for i in range(30) if i%3 is 0] #------------è¿™æ˜¯list-----è¿™æ˜¯æ¡ä»¶----- è¯­æ³•ï¼š\nvariable = [out_exp for out_exp in input_list if out_exp==2] #----------------------------------è¿™æ˜¯list------è¿™æ˜¯æ¡ä»¶---- 2.å­—å…¸æ¨å¯¼å¼\ndict = {v:k for k,v in some_dict.items()} ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(1) ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(3)\n","date":"2017-11-15T00:00:00Z","permalink":"/posts/2017/11/2017-11-15-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B02/","title":"ã€ŠPythonè¿›é˜¶ã€‹è¯»ä¹¦ç¬”è®°(2)"},{"content":"é™¤äº†zabbixï¼Œnagiosè¿™æ ·é‡é‡å‹çš„ç›‘æ§è½¯ä»¶ä¹‹å¤–ï¼ŒæŒ‘é€‰äº†å‡ ä¸ªç®€å•çš„linuxç›‘æ§è½¯ä»¶ï¼Œä¹Ÿè¿˜æ¯”è¾ƒå¥½ç”¨ï¼Œè®°å½•ä¸€ä¸‹\n1.linux-dash\næºåœ°å€ï¼šhttps://github.com/afaqurk/linux-dash\næ±‰åŒ–åœ°å€ï¼šhttps://github.com/NoBey/linux-dash-zh\nå®‰è£…è¿‡ç¨‹éå¸¸ç®€å•ï¼Œä¸å•°å—¦äº†ã€‚\næœ¬æœåŠ¡å™¨è¯•ç”¨åœ°å€ï¼šhttp://linux-dash.calmkart.com/\n2.psdash\næºåœ°å€ï¼šhttps://github.com/Jahaja/psdash\nå®‰è£…è¿‡ç¨‹åŒæ ·ç•¥è¿‡ï¼Œå¾ˆç®€å•ã€‚\næœ¬æœåŠ¡å™¨è¯•ç”¨åœ°å€ï¼šhttp://psdash.calmkart.com/\nå¯ä»¥æ„Ÿå—ä¸‹åˆ°åº•å“ªä¸ªæ¯”è¾ƒå¥½ç”¨ã€‚\n","date":"2017-11-08T00:00:00Z","permalink":"/posts/2017/11/2017-11-08-%E4%B8%A4%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84linux%E7%9B%91%E6%8E%A7%E8%BD%AF%E4%BB%B6/","title":"ä¸¤ä¸ªç®€å•çš„linuxç›‘æ§è½¯ä»¶"},{"content":"æœ€ç»ˆæ•ˆæœï¼š logè®°å½•: /var/log/messages\nhistoryè®°å½•: history\né¦–å…ˆå»gnuä¸‹è½½æœ€æ–°ç‰ˆçš„bashæºç ï¼Œæœ¬æ¬¡é‡‡ç”¨çš„æ˜¯bash-4.4ç‰ˆæœ¬\nç¼–è¾‘config-top.hæ–‡ä»¶ï¼Œä¸»è¦å…³æ³¨ä»¥ä¸‹ä¸¤ç‚¹: ä¸€.103è¡Œï¼Œå–æ¶ˆ\n#define SSH_SOURCE_BASHRC çš„æ³¨é‡Š äºŒ.116è¡Œï¼Œå–æ¶ˆ\n#define SYSLOG_HISTORY çš„æ³¨é‡Š\nç„¶åç¼–è¾‘bashhist.cæºç æ–‡ä»¶ï¼Œä¸»è¦å…³æ³¨750è¡Œ-\u0026gt;800è¡Œã€‚ æœªç»ä¿®æ”¹çš„åŸæ–‡ä»¶ï¼š\nvoid bash_syslog_history (line) const char *line; { char trunc[SYSLOG_MAXLEN]; static int first = 1; if (first) { openlog (shell_name, OPENLOG_OPTS, SYSLOG_FACILITY); first = 0; } if (strlen(line) \u0026lt; SYSLOG_MAXLEN) syslog (SYSLOG_FACILITY|SYSLOG_LEVEL, \u0026#34;HISTORY: PID=%d UID=%d %s\u0026#34;, getpid(), current_user.uid, line); else { strncpy (trunc, line, SYSLOG_MAXLEN); trunc[SYSLOG_MAXLEN - 1] = \u0026#39;\\0\u0026#39;; syslog (SYSLOG_FACILITY|SYSLOG_LEVEL, \u0026#34;HISTORY (TRUNCATED): PID=%d UID=%d %s\u0026#34;, getpid(), current_user.uid, trunc); } } è¿™é‡Œä¸»è¦å°±æ˜¯ç”¨æ¥ä¿®æ”¹syslogæœåŠ¡çš„ç›¸å…³è®°å½•é¡¹ï¼Œå¯ä»¥å¢åˆ åŠŸèƒ½ã€‚ ä¿®æ”¹åçš„ä»£ç ï¼š\nbash_syslog_history (line) const char *line; { char trunc[SYSLOG_MAXLEN]; static int first = 1; FILE *fp; char buffer[LEN_p]; fp=popen(\u0026#34;echo \\\u0026#34;[`who am i 2\u0026gt;/dev/null| awk \u0026#39;{print $NF}\u0026#39;|sed -e \u0026#39;s/ [()]//g\u0026#39;|sed \u0026#39;s/(//g\u0026#39;|sed \u0026#39;s/)//g\u0026#39;`]\\\u0026#34;\u0026#34;,\u0026#34;r\u0026#34;); fgets(buffer,sizeof(buffer),fp); int ii = LEN_p-1; while(ii\u0026gt;=0 \u0026amp;\u0026amp; buffer[ii]==\u0026#39; \u0026#39;) ii--; buffer[ii] = \u0026#39;\\0\u0026#39;; char buffer_test[LEN_p]; int iii = 0; int jjj = 0; while(buffer[iii]!=\u0026#39;\\0\u0026#39;){ if(buffer[iii]\u0026lt;32) iii++; else buffer_test[jjj++]=buffer[iii++]; } buffer_test[jjj]=\u0026#39;\\0\u0026#39;; //const char *buffer_test; //buffer_test = buffer; pclose(fp); //buffer_test = getenv(\u0026#34;NAME_OF_KEY\u0026#34;); if (first) { openlog (shell_name, OPENLOG_OPTS, SYSLOG_FACILITY); first = 0; } if (strlen(line) \u0026lt; SYSLOG_MAXLEN) syslog (SYSLOG_FACILITY|SYSLOG_LEVEL, \u0026#34;HISTORY: PID=%d UID=%d User=%s KEY=%s CMD=%s\u0026#34;, getpid(), current_user.uid, current_user.user_name, buffer_test,line); else { strncpy (trunc, line, SYSLOG_MAXLEN); trunc[SYSLOG_MAXLEN - 1] = \u0026#39;\\0\u0026#39;; syslog (SYSLOG_FACILITY|SYSLOG_LEVEL, \u0026#34;HISTORY (TRUNCATED): PID=%d UID=%d User=%s KEY=%s CMD=%s\u0026#34;, getpid(), current_user.uid, current_user.user_name, buffer_test,trunc); } } è¿™é‡Œæ—¢æ˜¯é€šè¿‡ä¿®æ”¹æºç çš„æ–¹æ³•æ·»åŠ äº†å®¡è®¡usernameå’ŒIPçš„åŠŸèƒ½ï¼Œå¦‚éœ€è¦åŠ å…¥å…¶ä»–ä»»ä½•åŠŸèƒ½ç›´æ¥åœ¨è¿™é‡Œå†™Cä»£ç å°±å¯ä»¥äº†ã€‚ ç„¶åï¼Œæœ‰å”¯ä¸€ä¸€ä¸ªéœ€è¦æ³¨æ„çš„è¦ç‚¹ï¼Œrsyslogå¤„ç†æ‰€æœ‰ascii\u0026lt;32çš„ç‰¹æ®Šå­—ç¬¦éƒ½ä¼šæ˜¾ç¤º#012æ— æ³•è¯†åˆ«ï¼Œæ‰€ä»¥æ— è®ºç”¨rsyslogè®°å½•ä»€ä¹ˆï¼Œéƒ½éœ€è¦æŠŠascii\u0026lt;32çš„ç‰¹æ®Šå­—ç¬¦åˆ é™¤æ‰ ç„¶åç¼–è¯‘ï¼Œæ›¿æ¢/bin/bashä¸å†å¤šè¯´\næœ€åï¼Œå¯ä»¥ç¼–è¾‘/etc/profileï¼Œä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œæ·»åŠ å¦‚ä¸‹ä¸‰è¡Œå¸¸ç”¨é…ç½®ï¼š\nexport HISTTIMEFORMAT=\u0026#34;[%Y-%m-%d %H:%M:%S] [`who am i 2\u0026gt;/dev/null| awk \u0026#39;{print $NF}\u0026#39;|sed -e \u0026#39;s/[ ()]//g\u0026#39;`] \u0026#34; export HISTSIZE=\u0026#34;999999\u0026#34; readonly PROMPT_COMMAND=\u0026#34;history -a\u0026#34; ç¬¬ä¸€è¡Œå®šä¹‰historyæ ¼å¼ ç¬¬äºŒè¡Œç¬¬ä¸€historyæœ€å¤§å­˜å‚¨ ç¬¬ä¸‰è¡Œè®©æ‰€æœ‰ç”¨æˆ·æ“ä½œéƒ½èƒ½å³æ—¶å†™å…¥historyä¸­ï¼Œè€Œä¸æ˜¯é€€å‡ºsessionæ—¶å†å†™å…¥(å¦‚æœåŒæ—¶åˆå‡ ä¸ªç”¨æˆ·ç™»å½•ï¼Œå¯èƒ½å¯¼è‡´historyäº‹ä»¶é”™ä¹±)\nå†å²è¯„è®º (3 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nè¯·å«æˆ‘æ€»è£è°¢ (2017-09-18 18:18) æˆ‘æ—¥ï¼Œå½­æ€»ä¸äºæ˜¯å…¨å›½pythoneç¬¬ä¸€äººï¼ŒæŠ€æœ¯åšå®¢åŠç‚¸å¤©ï¼Œåœ¨ä¸‹æ˜¯æœçš„ å­™æ˜Š (2017-10-31 14:12) å½­æ€»ï¼Œå¿«æ›´æ–°æ–‡ç« å•Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ Huanguo (2017-11-10 17:23) dalao,dalao ","date":"2017-09-13T00:00:00Z","permalink":"/posts/2017/09/2017-09-13-%E6%89%A9%E5%B1%95%E5%B9%B6%E4%BF%AE%E6%94%B9bash%E6%BA%90%E7%A0%81%E4%BD%BF%E6%94%AF%E6%8C%81rsyslog%E4%B8%94%E5%A2%9E%E5%8A%A0%E5%AE%A1%E8%AE%A1%E6%9D%A1%E7%9B%AE/","title":"æ‰©å±•å¹¶ä¿®æ”¹bashæºç ä½¿æ”¯æŒrsyslogä¸”å¢åŠ å®¡è®¡æ¡ç›®"},{"content":"ä¸€ç¯‡å…³äºPYTHONå­—ç¬¦ä¸²å’Œç¼–ç çš„æ–‡ç« ï¼Œå†™çš„å¾ˆå¥½ï¼ŒåŸåœ°å€ï¼š\nhttps://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431664106267f12e9bef7ee14cf6a8776a479bdec9b9000\nå…¨æ–‡å¦‚ä¸‹ï¼š\nå­—ç¬¦ç¼–ç  æˆ‘ä»¬å·²ç»è®²è¿‡äº†ï¼Œå­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œä½†æ˜¯ï¼Œå­—ç¬¦ä¸²æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯è¿˜æœ‰ä¸€ä¸ªç¼–ç é—®é¢˜ã€‚\nå› ä¸ºè®¡ç®—æœºåªèƒ½å¤„ç†æ•°å­—ï¼Œå¦‚æœè¦å¤„ç†æ–‡æœ¬ï¼Œå°±å¿…é¡»å…ˆæŠŠæ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—æ‰èƒ½å¤„ç†ã€‚æœ€æ—©çš„è®¡ç®—æœºåœ¨è®¾è®¡æ—¶é‡‡ç”¨8ä¸ªæ¯”ç‰¹ï¼ˆbitï¼‰ä½œä¸ºä¸€ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªå­—èŠ‚èƒ½è¡¨ç¤ºçš„æœ€å¤§çš„æ•´æ•°å°±æ˜¯255ï¼ˆäºŒè¿›åˆ¶11111111=åè¿›åˆ¶255ï¼‰ï¼Œå¦‚æœè¦è¡¨ç¤ºæ›´å¤§çš„æ•´æ•°ï¼Œå°±å¿…é¡»ç”¨æ›´å¤šçš„å­—èŠ‚ã€‚æ¯”å¦‚ä¸¤ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤ºçš„æœ€å¤§æ•´æ•°æ˜¯65535ï¼Œ4ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤ºçš„æœ€å¤§æ•´æ•°æ˜¯4294967295ã€‚\nç”±äºè®¡ç®—æœºæ˜¯ç¾å›½äººå‘æ˜çš„ï¼Œå› æ­¤ï¼Œæœ€æ—©åªæœ‰127ä¸ªå­—ç¬¦è¢«ç¼–ç åˆ°è®¡ç®—æœºé‡Œï¼Œä¹Ÿå°±æ˜¯å¤§å°å†™è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸€äº›ç¬¦å·ï¼Œè¿™ä¸ªç¼–ç è¡¨è¢«ç§°ä¸ºASCIIç¼–ç ï¼Œæ¯”å¦‚å¤§å†™å­—æ¯Açš„ç¼–ç æ˜¯65ï¼Œå°å†™å­—æ¯zçš„ç¼–ç æ˜¯122ã€‚\nä½†æ˜¯è¦å¤„ç†ä¸­æ–‡æ˜¾ç„¶ä¸€ä¸ªå­—èŠ‚æ˜¯ä¸å¤Ÿçš„ï¼Œè‡³å°‘éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œè€Œä¸”è¿˜ä¸èƒ½å’ŒASCIIç¼–ç å†²çªï¼Œæ‰€ä»¥ï¼Œä¸­å›½åˆ¶å®šäº†GB2312ç¼–ç ï¼Œç”¨æ¥æŠŠä¸­æ–‡ç¼–è¿›å»ã€‚\nä½ å¯ä»¥æƒ³å¾—åˆ°çš„æ˜¯ï¼Œå…¨ä¸–ç•Œæœ‰ä¸Šç™¾ç§è¯­è¨€ï¼Œæ—¥æœ¬æŠŠæ—¥æ–‡ç¼–åˆ°Shift_JISé‡Œï¼ŒéŸ©å›½æŠŠéŸ©æ–‡ç¼–åˆ°Euc-kré‡Œï¼Œå„å›½æœ‰å„å›½çš„æ ‡å‡†ï¼Œå°±ä¼šä¸å¯é¿å…åœ°å‡ºç°å†²çªï¼Œç»“æœå°±æ˜¯ï¼Œåœ¨å¤šè¯­è¨€æ··åˆçš„æ–‡æœ¬ä¸­ï¼Œæ˜¾ç¤ºå‡ºæ¥ä¼šæœ‰ä¹±ç ã€‚\nå› æ­¤ï¼ŒUnicodeåº”è¿è€Œç”Ÿã€‚UnicodeæŠŠæ‰€æœ‰è¯­è¨€éƒ½ç»Ÿä¸€åˆ°ä¸€å¥—ç¼–ç é‡Œï¼Œè¿™æ ·å°±ä¸ä¼šå†æœ‰ä¹±ç é—®é¢˜äº†ã€‚\nUnicodeæ ‡å‡†ä¹Ÿåœ¨ä¸æ–­å‘å±•ï¼Œä½†æœ€å¸¸ç”¨çš„æ˜¯ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼ˆå¦‚æœè¦ç”¨åˆ°éå¸¸ååƒ»çš„å­—ç¬¦ï¼Œå°±éœ€è¦4ä¸ªå­—èŠ‚ï¼‰ã€‚ç°ä»£æ“ä½œç³»ç»Ÿå’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½ç›´æ¥æ”¯æŒUnicodeã€‚\nç°åœ¨ï¼Œæ‹ä¸€æ‹ASCIIç¼–ç å’ŒUnicodeç¼–ç çš„åŒºåˆ«ï¼šASCIIç¼–ç æ˜¯1ä¸ªå­—èŠ‚ï¼Œè€ŒUnicodeç¼–ç é€šå¸¸æ˜¯2ä¸ªå­—èŠ‚ã€‚\nå­—æ¯Aç”¨ASCIIç¼–ç æ˜¯åè¿›åˆ¶çš„65ï¼ŒäºŒè¿›åˆ¶çš„01000001ï¼›\nå­—ç¬¦0ç”¨ASCIIç¼–ç æ˜¯åè¿›åˆ¶çš„48ï¼ŒäºŒè¿›åˆ¶çš„00110000ï¼Œæ³¨æ„å­—ç¬¦'0'å’Œæ•´æ•°0æ˜¯ä¸åŒçš„ï¼›\næ±‰å­—ä¸­å·²ç»è¶…å‡ºäº†ASCIIç¼–ç çš„èŒƒå›´ï¼Œç”¨Unicodeç¼–ç æ˜¯åè¿›åˆ¶çš„20013ï¼ŒäºŒè¿›åˆ¶çš„01001110 00101101ã€‚\nä½ å¯ä»¥çŒœæµ‹ï¼Œå¦‚æœæŠŠASCIIç¼–ç çš„Aç”¨Unicodeç¼–ç ï¼Œåªéœ€è¦åœ¨å‰é¢è¡¥0å°±å¯ä»¥ï¼Œå› æ­¤ï¼ŒAçš„Unicodeç¼–ç æ˜¯00000000 01000001ã€‚\næ–°çš„é—®é¢˜åˆå‡ºç°äº†ï¼šå¦‚æœç»Ÿä¸€æˆUnicodeç¼–ç ï¼Œä¹±ç é—®é¢˜ä»æ­¤æ¶ˆå¤±äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å†™çš„æ–‡æœ¬åŸºæœ¬ä¸Šå…¨éƒ¨æ˜¯è‹±æ–‡çš„è¯ï¼Œç”¨Unicodeç¼–ç æ¯”ASCIIç¼–ç éœ€è¦å¤šä¸€å€çš„å­˜å‚¨ç©ºé—´ï¼Œåœ¨å­˜å‚¨å’Œä¼ è¾“ä¸Šå°±ååˆ†ä¸åˆ’ç®—ã€‚\næ‰€ä»¥ï¼Œæœ¬ç€èŠ‚çº¦çš„ç²¾ç¥ï¼Œåˆå‡ºç°äº†æŠŠUnicodeç¼–ç è½¬åŒ–ä¸ºâ€œå¯å˜é•¿ç¼–ç â€çš„UTF-8ç¼–ç ã€‚UTF-8ç¼–ç æŠŠä¸€ä¸ªUnicodeå­—ç¬¦æ ¹æ®ä¸åŒçš„æ•°å­—å¤§å°ç¼–ç æˆ1-6ä¸ªå­—èŠ‚ï¼Œå¸¸ç”¨çš„è‹±æ–‡å­—æ¯è¢«ç¼–ç æˆ1ä¸ªå­—èŠ‚ï¼Œæ±‰å­—é€šå¸¸æ˜¯3ä¸ªå­—èŠ‚ï¼Œåªæœ‰å¾ˆç”Ÿåƒ»çš„å­—ç¬¦æ‰ä¼šè¢«ç¼–ç æˆ4-6ä¸ªå­—èŠ‚ã€‚å¦‚æœä½ è¦ä¼ è¾“çš„æ–‡æœ¬åŒ…å«å¤§é‡è‹±æ–‡å­—ç¬¦ï¼Œç”¨UTF-8ç¼–ç å°±èƒ½èŠ‚çœç©ºé—´ï¼š\nå­—ç¬¦ ASCII Unicode UTF-8 A 01000001 00000000 01000001 01000001 ä¸­ x 01001110 00101101 11100100 10111000 10101101 ä»ä¸Šé¢çš„è¡¨æ ¼è¿˜å¯ä»¥å‘ç°ï¼ŒUTF-8ç¼–ç æœ‰ä¸€ä¸ªé¢å¤–çš„å¥½å¤„ï¼Œå°±æ˜¯ASCIIç¼–ç å®é™…ä¸Šå¯ä»¥è¢«çœ‹æˆæ˜¯UTF-8ç¼–ç çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼Œå¤§é‡åªæ”¯æŒASCIIç¼–ç çš„å†å²é—ç•™è½¯ä»¶å¯ä»¥åœ¨UTF-8ç¼–ç ä¸‹ç»§ç»­å·¥ä½œã€‚\nææ¸…æ¥šäº†ASCIIã€Unicodeå’ŒUTF-8çš„å…³ç³»ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ€»ç»“ä¸€ä¸‹ç°åœ¨è®¡ç®—æœºç³»ç»Ÿé€šç”¨çš„å­—ç¬¦ç¼–ç å·¥ä½œæ–¹å¼ï¼š\nåœ¨è®¡ç®—æœºå†…å­˜ä¸­ï¼Œç»Ÿä¸€ä½¿ç”¨Unicodeç¼–ç ï¼Œå½“éœ€è¦ä¿å­˜åˆ°ç¡¬ç›˜æˆ–è€…éœ€è¦ä¼ è¾“çš„æ—¶å€™ï¼Œå°±è½¬æ¢ä¸ºUTF-8ç¼–ç ã€‚\nç”¨è®°äº‹æœ¬ç¼–è¾‘çš„æ—¶å€™ï¼Œä»æ–‡ä»¶è¯»å–çš„UTF-8å­—ç¬¦è¢«è½¬æ¢ä¸ºUnicodeå­—ç¬¦åˆ°å†…å­˜é‡Œï¼Œç¼–è¾‘å®Œæˆåï¼Œä¿å­˜çš„æ—¶å€™å†æŠŠUnicodeè½¬æ¢ä¸ºUTF-8ä¿å­˜åˆ°æ–‡ä»¶ï¼š\næµè§ˆç½‘é¡µçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä¼šæŠŠåŠ¨æ€ç”Ÿæˆçš„Unicodeå†…å®¹è½¬æ¢ä¸ºUTF-8å†ä¼ è¾“åˆ°æµè§ˆå™¨ï¼š\næ‰€ä»¥ä½ çœ‹åˆ°å¾ˆå¤šç½‘é¡µçš„æºç ä¸Šä¼šæœ‰ç±»ä¼¼\u0026lt;meta charset=\u0026quot;UTF-8\u0026quot; /\u0026gt;çš„ä¿¡æ¯ï¼Œè¡¨ç¤ºè¯¥ç½‘é¡µæ­£æ˜¯ç”¨çš„UTF-8ç¼–ç ã€‚\nPythonçš„å­—ç¬¦ä¸² ææ¸…æ¥šäº†ä»¤äººå¤´ç–¼çš„å­—ç¬¦ç¼–ç é—®é¢˜åï¼Œæˆ‘ä»¬å†æ¥ç ”ç©¶Pythonçš„å­—ç¬¦ä¸²ã€‚\nåœ¨æœ€æ–°çš„Python 3ç‰ˆæœ¬ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯ä»¥Unicodeç¼–ç çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒPythonçš„å­—ç¬¦ä¸²æ”¯æŒå¤šè¯­è¨€ï¼Œä¾‹å¦‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; print(\u0026#39;åŒ…å«ä¸­æ–‡çš„str\u0026#39;) åŒ…å«ä¸­æ–‡çš„str å¯¹äºå•ä¸ªå­—ç¬¦çš„ç¼–ç ï¼ŒPythonæä¾›äº†ord()å‡½æ•°è·å–å­—ç¬¦çš„æ•´æ•°è¡¨ç¤ºï¼Œchr()å‡½æ•°æŠŠç¼–ç è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ï¼š\n\u0026gt;\u0026gt;\u0026gt; ord(\u0026#39;A\u0026#39;) 65 \u0026gt;\u0026gt;\u0026gt; ord(\u0026#39;ä¸­\u0026#39;) 20013 \u0026gt;\u0026gt;\u0026gt; chr(66) \u0026#39;B\u0026#39; \u0026gt;\u0026gt;\u0026gt; chr(25991) \u0026#39;æ–‡\u0026#39; å¦‚æœçŸ¥é“å­—ç¬¦çš„æ•´æ•°ç¼–ç ï¼Œè¿˜å¯ä»¥ç”¨åå…­è¿›åˆ¶è¿™ä¹ˆå†™strï¼š\n\u0026gt;\u0026gt;\u0026gt; \u0026#39;\\u4e2d\\u6587\u0026#39; \u0026#39;ä¸­æ–‡\u0026#39; ä¸¤ç§å†™æ³•å®Œå…¨æ˜¯ç­‰ä»·çš„ã€‚\nç”±äºPythonçš„å­—ç¬¦ä¸²ç±»å‹æ˜¯strï¼Œåœ¨å†…å­˜ä¸­ä»¥Unicodeè¡¨ç¤ºï¼Œä¸€ä¸ªå­—ç¬¦å¯¹åº”è‹¥å¹²ä¸ªå­—èŠ‚ã€‚å¦‚æœè¦åœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œæˆ–è€…ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå°±éœ€è¦æŠŠstrå˜ä¸ºä»¥å­—èŠ‚ä¸ºå•ä½çš„bytesã€‚\nPythonå¯¹bytesç±»å‹çš„æ•°æ®ç”¨å¸¦bå‰ç¼€çš„å•å¼•å·æˆ–åŒå¼•å·è¡¨ç¤ºï¼š\nx = b\u0026#39;ABC\u0026#39; è¦æ³¨æ„åŒºåˆ†'ABC'å’Œb'ABC'ï¼Œå‰è€…æ˜¯strï¼Œåè€…è™½ç„¶å†…å®¹æ˜¾ç¤ºå¾—å’Œå‰è€…ä¸€æ ·ï¼Œä½†bytesçš„æ¯ä¸ªå­—ç¬¦éƒ½åªå ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚\nä»¥Unicodeè¡¨ç¤ºçš„stré€šè¿‡encode()æ–¹æ³•å¯ä»¥ç¼–ç ä¸ºæŒ‡å®šçš„bytesï¼Œä¾‹å¦‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; \u0026#39;ABC\u0026#39;.encode(\u0026#39;ascii\u0026#39;) b\u0026#39;ABC\u0026#39; \u0026gt;\u0026gt;\u0026gt; \u0026#39;ä¸­æ–‡\u0026#39;.encode(\u0026#39;utf-8\u0026#39;) b\u0026#39;\\xe4\\xb8\\xad\\xe6\\x96\\x87\u0026#39; \u0026gt;\u0026gt;\u0026gt; \u0026#39;ä¸­æ–‡\u0026#39;.encode(\u0026#39;ascii\u0026#39;) Traceback (most recent call last): File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; UnicodeEncodeError: \u0026#39;ascii\u0026#39; codec can\u0026#39;t encode characters in position 0-1: ordinal not in range(128) çº¯è‹±æ–‡çš„strå¯ä»¥ç”¨ASCIIç¼–ç ä¸ºbytesï¼Œå†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œå«æœ‰ä¸­æ–‡çš„strå¯ä»¥ç”¨UTF-8ç¼–ç ä¸ºbytesã€‚å«æœ‰ä¸­æ–‡çš„stræ— æ³•ç”¨ASCIIç¼–ç ï¼Œå› ä¸ºä¸­æ–‡ç¼–ç çš„èŒƒå›´è¶…è¿‡äº†ASCIIç¼–ç çš„èŒƒå›´ï¼ŒPythonä¼šæŠ¥é”™ã€‚\nåœ¨bytesä¸­ï¼Œæ— æ³•æ˜¾ç¤ºä¸ºASCIIå­—ç¬¦çš„å­—èŠ‚ï¼Œç”¨\\x##æ˜¾ç¤ºã€‚\nåè¿‡æ¥ï¼Œå¦‚æœæˆ‘ä»¬ä»ç½‘ç»œæˆ–ç£ç›˜ä¸Šè¯»å–äº†å­—èŠ‚æµï¼Œé‚£ä¹ˆè¯»åˆ°çš„æ•°æ®å°±æ˜¯bytesã€‚è¦æŠŠbyteså˜ä¸ºstrï¼Œå°±éœ€è¦ç”¨decode()æ–¹æ³•ï¼š\n\u0026gt;\u0026gt;\u0026gt; b\u0026#39;ABC\u0026#39;.decode(\u0026#39;ascii\u0026#39;) \u0026#39;ABC\u0026#39; \u0026gt;\u0026gt;\u0026gt; b\u0026#39;\\xe4\\xb8\\xad\\xe6\\x96\\x87\u0026#39;.decode(\u0026#39;utf-8\u0026#39;) \u0026#39;ä¸­æ–‡\u0026#39; è¦è®¡ç®—stråŒ…å«å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå¯ä»¥ç”¨len()å‡½æ•°ï¼š\n\u0026gt;\u0026gt;\u0026gt; len(\u0026#39;ABC\u0026#39;) 3 \u0026gt;\u0026gt;\u0026gt; len(\u0026#39;ä¸­æ–‡\u0026#39;) 2 len()å‡½æ•°è®¡ç®—çš„æ˜¯strçš„å­—ç¬¦æ•°ï¼Œå¦‚æœæ¢æˆbytesï¼Œlen()å‡½æ•°å°±è®¡ç®—å­—èŠ‚æ•°ï¼š\n\u0026gt;\u0026gt;\u0026gt; len(b\u0026#39;ABC\u0026#39;) 3 \u0026gt;\u0026gt;\u0026gt; len(b\u0026#39;\\xe4\\xb8\\xad\\xe6\\x96\\x87\u0026#39;) 6 \u0026gt;\u0026gt;\u0026gt; len(\u0026#39;ä¸­æ–‡\u0026#39;.encode(\u0026#39;utf-8\u0026#39;)) 6 å¯è§ï¼Œ1ä¸ªä¸­æ–‡å­—ç¬¦ç»è¿‡UTF-8ç¼–ç åé€šå¸¸ä¼šå ç”¨3ä¸ªå­—èŠ‚ï¼Œè€Œ1ä¸ªè‹±æ–‡å­—ç¬¦åªå ç”¨1ä¸ªå­—èŠ‚ã€‚\nåœ¨æ“ä½œå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°strå’Œbytesçš„äº’ç›¸è½¬æ¢ã€‚ä¸ºäº†é¿å…ä¹±ç é—®é¢˜ï¼Œåº”å½“å§‹ç»ˆåšæŒä½¿ç”¨UTF-8ç¼–ç å¯¹strå’Œbytesè¿›è¡Œè½¬æ¢ã€‚\nç”±äºPythonæºä»£ç ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œå½“ä½ çš„æºä»£ç ä¸­åŒ…å«ä¸­æ–‡çš„æ—¶å€™ï¼Œåœ¨ä¿å­˜æºä»£ç æ—¶ï¼Œå°±éœ€è¦åŠ¡å¿…æŒ‡å®šä¿å­˜ä¸ºUTF-8ç¼–ç ã€‚å½“Pythonè§£é‡Šå™¨è¯»å–æºä»£ç æ—¶ï¼Œä¸ºäº†è®©å®ƒæŒ‰UTF-8ç¼–ç è¯»å–ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨æ–‡ä»¶å¼€å¤´å†™ä¸Šè¿™ä¸¤è¡Œï¼š\n#!/usr/bin/env python3 # -*- coding: utf-8 -*- ç¬¬ä¸€è¡Œæ³¨é‡Šæ˜¯ä¸ºäº†å‘Šè¯‰Linux/OS Xç³»ç»Ÿï¼Œè¿™æ˜¯ä¸€ä¸ªPythonå¯æ‰§è¡Œç¨‹åºï¼ŒWindowsç³»ç»Ÿä¼šå¿½ç•¥è¿™ä¸ªæ³¨é‡Šï¼›\nç¬¬äºŒè¡Œæ³¨é‡Šæ˜¯ä¸ºäº†å‘Šè¯‰Pythonè§£é‡Šå™¨ï¼ŒæŒ‰ç…§UTF-8ç¼–ç è¯»å–æºä»£ç ï¼Œå¦åˆ™ï¼Œä½ åœ¨æºä»£ç ä¸­å†™çš„ä¸­æ–‡è¾“å‡ºå¯èƒ½ä¼šæœ‰ä¹±ç ã€‚\nç”³æ˜äº†UTF-8ç¼–ç å¹¶ä¸æ„å‘³ç€ä½ çš„.pyæ–‡ä»¶å°±æ˜¯UTF-8ç¼–ç çš„ï¼Œå¿…é¡»å¹¶ä¸”è¦ç¡®ä¿æ–‡æœ¬ç¼–è¾‘å™¨æ­£åœ¨ä½¿ç”¨UTF-8 without BOMç¼–ç ï¼š\nå¦‚æœ.pyæ–‡ä»¶æœ¬èº«ä½¿ç”¨UTF-8ç¼–ç ï¼Œå¹¶ä¸”ä¹Ÿç”³æ˜äº†# -*- coding: utf-8 -*-ï¼Œæ‰“å¼€å‘½ä»¤æç¤ºç¬¦æµ‹è¯•å°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡ï¼š\n","date":"2017-09-05T00:00:00Z","permalink":"/posts/2017/09/2017-09-05-%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E7%BC%96%E7%A0%81/","title":"(è½¬)å­—ç¬¦ä¸²å’Œç¼–ç "},{"content":"ç”±äºè¿‘æ¥åœ¨å­¦è‹±è¯­ï¼Œéœ€è¦èƒŒè‹±è¯­å•è¯ã€‚ä½†ç½‘ä¸ŠèƒŒè‹±è¯­å•è¯çš„ç½‘ç«™å¥½åƒä¸èŠ±é’±éƒ½ä¸æ”¯æŒè‡ªå»ºè¯åº“ï¼Œæ‰€ä»¥å°±é¡ºæ‰‹è‡ªå·±å†™äº†ä¸€ä¸ªç®€å•è€Œæ”¯æŒè‡ªå»ºè¯åº“çš„èƒŒè‹±è¯­å•è¯ç½‘ç«™ï¼Œè‡ªç”¨ã€‚(www.calmkart.com/learn)\né¦–å…ˆéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯è‹±è¯­å•è¯çš„ç¿»è¯‘è¿‡ç¨‹ï¼Œæˆ‘çš„ç¬¬ä¸€ååº”æ˜¯è€ƒè™‘ç”¨GOOGLEç¿»è¯‘çš„APIï¼Œä½†æ˜¯ç»è¿‡æŸ¥è¯¢ï¼Œéœ€è¦æ”¶è´¹ï¼Œå›½å†…çš„å¤§å¤šåœ¨çº¿ç¿»è¯‘çš„APIä¸€èˆ¬ä¹Ÿéƒ½æ˜¯è¦æ”¶è´¹çš„ã€‚ ç„¶åå¼€å§‹è€ƒè™‘ç”¨çˆ¬ç½‘é¡µçš„æ–¹å¼å»åšï¼Œä½†å› ä¸ºGOOGLEæœ‰è‡ªå·±çš„é˜²çˆ¬æœºåˆ¶(token)ï¼Œé€šè¿‡æœ¬åœ°è®¡ç®—åå†çˆ¬ç½‘é¡µçš„è¯ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œæµªè´¹æ—¶é—´ã€‚ æ‰€ä»¥æœ€åé‡‡å–äº†ä½¿ç”¨æœ¬åœ°è¯å…¸æ•°æ®åº“çš„æ–¹æ³•æ¥åšç¿»è¯‘ã€‚\næœ€å¤æ‚çš„åœ°æ–¹æ˜¯PYTHONä¸­å­—ç¬¦ç¼–ç çš„é—®é¢˜ï¼Œéœ€è¦å¾ˆå¤šæ¬¡æ— è°“ENCODEå’ŒDECODEï¼Œäºæ˜¯æˆ‘é‡‡ç”¨äº†æœ€ç®€å•çš„æ–¹æ³•ï¼Œå®Œå…¨æ”¾å¼ƒä½¿ç”¨python2.7ï¼Œè€Œç›´æ¥é‡‡ç”¨python3.6ï¼Œå¾ˆå¥½çš„è§£å†³äº†å­—ç¬¦ç¼–ç çš„é—®é¢˜ã€‚å‰©ä¸‹çš„åç«¯çš„ä¸œè¥¿éƒ½æ¯”è¾ƒç®€å•ï¼Œæ— éä¸Šä¼ æŸ¥æ‰¾ç¿»è¯‘ç­‰ç­‰ï¼Œè§åæ–‡çš„ä»£ç åœ°å€ã€‚\nä¸»è¦é¡µé¢åŠŸèƒ½å¦‚ä¸‹ï¼š å‰åç«¯æ•°æ®äº¤äº’é‡‡ç”¨äº†ç”±åç«¯æ¸²æŸ“çš„æ–¹å¼ï¼Œç”¨äº†flaskçš„jinja2æ¨¡æ¿ã€‚\nè¿™é‡Œé‡‡ç”¨jinja2æ¨¡æ¿æ¸²æŸ“ä¹‹ååˆä¸€ä¸ªå¯ä»¥è€ƒè™‘çš„åœ°æ–¹ï¼Œæ˜¯ç”¨æˆ·æ¯æ¬¡åˆ‡æ¢ä¸€ä¸ªå•è¯å°±å»æœåŠ¡å™¨æŸ¥è¯¢ä¸€æ¬¡ç»“æœè¿˜æ˜¯æœåŠ¡å™¨ç›´æ¥æŸ¥è¯¢å‡ºè¯¥ç”¨æˆ·å­—å…¸æ‰€æœ‰å•è¯ç»“æœç›´æ¥ä¼ ç»™ç”¨æˆ·ï¼Œç”¨æˆ·åˆ‡è¯ç­‰äºå®Œå…¨åœ¨æœ¬åœ°é€šè¿‡JSæ“ä½œï¼Œå’ŒæœåŠ¡å™¨å®Œå…¨è„±ç¦»å…³ç³»ã€‚ åœ¨è¿™é‡Œé‡‡ç”¨äº†åä¸€ç§æ–¹å¼ï¼Œç›´æ¥æŠŠç”¨æˆ·è¯å…¸çš„æ‰€æœ‰ç¿»è¯‘ç»“æœä¼ ç»™å®¢æˆ·ç«¯ï¼Œç„¶åç”¨æˆ·åˆ‡è¯å®Œå…¨ä¾é JSæ“ä½œï¼Œä¸éœ€è¦å†å»æœåŠ¡å™¨åšæŸ¥è¯¢ï¼Œè¿™æ ·åº”è¯¥æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œè€Œä¸”ä¹Ÿèƒ½ç»™æœåŠ¡å™¨å‡è½»è´Ÿæ‹…ã€‚\nå‰ç«¯æ˜¯é‡‡ç”¨äº†bootstrapæ¡†æ¶ï¼Œbootstrapçš„å¸ƒå±€æ˜¯åˆ†æˆ12æ ¼ï¼ŒæŒºå¥½ç”¨çš„ã€‚\né¡¹ç›®åœ°å€ï¼šwww.calmkart.com/learn\nä»£ç å·²ä¸Šä¼ github,åœ°å€ï¼š\nhttps://github.com/calmkart/learn_english\nè‡ªè¡Œä½¿ç”¨æ—¶è¯·å…ˆä¿®æ”¹settingæ–‡ä»¶ä¸­çš„è·¯å¾„ï¼Œç”¨äºä¸æœ¬åœ°åŒ¹é…ã€‚\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\néƒ­æ˜Šæ—» (2017-09-08 15:54) æˆ‘æ—¥ï¼Œè¿™ä¸ªåŠŸèƒ½å±Œï¼Œå¼ºæ— æ•Œï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„è‹±è¯­äº†ã€‚ ","date":"2017-09-04T00:00:00Z","permalink":"/posts/2017/09/2017-09-04-%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%94%AF%E6%8C%81%E8%87%AA%E5%BB%BA%E8%AF%8D%E5%BA%93%E7%9A%84%E8%83%8C%E8%8B%B1%E8%AF%AD%E5%8D%95%E8%AF%8D%E7%BD%91%E7%AB%99/","title":"ä¸€ä¸ªç®€å•çš„ï¼Œæ”¯æŒè‡ªå»ºè¯åº“çš„èƒŒè‹±è¯­å•è¯ç½‘ç«™"},{"content":"æœ€å¸¸ç”¨åˆ°çš„ç¼–è¾‘å™¨VIMï¼Œè®°å½•ä¸€ä¸‹è‡ªç”¨ç®€æ˜“é…ç½®æ–¹å¼ï¼Œæ–¹ä¾¿éœ€è¦çš„æ—¶å€™ä½¿ç”¨ã€‚\ncd ./.vimrc ./.vimrc\n\u0026#34;å»æ‰viçš„ä¸€è‡´æ€§\u0026#34; set nocompatible \u0026#34; éšè—æ»šåŠ¨æ¡\u0026#34; set guioptions-=r set guioptions-=L set guioptions-=b \u0026#34;éšè—é¡¶éƒ¨æ ‡ç­¾æ \u0026#34; set showtabline=0 \u0026#34;è®¾ç½®å­—ä½“\u0026#34; set guifont=Monaco:h13 syntax on \u0026#34;å¼€å¯è¯­æ³•é«˜äº®\u0026#34; set background=dark \u0026#34;è®¾ç½®èƒŒæ™¯è‰²\u0026#34; set fileformat=unix \u0026#34;è®¾ç½®ä»¥unixçš„æ ¼å¼ä¿å­˜æ–‡ä»¶\u0026#34; set tabstop=4 \u0026#34;è®¾ç½®tableé•¿åº¦\u0026#34; set shiftwidth=4 \u0026#34;åŒä¸Š\u0026#34; set showmatch \u0026#34;æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·\u0026#34; set scrolloff=5 \u0026#34;è·ç¦»é¡¶éƒ¨å’Œåº•éƒ¨5è¡Œ\u0026#34; set laststatus=2 \u0026#34;å‘½ä»¤è¡Œä¸ºä¸¤è¡Œ\u0026#34; set fenc=utf-8 \u0026#34;æ–‡ä»¶ç¼–ç \u0026#34; set backspace=2 set mouse=n \u0026#34;å¯ç”¨é¼ æ ‡\u0026#34; set selection=exclusive set selectmode=mouse,key set matchtime=5 set ignorecase \u0026#34;å¿½ç•¥å¤§å°å†™\u0026#34; set incsearch set hlsearch \u0026#34;é«˜äº®æœç´¢é¡¹\u0026#34; set expandtab \u0026#34;ä¸å…è®¸æ‰©å±•table\u0026#34; set autoread set list set listchars=tab:\u0026gt;- set nu map :w:!python % set rtp+=~/.vim/bundle/Vundle.vim call vundle#begin() Plugin \u0026#39;VundleVim/Vundle.vim\u0026#39; Plugin \u0026#39;vim-airline/vim-airline\u0026#39; call vundle#end() let g:airline_powerline_fonts = 1 ç„¶åå®‰è£…æ’ä»¶ è¿™é‡Œä¸»è¦å®‰è£…Vundleç®¡ç†æ’ä»¶ä»¥åŠç•Œé¢ç¾åŒ–æ’ä»¶vim-airline\n1.å®‰è£…Vundle\ngit clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim VIMä¸‹è¿è¡Œ :BundleInstall è¿›è¡Œå®‰è£…æ’ä»¶ :BundleClean å¸è½½æ²¡æœ‰å†™åœ¨./.vimrcä¸­çš„æ’ä»¶\n2.å®‰è£…vim-airline Plugin \u0026lsquo;vim-airline/vim-airline\u0026rsquo; æ—¢å¯\né…ç½®å·²ä¸Šä¼ github: https://github.com/calmkart/vim_config\n","date":"2017-08-24T00:00:00Z","permalink":"/posts/2017/08/2017-08-24-%E8%87%AA%E7%94%A8%E7%AE%80%E6%98%93vim%E9%85%8D%E7%BD%AE/","title":"è‡ªç”¨ç®€æ˜“VIMé…ç½®"},{"content":"å› zabbixå¯èƒ½åŒä¸€æ®µæ—¶é—´æŠ¥è­¦è¿‡å¤šï¼Œæ¥å—æ¶ˆæ¯æ—¶å¦‚æœä¸åšæ”¶æ•›å¯èƒ½å‡ºé”™ä¹Ÿä¸å®¹æ˜“å®¡æŸ¥ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæŠ¥è­¦æ”¶æ•›æœºåˆ¶ã€‚\nå®éªŒç¯å¢ƒåˆ†ä¸ºserverç«¯ä¸clientç«¯ï¼š serverç«¯æ¨¡æ‹Ÿæ”¶æ•›ç¨‹åºé€šè¿‡TCP SOCKETè¿æ¥æ¥å—zabbixæŠ¥è­¦ï¼Œåšæ”¶æ•›å¤„ç†å¹¶å‘é€ï¼› clientç«¯æ¨¡æ‹ŸzabbixæŠ¥è­¦ç¨‹åºï¼Œé€šè¿‡TCP SOCKETè¿æ¥å‘é€æ¨¡æ‹Ÿçš„zabbixæŠ¥è­¦ç»™server;\nserverç«¯ç¨‹åºå¦‚ä¸‹ï¼š\n# -*- coding:utf-8 -*- from threading import Timer import urllib2 import socket import threading import re #event_listä¸ºæ”¶æ•›ç±»å‹æ•°ç›®åˆ—è¡¨ #ip_listä¸ºIPæ”¶æ•›å­—å…¸åˆ—è¡¨ #summaryä¸ºæ”¶æ•›ç±»å‹è¯´æ˜åˆ—è¡¨ #keywä¸ºæ­£åˆ™åŒ¹é…å…ƒç´  class convergence(object): event_list = [0,0,0,0] summary = [\u0026#39;è·å–uptimeæ—¶é—´å¤±è´¥\u0026#39;,\u0026#39;SNMP_cant_respond_for_5minutesé”™è¯¯\u0026#39;,\u0026#39;OKé”™è¯¯\u0026#39;,\u0026#39;æµé‡é€Ÿç‡å¼‚å¸¸é”™è¯¯\u0026#39;] ip_list = [{},{},{},{}] keyw = [\u0026#39;è·å–uptimeæ—¶é—´å¤±è´¥\u0026#39;,\u0026#39;SNMPcan\\\u0026#39;trespondfor5minutes\u0026#39;,\u0026#39;ok\u0026#39;,\u0026#39;æµé‡é€Ÿåº¦å¼‚å¸¸\u0026#39;] t = None def convergence(self,event): temp = self.keyword(event) ip = self.findip(event) if temp != 0: #åšæŠ¥è­¦IPæ”¶æ•› if self.ip_list[temp-1].has_key(ip): self.ip_list[temp-1][ip] = self.ip_list[temp-1][ip]+1 else: self.ip_list[temp-1][ip] = 1 #åšæŠ¥è­¦æ¡ç›®æ”¶æ•› self.event_list[temp-1] = self.event_list[temp-1]+1 if self.t == None: self.timer(event) else: pass else: #æŒ‰åŸæ ¼å¼å‘é€ print event pass def send(self,event): print \u0026#39;ç›®å‰çš„ç¼“å­˜åŒºä¸º\u0026#39;+str(self.event_list) if max(self.event_list) == 0: pass else: for i in range(0,len(event_list)): if self.event_list[i]==0: pass else:#å‘é€æ”¶æ•›åçš„æŠ¥è­¦åˆ°æŒ‡å®šä½ç½® content = str(event_list[i]+\u0026#39;æ¬¡\u0026#39;+self.summary[i]+\u0026#39;(å‰20ç§’å†…)\u0026#39;) self.event_list[i] = 0 self.t = None urllib2.urlopen(\u0026#39;http://www.calmkart.com\u0026#39;) print content def timer(self,event):#å¯åŠ¨å®šæ—¶å™¨ self.t = Timer(20,self.send,args=[event]) self.t.start() def keyword(self,event): for i in range(0,len(self.keyw)): if re.search(self.keyw[i],event,flags=re.IGNORECASE) != None: return i+1 return 0 def findip(self,event): m = re.search(r\u0026#39;(?\u0026lt;![\\.\\d])(?:\\d{1,3}\\.){3}\\d{1,3}(?![\\.\\d])\u0026#39;,event) if m is not None: ip = m.group() return str(ip) return \u0026#39;æŸ¥ä¸åˆ°IP\u0026#39; test = convergence() #tcpæµ‹è¯•,serverç«¯ï¼Œæ¥æ”¶ host = \u0026#39;0.0.0.0\u0026#39; port = 9001 s = socket.socket() s.bind((host,port)) s.listen(5) while True: c,addr = s.accept() data = c.recv(1024) test.convergence(data) ##udpæµ‹è¯•,serverç«¯ï¼Œæ¥æ”¶ #s= socket.socket(socket.AF_INET, socket.SOCK_DGRAM) #host = \u0026#39;10.17.16.207\u0026#39; #port = 9001 #s.bind((host,port)) # #while True: #\tdata,addr = s.recvfrom(2048) #\ttest.convergence(data) clentç«¯ç¨‹åºå¦‚ä¸‹ï¼š\n# --- coding:utf-8 --- import random from multiprocessing.connection import Client str1 = [ \u0026#39;192.168.0.1SNMPé”™è¯¯\u0026#39;, \u0026#39;192.168.0.2SNMPé”™è¯¯\u0026#39;, \u0026#39;192.168.0.100,OK\u0026#39;, \u0026#39;192.168.0.101,ok\u0026#39;, \u0026#39;192.168.0.102,æµé‡é€Ÿç‡å¼‚å¸¸\u0026#39;, \u0026#39;192.168.0.103,æµé‡é€Ÿç‡å¼‚å¸¸\u0026#39;, \u0026#39;192.168.0.104,è·å–uptimeæ—¶é—´å¤±è´¥\u0026#39;, \u0026#39;192.168.0.105,è·å–uptimeæ—¶é—´å¤±è´¥\u0026#39; ] address = (\u0026#39;0.0.0.0\u0026#39;,9001) for i in range(0,1000): m = str1[random.randrange(0,11)] conn = Client(address) conn.send(m) conn.close ä¸»è¦ç”¨åˆ°çš„å·¥å…·æ˜¯æ­£åˆ™è¡¨è¾¾å¼åšåŒ¹é…\nä»£ç å·²ä¸Šä¼ è‡³github,åœ°å€ https://github.com/calmkart/Zabbix_convergence\nå†å²è¯„è®º (1 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\næˆ‘æœ‰ä¸€ä¸ªå¯çˆ±çš„å°æ¤°å­ (2017-08-29 20:39) å‰å®³äº†ï¼Œè¿‡æ¥å­¦ä¹ ä¸€ä¸‹ ","date":"2017-08-23T00:00:00Z","permalink":"/posts/2017/08/2017-08-23-zabbix%E6%8A%A5%E8%AD%A6%E6%94%B6%E6%95%9B/","title":"zabbixæŠ¥è­¦æ”¶æ•›"},{"content":"å› ä¸ºwindowsæœ¬èº«æ˜¯ä¸æ”¯æŒsnmp v3çš„ï¼Œæ‰€ä»¥éœ€è¦ç¬¬ä¸‰æ–¹å·¥å…·çš„å¸®åŠ© è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¸¸ç”¨çš„net-snmp\næ­¥éª¤ï¼š 1.å…³é—­æœ¬ç³»ç»Ÿä¸­çš„SNMPæœåŠ¡\n2.å®‰è£…vc x64åº“\n3.å®‰è£…openssl x64ç‰ˆæœ¬(æœ€æ–°ç‰ˆæœ¬)\n4.è§£å‹openssl 0.9.8zf x64ç‰ˆï¼Œå°†ssleay32.dllå’Œlibeay32.dllå¤åˆ¶è¿›c:/windows/system32å’Œc:/windows/syswow64 é‡Œï¼Œæ›¿æ¢åŸæ–‡ä»¶\n5.å®‰è£…net-snmp-5.5.0-2.x64ç‰ˆæœ¬çš„net-snmpï¼Œè®°å¾—å‹¾é€‰with windows extension dll supportå’Œencryption support(openssl)é€‰é¡¹(WINDOWS DLLå¯ä»¥å¼€å¯ä¸€äº›ä¸èƒ½ä½¿ç”¨çš„åŠŸèƒ½ï¼Œencrytion supportæ‰å¯ä»¥å¼€å¯ç™»å½•ä¸”éªŒè¯çš„SNMP V3åŠŸèƒ½)\n6.å®‰è£…activeperlï¼Œé»˜è®¤å®‰è£…æ—¢å¯\n7.è¿è¡Œc:/usr/registeragent.bat æŠŠSNMP V3æœåŠ¡è¿›è¡Œæ³¨å†Œ\n8.ç¼–å†™ c:\\usr\\etc\\snmp\\snmpd.conf é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ç”¨çš„é…ç½®å¦‚ä¸‹ï¼ˆç»†èŠ‚ä¸èµ˜è¿°ï¼‰\nagentAddress udp:0.0.0.0:161 createUser authPrivUser SHA \u0026#34;passwordauthprivuser\u0026#34; DES # Full read-only access for SNMPv3 # Full write access for encrypted requests # Remember to activate the \u0026#39;createUser\u0026#39; lines above rouser authPrivUser priv sysLocation Sitting on the Dock of the Bay sysContact Me \u0026lt;me@example.org\u0026gt; # Application + End-to-End layers sysServices 72 # At least one \u0026#39;mountd\u0026#39; process proc mountd # No more than 4 \u0026#39;ntalkd\u0026#39; processes - 0 is OK proc ntalkd 4 # At least one \u0026#39;sendmail\u0026#39; process, but no more than 10 proc sendmail 10 1 # 10MBs required on root disk, 5% free on /var, 10% free on all other disks #disk / 10000 #disk /var 5% #includeAllDisks 10% # Unacceptable 1-, 5-, and 15-minute load averages load 12 10 5 # send SNMPv2c traps # send SNMPv2c INFORMs # Remember to activate the \u0026#39;createUser\u0026#39; lines above iquerySecName internalUser rouser internalUser # generate traps on UCD error conditions defaultMonitors yes # generate traps on linkUp/Down linkUpDownNotifications yes # Run as an AgentX master agent master agentx # Listen for network connections (from localhost) # rather than the default named socket /var/agentx/master æµ‹è¯•ï¼š snmp v3 å®‰å…¨çº§åˆ«æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«ä¸º noAuthNoPrivï¼ˆä¸è®¤è¯ä¹Ÿä¸åŠ å¯†ï¼‰ã€authNoPrivï¼ˆè®¤è¯ä½†æ˜¯ä¸åŠ å¯†ï¼‰ã€ authPrivï¼ˆæ—¢è®¤è¯åˆåŠ å¯†ï¼‰\nå¸¸è§çš„ SNMP OIDåˆ—è¡¨ ç›‘æ§éœ€è¦ç”¨åˆ°çš„OIDå¦‚ä¸‹è¿æ¥:\nhttp://www.ttlsa.com/monitor/snmp-oid/\næœ¬æ¬¡æ•´ä¸ªé…ç½®è¿‡ç¨‹æ‰€æœ‰ç¨‹åºå®‰è£…åŒ…åœ¨æ­¤ä¸‹è½½:\nhttp://www.calmkart.com/snmp_v3_allinone.rar\nå†å²è¯„è®º (3 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nåä¸ºè°¢çš„æ€» (2017-08-14 16:53) å½­æ€»666 é—¨é¢ã®éœ¸ (2017-08-15 11:54) å½­æ€»åŠç‚¸å¤© Ares (2020-03-16 09:43) è°¢è°¢å•Šåªä¸è¿‡æ‰¾åˆ°çš„æœ‰ç‚¹è¿Ÿäº†ï¼Œå‚è€ƒäº†è¿™ä¸ªhttps://syesilbulut.blogspot.com/2015/04/net-snmp-step-by-step-installation.html æå®Œäº†å‘ç°ä½ è¿™ä¸ªäº† å®Œäº†é‡æ–°å®‰è£…äº†ä¸€é ","date":"2017-08-10T00:00:00Z","permalink":"/posts/2017/08/2017-08-10-windows%E9%85%8D%E7%BD%AEsnmp-v3%E7%9B%91%E6%8E%A7net-snmp/","title":"windowsé…ç½®snmp v3ç›‘æ§(net-snmp)"},{"content":"åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°éœ€è¦æ‰¹é‡æ“ä½œå¤šå°äº¤æ¢æœºçš„æƒ…å†µã€‚è€Œäº¤æ¢æœºæ™®éæ˜¯é‡‡ç”¨å®šåˆ¶ç³»ç»Ÿï¼Œé»˜è®¤æ˜¯telnetç™»é™†ï¼Œå³ä½¿æ¢æˆsshç™»é™†ä¹Ÿæ— æ³•ä½¿ç”¨ansibleè¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œæ‰€ä»¥é€šè¿‡python telnetlibåº“å®ç°äº†äº¤æ¢æœºçš„æ‰¹é‡ç®¡ç†(äº¤æ¢æœºå‹å·ä¸ºæ€ç§‘2960x)\nå®ç°ä»£ç å¦‚ä¸‹ï¼š switch_telnet.py\n#encoding=utf-8 import sys import telnetlib import time def tel(ip,user,password): tn = telnetlib.Telnet(ip,port=23) tn.read_until(\u0026#39;Verification\\r\\n\\r\\nUsername: \u0026#39;) tn.write(user+\u0026#39;\\n\u0026#39;) # tn.set_debuglevel(2) #password tn.read_until(\u0026#39;Password: \u0026#39;) tn.write(password+\u0026#39;\\n\u0026#39;) #login fail if tn.read_some()==\u0026#39;\\r\\nPassword: \u0026#39;: print \u0026#39;\\033[1;31;40m\u0026#39;+ip+\u0026#39;\\033[0m\u0026#39;+\u0026#39; password is wrong,login false!\u0026#39; tn.close() return 1 #login successs tn.write(\u0026#39;enable\\n\u0026#39;) #password tn.read_until(\u0026#39;Password: \u0026#39;) tn.write(password+\u0026#39;\\n\u0026#39;) #enable susccess set terimal length tn.read_until(\u0026#39;Switch#\u0026#39;) tn.write(\u0026#39;ter len 0\\n\u0026#39;) time.sleep(1) if tn.read_some()==\u0026#39;ter len 0\\r\\nSwitch#\u0026#39;: print ip+\u0026#39; telnet login susccess\u0026#39; return tn print ip+\u0026#39; terminal length 0 false!\u0026#39; return 1 def comm(tn,ip,cmd): tn.write(cmd+\u0026#39;\\n\u0026#39;) time.sleep(.2) result = tn.read_very_eager() print (\u0026#39;\\033[1;31;40m\u0026#39;+ip+\u0026#39;\\033[0m\u0026#39;+\u0026#39; \u0026#39;+result) ip_list = [] user_list = [] password_list = [] tn = [] ip_fp = open(\u0026#39;ip_list\u0026#39;,\u0026#39;r\u0026#39;) ip_fs = ip_fp.read() ip_fp.close() fa = ip_fs.split(\u0026#39;\\n\u0026#39;) for i in range(0,len(fa)-1): f_res = fa[i].split(\u0026#39;,\u0026#39;) ip_list.append(f_res[0]) user_list.append(f_res[1]) password_list.append(f_res[2]) for i in range(0,len(fa)-1): tn.append(tel(ip_list[i],user_list[i],password_list[i])) while 1: cmd = raw_input(\u0026#34;input the command: \u0026#34;) if cmd == \u0026#39;quit\u0026#39;: for i in range(0,len(fa)-1): tn[i].write(\u0026#39;quit\\n\u0026#39;) break for i in range(0,len(fa)-1): comm(tn[i],ip_list[i],cmd+\u0026#39;\\n\u0026#39;) è„šæœ¬è¯¦è§£ï¼š\nä¸»è¦ä½¿ç”¨äº†pythonçš„telnetlibåº“ï¼Œä¸‹é¢æ¦‚è¿°å¸¸è§çš„å‡ ä¸ªæ–¹æ³•ã€‚\ntelnetlib.Telnet([host[, port[, timeout]]]) æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªclientå¯¹è±¡ï¼Œå¯æ“ä½œ\nTelnet.read_until(expected[, timeout]) æ­¤æ–¹æ³•é˜»å¡è¯»å–ç¼“å­˜åŒºè¾“å‡ºï¼ŒåŒ¹é…expectedæ‰ç»§ç»­\nTelnet.read_all() è¯»å–æ‰€æœ‰è¾“å‡ºï¼Œè¯»å–åˆ°ç»“æŸç¬¦æˆ–è€…è¿æ¥ä¸­æ–­\nTelnet.read_some() è¯»å–è‡³å°‘ä¸€ä¸ªè¾“å‡º\nTelnet.read_very_eager() è¯»å–å°½é‡å¤šçš„è¾“å‡ºï¼Œä½†è®°å¾—è¦time.sleep()ä¸€å®šæ—¶é—´ï¼Œä¸ç„¶ä¼šå› ä¸ºæ¥ä¸åŠè¯»å–æ‰€æœ‰æ•°æ®å¯¼è‡´æ•°æ®ä¸¢å¤±\nTelnet.write(buffer) å‘clientå¯¹è±¡å†™å…¥æ•°æ®ï¼Œè®°å¾—æ¢è¡Œç¬¦\\n\nTelnet.close() å…³é—­è¿æ¥\næ“ä½œæŒ‡å—ï¼š\nä½¿ç”¨æ—¶åœ¨åŒè·¯å¾„ä¸‹ç¼–è¾‘ip_listæ–‡ä»¶ï¼Œæ ¼å¼ä¸ºip,username,passwordæ—¢å¯ï¼Œä¸€ä¸ªäº¤æ¢æœºå ä¸€è¡Œï¼Œå¦‚ä¸‹ä¾‹ï¼š\n10.32.19.9,cisco,123456 10.32.19.10,cisco,654321 è¿è¡Œ python ./switch_telnet.py\næ˜¾ç¤ºæ‰€æœ‰äº¤æ¢æœºIPçš„ç™»é™†æƒ…å†µï¼Œç„¶åè¾“å…¥å‘½ä»¤äº¤äº’å³å¯ï¼ˆç±»ä¼¼ansibleï¼‰\nå¯ä»¥éšæ„ä½¿ç”¨exitå‘½ä»¤ï¼Œä½†ç›´æ¥é€€å‡ºè„šæœ¬æŒ‡ä»¤ä¸ºquit\nå…¶ä»–ï¼š\nåŒç±»å¯ç”¨åº“è¿˜æœ‰pexpectï¼Œéå¸¸å¼ºå¤§ å¦‚æœæ˜¯SSHç™»é™†çš„äº¤æ¢æœºï¼Œå¯ä»¥ä½¿ç”¨netmikoï¼Œè¿˜å¯ä»¥ç”¨fabricæ‰¹é‡ç®¡ç†ï¼Œä¸å†èµ˜è¿°\né¡¹ç›®æºç å·²ä¸Šä¼ github https://github.com/calmkart/switch_telnet\n","date":"2017-08-07T00:00:00Z","permalink":"/posts/2017/08/2017-08-07-%E7%94%A8telnetlib%E5%BA%93%E5%AE%9E%E7%8E%B0%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%89%B9%E9%87%8F%E7%AE%A1%E7%90%86/","title":"ç”¨telnetlibåº“å®ç°äº¤æ¢æœºæ‰¹é‡ç®¡ç†"},{"content":"1.éƒ¨ç½²ç¯å¢ƒ æœ¬æ¬¡openstackéƒ¨ç½²ç¯å¢ƒä¸ºä¸‰å°æœåŠ¡å™¨ï¼Œç³»ç»Ÿç»Ÿä¸€ä¸ºubuntu16.04 serverã€‚ä¸‰å°æœåŠ¡å™¨åˆ†åˆ«ä¸ºR730ï¼ŒR720ï¼ŒR710ï¼Œå…¶ä¸­R730ä½œä¸ºæ§åˆ¶èŠ‚ç‚¹+ç½‘ç»œèŠ‚ç‚¹+è®¡ç®—èŠ‚ç‚¹ï¼ŒR710ä¸R720ä½œä¸ºè®¡ç®—èŠ‚ç‚¹ã€‚\néƒ¨ç½²ç¯å¢ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å…¶ä¸­å„æœºå™¨eth1ç½‘å¡ä¸ºç®¡ç†åŠAPIç½‘ç»œï¼ˆåŒæ—¶ä¹Ÿæ˜¯éƒ¨ç½²ä¸ä¸‹è½½ç½‘ç»œï¼‰ï¼Œeth2ç½‘å¡ä¸ºè™šæ‹Ÿæœºå†…éƒ¨ç§Ÿæˆ·ç½‘ç»œï¼Œæ§åˆ¶èŠ‚ç‚¹R730æœåŠ¡å™¨çš„eth2ç½‘å¡ä¸ºç”¨æ¥ä¸Šç½‘çš„å¤–éƒ¨ç½‘ç»œã€‚\nå…¶ä¸­å„èŠ‚ç‚¹å®‰è£…æœåŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š (R730)Devstack-controllerï¼šKeystone,Glance,Cinder,Neutron,Nova\u0026hellip;.. (R720)Devstack-compute-1ï¼šKVM Hypervisor,Nova,Neutron agent\u0026hellip;. (R710)Devstack-compute-2ï¼šKVM Hypervisor,Nova,Neutron agent\u0026hellip;.\n2.æ§åˆ¶èŠ‚ç‚¹ç½‘ç»œæ‹“æ‰‘ å¤–ç½‘ç½‘å¡eth2ç»‘å®šOVSå¤–éƒ¨ç½‘ç»œç½‘æ¡¥Br-exï¼Œå†é€šè¿‡è™šæ‹Ÿè·¯ç”±å™¨è¿æ¥å†…éƒ¨OVSç½‘æ¡¥Br-intä¸Br-exï¼Œå®ç°å†…éƒ¨è™šæ‹Ÿæœºä¸å¤–éƒ¨çš„é€šä¿¡ã€‚ ä½†ç”±äºè™šæ‹Ÿè·¯ç”±é»˜è®¤è‡ªå¸¦DHCPåŠŸèƒ½ï¼Œä¼šæ±¡æŸ“å¤–éƒ¨ç½‘ç»œï¼Œæ‰€ä»¥ç›®å‰çš„åšæ³•æ˜¯å°†è™šæ‹Ÿè·¯ç”±çš„DHCPåŠŸèƒ½å…³é—­ï¼Œä¸ºå†…éƒ¨ä¸€å°è·³æ¿æœºæ‰‹åŠ¨é…ç½®IPï¼Œç„¶åæ‰€æœ‰å†…éƒ¨è™šæ‹Ÿæœºé€šè¿‡æ­¤è·³æ¿æœºè®¿é—®ã€‚\n3.éƒ¨ç½²è¿‡ç¨‹ç»†èŠ‚ 1.ä¸ºå„å°æœåŠ¡å™¨é…ç½®ç½‘å¡å‚æ•° /etc/network/interfaces\nR730ï¼š R720ï¼š R710ï¼š é‡å¯æœºå™¨\n2.é…ç½®devstackç›¸å…³ç¯å¢ƒ 1.é…ç½®ä¸­å›½çš„é•œåƒæº Vi /etc/apt/sources.list\ndeb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse Apt-get update Apt-get upgrade\n2.é…ç½®PIPæº Mkdir /root/.pip\nVi /root/.pip/pip.conf\n[global] timeout = 60 index-url = http://pypi.douban.com/simple trusted-host = pypi.douban.com 3.ä¸‹è½½devstackä»£ç  æœ¬æ¬¡éƒ¨ç½²ä½¿ç”¨çš„openstackæ˜¯newtonç‰ˆæœ¬\ngit clone https://git.openstack.org/openstack-dev/devstack -b stable/newton (ç½‘ç»œæ…¢çš„è¯å¯ä»¥è€ƒè™‘æœ¬æœºä¸‹è½½åSCPåˆ°æœåŠ¡å™¨ä¸Š)\n4.é…ç½®devstackéƒ¨ç½²å®‰è£…ç›¸å…³ç¯å¢ƒ å®‰è£…python-pip Apt-get install python-pip\nåˆ›å»ºstackç”¨æˆ· Devstack/tools/create-stack-user.sh æ·»åŠ æƒé™ Vi /etc/sudoers\n# User privilege specification rootÂ ALL=(ALL:ALL) ALL stackÂ ALL=(ALL:ALL) ALL Chmod 777 /edv/pts/0\nMv devstack /opt/stack/ Chown -R stack:stack /opt/stack/devstack\nåˆ‡æ¢åˆ°stackç”¨æˆ· Su - stack Cd devstack\n5.ç¼–å†™é…ç½®æ–‡ä»¶ Vi local.conf é…ç½®æ–‡ä»¶å¯é€‰å‚æ•°å¤ªå¤šï¼Œä¸å†åˆ—å‡ºï¼Œä¸‹é™„æœ¬æ¬¡éƒ¨ç½²çš„é…ç½®æ–‡ä»¶\nR730(æ§åˆ¶èŠ‚ç‚¹)éƒ¨ç½²æ–‡ä»¶local.conf:\n[[local|localrc]] MULTI_HOST=true # management \u0026amp; api network HOST_IP=10.32.19.1 LOGFILE=/opt/stack/logs/stack.sh.log # Credentials ADMIN_PASSWORD=admin MYSQL_PASSWORD=secret RABBIT_PASSWORD=secret SERVICE_PASSWORD=secret SERVICE_TOKEN=abcdefghijklmnopqrstuvwxyz # enable neutron-ml2-vlan disable_service n-net enable_service q-svc,q-agt,q-dhcp,q-l3,q-meta,neutron,q-lbaas,q-fwaas Q_AGENT=openvswitch ENABLE_TENANT_VLANS=True TENANT_VLAN_RANGE=3001:4000 PHYSICAL_NETWORK=eno2 LOG_COLOR=True LOGDIR=$DEST/logs SCREEN_LOGDIR=$LOGDIR/screen #network FIXED_RANGE=192.168.0.0/24 NETWORK_GATEWAY=192.168.0.1 FLOATING_RANGE=10.32.19.0/22 PUBLIC_NETWORK_GATEWAY=10.32.16.1 Q_FLOATING_ALLOCATION_POOL=start=10.32.19.3,end=10.32.19.10 # use TryStack git mirror GIT_BASE=http://git.trystack.cn NOVNC_REPO=http://git.trystack.cn/kanaka/noVNC.git SPICE_REPO=http://git.trystack.cn/git/spice/spice-html5.git R720(è®¡ç®—èŠ‚ç‚¹)éƒ¨ç½²æ–‡ä»¶local.conf:\n[[local|localrc]] MULTI_HOST=true # management \u0026amp; api network HOST_IP=10.32.19.2 # Credentials ADMIN_PASSWORD=admin MYSQL_PASSWORD=secret RABBIT_PASSWORD=secret SERVICE_PASSWORD=secret SERVICE_TOKEN=abcdefghijklmnopqrstuvwxyz # Service information SERVICE_HOST=10.32.19.1 MYSQL_HOST=$SERVICE_HOST RABBIT_HOST=$SERVICE_HOST GLANCE_HOSTPORT=$SERVICE_HOST:9292 Q_HOST=$SERVICE_HOST KEYSTONE_AUTH_HOST=$SERVICE_HOST KEYSTONE_SERVICE_HOST=$SERVICE_HOST ENABLED_SERVICES=n-cpu,q-agt,neutron,n-api-meta,cinder,c-vol,placement-client Q_AGENT=openvswitch ENABLE_TENANT_VLANS=True TENANT_VLAN_RANGE=3001:4000 PHYSICAL_NETWORK=default # vnc config NOVA_VNC_ENABLED=True NOVNCPROXY_URL=\u0026#34;http://$SERVICE_HOST:6080/vnc_auto.html\u0026#34; VNCSERVER_LISTEN=$HOST_IP VNCSERVER_PROXYCLIENT_ADDRESS=$VNCSERVER_LISTEN LOG_COLOR=True LOGDIR=$DEST/logs SCREEN_LOGDIR=$LOGDIR/screen # use TryStack git mirror GIT_BASE=http://git.trystack.cn NOVNC_REPO=http://git.trystack.cn/kanaka/noVNC.git SPICE_REPO=http://git.trystack.cn/git/spice/spice-html5.git R710(è®¡ç®—èŠ‚ç‚¹)éƒ¨ç½²æ–‡ä»¶local.conf:\n[[local|localrc]] MULTI_HOST=true # management \u0026amp; api network HOST_IP=10.32.19.3 # Credentials ADMIN_PASSWORD=admin MYSQL_PASSWORD=secret RABBIT_PASSWORD=secret SERVICE_PASSWORD=secret SERVICE_TOKEN=abcdefghijklmnopqrstuvwxyz # Service information SERVICE_HOST=10.32.19.1 MYSQL_HOST=$SERVICE_HOST RABBIT_HOST=$SERVICE_HOST GLANCE_HOSTPORT=$SERVICE_HOST:9292 Q_HOST=$SERVICE_HOST KEYSTONE_AUTH_HOST=$SERVICE_HOST KEYSTONE_SERVICE_HOST=$SERVICE_HOST ENABLED_SERVICES=n-cpu,q-agt,neutron,n-api-meta,cinder,c-vol,placement-client Q_AGENT=openvswitch ENABLE_TENANT_VLANS=True TENANT_VLAN_RANGE=3001:4000 PHYSICAL_NETWORK=default # vnc config NOVA_VNC_ENABLED=True NOVNCPROXY_URL=\u0026#34;http://$SERVICE_HOST:6080/vnc_auto.html\u0026#34; VNCSERVER_LISTEN=$HOST_IP VNCSERVER_PROXYCLIENT_ADDRESS=$VNCSERVER_LISTEN LOG_COLOR=True LOGDIR=$DEST/logs SCREEN_LOGDIR=$LOGDIR/screen # use TryStack git mirror GIT_BASE=http://git.trystack.cn NOVNC_REPO=http://git.trystack.cn/kanaka/noVNC.git SPICE_REPO=http://git.trystack.cn/git/spice/spice-html5.git 3.éƒ¨ç½²è¿‡ç¨‹ é¦–å…ˆåœ¨R730æ§åˆ¶èŠ‚ç‚¹è¿è¡Œ ./stack.sh ç­‰å¾…éƒ¨ç½²å®Œæˆï¼Œå·®ä¸å¤š2é’Ÿå¤´å†…å°±ä¼šå®Œæˆ\nç„¶åæŠŠå¤–ç½‘ç½‘å¡eno2ç»‘å®šåˆ°å¤–éƒ¨ç½‘ç»œç½‘æ¡¥br-exä¸Šï¼ŒæŠŠeno2çš„ipäº¤ç»™br-exç½‘æ¡¥ã€‚æ¥ç€æŠŠ/etc/neutron/l3_agent.iniä¸­external_network_bridgeé€‰é¡¹æ”¹ä¸ºbr-exã€‚ åŒæ—¶ï¼Œä¿®æ”¹/etc/neutron/plugins/ml2/ml2_conf.iniæ–‡ä»¶ï¼ŒæŠŠbr-exå¯¹åº”çš„é¡¹ç›®é€‰æ‹©æ­£ç¡®ï¼ŒåŒæ—¶è®°å½•flat_networksçš„åç§°ï¼Œä¸ä¸‹é¢çš„å¤–ç½‘ç½‘æ¡¥å¯¹åº”ï¼Œæ­¤åç§°å³ä¸ºhorizonä¸­FLATç½‘ç»œç±»å‹çš„ç‰©ç†ç½‘ç»œåç§°ï¼Œä¸€å®šä¸å¯å¡«é”™ã€‚æœ€åé€šè¿‡screen -x stackè¿›å…¥neutronæœåŠ¡ï¼Œé‡å¯ä¹‹ï¼Œå³å¯ã€‚\nç„¶ååœ¨R710å’ŒR720è®¡ç®—èŠ‚ç‚¹è¿è¡Œ ./stack.sh æ—¢å¯ï¼ˆè®¡ç®—èŠ‚ç‚¹éƒ¨ç½²æ—¶é—´åœ¨30åˆ†é’Ÿä»¥å†…ï¼Œå¯éšæ—¶æŒ‰ä¸Šè¿°æ“ä½œæ­¥éª¤æ–°å¢è®¡ç®—èŠ‚ç‚¹ï¼‰\n4.å…¶ä»–æ‚é¡¹ 1.éƒ¨ç½²è¿‡ç¨‹ä¸­å‡ºé”™çš„è§£å†³æ–¹æ¡ˆ é¦–å…ˆæŸ¥çœ‹é”™è¯¯ç±»å‹ï¼Œå¸¸è§çš„é”™è¯¯æ˜¯ç½‘ç»œé—®é¢˜å¯¼è‡´ä¸‹è½½å¤±è´¥ ç„¶åè¿è¡Œ ./unstack.sh è§£é™¤å®‰è£…\nå†è¿è¡Œ ./clean.sh æ¸…ç†ç¯å¢ƒ\nç„¶åé‡è¯•å®‰è£…ï¼Œå¦‚æœè¿˜æ˜¯å‡ºBUGçš„è¯ï¼Œåˆ é™¤/opt/stack/ç›®å½•ï¼Œåˆ é™¤stackç”¨æˆ·ï¼Œé‡æ–°git cloneä¸€ä¸ªdevstackåŒ…ï¼Œåˆ›å»ºstackç”¨æˆ·è¿›è¡Œå®‰è£…(è®°å¾—æŸ¥çœ‹python-pipæœ‰æ— å®‰è£…ï¼Œæ²¡æœ‰å®‰è£…ä¸€å®šè¦å…ˆå®‰è£…å¥½)\n2.æ›´æ”¹devstackéƒ¨ç½²é…ç½®local.conf ç›´æ¥./unstack.shç„¶å./stack.shé‡æ–°éƒ¨ç½²æ—¢å¯ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œ10åˆ†é’Ÿå†…å°±ä¼šé‡æ–°éƒ¨ç½²å®Œæˆ\n3.é‡å¯æœåŠ¡å™¨å¯¼è‡´æ‰€æœ‰æœåŠ¡å…¨éƒ¨å®•æœº ç›´æ¥./unstack.shç„¶å./stack.shé‡æ–°éƒ¨ç½²æ—¢å¯ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œ10åˆ†é’Ÿå†…å°±ä¼šé‡æ–°éƒ¨ç½²å®Œæˆ\n4.è°ƒè¯•openstackå„æ¨¡å—å‚æ•°åé‡å¯æœåŠ¡ ä½¿ç”¨screené‡å¯æœåŠ¡ï¼Œåˆ‡æ¢åˆ°stackç”¨æˆ· è¿è¡Œ screen - x stackï¼ˆæˆ–æŸ¥æ‰¾screenç¼–å·ï¼‰ é€šè¿‡ctrl+a+pÂ ctrl+a+n åˆ‡æ¢openstackæœåŠ¡ é€šè¿‡ctrl+c ä¸­æ–­æœåŠ¡ï¼Œç„¶ååœ¨å¯¹åº”çš„çª—å£æŒ‰ â†‘ å›è½¦ é‡å¯æœåŠ¡\n5.ä½¿ç”¨ä¸äº†openstackå‘½ä»¤API é¦–å…ˆsource openrc admin admin\n6.å¸Œæœ›æŒ‡å®šç”±å…·ä½“å“ªå°æœåŠ¡å™¨åˆ›å»ºè™šæ‹Ÿæœº åˆ›å»ºZoneå’ŒAggreateï¼ˆä»¥R730ä¸ºä¾‹ï¼‰ Source openrc admin admin Nova aggregate-create 3 3 æŠŠå¯¹åº”çš„æœåŠ¡å™¨åˆ†é…è¿›zoneé‡Œ Nova aggregate-add-host 3 R730 æŸ¥çœ‹ zoneä¿¡æ¯ Nova service-list å¦‚ä¸Šæ–¹æ³•å§R710å’ŒR720åˆ†è¿›ä¸åŒzone\nå†è¿›å…¥horizonåˆ›å»ºè™šæ‹Ÿæœºç•Œé¢ï¼Œå°±ä¼šæœ‰åŸŸé€‰æ‹© é€‰æ‹©1å°±ä»710åˆ›å»ºï¼Œé€‰æ‹©2ä»720åˆ›å»ºï¼Œé€‰æ‹©3ä»730åˆ›å»ºã€‚\n7.è§£å†³devstackéƒ¨ç½²openstacké»˜è®¤é…é¢é—®é¢˜ å¯ç›´æ¥ä¿®æ”¹/etc/nova/nova.confé…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤é€‰æ‹©ï¼ˆå¦‚ quota_instances=10ï¼‰ï¼Œç„¶åé‡å¯novaæœåŠ¡ ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ source openrc admin admin æŸ¥çœ‹ç§Ÿæˆ·é…é¢ Nova quota-defaults \u0026ndash;tenant ç§Ÿæˆ·å æ”¹å˜ç§Ÿæˆ·é…é¢(ä¸¾ä¾‹æ”¹å˜å®ä¾‹æ•°é‡) Nova quota-update \u0026ndash;instance 999 ç§Ÿæˆ·å\nå†å²è¯„è®º (2 æ¡) ä»¥ä¸‹è¯„è®ºæ¥è‡ªåŸ WordPress ç«™ç‚¹ï¼Œä»…ä½œå­˜æ¡£å±•ç¤ºã€‚\nwhut_wu (2017-08-15 17:19) åšä¸»ä½ å¥½ï¼Œæ„Ÿè§‰ä½ çš„åšå®¢è®¿é—®é€Ÿåº¦å¾ˆå¿«ï¼Œå»¶æ—¶ä¹Ÿä¸‹ï¼Œè¯·é—®æ˜¯è‡ªå·±æ­å»ºçš„æœåŠ¡å™¨è¿˜æ˜¯ä¹°çš„è™šæ‹Ÿä¸»æœºå•Šï¼Ÿèƒ½æ¨èä¸€ä¸‹ä¹°çš„å“ªå®¶å—ï¼Œè°¢è°¢ calmkart (2017-08-16 09:31) æˆ‘åœ¨ https://www.vultr.com/ ä¹°çš„æœåŠ¡å™¨ https://www.vultrvps.com/test-server è¿™é‡Œå¯ä»¥å…ˆæµ‹è¯•ä¸‹é€Ÿåº¦ï¼Œæˆ‘ä¸ªäººç”¨çš„æ´›æ‰çŸ¶çš„æœåŠ¡å™¨ æ”¯ä»˜å¯ä»¥ä½¿ç”¨paypalï¼ŒæŒºæ–¹ä¾¿çš„ ","date":"2017-08-03T00:00:00Z","permalink":"/posts/2017/08/2017-08-03-openstack%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97devstacknewton/","title":"openstackéƒ¨ç½²æŒ‡å—(devstack/newton)"},{"content":"æœåŠ¡å™¨ç³»ç»Ÿä¸ºubuntu16.04 server\nç½‘ç»œç»“æ„: Server(ubuntu16.04)ï¼š åŒç½‘å¡ï¼Œenp0s3å†…ç½‘ç½‘å¡ï¼ˆæ— æ³•ä¸Šå¤–ç½‘ï¼ŒIP 169.254.0.10/16ï¼‰ï¼Œenp0s8å¤–ç½‘ç½‘å¡ï¼ˆIP10.32.18.159/22ï¼‰\nClient1(ubuntu16.04)ï¼šå•ç½‘å¡ï¼Œenp0s3å†…ç½‘ç½‘å¡ï¼ˆæ— æ³•ä¸Šå¤–ç½‘ï¼ŒIP169.254.1.10/16ï¼‰\nClient2(WIN7)ï¼šå•ç½‘å¡ï¼Œå†…ç½‘ç½‘å¡ï¼ˆæ— æ³•ä¸Šå¤–ç½‘ï¼ŒIP169.254.39.53/16ï¼‰\n1.é¦–å…ˆé…æº ViÂ /etc/apt/source.list\n#deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial universe deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties deb http://archive.canonical.com/ubuntu xenial partner deb-src http://archive.canonical.com/ubuntu xenial partner deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse Apt-get update\nApt-get upgrade\n2.ä¸‹è½½å®‰è£…rp-pppoe Wget https://www.roaringpenguin.com/files/download/rp-pppoe-3.12.tar.gz Tar xzvf rp-pppoe-3.12.tar.gz Chown -R root:root /rp-pppoe-3.12/ Apt-get Install libc6-dev Apt-get Install gcc Apt-get install make Apt-get install ppp ./rp-pppoe-3.12/go è¾“å…¥ç›¸å…³ä¿¡æ¯\n3.é…ç½®ppp å…ˆå¸è½½é‡è£…ä¸€éppp(å¦‚æœå·²ç»é¢„è£…)ç”¨ä»¥è¿˜åŸè®¾ç½®\nApt-get purge ppp Apt-get install ppp ä¿®æ”¹pppé…ç½®æ–‡ä»¶\nViÂ /etc/ppp/options\nMs-dns 10.32.64.33 Ms-dns 10.32.64.34 Asyncmap 0 Auth Crtscts Lock Hide-password Modem -pap +chap Lcp-echo-interval 30 Lcp-echo-failure 4 Noipx å…¶ä¸­-papå’Œ+chapé…ç½®ä»£è¡¨é€‰æ‹©chapéªŒè¯ï¼ŒpapéªŒè¯æ–¹å¼æ— æ³•åœ¨XPä»¥ä¸Šç³»ç»Ÿä½¿ç”¨ã€‚\nViÂ /etc/ppp/pppoe-server-options\nAuth Require-chap æ·»åŠ ç™»å½•ç”¨æˆ·ä¿¡æ¯\nViÂ /etc/ppp/chap-secrets\n# client server secretÂ IP address â€œtestâ€ * â€œtestâ€ * (æœ‰å…¶ä»–ç”¨æˆ·éœ€è¦ç™»å½•ç›´æ¥å†™åœ¨è¿™ä¸ªæ–‡ä»¶ä¸‹)\n4.å¯åŠ¨PPPOEæœåŠ¡ Pppoe-server -I enp0s3 -L 172.168.0.1 -R 172.168.0.100 -N 10 -I ååŠ  ç›‘å¬PPPOEæœåŠ¡çš„ç½‘å¡ -LååŠ  PPPOEè™šæ‹ŸæœåŠ¡å™¨IPï¼ˆéšæ„è®¾ç½®ï¼‰ -RååŠ  PPPOEç½‘ç»œIPèµ·å§‹ï¼ˆéšæ„è®¾ç½®ï¼‰ -NååŠ å¯åŒæ—¶è¿æ¥æ•°\nå¯é€šè¿‡ps -aux|grep pppæŸ¥çœ‹å¯åŠ¨æ˜¯å¦æˆåŠŸ è®¾ç½®ipv4è½¬å‘\nVi /etc/sysctl.conf\nNet.ipv4.ip_forward = 1 Sysctl -p ç„¶åè®¾ç½®iptablesä¼ªè£…\nIptables -t nat -A POSTROUTING -s 172.168.0.0/24 -o enp0s8 -j MASQUERADE æŠŠ172.168æ®µçš„ä¼ªè£…åˆ°enp0s8å¤–ç½‘ç½‘å¡ä¸Šã€‚æ—¢å¯æ‹¨ä¸Šå¤–ç½‘ã€‚\n","date":"2017-08-03T00:00:00Z","permalink":"/posts/2017/08/2017-08-03-pppoe_server%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97ubuntu_server16-04/","title":"pppoe_serveréƒ¨ç½²æŒ‡å—(ubuntu_server16.04)"}]