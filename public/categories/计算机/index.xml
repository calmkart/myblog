<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>计算机 on cAlm的个人Blog</title>
        <link>http://localhost:1313/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/</link>
        <description>Recent content in 计算机 on cAlm的个人Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Wed, 25 Dec 2019 00:00:00 +0000</lastBuildDate><atom:link href="http://localhost:1313/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/index.xml" rel="self" type="application/rss+xml" /><item>
            <title>琐事繁多是不是一定不好?</title>
            <link>http://localhost:1313/posts/2019/12/2019-12-25-%E7%90%90%E4%BA%8B%E7%B9%81%E5%A4%9A%E6%98%AF%E4%B8%8D%E6%98%AF%E4%B8%80%E5%AE%9A%E4%B8%8D%E5%A5%BD/</link>
            <pubDate>Wed, 25 Dec 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/12/2019-12-25-%E7%90%90%E4%BA%8B%E7%B9%81%E5%A4%9A%E6%98%AF%E4%B8%8D%E6%98%AF%E4%B8%80%E5%AE%9A%E4%B8%8D%E5%A5%BD/</guid>
            <description>&lt;p&gt;摘抄自 《SRE: Google运维解密》&lt;/p&gt;&#xA;&lt;p&gt;字字珠玑。&lt;/p&gt;&#xA;&lt;hr&gt;&#xA;&lt;p&gt;琐事不会总是让每个人都不开心，特别是不太多的时候。已知的和重复性的工作有一种让人平静的功效。完成这些事可以带来一种满足感和快速胜利感。琐事可能是低风险低压力的活动，有些员工甚至喜欢做这种类型的工作。&lt;/p&gt;&#xA;&lt;p&gt;琐事的存在并不总是坏事，但是每个人都必须清楚，在SRE所扮演的角色中，一定数量的琐事是不可避免的，这其实是任何工程类工作都具有的特点。少量的琐事存在不是什么大问题。但是一旦琐事的数量变多，就会有害了。如果琐事特别繁重，那就应该非常担扰，大声抱怨。在许多琐事有害的原因中，有如下因素需要考虑：&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;职业停滞&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;如果花在工程项目上的时间太少，你的职业发展会变慢，甚至停滞。Google确实会奖励做那些脏活累活的人，但是仅仅是该工作是不可避免，并有巨大的正面影响的时候才会这样做。没有人可以通过不停地做脏活累活满足自己的职业发展。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;士气低落&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;每个人对自己可以承担的琐事限度有所不同，但是一定有个限度。过多的琐事会导致过度劳累，疲倦和不满。&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;另外，牺牲工程实践而做琐事会对SRE组织的整体发展造成损害，原因如下：&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;造成误解&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;我们努力确保每个SRE以及与SRE一起工作的人都理解SRE是一个工程组织。如果个人或团队过度参与琐事，会破坏这种角色，造成误解。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;进展缓慢&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;琐事过多会导致团队生产力下降，如果SRE团队忙于为手工操作和导出数据救火，新功能的发布就会变慢。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;开创先例&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;如果SRE过于愿意承担琐事，研发同事就更倾向于加入更多的琐事，有时候甚至将本该由研发团队承担的运维工作转给SRE来承担。其他团队也会开始指望SRE接受这样的工作，这显然是不好的。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;促进摩擦产生&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;即使你个人对琐事没有怨言，你现在的或未来的队友可能会很不开心。如果团队中引入了太多的琐事，其实就是在鼓励团队里最好的工程师开始寻找其他地方提供的更有价值的工作。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;违反承诺&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;那些为了项目工程工作而入职的新员工，以及转入SRE的老员工会有被欺骗的感觉，这非常不利于公司的士气。&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;如果我们都致力于每一周通过工程工作消除一点琐事，就可以持续性地整顿服务。我们就可以将更多的力量投入到扩大服务规模的工程工作上去，或者是进行下一代的服务的架构设计，又或者是建立一套跨SRE使用的工具链。让我们多创新，少干琐事吧！&lt;/p&gt;</description>
        </item><item>
            <title>什么是一流的技术文章？</title>
            <link>http://localhost:1313/posts/2019/12/2019-12-24-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E6%B5%81%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/</link>
            <pubDate>Tue, 24 Dec 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/12/2019-12-24-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E6%B5%81%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/</guid>
            <description>&lt;p&gt;这两天读Google的《SRE》时看到一段话&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;今天，我们能感受到整个行业都在鼓吹厚颜无耻的&amp;quot;代码拿来主义&amp;quot;(just show me the code)。开源社区内部正在形成一种&amp;quot;不要问我问题&amp;quot;的风气&amp;hellip;&amp;hellip;&amp;hellip;&amp;hellip;.这本书中没有万能药，没有什么东西能解决一切问题，但是这恰恰是本书的宗旨：相比最后的软件结果，架构设计而言，真实的设计过程，作者本身的思考经历更有价值。实现细节永远只是短暂存在的，但是文档化的设计过程却是****无价之宝。   &amp;ndash; 《Google SRE 运维解秘》&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;深以为然，不禁让我想到了过去学习张磊老师《深入剖析Kubernetes》时曾看到张磊老师回复课后留言时说过的一句话&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;直接讲源码是不负责任也是逃避困难的做法。（大意）&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;什么是一流的技术文章？绝不是一上来就开始贴源码画流程图深入到每一个函数。&lt;/p&gt;&#xA;&lt;p&gt;相比具体的实现，掌握其思想，掌握其设计理念&amp;mdash;为什么这样设计？架构为什么这样演进？更为重要。当然，要能将这些理念和演进历程传授给读者，更需要扎实的技术和文字功底。这远比上来就连篇累牍贴源码更困难也更有意义。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Talk is not cheap.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;向每一个真诚分享的技术人致谢。&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>使用kubefwd对k8s中的service进行本地化调试</title>
            <link>http://localhost:1313/posts/2019/12/2019-12-10-%E4%BD%BF%E7%94%A8kubefwd%E5%AF%B9k8s%E4%B8%AD%E7%9A%84service%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%B0%83%E8%AF%95/</link>
            <pubDate>Tue, 10 Dec 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/12/2019-12-10-%E4%BD%BF%E7%94%A8kubefwd%E5%AF%B9k8s%E4%B8%AD%E7%9A%84service%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%E5%8C%96%E8%B0%83%E8%AF%95/</guid>
            <description>&lt;p&gt;大家都知道,k8s中的服务(service)是对k8s中的deployment等对象的一个一致访问点.所以service会有一个vip(headless service没有).无论是普通service的vip或者headless service的pod ip其实都是k8s集群中的内部ip,在集群内访问它是非常容易的.比如有一个service叫nginx,我们在集群内的另一个pod里既可以对这个nginx service的vip进行get访问,也可以通过coredns对这个nginx service的域名如(nginx, nginx.default等)进行访问.但是在集群外呢?这就麻烦了.&lt;/p&gt;&#xA;&lt;p&gt;常见的集群外访问service的方式大致分为 LoadBalance, NodePort, ExternalIp等方式, 再细致一点也可以通过Ingress在7层做一层分发再外接上述流量接入,甚至你可以直接将api server做proxy. 很显然的，这些方式如果在我们只是需要对服务进行调试或者随便用用的场景都是要么太复杂(Ingress), 要么花钱(LoadBanlence),要么不靠谱(NodePort).&lt;/p&gt;&#xA;&lt;p&gt;这时候你会说,嗷,我们可以使用kubectl port-forward 功能,将service的端口port-forward到本地端口.对，没错，这确实是一个不错的解决方式，但这仍然存在非常多的问题。&lt;/p&gt;&#xA;&lt;p&gt;比如,我们并不想要将nginx service的80端口port-forward到我的8080端口上，就想用80端口，那么如果有两个service分别叫nginx1和nginx2，这不就没法弄了吗？再比如，如果我们port-forward的svc的pod发生了变动,怎么办？再比如,我们就是想像在集群内一样，通过service的内部域名对其访问(nginx, nginx.default等)，怎么办？再比如，如果我们有100个服务，难道我们要手动对每个服务port-forward然后手动选择一个没用过的端口吗？甚至，当我们的服务创建,删除,我们又得手动操作,这是何等的麻烦？&lt;/p&gt;&#xA;&lt;p&gt;基于上述问题,一个叫&lt;a class=&#34;link&#34; href=&#34;https://github.com/txn2/kubefwd&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;kubefwd&lt;/a&gt;的工具出现了。&lt;/p&gt;&#xA;&lt;p&gt;我们先从使用开始。 首先有一个集群,有nginx和nginx1两个service,其中nginx是普通service,而nginx1是headless service.&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;➜  ~ kubectl get pods&#xA;NAME                                 READY   STATUS      RESTARTS   AGE&#xA;nginx-deployment-5cdfb5fc49-fgn78    1/1     Running     0          24d&#xA;nginx-deployment-5cdfb5fc49-rjg26    1/1     Running     0          24d&#xA;nginx-deployment1-75c5577b94-tp7zr   1/1     Running     0          21d&#xA;nginx-deployment1-75c5577b94-vcpn5   1/1     Running     0          21d&#xA;pi-gw8s7                             0/1     Completed   0          74d&#xA;➜  ~ kubectl get service&#xA;NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE&#xA;kubernetes   ClusterIP   10.96.0.1               443/TCP   74d&#xA;nginx        ClusterIP   10.101.159.59           80/TCP    33d&#xA;nginx1       ClusterIP   None                    80/TCP    21d&#xA;➜  ~&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后我们下载最新版的kubefwd(&lt;a class=&#34;link&#34; href=&#34;https://github.com/txn2/kubefwd/releases&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;release&lt;/a&gt;)在本地运行。&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;➜  kubefwd git:(master) sudo kubefwd svc&#xA;Password:&#xA;INFO[11:44:47]  _          _           __             _&#xA;INFO[11:44:47] | | ___   _| |__   ___ / _|_      ____| |&#xA;INFO[11:44:47] | |/ / | | | &amp;#39;_ \ / _ \ |_\ \ /\ / / _  |&#xA;INFO[11:44:47] |   &amp;lt;| |_| | |_) |  __/  _|\ V  V / (_| |&#xA;INFO[11:44:47] |_|\_\\__,_|_.__/ \___|_|   \_/\_/ \__,_|&#xA;INFO[11:44:47]&#xA;INFO[11:44:47] Version 0.0.0&#xA;INFO[11:44:47] https://github.com/txn2/kubefwd&#xA;INFO[11:44:47]&#xA;INFO[11:44:47] Press [Ctrl-C] to stop forwarding.&#xA;INFO[11:44:47] &amp;#39;cat /etc/hosts&amp;#39; to see all host entries.&#xA;INFO[11:44:47] Loaded hosts file /etc/hosts&#xA;INFO[11:44:47] Hostfile management: Original hosts backup already exists at /Users/calmkart/hosts.original&#xA;WARN[11:44:47] WARNING: No Pod selector for service kubernetes in default on cluster .&#xA;INFO[11:44:47] Forwarding: nginx1:80 to pod nginx-deployment1-75c5577b94-tp7zr:80&#xA;INFO[11:44:47] Forwarding: nginx-deployment1-75c5577b94-tp7zr.nginx1:80 to pod nginx-deployment1-75c5577b94-tp7zr:80&#xA;INFO[11:44:47] Forwarding: nginx-deployment1-75c5577b94-vcpn5.nginx1:80 to pod nginx-deployment1-75c5577b94-vcpn5:80&#xA;INFO[11:44:47] Forwarding: nginx:80 to pod nginx-deployment-5cdfb5fc49-fgn78:80&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们可以通过控制台INFO输出清晰的看到,我们已经将普通service nginx port-forward到了它的第一个pod nginx-deployment-5cdfb5fc49-fgn78上，将headless service nginx1 port-forward到了它的第一个pod上，同时还port-forward到了它的每一个pod上(因为headless service中的pod是不等价的).&lt;/p&gt;&#xA;&lt;p&gt;接着我们查看一下本机的hosts&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;➜  ~ cat /etc/hosts&#xA;##&#xA;# Host Database&#xA;#&#xA;# localhost is used to configure the loopback interface&#xA;# when the system is booting.  Do not change this entry.&#xA;##&#xA;127.0.0.1        localhost&#xA;127.1.27.1       nginx1 nginx1.default.svc.cluster.local nginx1.default&#xA;127.1.27.2       nginx-deployment1-75c5577b94-tp7zr.nginx1 nginx-deployment1-75c5577b94-tp7zr.nginx1.default.svc.cluster.local nginx-deployment1-75c5577b94-tp7zr.nginx1.default&#xA;127.1.27.3       nginx-deployment1-75c5577b94-vcpn5.nginx1 nginx-deployment1-75c5577b94-vcpn5.nginx1.default.svc.cluster.local nginx-deployment1-75c5577b94-vcpn5.nginx1.default&#xA;127.1.27.4       nginx nginx.default.svc.cluster.local nginx.default&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;厉害了，居然多出了这么多记录。 从这个hosts看起来，我们访问nginx1/nginx1.default.svc.cluster.local/nginx1.default应该都可以访问到k8s集群中的nginx1服务; 我们访问nginx/nginx.default.svc.cluster.local/nginx.default应该都可以访问到k8s集群中的nginx服务,我们来尝试一下。 使用httpie试试&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;➜  ~ http get nginx1&#xA;HTTP/1.1 200 OK&#xA;Accept-Ranges: bytes&#xA;Connection: keep-alive&#xA;Content-Length: 612&#xA;Content-Type: text/html&#xA;Date: Tue, 10 Dec 2019 03:57:05 GMT&#xA;ETag: &amp;#34;58e66cf5-264&amp;#34;&#xA;Last-Modified: Thu, 06 Apr 2017 16:29:41 GMT&#xA;Server: nginx/1.11.13&#xA;&#xA;➜  ~ http get nginx&#xA;HTTP/1.1 200 OK&#xA;Accept-Ranges: bytes&#xA;Connection: keep-alive&#xA;Content-Length: 612&#xA;Content-Type: text/html&#xA;Date: Tue, 10 Dec 2019 03:57:17 GMT&#xA;ETag: &amp;#34;54999765-264&amp;#34;&#xA;Last-Modified: Tue, 23 Dec 2014 16:25:09 GMT&#xA;Server: nginx/1.7.9&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;厉害了也，真的管用。&lt;/p&gt;&#xA;&lt;p&gt;我们尝试在k8s集群中新添加一个service叫nginx2,这个服务和nginx1一样是一个headless service&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apiVersion: apps/v1&#xA;kind: Deployment&#xA;metadata:&#xA;  name: nginx-deployment2&#xA;  labels:&#xA;    app: nginx2&#xA;spec:&#xA;  replicas: 2&#xA;  selector:&#xA;    matchLabels:&#xA;      app: nginx2&#xA;  template:&#xA;    metadata:&#xA;      labels:&#xA;        app: nginx2&#xA;        test: test&#xA;        test1: test1&#xA;    spec:&#xA;      containers:&#xA;      - name: nginx&#xA;        image: nginx:latest&#xA;        ports:&#xA;        - containerPort: 80&#xA;        readinessProbe:&#xA;          tcpSocket:&#xA;            port: 80&#xA;        livenessProbe:&#xA;          tcpSocket:&#xA;            port: 80&#xA;---&#xA;apiVersion: v1&#xA;kind: Service&#xA;metadata:&#xA;  name: nginx2&#xA;spec:&#xA;  clusterIP: None&#xA;  selector:&#xA;    app: nginx2&#xA;  ports:&#xA;    - protocol: TCP&#xA;      port: 80&#xA;      targetPort: 80&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;➜  ~ kubectl apply -f nginx2.yaml&#xA;deployment.apps/nginx-deployment2 created&#xA;service/nginx2 created&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这个时候我们发现运行的kubefwd INFO记录显示了如下内容&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;INFO[12:01:12] Forwarding: nginx2:80 to pod nginx-deployment2-5995ddf44f-6r9fg:80&#xA;INFO[12:01:12] Forwarding: nginx-deployment2-5995ddf44f-6r9fg.nginx2:80 to pod nginx-deployment2-5995ddf44f-6r9fg:80&#xA;INFO[12:01:12] Forwarding: nginx-deployment2-5995ddf44f-d5q9d.nginx2:80 to pod nginx-deployment2-5995ddf44f-d5q9d:80&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们来看看Hosts&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;127.1.27.5       nginx2 nginx2.default.svc.cluster.local nginx2.default&#xA;127.1.27.6       nginx-deployment2-5995ddf44f-6r9fg.nginx2 nginx-deployment2-5995ddf44f-6r9fg.nginx2.default.svc.cluster.local nginx-deployment2-5995ddf44f-6r9fg.nginx2.default&#xA;127.1.27.7       nginx-deployment2-5995ddf44f-d5q9d.nginx2 nginx-deployment2-5995ddf44f-d5q9d.nginx2.default.svc.cluster.local nginx-deployment2-5995ddf44f-d5q9d.nginx2.default&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;果然，新添加了这些记录。看来我们通过本地域名解析nginx2就可以访问到nginx2服务啦.我们来试试.&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;➜  ~ http get nginx2&#xA;HTTP/1.1 200 OK&#xA;Accept-Ranges: bytes&#xA;Connection: keep-alive&#xA;Content-Length: 612&#xA;Content-Type: text/html&#xA;Date: Tue, 10 Dec 2019 04:03:23 GMT&#xA;ETag: &amp;#34;5dd3e500-264&amp;#34;&#xA;Last-Modified: Tue, 19 Nov 2019 12:50:08 GMT&#xA;Server: nginx/1.17.6&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;果然，和我们预想的一样。 最后我们通过ctrl+c停止kubefwd.&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;^CWARN[12:04:08] Stopped forwarding nginx-deployment1-75c5577b94-vcpn5.nginx1 in default.&#xA;WARN[12:04:08] Stopped forwarding nginx-deployment2-5995ddf44f-d5q9d.nginx2 in default.&#xA;WARN[12:04:08] Stopped forwarding nginx2 in default.&#xA;WARN[12:04:08] Stopped forwarding nginx in default.&#xA;WARN[12:04:08] Stopped forwarding nginx-deployment2-5995ddf44f-6r9fg.nginx2 in default.&#xA;WARN[12:04:08] Stopped forwarding nginx1 in default.&#xA;WARN[12:04:08] Stopped forwarding nginx-deployment1-75c5577b94-tp7zr.nginx1 in default.&#xA;INFO[12:04:08] Done...&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;terminal中显示我们停止了nginx,nginx1,nginx2的转发,我们再来看看hosts呢？&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;##&#xA;# Host Database&#xA;#&#xA;# localhost is used to configure the loopback interface&#xA;# when the system is booting.  Do not change this entry.&#xA;##&#xA;127.0.0.1        localhost&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;果然，已经清理完毕了。&lt;/p&gt;&#xA;&lt;p&gt;以上基本就是常规使用的全过程，接下来大致讲讲原理吧。&lt;/p&gt;&#xA;&lt;p&gt;kubefwd项目过去的运行机制是在运行时通过api-server拉取k8s中的所有service服务信息(List),并将服务分为普通服务和无头服务两类,通过普通服务的第一个pod/无头服务的每一个pod的port-forward subresource对其做转发,并在本地为其创建无人使用的环回接口ip,将其转发上去,实现端口的隔离。&lt;/p&gt;&#xA;&lt;p&gt;后来代码经过我的一次很大的重构,目前的流程是像一个自定义控制器一样,在启动时ListAndWatch api-server的service信息，能够自动感知api-server的服务变化，当服务被创建/删除，服务转发的pod被修改/删除时开启对应的goroutine对其进行port-forward并修改Hosts(过程中加锁).当kubefwd被停止时(或者某service被删除时)启动清理流程，结束转发并清理hosts.&lt;/p&gt;&#xA;&lt;p&gt;其实原理上并不复杂，但确实是能在k8s环境中解决某一个方向上的问题的。 欢迎大家来试着使用使用。&lt;/p&gt;</description>
        </item><item>
            <title>python利用零宽切片插入元素</title>
            <link>http://localhost:1313/posts/2019/10/2019-10-30-python%E5%88%A9%E7%94%A8%E9%9B%B6%E5%AE%BD%E5%88%87%E7%89%87%E6%8F%92%E5%85%A5%E5%85%83%E7%B4%A0/</link>
            <pubDate>Wed, 30 Oct 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/10/2019-10-30-python%E5%88%A9%E7%94%A8%E9%9B%B6%E5%AE%BD%E5%88%87%E7%89%87%E6%8F%92%E5%85%A5%E5%85%83%E7%B4%A0/</guid>
            <description>&lt;p&gt;常见的python插入元素方式一般是insert或者手动挪动后修改值,然后其实还有种比较少用的通过零宽切片插入元素的方式,比较有意思,随便记录下.&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Python 3.8.0 (v3.8.0:fa919fdf25, Oct 14 2019, 10:23:27) &#xA;[Clang 6.0 (clang-600.0.57)] on darwin&#xA;Type &amp;#34;help&amp;#34;, &amp;#34;copyright&amp;#34;, &amp;#34;credits&amp;#34; or &amp;#34;license&amp;#34; for more information.&#xA;&amp;gt;&amp;gt;&amp;gt; a = [1,2,3,4,5]&#xA;&amp;gt;&amp;gt;&amp;gt; a[:0] = [0,0,0]&#xA;&amp;gt;&amp;gt;&amp;gt; a&#xA;[0, 0, 0, 1, 2, 3, 4, 5]&#xA;&amp;gt;&amp;gt;&amp;gt; a[4:4] = [8,8,8,8,8,8]&#xA;&amp;gt;&amp;gt;&amp;gt; a&#xA;[0, 0, 0, 1, 8, 8, 8, 8, 8, 8, 2, 3, 4, 5]&#xA;&amp;gt;&amp;gt;&amp;gt; a[4:8] = []&#xA;&amp;gt;&amp;gt;&amp;gt; a&#xA;[0, 0, 0, 1, 8, 8, 2, 3, 4, 5]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;无正文.&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>使用kubectl-debug来调试pod</title>
            <link>http://localhost:1313/posts/2019/10/2019-10-21-%E4%BD%BF%E7%94%A8kubectl-debug%E6%9D%A5%E8%B0%83%E8%AF%95pod/</link>
            <pubDate>Mon, 21 Oct 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/10/2019-10-21-%E4%BD%BF%E7%94%A8kubectl-debug%E6%9D%A5%E8%B0%83%E8%AF%95pod/</guid>
            <description>&lt;p&gt;在k8s环境中,我们经常会碰到各种疑难杂症.比如下面这个例子: 某pod无法启动,查看日志显示原来是init时容器无法拉取某个外部网络上的包.我们exec登陆容器后试图调试下产生这个问题的原因,我们输入ping xxx.xxx.xxx,但sh直接提示&amp;quot;找不到ping命令&amp;quot;,甚至直接无法exec到一个没有sh的容器中. 这样的情况我们该怎么办呢？这里有一个解决类似问题的调试工具&lt;a class=&#34;link&#34; href=&#34;https://github.com/aylei/kubectl-debug&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;kubectl-debug&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;kubectl-debug的原理也很简单,因为docker容器是基于namespace做的隔离,所以可以创建一个新的预装好了各种调试工具的容器,直接加入待调试容器的namespace中,这样就可以与待调试pod共享各类栈,实现方便调试.(有点类似于k8s中的sidecar设计模式,但是使用的是一个用后既销的独立容器)&lt;/p&gt;&#xA;&lt;p&gt;这里介绍一下简单的使用方式 我们可以直接下载编译好的二进制文件包 &lt;a class=&#34;link&#34; href=&#34;https://github.com/aylei/kubectl-debug/releases&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/aylei/kubectl-debug/releases&lt;/a&gt; 也可以clone源代码自己做编译(可以获得更多最新修复和更新)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 这里要开启docker,因为是通过docker编译的&#xA;git clone https://github.com/aylei/kubectl-debug.git&#xA;cd kubectl-debug&#xA;make&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;最简单的使用方式&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl-debug POD_NAME&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;kubectl-debug将拉取nicolaka/netshoot镜像作为默认的debug镜像. 过一小会拉取镜像的功夫,我们创建好了一个插入待调试pod namespace中的调试容器,并且已经获取了stdin和stdout,我们就可以进行调试了. 调试完成后exit退出,kubectl-debug将完成相关的清理工作.&lt;/p&gt;&#xA;&lt;p&gt;当然,如果觉得默认的nicolaka/netshoot调试镜像不好用,也可以使用自己的私有镜像进行调试&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# 使用私有仓库镜像,并设置私有仓库使用的kubernetes secret&#xA;# secret data原文请设置为 {Username: , Password: }&#xA;# 默认secret_name为kubectl-debug-registry-secret,默认namspace为default&#xA;kubectl-debug POD_NAME --image calmkart/netshoot:latest --registry-secret-name  --registry-secret-namespace &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;甚至如果原pod已经无法启动了,我们可以使用fork模式fork出一个新的待调试pod用于调试(自动替换掉entry-point)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl debug POD_NAME --fork&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;更多功能可以参考&lt;a class=&#34;link&#34; href=&#34;https://github.com/aylei/kubectl-debug/blob/master/docs/zh-cn.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;kubectl-debug官方文档&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;总之这个工具还是非常实用的,我也参与添加了一些增强功能和bug修复.k8s官方据说也将在未来版本增加&lt;a class=&#34;link&#34; href=&#34;https://github.com/kubernetes/enhancements/issues/277&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;临时容器&lt;/a&gt;功能以支持调试,虽然不知道啥时候能用上,但还是期待的.&lt;/p&gt;</description>
        </item><item>
            <title>kubetnetes contribution github workflow</title>
            <link>http://localhost:1313/posts/2019/09/2019-09-25-kubetnetes-contribution-github-workflow/</link>
            <pubDate>Wed, 25 Sep 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/09/2019-09-25-kubetnetes-contribution-github-workflow/</guid>
            <description>&lt;p&gt;转一下kubernetes contribution的github workflow，不仅用在k8s里，也可以用在其他各个开源项目上，贴图备忘，无内容&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/09/git_workflow.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/git_workflow.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>virt-manager libxml2 module bug解决</title>
            <link>http://localhost:1313/posts/2019/09/2019-09-19-virt-manager-libxml2-module-bug%E8%A7%A3%E5%86%B3/</link>
            <pubDate>Thu, 19 Sep 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/09/2019-09-19-virt-manager-libxml2-module-bug%E8%A7%A3%E5%86%B3/</guid>
            <description>&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/virt-manager/virt-manager&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;virt-manager&lt;/a&gt;是一个kvm的管理工具，在自己用的小型环境里还是很方便的，我也用了挺久。因为是mac所以是用&lt;a class=&#34;link&#34; href=&#34;https://github.com/jeffreywildman/homebrew-virt-manager&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;homebrew-virt-manager&lt;/a&gt;。之前一直用的老版本，最近mac更新，而且老版本有存储池无法从/var/lib/libvirt/里切换的bug，所以通过brew更新到了最新的2.2.1版本，就出现了 &lt;strong&gt;No module named &amp;rsquo;libxml2&amp;rsquo;&lt;/strong&gt;  的bug，通过google和官方issue找不到解决办法，最终自己解决，这里记录一下，方便其他需要的朋友查询。&lt;/p&gt;&#xA;&lt;p&gt;主要的症状是brew安装或者更新完成homebrew-virt-manager后，运行virt-manager会显示&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;File &amp;#34;/usr/local/Cellar/virt-manager/2.2.1_2/libexec/share/virt-manager/virtinst/xmlapi.py&amp;#34;, line 7, in &amp;lt;module&amp;gt;&#xA;    import libxml2&#xA;ModuleNotFoundError: No module named &amp;#39;libxml2&amp;#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;原因是默认的包从python2升级到了python3。&lt;/p&gt;&#xA;&lt;p&gt;我们首先安装python3的libxml2包&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip3 install libxml2-python3&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后查询安装位置&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;➜  ~ python3&#xA;Python 3.7.1 (default, Nov  6 2018, 18:49:54)&#xA;[Clang 9.0.0 (clang-900.0.39.2)] on darwin&#xA;Type &amp;#34;help&amp;#34;, &amp;#34;copyright&amp;#34;, &amp;#34;credits&amp;#34; or &amp;#34;license&amp;#34; for more information.&#xA;&amp;gt;&amp;gt;&amp;gt; import libxml2&#xA;&amp;gt;&amp;gt;&amp;gt; print(libxml2.__file__)&#xA;/usr/local/lib/python3.7/site-packages/libxml2.py&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后将libxml2包和相关包从系统python3的默认site-packages拷贝到virt-manager的site-packages中即可&lt;/p&gt;&#xA;&lt;p&gt;参考上面显示的路径，既是将&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;/usr/local/lib/python3.7/site-packages/libxml*&lt;/strong&gt; &lt;/p&gt;&#xA;&lt;p&gt;拷贝到&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;/usr/local/Cellar/virt-manager/2.2.1_2/libexec/lib/python3.7/site-packages&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cp -r /usr/local/lib/python3.7/site-packages/libxml* /usr/local/Cellar/virt-manager/2.2.1_2/libexec/lib/python3.7/site-packages&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;TIPS:&lt;/p&gt;&#xA;&lt;p&gt;1，注意要拷贝libxml*而不仅仅是libxml2.py，因为libxml2还依赖libxml2mod。拷贝少了还是会报找不到包。&lt;/p&gt;&#xA;&lt;p&gt;2，我们也可以将python3的package添加到默认PYTHONPATH中去，也可以解决这个问题。&lt;/p&gt;&#xA;&lt;p&gt;3，顺便记录一个virt / virt-manager使用的问题，更换默认存储池后新建的默认存储池必须设置名称为default，不然会自动在/var/lib/libvirt/目录下重建默认存储池&lt;/p&gt;</description>
        </item><item>
            <title>kubernetes scheduler流程图</title>
            <link>http://localhost:1313/posts/2019/09/2019-09-18-kubernetes-scheduler%E6%B5%81%E7%A8%8B%E5%9B%BE/</link>
            <pubDate>Wed, 18 Sep 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/09/2019-09-18-kubernetes-scheduler%E6%B5%81%E7%A8%8B%E5%9B%BE/</guid>
            <description>&lt;p&gt;最近在跟着&lt;a class=&#34;link&#34; href=&#34;https://github.com/farmer-hutao/k8s-source-code-analysis&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;《k8s-1.13版本源码分析》&lt;/a&gt;读k8s源码，顺着流程把scheduler调度器模块过了一遍，文中有一幅k8s  scheduler调度器工作流程图画的不错，这里做个记录备忘。&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/09/kube-scheduler-workflow.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/kube-scheduler-workflow.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>配置和使用kube-prometheus</title>
            <link>http://localhost:1313/posts/2019/08/2019-08-22-%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8kube-prometheus/</link>
            <pubDate>Thu, 22 Aug 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/08/2019-08-22-%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8kube-prometheus/</guid>
            <description>&lt;p&gt;我们在k8s集群中使用云原生的promethues通常需要用到coreos的&lt;a class=&#34;link&#34; href=&#34;https://github.com/coreos/prometheus-operator&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;prometheus-operater&lt;/a&gt;，它可以方便的帮助我们在k8s中部署和配置使用prometheus。但prometheus并不是开箱即用的，如果要做到开箱即用的监控全家桶，官方提供了两个选择，分别是&lt;a class=&#34;link&#34; href=&#34;https://github.com/helm/charts/tree/master/stable/prometheus-operator&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;prometheus-operater helm chart&lt;/a&gt;和&lt;a class=&#34;link&#34; href=&#34;https://github.com/coreos/kube-prometheus&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;kube-prometheus&lt;/a&gt;。这两者都可以为我们提供开箱即用的方式部署promethues+alertmanager+promethues-push-gateway(kube-promethueus不包含,需要单独部署)+grafana全家桶，同时包含&lt;a class=&#34;link&#34; href=&#34;https://github.com/kubernetes-monitoring/kubernetes-mixin&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;kubernetes-mixin&lt;/a&gt;的一整套报警规则和node-exporter，kube-state-metrics等一系列metrics exporter。区别在于helm chart由社区维护，而kube-promethues由coreos维护。这里我们将以kube-prometheus为例，简要说明配置和使用方式。&lt;/p&gt;&#xA;&lt;p&gt;首先是部署，还是非常简单的，我们先将kube-prometheus的仓库clone下来&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git clone https://github.com/coreos/kube-prometheus.git&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后根据官方文档操作即可&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ kubectl create -f manifests/&#xA;&#xA;# It can take a few seconds for the above &amp;#39;create manifests&amp;#39; command to fully create the following resources, so verify the resources are ready before proceeding.&#xA;$ until kubectl get customresourcedefinitions servicemonitors.monitoring.coreos.com ; do date; sleep 1; echo &amp;#34;&amp;#34;; done&#xA;$ until kubectl get servicemonitors --all-namespaces ; do date; sleep 1; echo &amp;#34;&amp;#34;; done&#xA;&#xA;$ kubectl apply -f manifests/ # This command sometimes may need to be done twice (to workaround a race condition).&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里将自动为我们部署prometheus，alertmanager和grafana。我们接下来可以通过port-forward也可以通过ingress将服务暴露出来&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Prometheus&#xA;&#xA;$ kubectl --namespace monitoring port-forward svc/prometheus-k8s 9090&#xA;&#xA;Then access via http://localhost:9090&#xA;&#xA;Grafana&#xA;&#xA;$ kubectl --namespace monitoring port-forward svc/grafana 3000&#xA;&#xA;Then access via http://localhost:3000 and use the default grafana user:password of admin:admin.&#xA;&#xA;Alert Manager&#xA;&#xA;$ kubectl --namespace monitoring port-forward svc/alertmanager-main 9093&#xA;&#xA;Then access via http://localhost:9093&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;或者编写ingress&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# ingress-monitor.yaml&#xA;apiVersion: extensions/v1beta1&#xA;kind: Ingress&#xA;metadata:&#xA;  name: monitoring-ingress&#xA;  annotations:&#xA;    nginx.ingress.kubernetes.io/ssl-redirect: &amp;#34;false&amp;#34;&#xA;  namespace: monitoring&#xA;spec:&#xA;  rules:&#xA;  - host: k8s-prometheus.calmkart.com&#xA;    http:&#xA;      paths:&#xA;      - path: /&#xA;        backend:&#xA;          serviceName: prometheus-k8s&#xA;          servicePort: 9090&#xA;  - host: k8s-grafana.calmkart.com&#xA;    http:&#xA;      paths:&#xA;      - path: /&#xA;        backend:&#xA;          serviceName: grafana&#xA;          servicePort: 3000&#xA;  - host: k8s-alertmanager.calmkart.com&#xA;    http:&#xA;      paths:&#xA;      - path: /&#xA;        backend:&#xA;          serviceName: alertmanager-main&#xA;          servicePort: 9093&#xA;&#xA;# kubectl apply -f ingress-monitor.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后我们就可以访问到prometheus,alertmanager和grafana的服务页面了 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/08/prometheus.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/prometheus.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/08/alert-manager.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/alert-manager.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/08/grafana.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/grafana.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;这里prometheus已经集成了一些k8s相关的exporter和kubernetes-mixin的报警规则，我们可以从prometheus的status-&amp;gt;rules和status-&amp;gt;target中查看到。&lt;/p&gt;&#xA;&lt;p&gt;接下来，我们部署&lt;a class=&#34;link&#34; href=&#34;https://github.com/helm/charts/tree/master/stable/prometheus-pushgateway&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;push-gateway&lt;/a&gt;&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#可以参考我这里NodePort的values参数,也可以自行设置&#xA;# values.yaml&#xA;&#xA;# Default values for prometheus-pushgateway.&#xA;# This is a YAML-formatted file.&#xA;# Declare variables to be passed into your templates.&#xA;image:&#xA;  repository: prom/pushgateway&#xA;  tag: v0.9.0&#xA;  pullPolicy: IfNotPresent&#xA;&#xA;service:&#xA;  type: NodePort&#xA;  port: 9091&#xA;  targetPort: 9091&#xA;&#xA;# Optional pod annotations&#xA;podAnnotations: {}&#xA;&#xA;# Optional pod labels&#xA;podLabels: {}&#xA;&#xA;# Optional service labels&#xA;serviceLabels: {}&#xA;&#xA;# Optional serviceAccount labels&#xA;serviceAccountLabels: {}&#xA;&#xA;# Optional additional arguments&#xA;extraArgs: []&#xA;&#xA;# Optional additional environment variables&#xA;extraVars: []&#xA;&#xA;resources: {}&#xA;  # We usually recommend not to specify default resources and to leave this as a conscious&#xA;  # choice for the user. This also increases chances charts run on environments with little&#xA;  # resources, such as Minikube. If you do want to specify resources, uncomment the following&#xA;  # lines, adjust them as necessary, and remove the curly braces after &amp;#39;resources:&amp;#39;.&#xA;  # limits:&#xA;  #   cpu: 200m&#xA;  #    memory: 50Mi&#xA;  # requests:&#xA;  #   cpu: 100m&#xA;  #   memory: 30Mi&#xA;&#xA;serviceAccount:&#xA;  # Specifies whether a ServiceAccount should be created&#xA;  create: true&#xA;  # The name of the ServiceAccount to use.&#xA;  # If not set and create is true, a name is generated using the fullname template&#xA;  name:&#xA;&#xA;## Configure ingress resource that allow you to access the&#xA;## pushgateway installation. Set up the URL&#xA;## ref: http://kubernetes.io/docs/user-guide/ingress/&#xA;##&#xA;ingress:&#xA;  ## Enable Ingress.&#xA;  ##&#xA;  enabled: false&#xA;&#xA;    ## Annotations.&#xA;    ##&#xA;    # annotations:&#xA;    #   kubernetes.io/ingress.class: nginx&#xA;    #   kubernetes.io/tls-acme: &amp;#39;true&amp;#39;&#xA;&#xA;    ## Hostnames.&#xA;    ## Must be provided if Ingress is enabled.&#xA;    ##&#xA;    # hosts:&#xA;    #   - pushgateway.domain.com&#xA;&#xA;    ## TLS configuration.&#xA;    ## Secrets must be manually created in the namespace.&#xA;    ##&#xA;    # tls:&#xA;    #   - secretName: pushgateway-tls&#xA;    #     hosts:&#xA;    #       - pushgateway.domain.com&#xA;&#xA;tolerations: {}&#xA;  # - effect: NoSchedule&#xA;  #   operator: Exists&#xA;&#xA;## Node labels for pushgateway pod assignment&#xA;## Ref: https://kubernetes.io/docs/user-guide/node-selection/&#xA;##&#xA;nodeSelector: {}&#xA;&#xA;replicaCount: 1&#xA;&#xA;## Affinity for pod assignment&#xA;## Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity&#xA;affinity: {}&#xA;&#xA;# Enable this if you&amp;#39;re using https://github.com/coreos/prometheus-operator&#xA;serviceMonitor:&#xA;  enabled: true&#xA;  namespace: monitoring&#xA;  # fallback to the prometheus default unless specified&#xA;  # interval: 10s&#xA;  ## Defaults to what&amp;#39;s used if you follow CoreOS [Prometheus Install Instructions](https://github.com/helm/charts/tree/master/stable/prometheus-operator#tldr)&#xA;  ## [Prometheus Selector Label](https://github.com/helm/charts/tree/master/stable/prometheus-operator#prometheus-operator-1)&#xA;  ## [Kube Prometheus Selector Label](https://github.com/helm/charts/tree/master/stable/prometheus-operator#exporters)&#xA;  selector:&#xA;    prometheus: kube-prometheus&#xA;  # Retain the job and instance labels of the metrics pushed to the Pushgateway&#xA;  # [Scraping Pushgateway](https://github.com/prometheus/pushgateway#configure-the-pushgateway-as-a-target-to-scrape)&#xA;  honorLabels: true&#xA;&#xA;# The values to set in the PodDisruptionBudget spec (minAvailable/maxUnavailable)&#xA;# If not set then a PodDisruptionBudget will not be created&#xA;podDisruptionBudget:&#xA;&#xA;# helm install --name push-gateway -f values.yaml stable/prometheus-pushgateway&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后我们来试着接入内部和外部的prometheus监控target.&lt;/p&gt;&#xA;&lt;p&gt;1.实现接入内部的target 无论是外部或内部的target都需要一个metrics-server目标，对于内部target而言，一般是一个服务，比如服务calm-server 在prometheus-operater的使用方式中，有一个crd叫serviceMonitor，我们创建一个新的serviceMonitor就创建了一个prometheus的target 我们首先查看monitoring命名空间中已有的serviceMonitor(既prometheus target)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[xxx@xxxxx]# kubectl get servicemonitors.monitoring.coreos.com -n monitoring&#xA;NAME                      AGE&#xA;alertmanager              23d&#xA;coredns                   23d&#xA;grafana                   23d&#xA;ingress-nginx             17d&#xA;kube-apiserver            23d&#xA;kube-controller-manager   23d&#xA;kube-scheduler            23d&#xA;kube-state-metrics        23d&#xA;kubelet                   23d&#xA;node-exporter             23d&#xA;prometheus                23d&#xA;prometheus-operator       23d&#xA;prometheus-pushgateway    19d&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们创建一个新的serviceMonitor,将calm-server的/metrics作为target # calm-server-serviceMonitor.yaml&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apiVersion: monitoring.coreos.com/v1&#xA;kind: ServiceMonitor&#xA;metadata:&#xA;  name: calm-server-metrics&#xA;  labels:&#xA;    k8s-app: calm-server-metrics&#xA;  namespace: monitoring&#xA;spec:&#xA;  namespaceSelector:&#xA;    any: true&#xA;  selector:&#xA;    matchLabels:&#xA;      app: calm-server&#xA;  endpoints:&#xA;  - port: web&#xA;    interval: 10s&#xA;    honorLabels: true&#xA;&#xA;# kubectl apply -f calm-server-serviceMonitor.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里有几个需要注意的tips:&lt;/p&gt;&#xA;&lt;p&gt;1.如果service和prometheus不再同一个命名空间，需要设置namespaceSelector，可以单独设置需要搜索的namespace，也可以像上面那样设置为全局搜索。&lt;/p&gt;&#xA;&lt;p&gt;2.其次，endpoints中设置的port会按照interval设置的时间定时去:/metrics拉取数据，所以对应的服务需要提供相应的metrics(官方有非常多的exporter提供使用，可以参考&lt;a class=&#34;link&#34; href=&#34;https://prometheus.io/docs/instrumenting/exporters/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://prometheus.io/docs/instrumenting/exporters/&lt;/a&gt;)&lt;/p&gt;&#xA;&lt;p&gt;我们接下来再查看所有serviceMonitor crd api对象，就会发现创建成功，同时prometheus的state-&amp;gt;target中也会出现对应的target，我们也可以在prometheus中查询到对应的数据了。&lt;/p&gt;&#xA;&lt;p&gt;2.实现接入外部target 实现了接入内部的target，那么，k8s集群外部的服务想要接入该怎么办呢？当然还是通过监控k8s集群内service的方式，不是service对应的是一个外部的endpoint对象。下面我们将以calm-server服务为例，说明如何通过k8s的endpoint外部对象接入外部target监控。 首先我们创建一个endpoint对象&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# calm-server-endpoint.yaml&#xA;apiVersion: v1&#xA;kind: Endpoints&#xA;metadata:&#xA;  name: calm-server-metrics&#xA;subsets:&#xA;  - addresses:&#xA;    - ip: x.x.x.x&#xA;    ports:&#xA;    - name: metrics&#xA;      port: xxxx&#xA;      protocol: TCP&#xA;# kubectl apply -f calm-server-endpoint.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们将ip和port替换成我们的外部服务，apply后就创建了一个endpoint api对象，我们可以通过kubectl get endpoints查看&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[xxx@xxxxxxx]# kubectl get endpoints&#xA;NAME                                  ENDPOINTS                                                           AGE&#xA;calm-server-metrics                   10.41.13.17:6789                                                    19d&#xA;kubernetes                            10.1.33.159:6443                                                    92d&#xA;push-gateway-prometheus-pushgateway   10.240.224.15:9091                                                  19d&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里需要注意的是,endpoint对象是不区分namespaces的 接着，我们创建一个service，service的选择器选择calm-server-metrics这个外部endpoint&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# calm-server-metrics-service.yaml&#xA;&#xA;apiVersion: v1&#xA;kind: Service&#xA;metadata:&#xA;  name: calm-server-metrics&#xA;  labels:&#xA;    app: calm-server-metrics&#xA;spec:&#xA;  type: ExternalName&#xA;  externalName: x.x.x.x&#xA;  clusterIP: &amp;#34;&amp;#34;&#xA;  ports:&#xA;  - name: metrics&#xA;    port: xxxx&#xA;    protocol: TCP&#xA;    targetPort: 6789&#xA;&#xA;# kubectl apply -f calm-server-metrics-service.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们这个时候访问这个服务，就等于访问了外部的endpoint，既外部服务 我们就可以像上面创建内部服务的serviceMonitor一样，创建serviceMonitor api对象从而更新prometheus target列表了。&lt;/p&gt;&#xA;&lt;p&gt;接下来我们会有一个问题，如何修改这一系列全家桶的配置呢?比如prometheus的配置，grafana的配置。比如我们需要修改smtp报警配置该怎么办呢？如果是非云原生环境，我们可以直接修改配置文件即可，但在云原生环境中不一样。&lt;/p&gt;&#xA;&lt;p&gt;kube-prometheus官方文档推荐的方式是使用&lt;a class=&#34;link&#34; href=&#34;https://jsonnet.org/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;jsonnet&lt;/a&gt;对官方库做编译修改。那么如何直接通过修改yaml的方式修改配置文件呢？下面将分别介绍如何修改全家桶中的各个配置文件。&lt;/p&gt;&#xA;&lt;p&gt;1.首先是prometheus的alert rules，我们可以通过修改prometheus-rules.yaml文件修改。 2.其次是alertmanager的config,我们可以修改alertmanager-secret.yaml文件,注意，这是一个secret对象，内容经过了base64加密，我们应该先将内容解密再做修改，修改后再加密替换即可。 3.最后是grafana的配置修改，参考了grafana官方的docker image之后，我们可以先修改grafana-deployment.yaml文件，为其增加一个volume,配置如下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apiVersion: apps/v1beta2&#xA;kind: Deployment&#xA;metadata:&#xA;  labels:&#xA;    app: grafana&#xA;  name: grafana&#xA;  namespace: monitoring&#xA;spec:&#xA;  replicas: 1&#xA;  selector:&#xA;    matchLabels:&#xA;      app: grafana&#xA;  template:&#xA;    metadata:&#xA;      labels:&#xA;        app: grafana&#xA;    spec:&#xA;      containers:&#xA;      - image: grafana/grafana:6.2.2&#xA;        name: grafana&#xA;        ports:&#xA;        - containerPort: 3000&#xA;          name: http&#xA;        readinessProbe:&#xA;          httpGet:&#xA;            path: /api/health&#xA;            port: http&#xA;        resources:&#xA;          limits:&#xA;            cpu: 200m&#xA;            memory: 200Mi&#xA;          requests:&#xA;            cpu: 100m&#xA;            memory: 100Mi&#xA;        volumeMounts:&#xA;        - mountPath: /var/lib/grafana&#xA;          name: grafana-storage&#xA;          readOnly: false&#xA;        - mountPath: /etc/grafana/provisioning/datasources&#xA;          name: grafana-datasources&#xA;          readOnly: false&#xA;        - mountPath: /etc/grafana/provisioning/dashboards&#xA;          name: grafana-dashboards&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/apiserver&#xA;          name: grafana-dashboard-apiserver&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/controller-manager&#xA;          name: grafana-dashboard-controller-manager&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/k8s-cluster-rsrc-use&#xA;          name: grafana-dashboard-k8s-cluster-rsrc-use&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/k8s-node-rsrc-use&#xA;          name: grafana-dashboard-k8s-node-rsrc-use&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/k8s-resources-cluster&#xA;          name: grafana-dashboard-k8s-resources-cluster&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/k8s-resources-namespace&#xA;          name: grafana-dashboard-k8s-resources-namespace&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/k8s-resources-pod&#xA;          name: grafana-dashboard-k8s-resources-pod&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/k8s-resources-workload&#xA;          name: grafana-dashboard-k8s-resources-workload&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/k8s-resources-workloads-namespace&#xA;          name: grafana-dashboard-k8s-resources-workloads-namespace&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/kubelet&#xA;          name: grafana-dashboard-kubelet&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/nodes&#xA;          name: grafana-dashboard-nodes&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/persistentvolumesusage&#xA;          name: grafana-dashboard-persistentvolumesusage&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/pods&#xA;          name: grafana-dashboard-pods&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/prometheus-remote-write&#xA;          name: grafana-dashboard-prometheus-remote-write&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/prometheus&#xA;          name: grafana-dashboard-prometheus&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/proxy&#xA;          name: grafana-dashboard-proxy&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/scheduler&#xA;          name: grafana-dashboard-scheduler&#xA;          readOnly: false&#xA;        - mountPath: /grafana-dashboard-definitions/0/statefulset&#xA;          name: grafana-dashboard-statefulset&#xA;          readOnly: false&#xA;        - mountPath: /etc/grafana&#xA;          name: config-custom&#xA;      nodeSelector:&#xA;        beta.kubernetes.io/os: linux&#xA;      securityContext:&#xA;        runAsNonRoot: true&#xA;        runAsUser: 65534&#xA;      serviceAccountName: grafana&#xA;      volumes:&#xA;      - emptyDir: {}&#xA;        name: grafana-storage&#xA;      - name: grafana-datasources&#xA;        secret:&#xA;          secretName: grafana-datasources&#xA;      - configMap:&#xA;          name: grafana-dashboards&#xA;        name: grafana-dashboards&#xA;      - configMap:&#xA;          name: grafana-dashboard-apiserver&#xA;        name: grafana-dashboard-apiserver&#xA;      - configMap:&#xA;          name: grafana-dashboard-controller-manager&#xA;        name: grafana-dashboard-controller-manager&#xA;      - configMap:&#xA;          name: grafana-dashboard-k8s-cluster-rsrc-use&#xA;        name: grafana-dashboard-k8s-cluster-rsrc-use&#xA;      - configMap:&#xA;          name: grafana-dashboard-k8s-node-rsrc-use&#xA;        name: grafana-dashboard-k8s-node-rsrc-use&#xA;      - configMap:&#xA;          name: grafana-dashboard-k8s-resources-cluster&#xA;        name: grafana-dashboard-k8s-resources-cluster&#xA;      - configMap:&#xA;          name: grafana-dashboard-k8s-resources-namespace&#xA;        name: grafana-dashboard-k8s-resources-namespace&#xA;      - configMap:&#xA;          name: grafana-dashboard-k8s-resources-pod&#xA;        name: grafana-dashboard-k8s-resources-pod&#xA;      - configMap:&#xA;          name: grafana-dashboard-k8s-resources-workload&#xA;        name: grafana-dashboard-k8s-resources-workload&#xA;      - configMap:&#xA;          name: grafana-dashboard-k8s-resources-workloads-namespace&#xA;        name: grafana-dashboard-k8s-resources-workloads-namespace&#xA;      - configMap:&#xA;          name: grafana-dashboard-kubelet&#xA;        name: grafana-dashboard-kubelet&#xA;      - configMap:&#xA;          name: grafana-dashboard-nodes&#xA;        name: grafana-dashboard-nodes&#xA;      - configMap:&#xA;          name: grafana-dashboard-persistentvolumesusage&#xA;        name: grafana-dashboard-persistentvolumesusage&#xA;      - configMap:&#xA;          name: grafana-dashboard-pods&#xA;        name: grafana-dashboard-pods&#xA;      - configMap:&#xA;          name: grafana-dashboard-prometheus-remote-write&#xA;        name: grafana-dashboard-prometheus-remote-write&#xA;      - configMap:&#xA;          name: grafana-dashboard-prometheus&#xA;        name: grafana-dashboard-prometheus&#xA;      - configMap:&#xA;          name: grafana-dashboard-proxy&#xA;        name: grafana-dashboard-proxy&#xA;      - configMap:&#xA;          name: grafana-dashboard-scheduler&#xA;        name: grafana-dashboard-scheduler&#xA;      - configMap:&#xA;          name: grafana-dashboard-statefulset&#xA;        name: grafana-dashboard-statefulset&#xA;      - configMap:&#xA;          name: grafana-config&#xA;        name: config-custom&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其实就是将一个叫grafana-config的configMap作为volumeMount到/etc/grafana下。 然后我们创建这个configMap&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# grafana-configmap.yaml&#xA;&#xA;apiVersion: v1&#xA;kind: ConfigMap&#xA;metadata:&#xA;  name: grafana-config&#xA;  namespace: monitoring&#xA;data:&#xA;  grafana.ini: |&#xA;    [smtp]&#xA;    enabled = true&#xA;    host = smtp.calmkart.com:465&#xA;    user = calmkart@calmkart.com&#xA;    password = xxxxxxxxxx&#xA;    skip_verify = false&#xA;    from_address = calmkart@calmkart.com&#xA;    from_name = grafana&#xA;&#xA;# kubectl apply -f grafana-configmap.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这样就可以替换掉默认的配置文件了。&lt;/p&gt;&#xA;&lt;p&gt;另外还有关于如何为grafana增加plugin等等话题，可以参考官方的相关资料。 就简单介绍到这里吧。&lt;/p&gt;</description>
        </item><item>
            <title>grafana dashboard django bug修复</title>
            <link>http://localhost:1313/posts/2019/08/2019-08-14-grafana-dashboard-django-bug%E4%BF%AE%E5%A4%8D/</link>
            <pubDate>Wed, 14 Aug 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/08/2019-08-14-grafana-dashboard-django-bug%E4%BF%AE%E5%A4%8D/</guid>
            <description>&lt;p&gt;grafana的官方有很多用户提供的dashboard样本,其中关于django的有&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://grafana.com/grafana/dashboards/9528&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://grafana.com/grafana/dashboards/9528&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;对应的django-metric是&lt;a class=&#34;link&#34; href=&#34;https://github.com/korfuri/django-prometheus/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/korfuri/django-prometheus/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;但是这个dashboard的页面是有问题的。页面的选择器选择的label是app，但是prometheus采集到的metric label是service和job。所以我们需要把dashboard json做一下修改。&lt;/p&gt;&#xA;&lt;p&gt;修改后的dashboard json如下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;{&#xA;  &amp;#34;annotations&amp;#34;: {&#xA;    &amp;#34;list&amp;#34;: [&#xA;      {&#xA;        &amp;#34;builtIn&amp;#34;: 1,&#xA;        &amp;#34;datasource&amp;#34;: &amp;#34;-- Grafana --&amp;#34;,&#xA;        &amp;#34;enable&amp;#34;: true,&#xA;        &amp;#34;hide&amp;#34;: true,&#xA;        &amp;#34;iconColor&amp;#34;: &amp;#34;rgba(0, 211, 255, 1)&amp;#34;,&#xA;        &amp;#34;name&amp;#34;: &amp;#34;Annotations &amp;amp; Alerts&amp;#34;,&#xA;        &amp;#34;type&amp;#34;: &amp;#34;dashboard&amp;#34;&#xA;      }&#xA;    ]&#xA;  },&#xA;  &amp;#34;description&amp;#34;: &amp;#34;Django metrics dashboard using korfuri/django-prometheus Prometheus metrics exporter&amp;#34;,&#xA;  &amp;#34;editable&amp;#34;: true,&#xA;  &amp;#34;gnetId&amp;#34;: 9528,&#xA;  &amp;#34;graphTooltip&amp;#34;: 0,&#xA;  &amp;#34;id&amp;#34;: 21,&#xA;  &amp;#34;iteration&amp;#34;: 1565764572579,&#xA;  &amp;#34;links&amp;#34;: [],&#xA;  &amp;#34;panels&amp;#34;: [&#xA;    {&#xA;      &amp;#34;cacheTimeout&amp;#34;: null,&#xA;      &amp;#34;colorBackground&amp;#34;: false,&#xA;      &amp;#34;colorValue&amp;#34;: false,&#xA;      &amp;#34;colors&amp;#34;: [&#xA;        &amp;#34;#299c46&amp;#34;,&#xA;        &amp;#34;rgba(237, 129, 40, 0.89)&amp;#34;,&#xA;        &amp;#34;#d44a3a&amp;#34;&#xA;      ],&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;description&amp;#34;: &amp;#34;increase(v range-vector) calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. The increase is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if a counter increases only by integer increments.&amp;#34;,&#xA;      &amp;#34;format&amp;#34;: &amp;#34;none&amp;#34;,&#xA;      &amp;#34;gauge&amp;#34;: {&#xA;        &amp;#34;maxValue&amp;#34;: 100,&#xA;        &amp;#34;minValue&amp;#34;: 0,&#xA;        &amp;#34;show&amp;#34;: false,&#xA;        &amp;#34;thresholdLabels&amp;#34;: false,&#xA;        &amp;#34;thresholdMarkers&amp;#34;: true&#xA;      },&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 2,&#xA;        &amp;#34;w&amp;#34;: 12,&#xA;        &amp;#34;x&amp;#34;: 0,&#xA;        &amp;#34;y&amp;#34;: 0&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 13,&#xA;      &amp;#34;interval&amp;#34;: null,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;mappingType&amp;#34;: 1,&#xA;      &amp;#34;mappingTypes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;name&amp;#34;: &amp;#34;value to text&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: 1&#xA;        },&#xA;        {&#xA;          &amp;#34;name&amp;#34;: &amp;#34;range to text&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: 2&#xA;        }&#xA;      ],&#xA;      &amp;#34;maxDataPoints&amp;#34;: 100,&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;connected&amp;#34;,&#xA;      &amp;#34;nullText&amp;#34;: null,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;postfix&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;postfixFontSize&amp;#34;: &amp;#34;50%&amp;#34;,&#xA;      &amp;#34;prefix&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;prefixFontSize&amp;#34;: &amp;#34;50%&amp;#34;,&#xA;      &amp;#34;rangeMaps&amp;#34;: [&#xA;        {&#xA;          &amp;#34;from&amp;#34;: &amp;#34;null&amp;#34;,&#xA;          &amp;#34;text&amp;#34;: &amp;#34;N/A&amp;#34;,&#xA;          &amp;#34;to&amp;#34;: &amp;#34;null&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;sparkline&amp;#34;: {&#xA;        &amp;#34;fillColor&amp;#34;: &amp;#34;rgba(31, 118, 189, 0.18)&amp;#34;,&#xA;        &amp;#34;full&amp;#34;: false,&#xA;        &amp;#34;lineColor&amp;#34;: &amp;#34;rgb(31, 120, 193)&amp;#34;,&#xA;        &amp;#34;show&amp;#34;: false&#xA;      },&#xA;      &amp;#34;tableColumn&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_http_requests_total_by_transport_total{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;}[1m]))&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;Total Requests&amp;#34;,&#xA;      &amp;#34;type&amp;#34;: &amp;#34;singlestat&amp;#34;,&#xA;      &amp;#34;valueFontSize&amp;#34;: &amp;#34;80%&amp;#34;,&#xA;      &amp;#34;valueMaps&amp;#34;: [&#xA;        {&#xA;          &amp;#34;op&amp;#34;: &amp;#34;=&amp;#34;,&#xA;          &amp;#34;text&amp;#34;: &amp;#34;N/A&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: &amp;#34;null&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;valueName&amp;#34;: &amp;#34;avg&amp;#34;&#xA;    },&#xA;    {&#xA;      &amp;#34;cacheTimeout&amp;#34;: null,&#xA;      &amp;#34;colorBackground&amp;#34;: false,&#xA;      &amp;#34;colorValue&amp;#34;: false,&#xA;      &amp;#34;colors&amp;#34;: [&#xA;        &amp;#34;#629e51&amp;#34;,&#xA;        &amp;#34;rgba(237, 129, 40, 0.89)&amp;#34;,&#xA;        &amp;#34;#d44a3a&amp;#34;&#xA;      ],&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;format&amp;#34;: &amp;#34;none&amp;#34;,&#xA;      &amp;#34;gauge&amp;#34;: {&#xA;        &amp;#34;maxValue&amp;#34;: 100,&#xA;        &amp;#34;minValue&amp;#34;: 0,&#xA;        &amp;#34;show&amp;#34;: false,&#xA;        &amp;#34;thresholdLabels&amp;#34;: false,&#xA;        &amp;#34;thresholdMarkers&amp;#34;: true&#xA;      },&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 2,&#xA;        &amp;#34;w&amp;#34;: 4,&#xA;        &amp;#34;x&amp;#34;: 12,&#xA;        &amp;#34;y&amp;#34;: 0&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 15,&#xA;      &amp;#34;interval&amp;#34;: null,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;mappingType&amp;#34;: 1,&#xA;      &amp;#34;mappingTypes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;name&amp;#34;: &amp;#34;value to text&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: 1&#xA;        },&#xA;        {&#xA;          &amp;#34;name&amp;#34;: &amp;#34;range to text&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: 2&#xA;        }&#xA;      ],&#xA;      &amp;#34;maxDataPoints&amp;#34;: 100,&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;connected&amp;#34;,&#xA;      &amp;#34;nullText&amp;#34;: null,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;postfix&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;postfixFontSize&amp;#34;: &amp;#34;50%&amp;#34;,&#xA;      &amp;#34;prefix&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;prefixFontSize&amp;#34;: &amp;#34;50%&amp;#34;,&#xA;      &amp;#34;rangeMaps&amp;#34;: [&#xA;        {&#xA;          &amp;#34;from&amp;#34;: &amp;#34;null&amp;#34;,&#xA;          &amp;#34;text&amp;#34;: &amp;#34;N/A&amp;#34;,&#xA;          &amp;#34;to&amp;#34;: &amp;#34;null&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;sparkline&amp;#34;: {&#xA;        &amp;#34;fillColor&amp;#34;: &amp;#34;rgba(31, 118, 189, 0.18)&amp;#34;,&#xA;        &amp;#34;full&amp;#34;: false,&#xA;        &amp;#34;lineColor&amp;#34;: &amp;#34;rgb(31, 120, 193)&amp;#34;,&#xA;        &amp;#34;show&amp;#34;: false&#xA;      },&#xA;      &amp;#34;tableColumn&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_http_responses_total_by_status_total{status=~\&amp;#34;2.+\&amp;#34;,namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;}[1m]))&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;2XX Responses&amp;#34;,&#xA;      &amp;#34;type&amp;#34;: &amp;#34;singlestat&amp;#34;,&#xA;      &amp;#34;valueFontSize&amp;#34;: &amp;#34;80%&amp;#34;,&#xA;      &amp;#34;valueMaps&amp;#34;: [&#xA;        {&#xA;          &amp;#34;op&amp;#34;: &amp;#34;=&amp;#34;,&#xA;          &amp;#34;text&amp;#34;: &amp;#34;N/A&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: &amp;#34;null&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;valueName&amp;#34;: &amp;#34;avg&amp;#34;&#xA;    },&#xA;    {&#xA;      &amp;#34;cacheTimeout&amp;#34;: null,&#xA;      &amp;#34;colorBackground&amp;#34;: false,&#xA;      &amp;#34;colorValue&amp;#34;: false,&#xA;      &amp;#34;colors&amp;#34;: [&#xA;        &amp;#34;#299c46&amp;#34;,&#xA;        &amp;#34;rgba(237, 129, 40, 0.89)&amp;#34;,&#xA;        &amp;#34;#d44a3a&amp;#34;&#xA;      ],&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;format&amp;#34;: &amp;#34;none&amp;#34;,&#xA;      &amp;#34;gauge&amp;#34;: {&#xA;        &amp;#34;maxValue&amp;#34;: 100,&#xA;        &amp;#34;minValue&amp;#34;: 0,&#xA;        &amp;#34;show&amp;#34;: false,&#xA;        &amp;#34;thresholdLabels&amp;#34;: false,&#xA;        &amp;#34;thresholdMarkers&amp;#34;: true&#xA;      },&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 2,&#xA;        &amp;#34;w&amp;#34;: 4,&#xA;        &amp;#34;x&amp;#34;: 16,&#xA;        &amp;#34;y&amp;#34;: 0&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 16,&#xA;      &amp;#34;interval&amp;#34;: null,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;mappingType&amp;#34;: 1,&#xA;      &amp;#34;mappingTypes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;name&amp;#34;: &amp;#34;value to text&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: 1&#xA;        },&#xA;        {&#xA;          &amp;#34;name&amp;#34;: &amp;#34;range to text&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: 2&#xA;        }&#xA;      ],&#xA;      &amp;#34;maxDataPoints&amp;#34;: 100,&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;connected&amp;#34;,&#xA;      &amp;#34;nullText&amp;#34;: null,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;postfix&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;postfixFontSize&amp;#34;: &amp;#34;50%&amp;#34;,&#xA;      &amp;#34;prefix&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;prefixFontSize&amp;#34;: &amp;#34;50%&amp;#34;,&#xA;      &amp;#34;rangeMaps&amp;#34;: [&#xA;        {&#xA;          &amp;#34;from&amp;#34;: &amp;#34;null&amp;#34;,&#xA;          &amp;#34;text&amp;#34;: &amp;#34;N/A&amp;#34;,&#xA;          &amp;#34;to&amp;#34;: &amp;#34;null&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;sparkline&amp;#34;: {&#xA;        &amp;#34;fillColor&amp;#34;: &amp;#34;rgba(31, 118, 189, 0.18)&amp;#34;,&#xA;        &amp;#34;full&amp;#34;: false,&#xA;        &amp;#34;lineColor&amp;#34;: &amp;#34;rgb(31, 120, 193)&amp;#34;,&#xA;        &amp;#34;show&amp;#34;: false&#xA;      },&#xA;      &amp;#34;tableColumn&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_http_responses_total_by_status_total{status=~\&amp;#34;4.+\&amp;#34;,namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;}[1m]))&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;4XX Responses&amp;#34;,&#xA;      &amp;#34;type&amp;#34;: &amp;#34;singlestat&amp;#34;,&#xA;      &amp;#34;valueFontSize&amp;#34;: &amp;#34;80%&amp;#34;,&#xA;      &amp;#34;valueMaps&amp;#34;: [&#xA;        {&#xA;          &amp;#34;op&amp;#34;: &amp;#34;=&amp;#34;,&#xA;          &amp;#34;text&amp;#34;: &amp;#34;N/A&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: &amp;#34;null&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;valueName&amp;#34;: &amp;#34;avg&amp;#34;&#xA;    },&#xA;    {&#xA;      &amp;#34;cacheTimeout&amp;#34;: null,&#xA;      &amp;#34;colorBackground&amp;#34;: false,&#xA;      &amp;#34;colorValue&amp;#34;: false,&#xA;      &amp;#34;colors&amp;#34;: [&#xA;        &amp;#34;#299c46&amp;#34;,&#xA;        &amp;#34;rgba(237, 129, 40, 0.89)&amp;#34;,&#xA;        &amp;#34;#d44a3a&amp;#34;&#xA;      ],&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;format&amp;#34;: &amp;#34;none&amp;#34;,&#xA;      &amp;#34;gauge&amp;#34;: {&#xA;        &amp;#34;maxValue&amp;#34;: 100,&#xA;        &amp;#34;minValue&amp;#34;: 0,&#xA;        &amp;#34;show&amp;#34;: false,&#xA;        &amp;#34;thresholdLabels&amp;#34;: false,&#xA;        &amp;#34;thresholdMarkers&amp;#34;: true&#xA;      },&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 2,&#xA;        &amp;#34;w&amp;#34;: 4,&#xA;        &amp;#34;x&amp;#34;: 20,&#xA;        &amp;#34;y&amp;#34;: 0&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 17,&#xA;      &amp;#34;interval&amp;#34;: null,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;mappingType&amp;#34;: 1,&#xA;      &amp;#34;mappingTypes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;name&amp;#34;: &amp;#34;value to text&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: 1&#xA;        },&#xA;        {&#xA;          &amp;#34;name&amp;#34;: &amp;#34;range to text&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: 2&#xA;        }&#xA;      ],&#xA;      &amp;#34;maxDataPoints&amp;#34;: 100,&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;connected&amp;#34;,&#xA;      &amp;#34;nullText&amp;#34;: null,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;postfix&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;postfixFontSize&amp;#34;: &amp;#34;50%&amp;#34;,&#xA;      &amp;#34;prefix&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;prefixFontSize&amp;#34;: &amp;#34;50%&amp;#34;,&#xA;      &amp;#34;rangeMaps&amp;#34;: [&#xA;        {&#xA;          &amp;#34;from&amp;#34;: &amp;#34;null&amp;#34;,&#xA;          &amp;#34;text&amp;#34;: &amp;#34;N/A&amp;#34;,&#xA;          &amp;#34;to&amp;#34;: &amp;#34;null&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;sparkline&amp;#34;: {&#xA;        &amp;#34;fillColor&amp;#34;: &amp;#34;rgba(31, 118, 189, 0.18)&amp;#34;,&#xA;        &amp;#34;full&amp;#34;: false,&#xA;        &amp;#34;lineColor&amp;#34;: &amp;#34;rgb(31, 120, 193)&amp;#34;,&#xA;        &amp;#34;show&amp;#34;: false&#xA;      },&#xA;      &amp;#34;tableColumn&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_http_responses_total_by_status_total{status=~\&amp;#34;5.+\&amp;#34;,namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;}[1m]))&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: &amp;#34;&amp;#34;,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;5XX Responses&amp;#34;,&#xA;      &amp;#34;type&amp;#34;: &amp;#34;singlestat&amp;#34;,&#xA;      &amp;#34;valueFontSize&amp;#34;: &amp;#34;80%&amp;#34;,&#xA;      &amp;#34;valueMaps&amp;#34;: [&#xA;        {&#xA;          &amp;#34;op&amp;#34;: &amp;#34;=&amp;#34;,&#xA;          &amp;#34;text&amp;#34;: &amp;#34;N/A&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: &amp;#34;null&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;valueName&amp;#34;: &amp;#34;avg&amp;#34;&#xA;    },&#xA;    {&#xA;      &amp;#34;aliasColors&amp;#34;: {},&#xA;      &amp;#34;bars&amp;#34;: false,&#xA;      &amp;#34;dashLength&amp;#34;: 10,&#xA;      &amp;#34;dashes&amp;#34;: false,&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;fill&amp;#34;: 1,&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 9,&#xA;        &amp;#34;w&amp;#34;: 12,&#xA;        &amp;#34;x&amp;#34;: 0,&#xA;        &amp;#34;y&amp;#34;: 2&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 2,&#xA;      &amp;#34;legend&amp;#34;: {&#xA;        &amp;#34;avg&amp;#34;: false,&#xA;        &amp;#34;current&amp;#34;: false,&#xA;        &amp;#34;max&amp;#34;: false,&#xA;        &amp;#34;min&amp;#34;: false,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;total&amp;#34;: false,&#xA;        &amp;#34;values&amp;#34;: false&#xA;      },&#xA;      &amp;#34;lines&amp;#34;: true,&#xA;      &amp;#34;linewidth&amp;#34;: 1,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;null&amp;#34;,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;percentage&amp;#34;: false,&#xA;      &amp;#34;pointradius&amp;#34;: 5,&#xA;      &amp;#34;points&amp;#34;: false,&#xA;      &amp;#34;renderer&amp;#34;: &amp;#34;flot&amp;#34;,&#xA;      &amp;#34;seriesOverrides&amp;#34;: [],&#xA;      &amp;#34;spaceLength&amp;#34;: 10,&#xA;      &amp;#34;stack&amp;#34;: false,&#xA;      &amp;#34;steppedLine&amp;#34;: false,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_http_requests_total_by_view_transport_method_total{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;,view!~\&amp;#34;prometheus-django-metrics|healthcheck\&amp;#34;}[1m])) by(method, view)&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;hide&amp;#34;: false,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;{{method}} /{{view}}&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: [],&#xA;      &amp;#34;timeFrom&amp;#34;: null,&#xA;      &amp;#34;timeRegions&amp;#34;: [],&#xA;      &amp;#34;timeShift&amp;#34;: null,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;Requests&amp;#34;,&#xA;      &amp;#34;tooltip&amp;#34;: {&#xA;        &amp;#34;shared&amp;#34;: true,&#xA;        &amp;#34;sort&amp;#34;: 0,&#xA;        &amp;#34;value_type&amp;#34;: &amp;#34;individual&amp;#34;&#xA;      },&#xA;      &amp;#34;type&amp;#34;: &amp;#34;graph&amp;#34;,&#xA;      &amp;#34;xaxis&amp;#34;: {&#xA;        &amp;#34;buckets&amp;#34;: null,&#xA;        &amp;#34;mode&amp;#34;: &amp;#34;time&amp;#34;,&#xA;        &amp;#34;name&amp;#34;: null,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;values&amp;#34;: []&#xA;      },&#xA;      &amp;#34;yaxes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        },&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        }&#xA;      ],&#xA;      &amp;#34;yaxis&amp;#34;: {&#xA;        &amp;#34;align&amp;#34;: false,&#xA;        &amp;#34;alignLevel&amp;#34;: null&#xA;      }&#xA;    },&#xA;    {&#xA;      &amp;#34;aliasColors&amp;#34;: {},&#xA;      &amp;#34;bars&amp;#34;: false,&#xA;      &amp;#34;dashLength&amp;#34;: 10,&#xA;      &amp;#34;dashes&amp;#34;: false,&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;fill&amp;#34;: 1,&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 9,&#xA;        &amp;#34;w&amp;#34;: 12,&#xA;        &amp;#34;x&amp;#34;: 12,&#xA;        &amp;#34;y&amp;#34;: 2&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 4,&#xA;      &amp;#34;legend&amp;#34;: {&#xA;        &amp;#34;avg&amp;#34;: false,&#xA;        &amp;#34;current&amp;#34;: false,&#xA;        &amp;#34;max&amp;#34;: false,&#xA;        &amp;#34;min&amp;#34;: false,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;total&amp;#34;: false,&#xA;        &amp;#34;values&amp;#34;: false&#xA;      },&#xA;      &amp;#34;lines&amp;#34;: true,&#xA;      &amp;#34;linewidth&amp;#34;: 1,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;null&amp;#34;,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;percentage&amp;#34;: false,&#xA;      &amp;#34;pointradius&amp;#34;: 5,&#xA;      &amp;#34;points&amp;#34;: false,&#xA;      &amp;#34;renderer&amp;#34;: &amp;#34;flot&amp;#34;,&#xA;      &amp;#34;seriesOverrides&amp;#34;: [],&#xA;      &amp;#34;spaceLength&amp;#34;: 10,&#xA;      &amp;#34;stack&amp;#34;: false,&#xA;      &amp;#34;steppedLine&amp;#34;: false,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;histogram_quantile(0.50, sum(rate(django_http_requests_latency_seconds_by_view_method_bucket{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;,view!~\&amp;#34;prometheus-django-metrics|healthcheck\&amp;#34;}[5m])) by (job, le))&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;interval&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;quantile=50&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        },&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;histogram_quantile(0.95, sum(rate(django_http_requests_latency_seconds_by_view_method_bucket{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;,view!~\&amp;#34;prometheus-django-metrics|healthcheck\&amp;#34;}[5m])) by (job, le))&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;hide&amp;#34;: false,&#xA;          &amp;#34;interval&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;quantile=95&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;B&amp;#34;&#xA;        },&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;histogram_quantile(0.99, sum(rate(django_http_requests_latency_seconds_by_view_method_bucket{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;,view!~\&amp;#34;prometheus-django-metrics|healthcheck\&amp;#34;}[5m])) by (job, le))&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;hide&amp;#34;: false,&#xA;          &amp;#34;interval&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;quantile=99&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;C&amp;#34;&#xA;        },&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;histogram_quantile(0.999, sum(rate(django_http_requests_latency_seconds_by_view_method_bucket{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;,view!~\&amp;#34;prometheus-django-metrics|healthcheck\&amp;#34;}[5m])) by (job, le))&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;hide&amp;#34;: false,&#xA;          &amp;#34;interval&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;quantile=99.9&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;D&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: [],&#xA;      &amp;#34;timeFrom&amp;#34;: null,&#xA;      &amp;#34;timeRegions&amp;#34;: [],&#xA;      &amp;#34;timeShift&amp;#34;: null,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;Request Latency&amp;#34;,&#xA;      &amp;#34;tooltip&amp;#34;: {&#xA;        &amp;#34;shared&amp;#34;: true,&#xA;        &amp;#34;sort&amp;#34;: 0,&#xA;        &amp;#34;value_type&amp;#34;: &amp;#34;individual&amp;#34;&#xA;      },&#xA;      &amp;#34;type&amp;#34;: &amp;#34;graph&amp;#34;,&#xA;      &amp;#34;xaxis&amp;#34;: {&#xA;        &amp;#34;buckets&amp;#34;: null,&#xA;        &amp;#34;mode&amp;#34;: &amp;#34;time&amp;#34;,&#xA;        &amp;#34;name&amp;#34;: null,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;values&amp;#34;: []&#xA;      },&#xA;      &amp;#34;yaxes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;dtdurations&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        },&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        }&#xA;      ],&#xA;      &amp;#34;yaxis&amp;#34;: {&#xA;        &amp;#34;align&amp;#34;: false,&#xA;        &amp;#34;alignLevel&amp;#34;: null&#xA;      }&#xA;    },&#xA;    {&#xA;      &amp;#34;aliasColors&amp;#34;: {&#xA;        &amp;#34;api-beatstream-api&amp;#34;: &amp;#34;#1f78c1&amp;#34;&#xA;      },&#xA;      &amp;#34;bars&amp;#34;: false,&#xA;      &amp;#34;dashLength&amp;#34;: 10,&#xA;      &amp;#34;dashes&amp;#34;: false,&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;fill&amp;#34;: 1,&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 9,&#xA;        &amp;#34;w&amp;#34;: 12,&#xA;        &amp;#34;x&amp;#34;: 0,&#xA;        &amp;#34;y&amp;#34;: 11&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 7,&#xA;      &amp;#34;legend&amp;#34;: {&#xA;        &amp;#34;avg&amp;#34;: false,&#xA;        &amp;#34;current&amp;#34;: false,&#xA;        &amp;#34;max&amp;#34;: false,&#xA;        &amp;#34;min&amp;#34;: false,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;total&amp;#34;: false,&#xA;        &amp;#34;values&amp;#34;: false&#xA;      },&#xA;      &amp;#34;lines&amp;#34;: true,&#xA;      &amp;#34;linewidth&amp;#34;: 1,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;null&amp;#34;,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;percentage&amp;#34;: false,&#xA;      &amp;#34;pointradius&amp;#34;: 5,&#xA;      &amp;#34;points&amp;#34;: false,&#xA;      &amp;#34;renderer&amp;#34;: &amp;#34;flot&amp;#34;,&#xA;      &amp;#34;seriesOverrides&amp;#34;: [&#xA;        {}&#xA;      ],&#xA;      &amp;#34;spaceLength&amp;#34;: 10,&#xA;      &amp;#34;stack&amp;#34;: false,&#xA;      &amp;#34;steppedLine&amp;#34;: false,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_http_responses_before_middlewares_total{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;, view!~\&amp;#34;prometheus-django-metrics|healthcheck\&amp;#34;}[1m])) by(job)&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;interval&amp;#34;: &amp;#34;&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;{{job}}&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: [],&#xA;      &amp;#34;timeFrom&amp;#34;: null,&#xA;      &amp;#34;timeRegions&amp;#34;: [],&#xA;      &amp;#34;timeShift&amp;#34;: null,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;Responses&amp;#34;,&#xA;      &amp;#34;tooltip&amp;#34;: {&#xA;        &amp;#34;shared&amp;#34;: true,&#xA;        &amp;#34;sort&amp;#34;: 0,&#xA;        &amp;#34;value_type&amp;#34;: &amp;#34;individual&amp;#34;&#xA;      },&#xA;      &amp;#34;type&amp;#34;: &amp;#34;graph&amp;#34;,&#xA;      &amp;#34;xaxis&amp;#34;: {&#xA;        &amp;#34;buckets&amp;#34;: null,&#xA;        &amp;#34;mode&amp;#34;: &amp;#34;time&amp;#34;,&#xA;        &amp;#34;name&amp;#34;: null,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;values&amp;#34;: []&#xA;      },&#xA;      &amp;#34;yaxes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        },&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        }&#xA;      ],&#xA;      &amp;#34;yaxis&amp;#34;: {&#xA;        &amp;#34;align&amp;#34;: false,&#xA;        &amp;#34;alignLevel&amp;#34;: null&#xA;      }&#xA;    },&#xA;    {&#xA;      &amp;#34;aliasColors&amp;#34;: {},&#xA;      &amp;#34;bars&amp;#34;: false,&#xA;      &amp;#34;dashLength&amp;#34;: 10,&#xA;      &amp;#34;dashes&amp;#34;: false,&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;fill&amp;#34;: 1,&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 9,&#xA;        &amp;#34;w&amp;#34;: 12,&#xA;        &amp;#34;x&amp;#34;: 12,&#xA;        &amp;#34;y&amp;#34;: 11&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 11,&#xA;      &amp;#34;legend&amp;#34;: {&#xA;        &amp;#34;avg&amp;#34;: false,&#xA;        &amp;#34;current&amp;#34;: false,&#xA;        &amp;#34;max&amp;#34;: false,&#xA;        &amp;#34;min&amp;#34;: false,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;total&amp;#34;: false,&#xA;        &amp;#34;values&amp;#34;: false&#xA;      },&#xA;      &amp;#34;lines&amp;#34;: true,&#xA;      &amp;#34;linewidth&amp;#34;: 1,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;null&amp;#34;,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;percentage&amp;#34;: false,&#xA;      &amp;#34;pointradius&amp;#34;: 5,&#xA;      &amp;#34;points&amp;#34;: false,&#xA;      &amp;#34;renderer&amp;#34;: &amp;#34;flot&amp;#34;,&#xA;      &amp;#34;seriesOverrides&amp;#34;: [],&#xA;      &amp;#34;spaceLength&amp;#34;: 10,&#xA;      &amp;#34;stack&amp;#34;: false,&#xA;      &amp;#34;steppedLine&amp;#34;: false,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_http_responses_total_by_status_total{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;, view!~\&amp;#34;prometheus-django-metrics|healthcheck\&amp;#34;}[1m])) by(status)&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;{{status}}&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: [],&#xA;      &amp;#34;timeFrom&amp;#34;: null,&#xA;      &amp;#34;timeRegions&amp;#34;: [],&#xA;      &amp;#34;timeShift&amp;#34;: null,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;Response Status&amp;#34;,&#xA;      &amp;#34;tooltip&amp;#34;: {&#xA;        &amp;#34;shared&amp;#34;: true,&#xA;        &amp;#34;sort&amp;#34;: 0,&#xA;        &amp;#34;value_type&amp;#34;: &amp;#34;individual&amp;#34;&#xA;      },&#xA;      &amp;#34;type&amp;#34;: &amp;#34;graph&amp;#34;,&#xA;      &amp;#34;xaxis&amp;#34;: {&#xA;        &amp;#34;buckets&amp;#34;: null,&#xA;        &amp;#34;mode&amp;#34;: &amp;#34;time&amp;#34;,&#xA;        &amp;#34;name&amp;#34;: null,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;values&amp;#34;: []&#xA;      },&#xA;      &amp;#34;yaxes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        },&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        }&#xA;      ],&#xA;      &amp;#34;yaxis&amp;#34;: {&#xA;        &amp;#34;align&amp;#34;: false,&#xA;        &amp;#34;alignLevel&amp;#34;: null&#xA;      }&#xA;    },&#xA;    {&#xA;      &amp;#34;aliasColors&amp;#34;: {&#xA;        &amp;#34;mysql&amp;#34;: &amp;#34;#584477&amp;#34;,&#xA;        &amp;#34;postgresql&amp;#34;: &amp;#34;#0064a5&amp;#34;&#xA;      },&#xA;      &amp;#34;bars&amp;#34;: false,&#xA;      &amp;#34;dashLength&amp;#34;: 10,&#xA;      &amp;#34;dashes&amp;#34;: false,&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;fill&amp;#34;: 1,&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 5,&#xA;        &amp;#34;w&amp;#34;: 24,&#xA;        &amp;#34;x&amp;#34;: 0,&#xA;        &amp;#34;y&amp;#34;: 20&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 9,&#xA;      &amp;#34;legend&amp;#34;: {&#xA;        &amp;#34;avg&amp;#34;: false,&#xA;        &amp;#34;current&amp;#34;: false,&#xA;        &amp;#34;max&amp;#34;: false,&#xA;        &amp;#34;min&amp;#34;: false,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;total&amp;#34;: false,&#xA;        &amp;#34;values&amp;#34;: false&#xA;      },&#xA;      &amp;#34;lines&amp;#34;: true,&#xA;      &amp;#34;linewidth&amp;#34;: 1,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;null&amp;#34;,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;percentage&amp;#34;: false,&#xA;      &amp;#34;pointradius&amp;#34;: 5,&#xA;      &amp;#34;points&amp;#34;: false,&#xA;      &amp;#34;renderer&amp;#34;: &amp;#34;flot&amp;#34;,&#xA;      &amp;#34;seriesOverrides&amp;#34;: [],&#xA;      &amp;#34;spaceLength&amp;#34;: 10,&#xA;      &amp;#34;stack&amp;#34;: false,&#xA;      &amp;#34;steppedLine&amp;#34;: false,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_db_execute_total{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;}[1m])) by (vendor)&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;{{vendor}}&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: [],&#xA;      &amp;#34;timeFrom&amp;#34;: null,&#xA;      &amp;#34;timeRegions&amp;#34;: [],&#xA;      &amp;#34;timeShift&amp;#34;: null,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;Database Ops&amp;#34;,&#xA;      &amp;#34;tooltip&amp;#34;: {&#xA;        &amp;#34;shared&amp;#34;: true,&#xA;        &amp;#34;sort&amp;#34;: 0,&#xA;        &amp;#34;value_type&amp;#34;: &amp;#34;individual&amp;#34;&#xA;      },&#xA;      &amp;#34;type&amp;#34;: &amp;#34;graph&amp;#34;,&#xA;      &amp;#34;xaxis&amp;#34;: {&#xA;        &amp;#34;buckets&amp;#34;: null,&#xA;        &amp;#34;mode&amp;#34;: &amp;#34;time&amp;#34;,&#xA;        &amp;#34;name&amp;#34;: null,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;values&amp;#34;: []&#xA;      },&#xA;      &amp;#34;yaxes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        },&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        }&#xA;      ],&#xA;      &amp;#34;yaxis&amp;#34;: {&#xA;        &amp;#34;align&amp;#34;: false,&#xA;        &amp;#34;alignLevel&amp;#34;: null&#xA;      }&#xA;    },&#xA;    {&#xA;      &amp;#34;aliasColors&amp;#34;: {},&#xA;      &amp;#34;bars&amp;#34;: false,&#xA;      &amp;#34;dashLength&amp;#34;: 10,&#xA;      &amp;#34;dashes&amp;#34;: false,&#xA;      &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;      &amp;#34;fill&amp;#34;: 1,&#xA;      &amp;#34;gridPos&amp;#34;: {&#xA;        &amp;#34;h&amp;#34;: 5,&#xA;        &amp;#34;w&amp;#34;: 24,&#xA;        &amp;#34;x&amp;#34;: 0,&#xA;        &amp;#34;y&amp;#34;: 25&#xA;      },&#xA;      &amp;#34;id&amp;#34;: 18,&#xA;      &amp;#34;legend&amp;#34;: {&#xA;        &amp;#34;alignAsTable&amp;#34;: true,&#xA;        &amp;#34;avg&amp;#34;: true,&#xA;        &amp;#34;current&amp;#34;: true,&#xA;        &amp;#34;hideEmpty&amp;#34;: false,&#xA;        &amp;#34;hideZero&amp;#34;: true,&#xA;        &amp;#34;max&amp;#34;: true,&#xA;        &amp;#34;min&amp;#34;: false,&#xA;        &amp;#34;rightSide&amp;#34;: true,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;total&amp;#34;: false,&#xA;        &amp;#34;values&amp;#34;: true&#xA;      },&#xA;      &amp;#34;lines&amp;#34;: true,&#xA;      &amp;#34;linewidth&amp;#34;: 1,&#xA;      &amp;#34;links&amp;#34;: [],&#xA;      &amp;#34;nullPointMode&amp;#34;: &amp;#34;null&amp;#34;,&#xA;      &amp;#34;options&amp;#34;: {},&#xA;      &amp;#34;percentage&amp;#34;: false,&#xA;      &amp;#34;pointradius&amp;#34;: 5,&#xA;      &amp;#34;points&amp;#34;: false,&#xA;      &amp;#34;renderer&amp;#34;: &amp;#34;flot&amp;#34;,&#xA;      &amp;#34;seriesOverrides&amp;#34;: [],&#xA;      &amp;#34;spaceLength&amp;#34;: 10,&#xA;      &amp;#34;stack&amp;#34;: false,&#xA;      &amp;#34;steppedLine&amp;#34;: false,&#xA;      &amp;#34;targets&amp;#34;: [&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_model_deletes_total{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;}[1m])) by (model)&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;[{{model}}] deletes&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;A&amp;#34;&#xA;        },&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_model_inserts_total{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;}[1m])) by (model)&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;[{{model}}] inserts&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;B&amp;#34;&#xA;        },&#xA;        {&#xA;          &amp;#34;expr&amp;#34;: &amp;#34;sum(irate(django_model_updates_total{namespace=~\&amp;#34;$namespace\&amp;#34;, service=~\&amp;#34;^$service$\&amp;#34;}[1m])) by (model)&amp;#34;,&#xA;          &amp;#34;format&amp;#34;: &amp;#34;time_series&amp;#34;,&#xA;          &amp;#34;intervalFactor&amp;#34;: 1,&#xA;          &amp;#34;legendFormat&amp;#34;: &amp;#34;[{{model}}] updates&amp;#34;,&#xA;          &amp;#34;refId&amp;#34;: &amp;#34;C&amp;#34;&#xA;        }&#xA;      ],&#xA;      &amp;#34;thresholds&amp;#34;: [],&#xA;      &amp;#34;timeFrom&amp;#34;: null,&#xA;      &amp;#34;timeRegions&amp;#34;: [],&#xA;      &amp;#34;timeShift&amp;#34;: null,&#xA;      &amp;#34;title&amp;#34;: &amp;#34;Models stats&amp;#34;,&#xA;      &amp;#34;tooltip&amp;#34;: {&#xA;        &amp;#34;shared&amp;#34;: true,&#xA;        &amp;#34;sort&amp;#34;: 0,&#xA;        &amp;#34;value_type&amp;#34;: &amp;#34;individual&amp;#34;&#xA;      },&#xA;      &amp;#34;type&amp;#34;: &amp;#34;graph&amp;#34;,&#xA;      &amp;#34;xaxis&amp;#34;: {&#xA;        &amp;#34;buckets&amp;#34;: null,&#xA;        &amp;#34;mode&amp;#34;: &amp;#34;time&amp;#34;,&#xA;        &amp;#34;name&amp;#34;: null,&#xA;        &amp;#34;show&amp;#34;: true,&#xA;        &amp;#34;values&amp;#34;: []&#xA;      },&#xA;      &amp;#34;yaxes&amp;#34;: [&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        },&#xA;        {&#xA;          &amp;#34;format&amp;#34;: &amp;#34;short&amp;#34;,&#xA;          &amp;#34;label&amp;#34;: null,&#xA;          &amp;#34;logBase&amp;#34;: 1,&#xA;          &amp;#34;max&amp;#34;: null,&#xA;          &amp;#34;min&amp;#34;: null,&#xA;          &amp;#34;show&amp;#34;: true&#xA;        }&#xA;      ],&#xA;      &amp;#34;yaxis&amp;#34;: {&#xA;        &amp;#34;align&amp;#34;: false,&#xA;        &amp;#34;alignLevel&amp;#34;: null&#xA;      }&#xA;    }&#xA;  ],&#xA;  &amp;#34;refresh&amp;#34;: &amp;#34;10s&amp;#34;,&#xA;  &amp;#34;schemaVersion&amp;#34;: 18,&#xA;  &amp;#34;style&amp;#34;: &amp;#34;dark&amp;#34;,&#xA;  &amp;#34;tags&amp;#34;: [],&#xA;  &amp;#34;templating&amp;#34;: {&#xA;    &amp;#34;list&amp;#34;: [&#xA;      {&#xA;        &amp;#34;current&amp;#34;: {&#xA;          &amp;#34;text&amp;#34;: &amp;#34;prometheus&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: &amp;#34;prometheus&amp;#34;&#xA;        },&#xA;        &amp;#34;hide&amp;#34;: 0,&#xA;        &amp;#34;includeAll&amp;#34;: false,&#xA;        &amp;#34;label&amp;#34;: null,&#xA;        &amp;#34;multi&amp;#34;: false,&#xA;        &amp;#34;name&amp;#34;: &amp;#34;datasource&amp;#34;,&#xA;        &amp;#34;options&amp;#34;: [],&#xA;        &amp;#34;query&amp;#34;: &amp;#34;prometheus&amp;#34;,&#xA;        &amp;#34;refresh&amp;#34;: 1,&#xA;        &amp;#34;regex&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;skipUrlSync&amp;#34;: false,&#xA;        &amp;#34;type&amp;#34;: &amp;#34;datasource&amp;#34;&#xA;      },&#xA;      {&#xA;        &amp;#34;allValue&amp;#34;: &amp;#34;.*&amp;#34;,&#xA;        &amp;#34;current&amp;#34;: {&#xA;          &amp;#34;text&amp;#34;: &amp;#34;default&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: &amp;#34;default&amp;#34;&#xA;        },&#xA;        &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;        &amp;#34;definition&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;hide&amp;#34;: 0,&#xA;        &amp;#34;includeAll&amp;#34;: false,&#xA;        &amp;#34;label&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;multi&amp;#34;: false,&#xA;        &amp;#34;name&amp;#34;: &amp;#34;namespace&amp;#34;,&#xA;        &amp;#34;options&amp;#34;: [],&#xA;        &amp;#34;query&amp;#34;: &amp;#34;label_values(django_db_new_connections_total, namespace)&amp;#34;,&#xA;        &amp;#34;refresh&amp;#34;: 1,&#xA;        &amp;#34;regex&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;skipUrlSync&amp;#34;: false,&#xA;        &amp;#34;sort&amp;#34;: 1,&#xA;        &amp;#34;tagValuesQuery&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;tags&amp;#34;: [],&#xA;        &amp;#34;tagsQuery&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;type&amp;#34;: &amp;#34;query&amp;#34;,&#xA;        &amp;#34;useTags&amp;#34;: false&#xA;      },&#xA;      {&#xA;        &amp;#34;allValue&amp;#34;: null,&#xA;        &amp;#34;current&amp;#34;: {&#xA;          &amp;#34;text&amp;#34;: &amp;#34;All&amp;#34;,&#xA;          &amp;#34;value&amp;#34;: &amp;#34;$__all&amp;#34;&#xA;        },&#xA;        &amp;#34;datasource&amp;#34;: &amp;#34;$datasource&amp;#34;,&#xA;        &amp;#34;definition&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;hide&amp;#34;: 0,&#xA;        &amp;#34;includeAll&amp;#34;: true,&#xA;        &amp;#34;label&amp;#34;: &amp;#34;app&amp;#34;,&#xA;        &amp;#34;multi&amp;#34;: false,&#xA;        &amp;#34;name&amp;#34;: &amp;#34;service&amp;#34;,&#xA;        &amp;#34;options&amp;#34;: [],&#xA;        &amp;#34;query&amp;#34;: &amp;#34;label_values(django_db_new_connections_total{namespace=~\&amp;#34;$namespace\&amp;#34;}, service)&amp;#34;,&#xA;        &amp;#34;refresh&amp;#34;: 1,&#xA;        &amp;#34;regex&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;skipUrlSync&amp;#34;: false,&#xA;        &amp;#34;sort&amp;#34;: 0,&#xA;        &amp;#34;tagValuesQuery&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;tags&amp;#34;: [],&#xA;        &amp;#34;tagsQuery&amp;#34;: &amp;#34;&amp;#34;,&#xA;        &amp;#34;type&amp;#34;: &amp;#34;query&amp;#34;,&#xA;        &amp;#34;useTags&amp;#34;: false&#xA;      }&#xA;    ]&#xA;  },&#xA;  &amp;#34;time&amp;#34;: {&#xA;    &amp;#34;from&amp;#34;: &amp;#34;now-15m&amp;#34;,&#xA;    &amp;#34;to&amp;#34;: &amp;#34;now&amp;#34;&#xA;  },&#xA;  &amp;#34;timepicker&amp;#34;: {&#xA;    &amp;#34;refresh_intervals&amp;#34;: [&#xA;      &amp;#34;5s&amp;#34;,&#xA;      &amp;#34;10s&amp;#34;,&#xA;      &amp;#34;30s&amp;#34;,&#xA;      &amp;#34;1m&amp;#34;,&#xA;      &amp;#34;5m&amp;#34;,&#xA;      &amp;#34;15m&amp;#34;,&#xA;      &amp;#34;30m&amp;#34;,&#xA;      &amp;#34;1h&amp;#34;,&#xA;      &amp;#34;2h&amp;#34;,&#xA;      &amp;#34;1d&amp;#34;&#xA;    ],&#xA;    &amp;#34;time_options&amp;#34;: [&#xA;      &amp;#34;5m&amp;#34;,&#xA;      &amp;#34;15m&amp;#34;,&#xA;      &amp;#34;1h&amp;#34;,&#xA;      &amp;#34;6h&amp;#34;,&#xA;      &amp;#34;12h&amp;#34;,&#xA;      &amp;#34;24h&amp;#34;,&#xA;      &amp;#34;2d&amp;#34;,&#xA;      &amp;#34;7d&amp;#34;,&#xA;      &amp;#34;30d&amp;#34;&#xA;    ]&#xA;  },&#xA;  &amp;#34;timezone&amp;#34;: &amp;#34;&amp;#34;,&#xA;  &amp;#34;title&amp;#34;: &amp;#34;a Django Prometheus&amp;#34;,&#xA;  &amp;#34;uid&amp;#34;: &amp;#34;O6v4rMpizda&amp;#34;,&#xA;  &amp;#34;version&amp;#34;: 1&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
        </item><item>
            <title>helm chart的制作及使用(顺便拉个票)</title>
            <link>http://localhost:1313/posts/2019/08/2019-08-14-helm-chart%E7%9A%84%E5%88%B6%E4%BD%9C%E5%8F%8A%E4%BD%BF%E7%94%A8%E9%A1%BA%E4%BE%BF%E6%8B%89%E4%B8%AA%E7%A5%A8/</link>
            <pubDate>Wed, 14 Aug 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/08/2019-08-14-helm-chart%E7%9A%84%E5%88%B6%E4%BD%9C%E5%8F%8A%E4%BD%BF%E7%94%A8%E9%A1%BA%E4%BE%BF%E6%8B%89%E4%B8%AA%E7%A5%A8/</guid>
            <description>&lt;p&gt;首先拉个票 [阿里云开发者社区-云原生应用大赛] &lt;a class=&#34;link&#34; href=&#34;https://developer.aliyun.com/hub&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://developer.aliyun.com/hub&lt;/a&gt; 麻烦不反感拉票的,有兴趣有空的,给我提交的下面三个应用点个星星，多谢了。(阿里云普通账号即可投票,支付宝登录亦可) &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/08/C0B4B70807593CFFFD06C612FCE18009.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/C0B4B70807593CFFFD06C612FCE18009.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;在k8s的容器云环境中,应用的部署方式通常是编写对应的api对象申明文件来完成. 比如比较简单的应用,如简单的django应用,我们通常就需要首先编写deployment用于控制replicaset-&amp;gt;pod，然后编写service控制deployment，最后编写ingress做服务暴露. 而比较复杂的应用,如prometheus,我们通常就要用到用户定义api对象crd,然后编写对应的循环和控制,最后完成上面的那一套部署方式.&lt;/p&gt;&#xA;&lt;p&gt;显然,这挺复杂的,而且特别多的东西感觉都可以用模板传变量来代替.那么我们是否需要自己编写一个系统用以根据参数自动生成这些复杂的yaml文件呢?答案基本上是没必要的(当然一切特殊情况还是需要),我们有helm来帮我们做这一切.&lt;/p&gt;&#xA;&lt;p&gt;你可以将helm与k8s的关系看作yum之于centos的关系.helm将应用进行打包,我们就可以通过填写必要的参数，自动生成和部署批量的yaml文件，从而实现一键部署复杂的系统. 比如promethues在k8s中的部署,如果我们用编写Yaml的方法来部署,很可能就要编写数十个yaml文件(包括promethues,alertmanager,grafana,push-gateway等等),但我们如果使用helm，我们就只需要一行命令&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;helm install stable/prometheus-operator&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;那么，我们应该怎样才能制作helm中的chart软件包用于给用户自动安装呢?首先,我们需要安装helm,下载二进制文件即可. &lt;a class=&#34;link&#34; href=&#34;https://github.com/helm/helm/releases&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/helm/helm/releases&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;然后我们开始创建一个helm软件包(project-name可替换)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;helm create &amp;lt;project-name&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们可以看到，创建了如下文件夹 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/08/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_86ed0736-bdd6-4486-83a6-a6dedf0d876d.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_86ed0736-bdd6-4486-83a6-a6dedf0d876d.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;其中template下就是各个yaml文件的模板,而values.yaml则是可以填充进各个yaml文件模板的参数(用户可调节). 我们要做的就是对values.yaml和template下各模板做修改,以适应实际应用的需求.&lt;/p&gt;&#xA;&lt;p&gt;其中,template的模板语法用的是golang的template语法，再加上sprig模板库函数(&lt;a class=&#34;link&#34; href=&#34;https://github.com/Masterminds/sprig&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/Masterminds/sprig&lt;/a&gt;)&lt;/p&gt;&#xA;&lt;p&gt;当我们设计好了一个chart之后,我们可以通过如下命令测试生成的yaml文件是否符合预期&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;helm install  --dry-run --debug ../&amp;lt;project-name&amp;gt;                                                &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们可以通过-f values.yaml统一设置参数,也可以通过&amp;ndash;set 单一设置参数&lt;/p&gt;&#xA;&lt;p&gt;如果符合预期,我们就可以直接安装了&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;helm install  ../&amp;lt;project-name&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;更多的helm相关的资料可以参考 &lt;a class=&#34;link&#34; href=&#34;https://whmzsu.github.io/helm-doc-zh-cn/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;helm用户与开发者指南(中文版)&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>Ant design pro删除BasicLayout国际化/帮助/顶部搜索</title>
            <link>http://localhost:1313/posts/2019/06/2019-06-28-ant-design-pro%E5%88%A0%E9%99%A4basiclayout%E5%9B%BD%E9%99%85%E5%8C%96-%E5%B8%AE%E5%8A%A9-%E9%A1%B6%E9%83%A8%E6%90%9C%E7%B4%A2/</link>
            <pubDate>Fri, 28 Jun 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/06/2019-06-28-ant-design-pro%E5%88%A0%E9%99%A4basiclayout%E5%9B%BD%E9%99%85%E5%8C%96-%E5%B8%AE%E5%8A%A9-%E9%A1%B6%E9%83%A8%E6%90%9C%E7%B4%A2/</guid>
            <description>&lt;p&gt;最近学了下react那一套东西，从react的官方文档和官方示例开始看起，感觉官方文档写得相当详实漂亮，由浅入深让人很容易接受。但想着国内可是有antd这么牛逼的轮子，作为react的UI组可是世界第二的存在(star数)，肯定要支持一下学学啦，然后开始了极让人自闭的ant design之旅。&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/06/zibi.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/zibi.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;以前写前端都是用的传统的后端渲染template方式，用了大批的js插件，前端的东西就jquery一把梭，学react这样的框架的时候还是很有新鲜感的。ant design先走了一趟官方的实践文档，过程中跟着走了一趟umi和dva的文档，不能说很懂，但大致还是看的明白的，全家桶这样的东西好用的话也没什么问题，然后开始看antd pro这个官方的脚手架。&lt;/p&gt;&#xA;&lt;p&gt;这个时候突然想起以前还关注过同样是阿里出的icework飞冰，觉得说不定能提升开发效率，下了个玩玩，基本上没发现有什么卵用。而且不同文档和应用中光创建一个项目的方式就很五花八门了，antd官方实践文档一个样，antd pro一个样，icework飞冰一个样，用的组件也有些不同，但又有些一致的，总之整的人糊涂。我也是真心不懂国内搞这么多千奇百怪的前端工具干啥，最后还是用的antd pro官方文档的方式。&lt;/p&gt;&#xA;&lt;p&gt;跟着antd pro官方文档过了一遍，打算就用普通的BasicLayout布局，但这时候突然发现官方文档里根本没提ProLayout布局的api啥的。比如，怎么删掉右上角的国际化？第一反应，先查查谷歌，查到一堆issue说要手动删全部引用的代码&amp;hellip;太牛了..感觉又是装了一个全家桶的感觉。跑去ant-design-pro-layout官方github看了下api说明，也不知道是啥时候更新的，和我最新创建的项目都不一致。比如有个rightContentRender，在官方文档根本查不到这到底是个啥。然后继续谷歌，哦，查到个issue说headerRender现在支持两个参数,rightContentRender是其中之一，就是右上角的那些鬼东西。&lt;/p&gt;&#xA;&lt;p&gt;终于查到了，原来这个rightContentRender就是右上角功能栏。然后代码里这里是填充了RightContent组件,引用自&amp;quot;@/components/GlobalHeader/RightContent&amp;quot;,跑去这个文件里看了看，果然。把&amp;quot;@/components/GlobalHeader/RightContent&amp;quot;中不需要的部分删掉，右上角那些东西就总算是没了。&lt;/p&gt;&#xA;&lt;p&gt;然后这个时候进随便啥自己写的页面，只要用了ProLayout又没有写国际化内容就会疯狂error，这个时候去BasicLayout.jsx里把所有formatmessage相关内容全部删完就行了。&lt;/p&gt;&#xA;&lt;p&gt;首先，这种前后端分离的单页前端开发框架确实以前没用过，是个新手，但是站在新手视角，antd pro的官方文档真的写得烂。而且作为一个颜控，国内的这些前端UI还是比国外的要丑，比如以往用的bootstrap就是很漂亮，比如material ui也漂亮。&lt;/p&gt;&#xA;&lt;p&gt;最后给react的官方实践文档点赞。&lt;/p&gt;&#xA;&lt;p&gt;一点初学者的小记录。&lt;/p&gt;</description>
        </item><item>
            <title>kubernetes&#43;jenkins实现现代cicd流水线(一)</title>
            <link>http://localhost:1313/posts/2019/06/2019-06-13-kubernetesjenkins%E5%AE%9E%E7%8E%B0%E7%8E%B0%E4%BB%A3cicd%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%B8%80/</link>
            <pubDate>Thu, 13 Jun 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/06/2019-06-13-kubernetesjenkins%E5%AE%9E%E7%8E%B0%E7%8E%B0%E4%BB%A3cicd%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%B8%80/</guid>
            <description>&lt;p&gt;前面几篇文章已经谈过在k8s中如何实现rook/ceph持久化存储和服务发现/负载均衡/服务暴露策略，接下来几篇文章将以springboot项目为例，详解如何利用kubernetes容器编排平台实现cicd流水线(devops)。&lt;/p&gt;&#xA;&lt;p&gt;我们根据上面几篇文章已经有了一个k8s集群，常见的的cicd工具有jenkins，gitlab-ci和&lt;a class=&#34;link&#34; href=&#34;https://github.com/drone/drone&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;drone&lt;/a&gt;等等，但因为种种原因(比如gitlabci只支持gitlab，drone需要借助其他git仓库的用户权限系统不支持原生裸git)，这里最终还是选择了jenkins进行实验。&lt;/p&gt;&#xA;&lt;p&gt;首先要解决的肯定是流程上的问题，就是所谓的cicd流程，参考了一些演讲ppt的做法，不过ppt嘛，你懂的，图画的还是很好看，但是也啰里八嗦的，不够简洁明快，有些地方明明很简单却故意讲的很高深莫测好像很厉害的样子，总之就是看着看着就觉得有点好笑 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/06/%e6%8a%8a%e5%a4%a7%e4%bc%99%e9%80%97%e4%b9%90%e4%ba%86.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/%e6%8a%8a%e5%a4%a7%e4%bc%99%e9%80%97%e4%b9%90%e4%ba%86.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;大致流程图我就意思意思吧:&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;&lt;strong&gt;用户提交代码 &amp;mdash;-&amp;gt; Jenkins触发构建 &amp;mdash;-&amp;gt; 编译打包 &amp;mdash;-&amp;gt; 归档成品 &amp;mdash;-&amp;gt; 制作镜像 &amp;mdash;-&amp;gt;k8s发布&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;其中构建触发这一部分因为是用的多分支流水线，觉得还是用触发扫描api由用户在运维平台点击一下比较好。构建因为是用的基于k8s的jenkins，所以同样用了动态的jenkins-slave，这样就可以做到有工作则自动生成jenkins-slave进行编译，无工作则自动销毁jenkins-slave释放资源，从而实现资源的最大化利用和伸缩性。&lt;/p&gt;&#xA;&lt;p&gt;首先在k8s中部署jenkins 1. 创建jenkins-master-home pvc&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# vim jenkins-master-pvc.yaml&#xA;&#xA;apiVersion: v1&#xA;kind: PersistentVolumeClaim&#xA;metadata:&#xA;  name: jenkins-master-home&#xA;  namespace: kube-ops&#xA;  labels:&#xA;    app: jenkins-master-home&#xA;spec:&#xA;  storageClassName: rook-ceph-block&#xA;  accessModes:&#xA;  - ReadWriteOnce&#xA;  resources:&#xA;    requests:&#xA;      storage: 100Gi&#xA;&#xA;# kubectl apply -f jenkins-master-pvc.yaml &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2. 创建 rbac&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# vim rbac.yaml&#xA;&#xA;apiVersion: v1&#xA;kind: ServiceAccount&#xA;metadata:&#xA;  name: jenkins2&#xA;  namespace: kube-ops&#xA;&#xA;---&#xA;&#xA;kind: ClusterRole&#xA;apiVersion: rbac.authorization.k8s.io/v1beta1&#xA;metadata:&#xA;  name: jenkins2&#xA;rules:&#xA;  - apiGroups: [&amp;#34;extensions&amp;#34;, &amp;#34;apps&amp;#34;]&#xA;    resources: [&amp;#34;deployments&amp;#34;]&#xA;    verbs: [&amp;#34;create&amp;#34;, &amp;#34;delete&amp;#34;, &amp;#34;get&amp;#34;, &amp;#34;list&amp;#34;, &amp;#34;watch&amp;#34;, &amp;#34;patch&amp;#34;, &amp;#34;update&amp;#34;]&#xA;  - apiGroups: [&amp;#34;&amp;#34;]&#xA;    resources: [&amp;#34;services&amp;#34;]&#xA;    verbs: [&amp;#34;create&amp;#34;, &amp;#34;delete&amp;#34;, &amp;#34;get&amp;#34;, &amp;#34;list&amp;#34;, &amp;#34;watch&amp;#34;, &amp;#34;patch&amp;#34;, &amp;#34;update&amp;#34;]&#xA;  - apiGroups: [&amp;#34;&amp;#34;]&#xA;    resources: [&amp;#34;pods&amp;#34;]&#xA;    verbs: [&amp;#34;create&amp;#34;,&amp;#34;delete&amp;#34;,&amp;#34;get&amp;#34;,&amp;#34;list&amp;#34;,&amp;#34;patch&amp;#34;,&amp;#34;update&amp;#34;,&amp;#34;watch&amp;#34;]&#xA;  - apiGroups: [&amp;#34;&amp;#34;]&#xA;    resources: [&amp;#34;pods/exec&amp;#34;]&#xA;    verbs: [&amp;#34;create&amp;#34;,&amp;#34;delete&amp;#34;,&amp;#34;get&amp;#34;,&amp;#34;list&amp;#34;,&amp;#34;patch&amp;#34;,&amp;#34;update&amp;#34;,&amp;#34;watch&amp;#34;]&#xA;  - apiGroups: [&amp;#34;&amp;#34;]&#xA;    resources: [&amp;#34;pods/log&amp;#34;]&#xA;    verbs: [&amp;#34;get&amp;#34;,&amp;#34;list&amp;#34;,&amp;#34;watch&amp;#34;]&#xA;  - apiGroups: [&amp;#34;&amp;#34;]&#xA;    resources: [&amp;#34;secrets&amp;#34;]&#xA;    verbs: [&amp;#34;get&amp;#34;]&#xA;&#xA;---&#xA;apiVersion: rbac.authorization.k8s.io/v1beta1&#xA;kind: ClusterRoleBinding&#xA;metadata:&#xA;  name: jenkins2&#xA;roleRef:&#xA;  apiGroup: rbac.authorization.k8s.io&#xA;  kind: ClusterRole&#xA;  name: jenkins2&#xA;subjects:&#xA;  - kind: ServiceAccount&#xA;    name: jenkins2&#xA;    namespace: kube-ops&#xA;&#xA;# kubectl apply -f rbac.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3.创建jenkins deployment和service&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# vim jenkins.yaml&#xA;&#xA;---&#xA;apiVersion: extensions/v1beta1&#xA;kind: Deployment&#xA;metadata:&#xA;  name: jenkins2-deployment&#xA;  namespace: kube-ops&#xA;spec:&#xA;  template:&#xA;    metadata:&#xA;      labels:&#xA;        app: jenkins2&#xA;    spec:&#xA;      terminationGracePeriodSeconds: 10&#xA;      serviceAccountName: jenkins2&#xA;      containers:&#xA;      - name: jenkins&#xA;        image: jenkins/jenkins:lts&#xA;        imagePullPolicy: IfNotPresent&#xA;        ports:&#xA;        - containerPort: 8080&#xA;          name: web&#xA;          protocol: TCP&#xA;        - containerPort: 50000&#xA;          name: agent&#xA;          protocol: TCP&#xA;        resources:&#xA;          limits:&#xA;            cpu: 4000m&#xA;            memory: 8Gi&#xA;          requests:&#xA;            cpu: 1000m&#xA;            memory: 2Gi&#xA;        livenessProbe:&#xA;          httpGet:&#xA;            path: /login&#xA;            port: 8080&#xA;          initialDelaySeconds: 60&#xA;          timeoutSeconds: 5&#xA;          failureThreshold: 12&#xA;        readinessProbe:&#xA;          httpGet:&#xA;            path: /login&#xA;            port: 8080&#xA;          initialDelaySeconds: 60&#xA;          timeoutSeconds: 5&#xA;          failureThreshold: 12&#xA;        volumeMounts:&#xA;        - name: jenkinshome&#xA;          subPath: jenkins2&#xA;          mountPath: /var/jenkins_home&#xA;        env:&#xA;        - name: LIMITS_MEMORY&#xA;          valueFrom:&#xA;            resourceFieldRef:&#xA;              resource: limits.memory&#xA;              divisor: 1Mi&#xA;        - name: JAVA_OPTS&#xA;          value: -Xmx$(LIMITS_MEMORY)m -XshowSettings:vm -Dhudson.slaves.NodeProvisioner.initialDelay=0 -Dhudson.slaves.NodeProvisioner.MARGIN=50 -Dhudson.slaves.NodeProvisioner.MARGIN0=0.85 -Duser.timezone=Asia/Shanghai&#xA;      securityContext:&#xA;        fsGroup: 1000&#xA;      volumes:&#xA;      - name: jenkinshome&#xA;        persistentVolumeClaim:&#xA;          claimName: jenkins-master-home&#xA;&#xA;---&#xA;apiVersion: v1&#xA;kind: Service&#xA;metadata:&#xA;  name: jenkins2&#xA;  namespace: kube-ops&#xA;  labels:&#xA;    app: jenkins2&#xA;spec:&#xA;  selector:&#xA;    app: jenkins2&#xA;  type: ClusterIP&#xA;  ports:&#xA;  - name: web&#xA;    port: 8080&#xA;    targetPort: web&#xA;  - name: agent&#xA;    port: 50000&#xA;    targetPort: agent&#xA;&#xA;# kubectl apply -f jenkins.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这个时候jenkins就已经起起来了，我们给jenkins的webui添加一个ingress负载均衡和服务暴露&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# vim kube-ops-ingress.yaml&#xA;&#xA;apiVersion: extensions/v1beta1&#xA;kind: Ingress&#xA;metadata:&#xA;  name: kube-ops-ingress&#xA;  annotations:&#xA;    nginx.ingress.kubernetes.io/ssl-redirect: &amp;#34;false&amp;#34;&#xA;  namespace: kube-ops&#xA;spec:&#xA;  rules:&#xA;  - host: k8s-jenkins.example.cn&#xA;    http:&#xA;      paths:&#xA;      - path: /&#xA;        backend:&#xA;          serviceName: jenkins2&#xA;          servicePort: 8080&#xA;&#xA;# kubectl apply -f kube-ops-ingress.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这时候因为ingress service是用的master node的externalIp，所以我们可以直接通过修改dns，将k8s-jenkins.example.cn域名指向master node的externalIp，然后直接访问k8s-jenkins.example.cn就可以访问到jenkins服务。(有问题可以查看下kubectl get ingress -o wide &amp;ndash;all-namespaces)&lt;/p&gt;&#xA;&lt;p&gt;然后安装常见的插件，进入jenkins后记得再安装如下两个插件 blueOcean(新一代的流水线UI)，kubernetes(k8s slave支持)，Multibranch Scan Webhook Trigger(多分枝流水线扫描触发器)&lt;/p&gt;&#xA;&lt;p&gt;安装好之后，进入设置，拉到最下面，选择添加一个云(k8s) &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/06/xzygy.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/xzygy.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; 按如上配置，在页面测试连接k8s正常即可(jenkins服务名这里叫jenkins2，按实际修改)&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;&lt;em&gt;至于下面的是否添加镜像，我推荐是不在这里添加，而选择用Yaml直接编写添加。原因是，这里添加slave k8s pod tempalte的话，slave编号无法动态化，会导致后以后构建任务等待前任务，无法多slave并行。(很多文章会在这里添加slave pod template，然后用一个自由风格软件项目做例子，那根本无法在实际环境中用的)&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;&lt;em&gt;这里还有个小坑，无论是yaml的slave k8s pod tempalte还是在jenkins设置里页面添加的slave k8s pod template，如果想使用自定义slave image的话，containers: - name 一定要填写成- name: jnlp，否则会不读取自定义slave image而采用官方的&lt;a class=&#34;link&#34; href=&#34;https://github.com/jenkinsci/docker-jnlp-slave&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;docker-jnlp-slave&lt;/a&gt;。&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;接下来我们创建自己的jenkins-jnlp-slave容器，参考官方的&lt;a class=&#34;link&#34; href=&#34;https://github.com/jenkinsci/docker-jnlp-slave&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;docker-jnlp-slave&lt;/a&gt; Dockerfile如下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ARG VERSION=0.0.1&#xA;ARG user=jenkins&#xA;ARG group=jenkins&#xA;ARG uid=1000&#xA;ARG gid=1000&#xA;&#xA;ENV HOME /home/${user}&#xA;RUN groupadd -g ${gid} ${group}&#xA;RUN useradd -d $HOME -u ${uid} -g ${group} ${user}&#xA;LABEL maintainer=&amp;#34;calmkart@calmkart.com&amp;#34; Description=&amp;#34;jenkins jnlp slave image&amp;#34; Vendor=&amp;#34;calmkart@calmkart.com&amp;#34; Version=&amp;#34;${VERSION}&amp;#34;&#xA;&#xA;ARG AGENT_WORKDIR=/home/${user}/agent&#xA;&#xA;RUN curl --create-dirs -fsSLo /usr/share/jenkins/slave.jar https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting/3.29/remoting-3.29.jar \&#xA;  &amp;amp;&amp;amp; chmod 755 /usr/share/jenkins \&#xA;  &amp;amp;&amp;amp; chmod 644 /usr/share/jenkins/slave.jar \&#xA;  &amp;amp;&amp;amp; rm -rf /etc/yum.repos.d/*&#xA;&#xA;COPY kubectl kubectl&#xA;COPY jdk/ ./jdk&#xA;COPY maven ./maven&#xA;COPY jenkins-slave /usr/local/bin/jenkins-slave&#xA;COPY CentOS-Base.repo /etc/yum.repos.d/&#xA;COPY epel.repo /etc/yum.repos.d/&#xA;&#xA;RUN yum makecache \&#xA;  &amp;amp;&amp;amp; yum install -y unzip.x86_64 \&#xA;  &amp;amp;&amp;amp; chmod +x ./kubectl \&#xA;  &amp;amp;&amp;amp; chmod +x /usr/local/bin/jenkins-slave \&#xA;  &amp;amp;&amp;amp; mv ./kubectl /usr/local/bin/kubectl \&#xA;  &amp;amp;&amp;amp; /bin/bash maven/default/install_maven \&#xA;  &amp;amp;&amp;amp; /bin/bash jdk/default/install_jdk \&#xA;  &amp;amp;&amp;amp; yum install -y nodejs \&#xA;  &amp;amp;&amp;amp; yum install -y python36.x86_64 \&#xA;  &amp;amp;&amp;amp; yum install -y docker-ce.x86_64 \&#xA;  &amp;amp;&amp;amp; yum install -y git \&#xA;  &amp;amp;&amp;amp; yum install -y which&#xA;&#xA;USER ${user}&#xA;ENV PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/maven/bin:/usr/java/jdk/bin&#xA;RUN export PATH=$PATH:/opt/maven/bin:/usr/java/jdk/bin&#xA;ENV AGENT_WORKDIR=${AGENT_WORKDIR}&#xA;RUN mkdir /home/${user}/.jenkins &amp;amp;&amp;amp; mkdir -p ${AGENT_WORKDIR}&#xA;&#xA;VOLUME /home/${user}/.jenkins&#xA;VOLUME ${AGENT_WORKDIR}&#xA;WORKDIR /home/${user}&#xA;&#xA;ENTRYPOINT [&amp;#34;jenkins-slave&amp;#34;]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里创建的是一个基于centos的jenkins jnlp slave容器镜像，安装了python2,python3,nodejs,docker,kubectl,maven,git等工具和环境。&lt;/p&gt;&#xA;&lt;p&gt;将该镜像build并上传到harbor仓库即可在项目的Jenkinsfile中使用.&lt;/p&gt;&#xA;&lt;p&gt;以下是具体待构建项目中jenkins jnlp slave的pod template信息&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# vim jnlp-slave-declarative.yaml&#xA;metadata:&#xA;  namespace: kube-ops&#xA;spec:&#xA;  containers:&#xA;  - name: jnlp&#xA;    image: harbor.example.org/example/jenkins-jnlp-slave:v0.0.1&#xA;    workingDir: /home/jenkins&#xA;    ttyEnabled: true&#xA;    privileged: false&#xA;    alwaysPullImage: false&#xA;    volumeMounts:&#xA;    - name: volume-0&#xA;      mountPath: /var/run/docker.sock&#xA;    - name: volume-1&#xA;      mountPath: /home/jenkins/.kube&#xA;    - name: volume-2&#xA;      mountPath: /home/jenkins&#xA;    - name: volume-3&#xA;      mountPath: /root/.m2&#xA;  volumes:&#xA;  - name: volume-0&#xA;    hostPath:&#xA;      path: /var/run/docker.sock&#xA;      type: &amp;#34;&amp;#34;&#xA;  - name: volume-1&#xA;    hostPath:&#xA;      path: /root/.kube&#xA;      type: &amp;#34;&amp;#34;&#xA;  - name: volume-2&#xA;    nfs:&#xA;      path: /home/shared/nfs/jenkins-home&#xA;      server: 10.1.33.159&#xA;  - name: volume-3&#xA;    nfs:&#xA;      path: /home/shared/nfs/maven-home&#xA;      server: 10.1.33.159&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;关于这个slave k8s pod template要解释一些东西，这里挂载了4个volume到slave中，分别是&lt;/p&gt;&#xA;&lt;p&gt;1.在slave中调用宿主机的docker命令,用于构造和上传镜像 /var/run/docker.sock -&amp;gt; /var/run/docker.sock&lt;/p&gt;&#xA;&lt;p&gt;2.在slave中调用宿主机的kubectl命令,用于在k8s中发布项目(创建deployment和service) /root/.kube -&amp;gt; /home/jenkins/.kube&lt;/p&gt;&#xA;&lt;p&gt;3.搭建了一个nfs用于多个slave共享workspace,避免多次clone代码 /home/shared/nfs/jenkins-home -&amp;gt; /home/jenkins&lt;/p&gt;&#xA;&lt;p&gt;4.搭建了一个nfs用于多个slave共享本地maven仓库,避免多次下载jar包,同时统一maven配置 /home/shared/nfs/maven-home —&amp;gt; /root/.m2&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;这里为什么不用ceph呢？原因很简单，因为ceph rbd块存储不支持ReadWriteMany，而cephfs共享存储虽然支持ReadWriteMany但是不支持分区。所以还是采用了最简单的nfs实现共享存储。&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;在项目的Jenkinsfile中编写如下agent字段调用该pod template的slave&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;def label_tag = &amp;#34;slave-${UUID.randomUUID().toString()}&amp;#34;&#xA;pipeline {&#xA;  agent {&#xA;    kubernetes {&#xA;      label label_tag&#xA;      yamlFile &amp;#39;jnlp-slave-declarative.yaml&amp;#39;&#xA;    }&#xA;  }&#xA;  }&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这是申明式pipeline的用法中比较好的写法，因为如果不单独写一个yaml的话我记得是不支持很多细节语法的.（具体细节参考&lt;a class=&#34;link&#34; href=&#34;https://github.com/jenkinsci/kubernetes-plugin&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;jenkins kubernetes plugin&lt;/a&gt;插件说明）&lt;/p&gt;&#xA;&lt;p&gt;做到这里之后，我们扫描多分支流水线，就可以发现创建一个新slave处理构建任务，构建完成则自动销毁了。 但这还远远不够，很多细节没有处理，下篇文章再详述编译发布构成和申明式Pipeline Jenkinsfile,以及项目Dockerfile镜像详细写法例子。&lt;/p&gt;</description>
        </item><item>
            <title>kubernetes集群中服务的负载均衡和外部发现</title>
            <link>http://localhost:1313/posts/2019/05/2019-05-25-kubernetes%E9%9B%86%E7%BE%A4%E4%B8%AD%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E5%A4%96%E9%83%A8%E5%8F%91%E7%8E%B0/</link>
            <pubDate>Sat, 25 May 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/05/2019-05-25-kubernetes%E9%9B%86%E7%BE%A4%E4%B8%AD%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%92%8C%E5%A4%96%E9%83%A8%E5%8F%91%E7%8E%B0/</guid>
            <description>&lt;p&gt;传统的负载均衡策略一般是:&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;客户端 -&amp;gt; dns -&amp;gt; 4层库在均衡(HA) -&amp;gt; 7层负载均衡 -&amp;gt; 具体的后端服务&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;这种方式处理服务发现和动态配置比较难搞,比如后端服务动态扩缩容什么的。 一开始的做法肯定是OP人工维护7层负载均衡集群配置，以nginx为例，用git仓库之类的做人工服务发现和变更。这样很显然是不科学的。然后就会开始希望用种种自动化的手段去处理服务发现，比如微博的nginx-upsync-module,比如nginx-lua，比如openresty，比如etcd+confd等种种手段实现服务发现和自动化配置，但还是有很多瑕疵，比如etcd+confd每次修改upstream的服务后端就要reload nginx，nginx的策略会新开x个worker，容易造成性能问题甚至机器顶不住。而且vm服务机器的逻辑和upstream挂钩也有问题，总之，麻烦的很。&lt;/p&gt;&#xA;&lt;p&gt;而kubernetes处理这一套服务发现和负载均衡的方法就挺好用的，比如接下来会实践的这一套nginx-ingress+externalIP+dns的方式就很直观而且方便自动化流程，大致策略如下:&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;客户端 -&amp;gt; dns -&amp;gt; k8s-nginx-ingress-service(in ExternalIP) -&amp;gt; ingress-obj -&amp;gt; service -&amp;gt; pod&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;kubernetes集群中具体工作的pod是由service做负载均衡和服务发现的，而service的外部发现策略通常有NodePort，Kube-proxy以及Ingress。对于内部服务暴露给外部，NodePort基本上是不好用的，因为本来Port就有限，而且如果是web服务(80,443)，需要接dns的，开在30000+端口以上，还得在外部做一个四层负载均衡，这样就很烦。Kube-proxy用在调试环境还行，同样有以上问题，所以Ingress是更好的选择。&lt;/p&gt;&#xA;&lt;p&gt;nginx-ingress采用了nginx-lua模块实现upstream动态修正，无需reload nginx，可以解决上述提到的2x worker导致性能下降问题。且结合了service的pods自动发现(coredns)，轻松简单的完成很多过去很麻烦的任务。&lt;/p&gt;&#xA;&lt;p&gt;首先在上篇blog里我们已经有了一个k8s集群，然后我们创建ingress-nginx相关的api对象&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/mandatory.yaml&#xA;kubectl apply -f mandatory.yaml&#xA;&#xA;#会创建好相应的ingress-nginx controller和rbac相关api&#xA;[root@xxxxxxxx ingress-nginx]# kubectl get pods -n ingress-nginx&#xA;NAME                                        READY   STATUS    RESTARTS   AGE&#xA;nginx-ingress-controller-5694ccb578-hwj2j   1/1     Running   0          3h11m&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后我们创建一个ingress的service，用ExternalIP的方式暴露给集群外部&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vim externalIp-ingress-service.yaml&#xA;&#xA;apiVersion: v1&#xA;kind: Service&#xA;metadata:&#xA;  name: ingress-nginx&#xA;  namespace: ingress-nginx&#xA;  labels:&#xA;    app.kubernetes.io/name: ingress-nginx&#xA;    app.kubernetes.io/part-of: ingress-nginx&#xA;spec:&#xA;  ports:&#xA;    - name: http&#xA;      port: 80&#xA;      protocol: TCP&#xA;    - name: https&#xA;      port: 443&#xA;      protocol: TCP&#xA;  selector:&#xA;    app.kubernetes.io/name: ingress-nginx&#xA;    app.kubernetes.io/part-of: ingress-nginx&#xA;  externalIPs:&#xA;    #这里填写你的k8s masterip&#xA;    - 10.1.33.159&#xA;&#xA;#将创建出如下服务&#xA;[root@xxxxxxxxxxxx ingress-nginx]# kubectl get service -n ingress-nginx&#xA;NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE&#xA;ingress-nginx   ClusterIP   10.96.139.222   10.1.33.159   80/TCP,443/TCP   3h12m&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接下来我们就可以创建具体的ingress对象了&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vim rook-ceph-ingress.yaml&#xA;&#xA;apiVersion: extensions/v1beta1&#xA;kind: Ingress&#xA;metadata:&#xA;  name: rook-ceph-ingress&#xA;  annotations:&#xA;    nginx.ingress.kubernetes.io/ssl-redirect: &amp;#34;false&amp;#34;&#xA;  #要暴露的service对应的命名空间  &#xA;  namespace: rook-ceph&#xA;spec:&#xA;  rules:&#xA;  #这里按需配置,就是nginx的配置方法,具体查下ingress-nginx的项目文档&#xA;  - host: k8s-ceph-dashboard.calmkart.com&#xA;    http:&#xA;      paths:&#xA;      - path: /&#xA;        backend:&#xA;          serviceName: rook-ceph-mgr-dashboard&#xA;          servicePort: 8443&#xA;&#xA;kubectl apply -f rook-ceph-ingress.yaml&#xA;#这个ingress将自动发现rook-ceph命名空间中的rook-ceph-mgr-dashboard服务，并将之作负载均衡对外暴露&#xA;[root@xxxxxxxxxxx ingress]# kubectl get service -n rook-ceph&#xA;NAME                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE&#xA;rook-ceph-mgr             ClusterIP   10.99.37.148             9283/TCP            3h48m&#xA;rook-ceph-mgr-dashboard   ClusterIP   10.110.163.110           8443/TCP            3h48m&#xA;rook-ceph-mon-a           ClusterIP   10.103.5.55              6789/TCP,3300/TCP   3h49m&#xA;rook-ceph-mon-b           ClusterIP   10.104.22.199            6789/TCP,3300/TCP   3h49m&#xA;rook-ceph-mon-c           ClusterIP   10.110.80.82             6789/TCP,3300/TCP   3h49m&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后我们查看一下ingress状态&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[root@xxxxxxxxxx ingress]# kubectl get ingress -n rook-ceph&#xA;NAME                HOSTS                                ADDRESS       PORTS   AGE&#xA;rook-ceph-ingress   k8s-ceph-dashboard.calmkart.com   10.1.33.159   80      170m&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这样就没问题了 最后我们把dns记录k8s-ceph-dashboard.calmkart.com指向10.1.33.159&lt;/p&gt;&#xA;&lt;p&gt;搞定。&lt;/p&gt;</description>
        </item><item>
            <title>kubernetes搭建并使用rook/ceph的pv存储</title>
            <link>http://localhost:1313/posts/2019/05/2019-05-24-kubernetes%E6%90%AD%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8rook-ceph%E7%9A%84pv%E5%AD%98%E5%82%A8/</link>
            <pubDate>Fri, 24 May 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/05/2019-05-24-kubernetes%E6%90%AD%E5%BB%BA%E5%B9%B6%E4%BD%BF%E7%94%A8rook-ceph%E7%9A%84pv%E5%AD%98%E5%82%A8/</guid>
            <description>&lt;p&gt;k8s中pod的存储在非单节点是不支持hostpath的，都得用各种分布式存储来实现.每个pvc对应的pv手工创建也很不现实,试了下rook-ceph分布式存储的搞法，感觉不错.其中也还是遇到了很多坑,这里稍微记录一下.&lt;/p&gt;&#xA;&lt;p&gt;首先有一个三个节点的k8s集群 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/05/111.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/111.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; 首先创建rook-ceph-common&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/common.yaml&#xA;kubectl apply -f common.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后创建rook-ceph-operator&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget https://raw.githubusercontent.com/rook/rook/release-1.0/cluster/examples/kubernetes/ceph/operator.yaml&#xA;kubectl apply -f operator.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;以上两步基本上不会出啥问题,标准配置 接下来创建cluster的问题比较多,贴上我的配置&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vim cluster.yaml&#xA;&#xA;apiVersion: ceph.rook.io/v1&#xA;kind: CephCluster&#xA;metadata:&#xA;  name: rook-ceph&#xA;  namespace: rook-ceph&#xA;spec:&#xA;  cephVersion:&#xA;    image: ceph/ceph:v14.2.1-20190430&#xA;    allowUnsupported: true&#xA;  #设置data路径到自己规划的路径&#xA;  dataDirHostPath: /home/shared/rook&#xA;  mon:&#xA;    count: 3&#xA;    allowMultiplePerNode: true&#xA;  dashboard:&#xA;    enabled: true&#xA;    port: 8443&#xA;    urlPrefix: /&#xA;    #关闭https&#xA;    ssl: false&#xA;  network:&#xA;    #如要在k8s集群外使用,这里可以打开&#xA;    hostNetwork: false&#xA;  rbdMirroring:&#xA;    workers: 0&#xA;  storage:&#xA;    #全节点使用&#xA;    useAllNodes: true&#xA;    useAllDevices: false&#xA;    deviceFilter:&#xA;    config:&#xA;      osdsPerDevice: &amp;#34;1&amp;#34;&#xA;    directories:&#xA;    - path: /home/shared/rook&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl apply -f cluster.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看部署情况 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/05/2.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/2.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; 这样就基本上没问题了,k8s中的每个Node会启两个pod(rook-ceph-agent和rook-discover),并且mgr和osd都没问题。 然后给ceph-dashboard提供NodePort的外部访问service&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vim dashboard-external-http.yaml&#xA;&#xA;apiVersion: v1&#xA;kind: Service&#xA;metadata:&#xA;  name: rook-ceph-mgr-dashboard-external-https&#xA;  namespace: rook-ceph&#xA;  labels:&#xA;    app: rook-ceph-mgr&#xA;    rook_cluster: rook-ceph&#xA;spec:&#xA;  ports:&#xA;  - name: dashboard&#xA;    port: 8443&#xA;    protocol: TCP&#xA;    targetPort: 8443&#xA;  selector:&#xA;    app: rook-ceph-mgr&#xA;    rook_cluster: rook-ceph&#xA;  sessionAffinity: None&#xA;  type: NodePort&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl apply -f dashboard-external-https.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后查看下service的情况,是否正常 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/05/3.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/3.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; 这样就对了,可以访问一下http://&lt;!-- raw HTML omitted --&gt;:&lt;!-- raw HTML omitted --&gt;，看看是不是能进ceph-dashboard&lt;/p&gt;&#xA;&lt;p&gt;一般情况下问题不大,查看admin的默认密码&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath=&amp;#34;{[&amp;#39;data&amp;#39;][&amp;#39;password&amp;#39;]}&amp;#34; | base64 --decode &amp;amp;&amp;amp; echo&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;但是admin登陆进去了之后，肯定会疯狂500错误，查了下官方的issue，这里有bug。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;解决办法是:&lt;/strong&gt; &lt;strong&gt;在dashboard里创建一个新role角色(右上角用户管理,roles)，把权限全钩上，然后去掉iscsi的所有权限。&lt;/strong&gt; &lt;strong&gt;接着创建一个新用户,绑定这个新的role角色,最后用新用户登陆&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;接着创建pool和storage用于自动生成pvc匹配的pv&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vim storageclass.yaml&#xA;&#xA;apiVersion: ceph.rook.io/v1&#xA;kind: CephBlockPool&#xA;metadata:&#xA;  name: replicapool&#xA;  namespace: rook-ceph&#xA;spec:&#xA;  replicated:&#xA;    size: 2&#xA;---&#xA;apiVersion: storage.k8s.io/v1&#xA;kind: StorageClass&#xA;metadata:&#xA;   name: rook-ceph-block&#xA;provisioner: ceph.rook.io/block&#xA;parameters:&#xA;  blockPool: replicapool&#xA;  clusterNamespace: rook-ceph&#xA;  fstype: xfs&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl apply -f storagecalss.yaml&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;创建pool和storage之后通过dashboard或者命令 kubectl get cephcluster -n rook-ceph 查看一下集群是否health，如果是health就没毛病了&lt;/p&gt;&#xA;&lt;p&gt;最后测试一下申请一个pvc看看是否会自动生成pv与之绑定&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apiVersion: v1&#xA;kind: PersistentVolumeClaim&#xA;metadata:&#xA;  name: jenkins-home&#xA;  namespace: kube-ops&#xA;  labels:&#xA;    app: jenkins-home&#xA;spec:&#xA;  storageClassName: rook-ceph-block&#xA;  accessModes:&#xA;  - ReadWriteOnce&#xA;  resources:&#xA;    requests:&#xA;      storage: 20Gi&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/05/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_dd2a2f8b-10fb-4f3f-8d21-bbaa31a4ba7d.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_dd2a2f8b-10fb-4f3f-8d21-bbaa31a4ba7d.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; 可见，管用了.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;外加一些小tips:&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;如果rook-ceph配置有误需要还原重新配置,一定要遵循官方的清理步骤 &lt;a class=&#34;link&#34; href=&#34;https://rook.github.io/docs/rook/v1.0/ceph-teardown.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://rook.github.io/docs/rook/v1.0/ceph-teardown.html&lt;/a&gt; 切记要删除掉所有k8s的node上配置的data文件夹,不然会导致新集群无法初始化.&lt;/p&gt;&#xA;&lt;p&gt;创建不出pod很多都是权限原因或者node无法调度,需要检查下rbac权限设置或者各个node的情况.&lt;/p&gt;&#xA;&lt;p&gt;最后附上rook项目的github地址: &lt;a class=&#34;link&#34; href=&#34;https://github.com/rook/rook&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/rook/rook&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>goreplay实现流量复制的AB测试</title>
            <link>http://localhost:1313/posts/2019/05/2019-05-09-goreplay%E5%AE%9E%E7%8E%B0%E6%B5%81%E9%87%8F%E5%A4%8D%E5%88%B6%E7%9A%84ab%E6%B5%8B%E8%AF%95/</link>
            <pubDate>Thu, 09 May 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/05/2019-05-09-goreplay%E5%AE%9E%E7%8E%B0%E6%B5%81%E9%87%8F%E5%A4%8D%E5%88%B6%E7%9A%84ab%E6%B5%8B%E8%AF%95/</guid>
            <description>&lt;p&gt;AB测试的流量复制工具以前有tcpdump啥的，讲道理不好用，啰里八嗦的，不高明，懂得都懂。所以用一款好用的新货，goreplay。&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/05/0E969B1EE4076B3AE46A718E8EC14C48.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/0E969B1EE4076B3AE46A718E8EC14C48.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;github地址:&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/buger/goreplay&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/buger/goreplay&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;先下载二进制文件到机器上，使用方法及其简单&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#假设有两台机器,机器名是vm1和vm2,需要将vm1的8900上的请求流量复制到vm2的8900上,并且限制为get请求,然后将流量缩小为原来的10%，并将vm2的8900上收到的请求和返回输出到文件里，如下操作即可&#xA;&#xA;#vm1&#xA;./gor --input-raw :8900 --output-http=&amp;#34;http://vm2:8900|10%&amp;#34; --http-allow-method GET&#xA;&#xA;#vm2&#xA;./gor --input-raw :8900 --output-http-track-response --input-raw-track-response --output-file=goreplay_response.log&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;以上流程是用goreplay将vm1中8900端口上的请求流量捕获，筛选出GET请求，缩小到10%流量转发给vm2 然后再vm2上用goreplay将vm2中8900端口上的请求流量和返回流量捕获，输出进文件goreplay_response.log中&lt;/p&gt;&#xA;&lt;p&gt;从而实现AB测试&lt;/p&gt;&#xA;&lt;p&gt;操作流程非常简单轻松，还有更多详细的配置参数配置项，有需要可以查查文档，随手记录下。&lt;/p&gt;</description>
        </item><item>
            <title>stunnel&#43;sniproxy&#43;dns劫持实现翻墙</title>
            <link>http://localhost:1313/posts/2019/04/2019-04-22-stunnelsniproxydns%E5%8A%AB%E6%8C%81%E5%AE%9E%E7%8E%B0%E7%BF%BB%E5%A2%99/</link>
            <pubDate>Mon, 22 Apr 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/04/2019-04-22-stunnelsniproxydns%E5%8A%AB%E6%8C%81%E5%AE%9E%E7%8E%B0%E7%BF%BB%E5%A2%99/</guid>
            <description>&lt;p&gt;原理其实挺简单的,懂得都懂,不多说了.配置过程也简单,懒的记细节了,留个图备个份.(文章无内容)&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/04/YWRtaW4_037343.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/YWRtaW4_037343.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>myip.calmkart.com获取自己的出口ip</title>
            <link>http://localhost:1313/posts/2019/04/2019-04-02-myip-calmkart-com%E8%8E%B7%E5%8F%96%E8%87%AA%E5%B7%B1%E7%9A%84%E5%87%BA%E5%8F%A3ip/</link>
            <pubDate>Tue, 02 Apr 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/04/2019-04-02-myip-calmkart-com%E8%8E%B7%E5%8F%96%E8%87%AA%E5%B7%B1%E7%9A%84%E5%87%BA%E5%8F%A3ip/</guid>
            <description>&lt;p&gt;最近在学陶辉的Nginx核心知识100讲,听到postread阶段的时候,顺手用realip模块弄了个小东西,用来获取自己的出口ip.&lt;/p&gt;&#xA;&lt;p&gt;地址myip.calmkart.com&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# curl或访问myip.calmkart.com即可，将返回你的出口ip&#xA;curl myip.calmkart.com&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;类似ifconfig.me，不细说了，小东西，留个存根。&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>WireGuard突破BeiJing GreatWall</title>
            <link>http://localhost:1313/posts/2019/04/2019-04-01-wireguard%E7%AA%81%E7%A0%B4beijing-greatwall/</link>
            <pubDate>Mon, 01 Apr 2019 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2019/04/2019-04-01-wireguard%E7%AA%81%E7%A0%B4beijing-greatwall/</guid>
            <description>&lt;p&gt;有好几个月没有写blog了，原因也挺多的。首先过年嘛，一直有点懒散，然后整天写业务代码又无聊又忙，实际可记录的东西本来也不多，又懒的记。一些新工具啥的，感觉记了也没什么意义，反正都记脑子里了。最近读了一些经典框架源码，学了一些源码课程，也挺有一些收获，不过这样的东西更喜欢记实体笔记一些。综上，总而言之挺久没记blog了。&lt;/p&gt;&#xA;&lt;p&gt;最近Beijing的伟大长城也是越来越狠了，我的ss从一开始的稳定，居然变得不能用了。每次都是刚开始能有连接信息，然后一小会之后，直接telnet都不通了，包括22和ss的端口都断了。换了几十个ip也不管用，port换了无数个，也不管用。&lt;/p&gt;&#xA;&lt;p&gt;特别是这几周因为贫穷的原因被迫搬家，租到了一个鸟不拉屎的地方，连联通都没得办，非得办啥长城宽带，一听这名字就不是啥好鸟，果然，有了the great wall，你想探头出去看看，不可能的。&lt;/p&gt;&#xA;&lt;p&gt;但平时下班和周末休息的时候没法翻墙实在是太痛苦了，我尝试了很多种办法之后，找到了一个相对好的方式解决了这个问题，那就是这篇blog的主题了，WireGuard VPN。&lt;/p&gt;&#xA;&lt;p&gt;wireguard是一种比较新的vpn，基于udp，速度可以说秒杀其他vpn(实测体验)，体验几乎不逊色于ss。&lt;/p&gt;&#xA;&lt;p&gt;并且wireguard配置简单，客户端易用，被集成进了linux内核，也许可以说比ss安全(这点我不确定，但是我的服务器确实ss被全面封杀，但是wireguard用起来轻松愉快)。&lt;/p&gt;&#xA;&lt;p&gt;所以，很推荐现在用不了ss的朋友试试这个新东西，下面开始配置过程。&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;首先配置服务端&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#推荐使用一键安装脚本,github地址&#xA;https://github.com/l-n-s/wireguard-install&#xA;#过程&#xA;wget https://raw.githubusercontent.com/l-n-s/wireguard-install/master/wireguard-install.sh -O wireguard-install.sh&#xA;bash wireguard-install.sh&#xA;&#xA;#然后输入下确定啥的（dns记得选择google的8.8.8.8,4.4.4.4，比较靠谱），你以为一切就ok了，然而一般并不是，你会报错，说啥服务没起来。&#xA;#你用systemctl status wg-quick@wg0.service查看一下到底除了啥问题，发现是ip link add dev wg0 type wireguard命令起不来&#xA;#再次尝试手动ip link add dev wg0 type wireguard，发现报错，找不到wireguard类型的网卡设备名&#xA;#查询了一下，原来是linux内核版本和linux-headers的问题，那么好办了，先更新下内核版本吧&#xA;apt-get install linux-image-4.9.0.8-amd64&#xA;#然后删除旧版本的linux内核&#xA;apt-get remove linux-image-4.x.x.x-amd64&#xA;#接着记得安装好对应版本的linux-headers&#xA;apt-get install linux-headers-4.9.0.8-amd64&#xA;#然后重启&#xA;reboot&#xA;#重启完成后手动启动wireguard网卡&#xA;ip link add dev wg0 type wireguard&#xA;#发现启动成功,这就很棒棒了&#xA;#现在重启服务吧&#xA;systemctl restart wg-quick@wg0.service&#xA;#查看服务状态&#xA;systemctl status wg-quick@wg0.service&#xA;#很棒棒，又成功了，你得到它了&#xA;&#xA;#然后生成客户端配置文件&#xA;wg showconf wg0&#xA;#客户端配置文件将自动生成为/etc/wireguard/wg0.conf&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;服务端这就已经配置完毕了，接着配置客户端(客户端用的Tunsafe，下载在文末)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#将客户端配置文件下载到自己的机器上(客户端),观察下配置文件的内容，其实也挺简单的，就是用rsa公私钥加密通信而已。&#xA;#在客户端修改配置文件&#xA;[Peer]&#xA;#添加&#xA;Endpoint = [服务端ip地址]:[服务端配置的ip端口号]&#xA;#配置文件也搞定了。&#xA;#客户端使用TunSafe，记得使用前需要先安装环境配置&#xA;#点击import,导入下载下来的配置文件&#xA;#然后点击connect即可&#xA;enjoy it&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;总的来说，用了也一段时间了，wireguard的稳定性和可靠性还是很棒的，但是还是有些缺点。&lt;/p&gt;&#xA;&lt;p&gt;比如因为是vpn所以没法像ss一样针对流量做分流，都是用的全局流量。其次，wireguard是用的rsa公私钥做加密的，单配置只针对单用户，需要多人连接需要在服务端配置多用户，也不是那么方便，而且流量管理啥的好像也没啥现成的东西。而且速度确实还是逊色于ss的。(当然，ss现在的封锁力度太大啦。)&lt;/p&gt;&#xA;&lt;p&gt;好的，就到这里了。&lt;/p&gt;&#xA;&lt;p&gt;附上tunsafe客户端，方便上不了tunsafe官网的朋友(记得先安装其中的ts环境)&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2019/04/TunSafe.zip&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;TunSafe&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>一个关于z-index的小问题</title>
            <link>http://localhost:1313/posts/2018/12/2018-12-26-%E4%B8%80%E4%B8%AA%E5%85%B3%E4%BA%8Ez-index%E7%9A%84%E5%B0%8F%E9%97%AE%E9%A2%98/</link>
            <pubDate>Wed, 26 Dec 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/12/2018-12-26-%E4%B8%80%E4%B8%AA%E5%85%B3%E4%BA%8Ez-index%E7%9A%84%E5%B0%8F%E9%97%AE%E9%A2%98/</guid>
            <description>&lt;p&gt;最近一直在忙,没空写blog.刚好今天写前端的时候碰到一个挺有意思的问题,记录一下.&lt;/p&gt;&#xA;&lt;p&gt;问题描述:在bootstrap的modal框里popover没反应.&lt;/p&gt;&#xA;&lt;p&gt;剧情是这样的,要弄一个timeline一样的动态step图,找了一圈除了很多wizard插件之外只有一个ystep可用.打算把ystep的流程图放在boostrap模态框里,放进去初始化ystep之后,发现基本css没问题,就是popover弹出框失效了(起码是视觉上失效了). 第一反应,是不是popover没初始化,马上加上&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$(&amp;#34;[data-toggle=&amp;#39;popover&amp;#39;]&amp;#34;).popover();&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;没任何作用。&lt;/p&gt;&#xA;&lt;p&gt;然后在浏览器中调试,发现选择$(&amp;quot;[data-toggle=&amp;lsquo;popover&amp;rsquo;]&amp;quot;)都是没问题的,查了focus事件,也是有绑定的.&lt;/p&gt;&#xA;&lt;p&gt;很奇怪,怀疑是不是ystep插件有啥问题,于是把div从模态框里弄了出来,发现popover弹窗恢复正常.&lt;/p&gt;&#xA;&lt;p&gt;这时候开始想到是不是z-index的层覆盖出了问题,因为之前用bootbox插件生成各种modal的时候总和手写的modal有层叠冲突,果断强加css(bootstap默认的modal z-index大概是2050左右)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;lt;style&amp;gt;&#xA;.popover {&#xA;z-index: 2099;&#xA;}&#xA;&amp;lt;/style&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;瞬间管用了,问题解决.&lt;/p&gt;</description>
        </item><item>
            <title>增量计算海量数据均值,方差,标准差</title>
            <link>http://localhost:1313/posts/2018/10/2018-10-12-%E5%A2%9E%E9%87%8F%E8%AE%A1%E7%AE%97%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%9D%87%E5%80%BC%E6%96%B9%E5%B7%AE%E6%A0%87%E5%87%86%E5%B7%AE/</link>
            <pubDate>Fri, 12 Oct 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/10/2018-10-12-%E5%A2%9E%E9%87%8F%E8%AE%A1%E7%AE%97%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%9D%87%E5%80%BC%E6%96%B9%E5%B7%AE%E6%A0%87%E5%87%86%E5%B7%AE/</guid>
            <description>&lt;p&gt;最近需要从海量数据中获取均值,方差,标准差&lt;/p&gt;&#xA;&lt;p&gt;显然直接读如内存中按公式做肯定是gg的,于是考虑是否可以增量计算&lt;/p&gt;&#xA;&lt;p&gt;最终写了一个增量计算海量数据均值方差标准差的python通用类&lt;/p&gt;&#xA;&lt;p&gt;参考了以下公式推导:&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/10/canvas.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/canvas.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;代码如下:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# -*- coding: utf-8 -*-&#xA;from __future__ import division&#xA;import numpy&#xA;&#xA;class incre_std_avg():&#xA;    &amp;#39;&amp;#39;&amp;#39;&#xA;    增量计算海量数据平均值和标准差,方差&#xA;    1.数据&#xA;    obj.avg为平均值&#xA;    obj.std为标准差&#xA;    obj.n为数据个数&#xA;    对象初始化时需要指定历史平均值,历史标准差和历史数据个数(初始数据集为空则可不填写)&#xA;    2.方法&#xA;    obj.incre_in_list()方法传入一个待计算的数据list,进行增量计算,获得新的avg,std和n(海量数据请循环使用该方法)&#xA;    obj.incre_in_value()方法传入一个待计算的新数据,进行增量计算,获得新的avg,std和n(海量数据请将每个新参数循环带入该方法)&#xA;    &amp;#39;&amp;#39;&amp;#39;&#xA;&#xA;    def __init__(self, h_avg=0, h_std=0, n=0):&#xA;        self.avg = h_avg&#xA;        self.std = h_std&#xA;        self.n = n&#xA;&#xA;    def incre_in_list(self, new_list):&#xA;        avg_new = numpy.mean(new_list)&#xA;        incre_avg = (self.n*self.avg+len(new_list)*avg_new) / \&#xA;            (self.n+len(new_list))&#xA;        std_new = numpy.std(new_list)&#xA;        incre_std = numpy.sqrt((self.n*(self.std**2+(incre_avg-self.avg)**2)+len(new_list)&#xA;                                * (std_new**2+(incre_avg-avg_new)**2))/(self.n+len(new_list)))&#xA;        self.avg = incre_avg&#xA;        self.std = incre_std&#xA;        self.n += len(new_list)&#xA;&#xA;    def incre_in_value(self, value):&#xA;        incre_avg = (self.n*self.avg+value)/(self.n+1)&#xA;        incre_std = numpy.sqrt((self.n*(self.std**2+(incre_avg-self.avg)&#xA;                                        ** 2)+(incre_avg-value)**2)/(self.n+1))&#xA;        self.avg = incre_avg&#xA;        self.std = incre_std&#xA;        self.n += 1&#xA;&#xA;if __name__ == &amp;#34;__main__&amp;#34;:&#xA;    c = incre_std_avg()&#xA;    c.incre_in_value(0.05)&#xA;    print c.avg&#xA;    print c.std&#xA;    print c.n&#xA;    c.incre_in_value(0.02)&#xA;    c.incre_in_list([0.5, 0.2, 0.3])&#xA;    print c.avg&#xA;    print c.std&#xA;    print c.n&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
        </item><item>
            <title>Django sso server(一个用户友好的的单点登录系统)</title>
            <link>http://localhost:1313/posts/2018/09/2018-09-28-django-sso-server%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7%E5%8F%8B%E5%A5%BD%E7%9A%84%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F/</link>
            <pubDate>Fri, 28 Sep 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/09/2018-09-28-django-sso-server%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7%E5%8F%8B%E5%A5%BD%E7%9A%84%E7%9A%84%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%B3%BB%E7%BB%9F/</guid>
            <description>&lt;p&gt;最近写了一个单点登录系统,这里做一些总结.&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/09/5C45207A-AF09-475D-ACD6-E732CFE1596D.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/5C45207A-AF09-475D-ACD6-E732CFE1596D.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; github地址:(欢迎来star一发^_^) &lt;a class=&#34;link&#34; href=&#34;https://github.com/calmkart/Django-sso-server&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/calmkart/Django-sso-server&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;1流程原理&#34;&gt;1.流程原理&#xA;&lt;/h3&gt;&lt;h4 id=&#34;1系统管理流程&#34;&gt;&amp;lt;1&amp;gt;.系统管理流程&#xA;&lt;/h4&gt;&lt;p&gt;管理员在初始化系统时，填写ldap相关设置以及管理员账号相关设置，之后管理员账号可以在管理员后台调整相关配置 其中: a.系统初始化时将自动生成rsa公私钥,系统中所有涉及的密码,都会经过aes加密存放在数据库中,包括rsa私钥也会经过aes加密存放 b.在取用密码时将调用aes解密,加密的salt写在了common/crypto.py中,也可以自己替换&lt;/p&gt;&#xA;&lt;h4 id=&#34;2用户流程&#34;&gt;&amp;lt;2&amp;gt;.用户流程&#xA;&lt;/h4&gt;&lt;p&gt;用户登录sso系统，验证ldap账号成功后，将用户信息以&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;now = time.time()&#xA;user_info = &amp;#34;{0}|||||{1}&amp;#34;.format(ldap_username, now)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;的形式,通过rsa公钥加密写入cookie中，key为sso_user&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;response.set_cookie(&amp;#39;sso_user&amp;#39;, rsa.crypto(&#xA;                public_key, user_info), domain=options.objects.all()[0].cookie_domain)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其他需要接入sso系统的子系统可以通过sso系统的api，来判断用户是否可以登录&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;url:      /api/auth&#xA;method:   POST&#xA;post_json_data:  {&amp;#34;sso_user&amp;#34;:cookie}&#xA;return:     {&amp;#34;status&amp;#34;:True/False, &amp;#34;msg&amp;#34;:username}&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;本sso系统已提供了相关装饰器，可在管理后台-添加站点的帮助栏查看&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import requests&#xA;&#xA;def auth_login(func):&#xA;&amp;#39;&amp;#39;&amp;#39;&#xA;装饰器,用于需要登录的views functions,将读取cookie并调用sso的api获取username&#xA;&#xA;也可手动编写相关装饰器&#xA;sso系统的登录鉴权api为&amp;#34;http://sso域名/api/auth&amp;#34;(如&amp;#34;http://sso.calmkart.com/api/auth&amp;#34;)&#xA;用POST方法以json形式将sso_cookie传给上述api,&#xA;返回{&amp;#34;status&amp;#34;:True, &amp;#34;msg&amp;#34;:{username}}则登录成功&#xA;否则{&amp;#34;status&amp;#34;:False, &amp;#34;msg&amp;#34;:{exception}}则登录失败&#xA;&#xA;&amp;#39;&amp;#39;&amp;#39;&#xA;    def _auth(request):&#xA;        cookie = request.COOKIES.get(&amp;#34;sso_user&amp;#34;, &amp;#34;&amp;#34;)&#xA;        if cookie==&amp;#34;&amp;#34;:&#xA;            return HttpResponseRedirect(&amp;#34;{http://sso站域名/}&amp;#34;)&#xA;        r = request.post(&amp;#34;{http://sso站域名/api/auth}&amp;#34;,data={&amp;#34;sso_cookie&amp;#34;:cookie})&#xA;        if r.json()[&amp;#34;status&amp;#34;]==False:&#xA;            return HttpResponseRedirect(&amp;#34;{http://sso站域名}&amp;#34;)&#xA;        else:&#xA;            username = r.json()[&amp;#34;msg&amp;#34;]&#xA;            if username == &amp;#34;&amp;#34; or username == &amp;#34;error&amp;#34;:&#xA;                return HttpResponseRedirect(&amp;#34;{http://sso站域名/}&amp;#34;)&#xA;            else:&#xA;                return func(request, username)&#xA;    return _auth&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;用户拥有cookie后登陆系统，系统将解cookie，并获取当前时间，若时间不超过最大时间，则返回username&lt;/p&gt;&#xA;&lt;h4 id=&#34;3企业扫码登陆流程&#34;&gt;&amp;lt;3&amp;gt;.企业扫码登陆流程&#xA;&lt;/h4&gt;&lt;p&gt;在管理后台配置企业微信扫码登陆相关参数，通过企业微信相关js api，生成二维码，用户扫码后，企业微信后台将用户请求重定向到/api/wxlogin  (method:get)上，并加上携带有用户username信息的code参数，成功则写cookie。&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;h3 id=&#34;2common相关模块原理&#34;&gt;2.common相关模块原理&#xA;&lt;/h3&gt;&lt;p&gt;参见本blog其他博文&lt;/p&gt;&#xA;&lt;h4 id=&#34;1关于django的图片验证码&#34;&gt;&amp;lt;1&amp;gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=332&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;关于django的图片验证码&lt;/a&gt;&#xA;&lt;/h4&gt;&lt;h4 id=&#34;2关于python操作ldap&#34;&gt;&amp;lt;2&amp;gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=355&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;关于python操作ldap&lt;/a&gt;&#xA;&lt;/h4&gt;&lt;h4 id=&#34;3关于python操作rsaaes加解密&#34;&gt;&amp;lt;3&amp;gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=353&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;关于python操作rsa,aes加解密&lt;/a&gt;&#xA;&lt;/h4&gt;</description>
        </item><item>
            <title>python操作ldap</title>
            <link>http://localhost:1313/posts/2018/09/2018-09-28-python%E6%93%8D%E4%BD%9Cldap/</link>
            <pubDate>Fri, 28 Sep 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/09/2018-09-28-python%E6%93%8D%E4%BD%9Cldap/</guid>
            <description>&lt;p&gt;封装了一个python的ldap常用操作类&lt;/p&gt;&#xA;&lt;p&gt;首先pip装库&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip install python-ldap&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后开始代码部分&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# -*- coding:utf-8 -*-&#xA;from __future__ import absolute_import&#xA;&#xA;import binascii&#xA;import hashlib&#xA;from base64 import b64encode&#xA;&#xA;import ldap&#xA;import ldap.modlist as modlist&#xA;&#xA;from common.common import log&#xA;&#xA;class MyLdap():&#xA;     &#xA;    def __init__(self,ldap_host=None,base_dn=None,user=None,password=None):&#xA;        self.base_dn = base_dn&#xA;        self.ldap_host = ldap_host&#xA;        self.user = user&#xA;        self.password = password&#xA;        try:&#xA;            self.ldapconn = ldap.initialize(ldap_host)&#xA;            self.ldapconn.simple_bind(user,password)&#xA;        except ldap.LDAPError,e:&#xA;            log().error(str(e))&#xA;            print e&#xA;&#xA;    @property&#xA;    def status(self):&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        验证初始化ldap账号密码,以及ldap地址是否正确&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        ldap_client = ldap.initialize(self.ldap_host)&#xA;        try:&#xA;            ldap_client.simple_bind_s(self.user, self.password)&#xA;            ldap_client.unbind_s()&#xA;            return {&amp;#34;status&amp;#34;:True}&#xA;        except Exception as e:&#xA;            log().error(str(e))&#xA;            return {&amp;#34;status&amp;#34;:False, &amp;#34;msg&amp;#34;:&amp;#34;ldap初始化管理员账号密码或ldap地址有误,详情:{0}&amp;#34;.format(str(e))}&#xA;&#xA;    def _ldap_search_dn(self,uid=None):&#xA;        obj = self.ldapconn&#xA;        obj.protocal_version = ldap.VERSION3&#xA;        searchScope = ldap.SCOPE_SUBTREE&#xA;        retrieveAttributes = None &#xA;        searchFilter = &amp;#34;cn=&amp;#34; + uid&#xA;        &#xA;        try:&#xA;            ldap_result_id = obj.search(self.base_dn, searchScope, searchFilter, retrieveAttributes)&#xA;            result_type, result_data = obj.result(ldap_result_id, 0)&#xA;            if result_type == ldap.RES_SEARCH_ENTRY:&#xA;                return result_data[0][0]&#xA;            else:&#xA;                return None&#xA;        except ldap.LDAPError, e:&#xA;            log().error(str(e))&#xA;&#xA;    def ldap_get_user(self,uid=None):&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        获取ldap用户详情,失败返None&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        obj = self.ldapconn&#xA;        obj.protocal_version = ldap.VERSION3&#xA;        searchScope = ldap.SCOPE_SUBTREE&#xA;        retrieveAttributes = None &#xA;        searchFilter = &amp;#34;cn=&amp;#34; + uid&#xA;        try:&#xA;            ldap_result_id = obj.search(self.base_dn, searchScope, searchFilter, retrieveAttributes)&#xA;            result_type, result_data = obj.result(ldap_result_id, 0)&#xA;            if result_type == ldap.RES_SEARCH_ENTRY:&#xA;                username = result_data[0][1][&amp;#39;cn&amp;#39;][0]&#xA;                mail = result_data[0][1][&amp;#39;mail&amp;#39;][0]&#xA;                displayName = result_data[0][1][&amp;#39;displayName&amp;#39;][0]&#xA;                sn = result_data[0][1][&amp;#39;sn&amp;#39;][0]&#xA;                result = {&amp;#39;username&amp;#39;:username,&amp;#39;mail&amp;#39;:mail,&amp;#39;displayName&amp;#39;:displayName, &amp;#39;sn&amp;#39;:sn}&#xA;                return result&#xA;            else:&#xA;                return None&#xA;        except ldap.LDAPError, e:&#xA;            log().error(str(e))&#xA;    &#xA;    def ldap_get(self,uid=None,passwd=None):&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        验证ldap账号密码,成功返True,失败返False&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        target_cn = self._ldap_search_dn(uid)&#xA;        if not target_cn:&#xA;            return False   &#xA;        try:&#xA;            client = ldap.initialize(self.ldap_host)&#xA;            client.simple_bind_s(target_cn,passwd)&#xA;            client.unbind_s()&#xA;            return True&#xA;        except ldap.LDAPError,e:&#xA;            log().error(str(e))&#xA;            return False&#xA;&#xA;    &#xA;    def cnupdatepass(self, cn, passwd):&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        更改ldap密码,成功返True,失败返error&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        dn=&amp;#39;cn={0},{1}&amp;#39;.format(cn, self.base_dn)&#xA;        try:&#xA;            result=self.ldapconn.search_s(dn, ldap.SCOPE_SUBTREE, &amp;#39;cn=%s&amp;#39; % cn)&#xA;            oldpass=result[0][1][&amp;#39;userPassword&amp;#39;]&#xA;            oldwifipass=result[0][1][&amp;#39;sambaNTPassword&amp;#39;]&#xA;            newpass=&amp;#39;{MD5}&amp;#39; + b64encode(hashlib.md5(passwd).digest())&#xA;            wifipass=binascii.hexlify(hashlib.new(&amp;#39;md4&amp;#39;, passwd.encode(&amp;#39;utf-16le&amp;#39;)).digest())&#xA;            old={&amp;#39;userPassword&amp;#39;:oldpass,&amp;#39;sambaNTPassword&amp;#39;: oldwifipass}&#xA;            new={&amp;#34;sambaNTPassword&amp;#34;: [wifipass],&amp;#34;userPassword&amp;#34;:[newpass]}&#xA;            mlist = modlist.modifyModlist(old, new)&#xA;            self.ldapconn.modify_s(dn, mlist)&#xA;            return {&amp;#34;status&amp;#34;:True}&#xA;        except ldap.LDAPError as e:&#xA;            log().error(str(e))&#xA;            return {&amp;#34;status&amp;#34;:False, &amp;#34;msg&amp;#34;:&amp;#34;ldap更改密码错误,详情: {0}&amp;#34;.format(str(e))}&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;使用时&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ldap_client = MyLdap(ldap_url, base_dn, admin, password)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;代码注释已经写的很清楚了感觉,不再写详情了,本文做个备忘&lt;/p&gt;</description>
        </item><item>
            <title>python操作rsa和aes加解密</title>
            <link>http://localhost:1313/posts/2018/09/2018-09-28-python%E6%93%8D%E4%BD%9Crsa%E5%92%8Caes%E5%8A%A0%E8%A7%A3%E5%AF%86/</link>
            <pubDate>Fri, 28 Sep 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/09/2018-09-28-python%E6%93%8D%E4%BD%9Crsa%E5%92%8Caes%E5%8A%A0%E8%A7%A3%E5%AF%86/</guid>
            <description>&lt;p&gt;封装了一个python的操作rsa和aes的加解密类&lt;/p&gt;&#xA;&lt;p&gt;首先pip装库&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip install pycrypto&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后代码如下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# -*- coding:utf-8 -*-&#xA;import base64&#xA;from Crypto import Random&#xA;from Crypto.Hash import SHA&#xA;from Crypto.Cipher import PKCS1_v1_5 as Cipher_pkcs1_v1_5&#xA;from Crypto.Signature import PKCS1_v1_5 as Signature_pkcs1_v1_5&#xA;from Crypto.PublicKey import RSA&#xA;from Crypto.Cipher import AES&#xA;from binascii import b2a_hex, a2b_hex&#xA;&#xA;#AES加解密,用于本地加密数据库密码和rsa private key&#xA;aes_salt = &amp;#34;opquweoijuqowieh&amp;#34;&#xA;class Aes():&#xA;    &#xA;    def __init__(self, key=aes_salt):&#xA;        self.key = key&#xA;        self.mode = AES.MODE_CBC&#xA;&#xA;    def encrypt(self, text):&#xA;        cryptor = AES.new(self.key, self.mode, b&amp;#39;0000000000000000&amp;#39;)&#xA;        length = 16&#xA;        count = len(text)&#xA;        if count &amp;lt; length: add = (length-count) text = text + (&amp;#39;\0&amp;#39; * add) elif count &amp;gt; length:&#xA;            add = (length-(count % length))&#xA;            text = text + (&amp;#39;\0&amp;#39; * add)&#xA;        self.ciphertext = cryptor.encrypt(text)&#xA;        return b2a_hex(self.ciphertext)&#xA;&#xA;    def decrypt(self, text):&#xA;        cryptor = AES.new(self.key, self.mode, b&amp;#39;0000000000000000&amp;#39;)&#xA;        plain_text = cryptor.decrypt(a2b_hex(text))&#xA;        return plain_text.rstrip(&amp;#39;\0&amp;#39;)&#xA;&#xA;#rsa加解密,用于cookie的加解密&#xA;class Rsa():&#xA;    &#xA;    def __init__(self):&#xA;        self.random_generator = Random.new().read&#xA;&#xA;    def gen_rsa_keys(self):&#xA;        rsa = RSA.generate(1024, self.random_generator)&#xA;        private_pem = rsa.exportKey()&#xA;        public_pem = rsa.publickey().exportKey()&#xA;        return (private_pem, public_pem)&#xA;&#xA;    def crypto(self, public_key, text):&#xA;        rsakey = RSA.importKey(public_key)&#xA;        cipher = Cipher_pkcs1_v1_5.new(rsakey)&#xA;        crypto_text = base64.b64encode(cipher.encrypt(text))&#xA;        return crypto_text&#xA;&#xA;    def decrypt(self, private_key, text):&#xA;        rsakey = RSA.importKey(private_key)&#xA;        cipher = Cipher_pkcs1_v1_5.new(rsakey)&#xA;        decrypt_text = cipher.decrypt(base64.b64decode(&#xA;            text), self.random_generator)&#xA;        return decrypt_text&#xA;&#xA;if __name__ == &amp;#39;__main__&amp;#39;:&#xA;    rsa = Rsa()&#xA;    aes = Aes()&#xA;    (pri,pub)=rsa.gen_rsa_keys()&#xA;    jm = rsa.crypto(pub, &amp;#34;pengng|||||123908123.123123&amp;#34;)&#xA;    print rsa.decrypt(pri, jm)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;调用方法&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;rsa = Rsa()&#xA;aes = Aes()&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;代码注释写得非常详细，细节就不赘述了，做个备忘&lt;/p&gt;</description>
        </item><item>
            <title>修改github项目所属语言</title>
            <link>http://localhost:1313/posts/2018/09/2018-09-25-%E4%BF%AE%E6%94%B9nginx%E9%A1%B9%E7%9B%AE%E6%89%80%E5%B1%9E%E8%AF%AD%E8%A8%80/</link>
            <pubDate>Tue, 25 Sep 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/09/2018-09-25-%E4%BF%AE%E6%94%B9nginx%E9%A1%B9%E7%9B%AE%E6%89%80%E5%B1%9E%E8%AF%AD%E8%A8%80/</guid>
            <description>&lt;p&gt;github上项目统计是以最多的语言作为项目语言,有时候有点为难强迫症. 以下方法可以改变统计的语言,一点小笔记&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#创建.gitattributes文件在项目根目录,内容如下&#xA;*.css linguist-language=Python&#xA;*.less linguist-language=Python&#xA;*.js linguist-language=Python&#xA;*.html linguist-language=Python&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;搞定!&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>django生成图片验证码</title>
            <link>http://localhost:1313/posts/2018/09/2018-09-18-django%E7%94%9F%E6%88%90%E7%99%BB%E5%BD%95%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81/</link>
            <pubDate>Tue, 18 Sep 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/09/2018-09-18-django%E7%94%9F%E6%88%90%E7%99%BB%E5%BD%95%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81/</guid>
            <description>&lt;p&gt;最近在做一个好玩的通用django单点登录系统，登录系统少不了验证码，参考了一下别人的做法和开源项目，总结一下。&lt;/p&gt;&#xA;&lt;p&gt;结果如下：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_837b19bb-98df-4c26-afae-6678c91ff47a.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;主要思路流程是，后端根据随机码绘图，然后做混淆(我这里几乎没做模糊之类的混淆)，最后将随机验证码写进后端session里，前端获取图像后，提交时与session里的验证码做比较。流程还是比较简单的，大致代码如下。&lt;/p&gt;&#xA;&lt;p&gt;1.captcha_handle.py&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;captcha_handle.py&#xA;#用于生成随机字符串以及生成验证码图片&#xA;&#xA;# -*- coding:utf-8 -*-&#xA;import random,string&#xA;from PIL import Image,ImageDraw,ImageFont,ImageFilter&#xA;&#xA;#生成随机字符串&#xA;def _getRandomChar():&#xA;    #string模块包含各种字符串，以下为小写字母加数字&#xA;    ran = string.ascii_lowercase+string.digits&#xA;    char = &amp;#39;&amp;#39;&#xA;    for i in range(4):&#xA;        char += random.choice(ran)&#xA;    return char&#xA;&#xA;#返回一个随机的RGB颜色&#xA;def _getRandomColor():&#xA;    return (random.randint(50,150),random.randint(50,150),random.randint(50,150))&#xA;&#xA;def create_captcha():&#xA;&#xA;    #创建图片，模式，大小，背景色&#xA;    img = Image.new(&amp;#39;RGB&amp;#39;, (120,30), (255,255,255))&#xA;    #创建画布&#xA;    draw = ImageDraw.Draw(img)&#xA;    #设置字体&#xA;    font = ImageFont.truetype(&amp;#39;Arial.ttf&amp;#39;, 25)&#xA;&#xA;    code = _getRandomChar()&#xA;    #将生成的字符画在画布上&#xA;    for t in range(4):&#xA;        draw.text((30*t+5,0),code[t],_getRandomColor(),font)&#xA;&#xA;    #生成干扰点&#xA;    for _ in range(random.randint(0,50)):&#xA;        #位置，颜色&#xA;        draw.point((random.randint(0, 120), random.randint(0, 30)),fill=_getRandomColor())&#xA;&#xA;    #使用模糊滤镜使图片模糊&#xA;    # img = img.filter(ImageFilter.BLUR)&#xA;    #保存&#xA;    #img.save(&amp;#39;&amp;#39;.join(code)+&amp;#39;.jpg&amp;#39;,&amp;#39;jpeg&amp;#39;)&#xA;    return img,code&#xA;&#xA;if __name__ == &amp;#39;__main__&amp;#39;:&#xA;    create_code()&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.views.py&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;views.py&#xA;#视图，生成验证码图片和code，返回图片，code存进session&#xA;class get_captcha(View):&#xA;&#xA;    def get(self, request):&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        生成验证码图片和验证码code,返回验证码图片,并以形式将验证码存放在session里&#xA;        &amp;#39;&amp;#39;&amp;#39;&#xA;        try:&#xA;            f = BytesIO()&#xA;            img, code = create_captcha()&#xA;            request.session[&amp;#34;captcha&amp;#34;] = code&#xA;            img.save(f,&amp;#39;PNG&amp;#39;)&#xA;            return HttpResponse(f.getvalue())&#xA;        except Exception as e:&#xA;            log().error(str(e))&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3.login.html&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;{# html #}&#xA;&amp;lt;div class=&amp;#34;col-xs-4&amp;#34;&amp;gt;&#xA;    &amp;lt;img id=&amp;#34;captcha_img&amp;#34; src=&amp;#34;{% url &amp;#39;get_captcha&amp;#39; %}&amp;#34; onclick=&amp;#34;refresh_captcha()&amp;#34; style=&amp;#34;margin-top: 28px;&amp;#34;&amp;gt;&#xA;    &amp;lt;p class=&amp;#34;help-block&amp;#34; onclick=&amp;#34;refresh_captcha()&amp;#34;&amp;gt;&#xA;    看不清楚?换一张!&#xA;    &amp;lt;/p&amp;gt;&#xA;&amp;lt;/div&amp;gt;&#xA;&#xA;{# js #}&#xA;&amp;lt;script&amp;gt;&#xA;    //刷新验证码&#xA;    function refresh_captcha() {&#xA;        $(&amp;#34;#captcha_img&amp;#34;).attr(&amp;#34;src&amp;#34;,$(&amp;#34;#captcha_img&amp;#34;)[0].src + &amp;#39;?&amp;#39;);&#xA;    };&#xA;&amp;lt;/script&amp;gt;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;4.url.py&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;url(r&amp;#39;^get_captcha/$&amp;#39;,cas_views.get_captcha.as_view(), name=&amp;#34;get_captcha&amp;#34;),&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;5.views.py&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#校验验证码是否正确&#xA;if request.session[&amp;#34;captcha&amp;#34;].lower() != captcha.lower():&#xA;    return JsonResponse({&amp;#34;status&amp;#34;:False, &amp;#34;msg&amp;#34;:&amp;#34;验证码错误!&amp;#34;})&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;一些代码是参考网络上其他开源代码，不过其实也挺简单的，熟悉request.session就差不多了。做个记录。&lt;/p&gt;</description>
        </item><item>
            <title>django类视图装饰器</title>
            <link>http://localhost:1313/posts/2018/09/2018-09-18-django%E7%B1%BB%E8%A7%86%E5%9B%BE%E8%A3%85%E9%A5%B0%E5%99%A8/</link>
            <pubDate>Tue, 18 Sep 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/09/2018-09-18-django%E7%B1%BB%E8%A7%86%E5%9B%BE%E8%A3%85%E9%A5%B0%E5%99%A8/</guid>
            <description>&lt;p&gt;一点关于django类视图装饰器的小笔记。&lt;/p&gt;&#xA;&lt;p&gt;django类视图是很常用的，对于传统的函数视图来说，装饰器可以直接装饰函数，但类视图，装饰器无法直接装饰类方法。&lt;/p&gt;&#xA;&lt;p&gt;比较了几种常见的解决方法,个人觉得比较优雅的解决方法如下：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.shortcuts import render&#xA;from django.utils.decorators import method_decorator&#xA;from django.views.decorators.csrf import csrf_exempt&#xA;from django.views.generic import View&#xA;&#xA;@method_decorator(csrf_exempt, name=&amp;#34;dispatch&amp;#34;)&#xA;class login(View):&#xA;&#xA;    @method_decorator(auth_login)&#xA;    def get(self, request, username):&#xA;        #....func...&#xA;        return render(request, &amp;#39;login.html&amp;#39;, {&amp;#34;displayName&amp;#34;:username, &amp;#34;admin_flag&amp;#34;:admin_flag})&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;既如以上代码，将装饰器函数传给method_decorator方法，直接修饰视图类方法。&lt;/p&gt;&#xA;&lt;p&gt;也可直接修饰视图类，对于需要修饰的方法，用name参数的形式传入method_decorator中即可，但感觉不够优雅。&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.shortcuts import render&#xA;from django.utils.decorators import method_decorator&#xA;from django.views.decorators.csrf import csrf_exempt&#xA;from django.views.generic import View&#xA;&#xA;@method_decorator(csrf_exempt, name=&amp;#34;dispatch&amp;#34;)&#xA;@method_decorator(auth_login, name=&amp;#34;get&amp;#34;)&#xA;class login(View):&#xA;&#xA;    def get(self, request, username):&#xA;        #....func...&#xA;        return render(request, &amp;#39;login.html&amp;#39;, {&amp;#34;displayName&amp;#34;:username, &amp;#34;admin_flag&amp;#34;:admin_flag})&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;需要稍微注意的是，csrf_exempt跨站排除装饰器，只能修饰在类视图的dispatch方法上，既原始写法如下：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;class login(View):&#xA;    &#xA;    @method_decorator(csrf_exempt)&#xA;    def dispatch(self, request, *args, **kwargs):&#xA;        return super(login,self).dispatch(request,*args,**kwargs)&#xA;    &#xA;    def get(self, request, username):&#xA;        #....func...&#xA;        return render(request, &amp;#39;login.html&amp;#39;, {&amp;#34;displayName&amp;#34;:username, &amp;#34;admin_flag&amp;#34;:admin_flag})&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;但其实直接用类方法装饰器装饰视图类，传入参数name=dispatch就行了，不需要重写dispatch方法。&lt;/p&gt;&#xA;&lt;p&gt;既如上文。&lt;/p&gt;</description>
        </item><item>
            <title>为django-admin的userpermission添加read only(can view)权限</title>
            <link>http://localhost:1313/posts/2018/09/2018-09-06-%E4%B8%BAdjango-admin%E7%9A%84userpermission%E6%B7%BB%E5%8A%A0read-onlycan-view%E6%9D%83%E9%99%90/</link>
            <pubDate>Thu, 06 Sep 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/09/2018-09-06-%E4%B8%BAdjango-admin%E7%9A%84userpermission%E6%B7%BB%E5%8A%A0read-onlycan-view%E6%9D%83%E9%99%90/</guid>
            <description>&lt;p&gt;默认的django-admin中用户的models权限只有三个,分别是(Can change, Can add, Can delete),显然的,对于绝大部分crud工程师(^_^)而言,一眼看过去就少了些什么,没错,少了很关键的Can view权限.&lt;/p&gt;&#xA;&lt;p&gt;当然django-admin的用户权限是可以自定义的,需要改permission的meta,这里不细述,发现一个简单好用的django app,可以直接添加Can view权限,美滋滋.&lt;/p&gt;&#xA;&lt;p&gt;最终效果如下 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/09/B6CE8AA0-F925-4290-B2C0-E3C98ECF0C79.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/B6CE8AA0-F925-4290-B2C0-E3C98ECF0C79.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;插件是: django-admin-view-permission 地址 &lt;a class=&#34;link&#34; href=&#34;https://github.com/ctxis/django-admin-view-permission&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/ctxis/django-admin-view-permission&lt;/a&gt; 使用方式及其简单&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#pip安装插件&#xA;pip install django-admin-view-permission&#xA;&#xA;#将app注册,记得一定注册在django.contrib.admin之前&#xA;INSTALLED_APPS = [&#xA;    &amp;#39;admin_view_permission&amp;#39;,&#xA;    &amp;#39;django.contrib.admin&amp;#39;,&#xA;    ...&#xA;]&#xA;&#xA;#更新数据库&#xA;python manage.py migrate&#xA;&#xA;即可&#xA;&#xA;#如需要只对一些数据库管用,可以&#xA;ADMIN_VIEW_PERMISSION_MODELS = [&#xA;    &amp;#39;auth.User&amp;#39;,&#xA;    ...&#xA;]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;的确是个好东西啊,免掉了手写这种本应就有的权限.分享一下.&lt;/p&gt;</description>
        </item><item>
            <title>sshd的AuthorizedKeysCommand选项</title>
            <link>http://localhost:1313/posts/2018/08/2018-08-22-sshd%E7%9A%84authorizedkeyscommand%E9%80%89%E9%A1%B9/</link>
            <pubDate>Wed, 22 Aug 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/08/2018-08-22-sshd%E7%9A%84authorizedkeyscommand%E9%80%89%E9%A1%B9/</guid>
            <description>&lt;p&gt;通常机器上保存的key都是读取~/.ssh/authorized_keys文件来获取的,这样的话就不好做到动态调整和控制权限.&lt;/p&gt;&#xA;&lt;p&gt;openssh6.2版本以上新增加了AuthorizedKeysCommand选项功能,可以获取动态keys列表&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Port 22&#xA;Protocol 2&#xA;SyslogFacility AUTH&#xA;LogLevel INFO&#xA;&#xA;#PermitRootLogin no&#xA;&#xA;RSAAuthentication yes&#xA;PubkeyAuthentication yes&#xA;AuthorizedKeysFile      .ssh/authorized_keys&#xA;&#xA;# To disable tunneled clear text passwords, change to no here!&#xA;PasswordAuthentication no&#xA;&#xA;# Change to no to disable s/key passwords&#xA;ChallengeResponseAuthentication no&#xA;&#xA;UsePAM yes&#xA;&#xA;AllowTcpForwarding no&#xA;X11UseLocalhost no&#xA;UseDNS no&#xA;Subsystem       sftp    /usr/libexec/openssh/sftp-server&#xA;&#xA;AuthorizedKeysCommand /etc/get_key.sh&#xA;AuthorizedKeysCommandUser root&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;一个典型的sshd配置如上,其中AuthorizedKeysCommand选项的作用是在每次登录时都调用指定的脚本，并以脚本当前的输出作为keys列表.当脚本的输出为空时,再调用本地authorized_keys文件中的keys列表验证.&lt;/p&gt;&#xA;&lt;p&gt;一个典型的使用方式是,将ssh公钥放在一个统一的鉴权服务器上,与cmdb中的服务器资源列表做匹配,通过http restapi返回服务器允许登录的公钥列表,在服务器上通过get_key.sh进行读取.当读取为空时，使用本地authorized_keys，一般为权限用户.&lt;/p&gt;&#xA;&lt;p&gt;这样就可以很好的实现服务器授权，组授权以及跳板机相关功能.(本地key转发通过跳板机连接服务器的情况,就可以做到权限集中与鉴权了)&lt;/p&gt;</description>
        </item><item>
            <title>记一次立竿见影的性能优化</title>
            <link>http://localhost:1313/posts/2018/08/2018-08-02-%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%AB%8B%E7%AB%BF%E8%A7%81%E5%BD%B1%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</link>
            <pubDate>Thu, 02 Aug 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/08/2018-08-02-%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%AB%8B%E7%AB%BF%E8%A7%81%E5%BD%B1%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</guid>
            <description>&lt;p&gt;通过一点细微代码的修改,将某系统首页载入时间缩短了10倍有余.&lt;/p&gt;&#xA;&lt;p&gt;系统首页大致这样&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/08/201882204014dama.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/201882204014dama.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;逻辑是读取后台的所有服务列表,判断用户是否有权限,有权限则交给前端用ztree显示,并可进行部署操作,但因为服务太多,遍历服务后判断用户是否有权限后台耗时太长,用chrome查了下,后台数据处理费时2000ms,这样首页就载入的太慢了.&lt;/p&gt;&#xA;&lt;p&gt;第一步,查代码,原始代码如下:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;@login_required&#xA;def services(request):&#xA;    user = request.user&#xA;    _online_apps = App.objects.filter(app_env=&amp;#39;online&amp;#39;)&#xA;    _test_apps = App.objects.filter(app_env=&amp;#39;test&amp;#39;)&#xA;    _dev_apps = App.objects.filter(app_env=&amp;#39;dev&amp;#39;)&#xA;&#xA;    online_apps = [a for a in _online_apps if user.has_perm(&amp;#39;deploy_perm&amp;#39;, a) or is_admin_by_group(user.username)]&#xA;    test_apps = [a for a in _test_apps if user.has_perm(&amp;#39;deploy_perm&amp;#39;, a) or is_admin_by_group(user.username)]&#xA;    dev_apps = [a for a in _dev_apps if user.has_perm(&amp;#39;deploy_perm&amp;#39;, a) or is_admin_by_group(user.username)]&#xA;&#xA;    online_apps_name = [{&amp;#39;name&amp;#39;:app.app_name, &amp;#39;id&amp;#39;:app.id} for app in online_apps]&#xA;    test_apps_name = [{&amp;#39;name&amp;#39;:app.app_name, &amp;#39;id&amp;#39;:app.id} for app in test_apps]&#xA;    dev_apps_name = [{&amp;#39;name&amp;#39;:app.app_name, &amp;#39;id&amp;#39;:app.id} for app in dev_apps]&#xA;    nodes = [&#xA;                {&amp;#39;name&amp;#39;:&amp;#39;online&amp;#39;,&#xA;                 &amp;#39;open&amp;#39;:&amp;#39;true&amp;#39;,&#xA;                 &amp;#39;children&amp;#39;:online_apps_name&#xA;                },&#xA;                {&amp;#39;name&amp;#39;:&amp;#39;test&amp;#39;,&#xA;                 &amp;#39;open&amp;#39;:&amp;#39;false&amp;#39;,&#xA;                 &amp;#39;children&amp;#39;:test_apps_name&#xA;                },&#xA;                {&amp;#39;name&amp;#39;:&amp;#39;dev&amp;#39;,&#xA;                 &amp;#39;open&amp;#39;:&amp;#39;false&amp;#39;,&#xA;                 &amp;#39;children&amp;#39;:dev_apps_name&#xA;                }&#xA;    ];&#xA;    return render(request, &amp;#39;services/services.html&amp;#39;, {&amp;#39;nodes&amp;#39;: json.dumps(nodes)})&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;也没什么复杂的,就是django models + django-guardian权限控制,然后返回数据给ztree生成树结构.&lt;/p&gt;&#xA;&lt;p&gt;初步设想是因为列表生成式太多导致速度慢,写测试代码做测试&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;python manage.py shell&#xA;&#xA;&amp;gt;&amp;gt;&amp;gt; import time&#xA;&amp;gt;&amp;gt;&amp;gt; from django.contrib.auth.models import User&#xA;&amp;gt;&amp;gt;&amp;gt; from services.views import new_service&#xA;&amp;gt;&amp;gt;&amp;gt; def test(user):&#xA;...     start = time.time()&#xA;...     new_service(user)&#xA;...     stop = time.time()&#xA;...     print stop-start&#xA;...&#xA;&amp;gt;&amp;gt;&amp;gt; pengng = User.objects.get(name=&amp;#39;pengng&amp;#39;)&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;1.93502497673&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;1.89282894135&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;2.14076519012&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;1.85515809059&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;1.91108703613&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;发现处理时间大致在1.8-1.9s之间,然后直接将上述原始代码第一步拆了出来&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#仅测试这一步&#xA;online_apps = [a for a in _online_apps if user.has_perm(&amp;#39;deploy_perm&amp;#39;, a) or is_admin_by_group(user.username)]&#xA;&#xA;#发现时间在1.2秒左右&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;1.25127100945&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;1.27178192139&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;1.22848701477&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;1.25300002098&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;继续分拆,发现是这个user.has_perm(&amp;lsquo;deploy_perm&amp;rsquo;,a)的guardian获取权限消耗了大量的时间 然后想起这个系统里权限都是以group来赋权的,获取用户对于服务的权限要先经过组再到服务,先遍历服务再单独查看用户是否有该组权限导致重复遍历太多,其实直接获取用户对应的所有拥有权限的服务对象即可(get_objects_for_user()方法),尝试修改代码&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;@login_required&#xA;def services(request):&#xA;    user = request.user&#xA;&#xA;    if is_admin_by_group(user.username):&#xA;        online_apps_name = [{&amp;#39;name&amp;#39;: a.app_name, &amp;#39;id&amp;#39;: a.id}&#xA;                            for a in App.objects.filter(app_env=&amp;#39;online&amp;#39;)]&#xA;        test_apps_name = [{&amp;#39;name&amp;#39;: a.app_name, &amp;#39;id&amp;#39;: a.id}&#xA;                          for a in App.objects.filter(app_env=&amp;#39;test&amp;#39;)]&#xA;        dev_apps_name = [{&amp;#39;name&amp;#39;: a.app_name, &amp;#39;id&amp;#39;: a.id}&#xA;                         for a in App.objects.filter(app_env=&amp;#39;dev&amp;#39;)]&#xA;    else:&#xA;        online_apps_name = [{&amp;#39;name&amp;#39;: a.app_name, &amp;#39;id&amp;#39;: a.id} for a in get_objects_for_user(&#xA;            user, &amp;#39;deploy_perm&amp;#39;, klass=App) if a.app_env == &amp;#34;online&amp;#34;]&#xA;        test_apps_name = [{&amp;#39;name&amp;#39;: a.app_name, &amp;#39;id&amp;#39;: a.id} for a in get_objects_for_user(&#xA;            user, &amp;#39;deploy_perm&amp;#39;, klass=App) if a.app_env == &amp;#34;test&amp;#34;]&#xA;        dev_apps_name = [{&amp;#39;name&amp;#39;: a.app_name, &amp;#39;id&amp;#39;: a.id} for a in get_objects_for_user(&#xA;            user, &amp;#39;deploy_perm&amp;#39;, klass=App) if a.app_env == &amp;#34;dev&amp;#34;]&#xA;&#xA;    nodes = [&#xA;        {&amp;#39;name&amp;#39;: &amp;#39;online&amp;#39;,&#xA;                 &amp;#39;open&amp;#39;: &amp;#39;true&amp;#39;,&#xA;                 &amp;#39;children&amp;#39;: online_apps_name&#xA;         },&#xA;        {&amp;#39;name&amp;#39;: &amp;#39;test&amp;#39;,&#xA;                 &amp;#39;open&amp;#39;: &amp;#39;false&amp;#39;,&#xA;                 &amp;#39;children&amp;#39;: test_apps_name&#xA;         },&#xA;        {&amp;#39;name&amp;#39;: &amp;#39;dev&amp;#39;,&#xA;                 &amp;#39;open&amp;#39;: &amp;#39;false&amp;#39;,&#xA;                 &amp;#39;children&amp;#39;: dev_apps_name&#xA;         }&#xA;    ]&#xA;    return render(request, &amp;#39;services/services.html&amp;#39;, {&amp;#39;nodes&amp;#39;: json.dumps(nodes)})&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后重载文件&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; reload(services.views)&#xA;&amp;lt;module &amp;#39;services.views&amp;#39; from &amp;#39;/home/**/***/services/views.py&amp;#39;&amp;gt;&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;0.0817279815674&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;0.0788700580597&#xA;&amp;gt;&amp;gt;&amp;gt; test(pengng)&#xA;0.0756318569183&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;立竿见影,瞬间从2秒降低到了0.08秒左右 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/08/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_008058b2-bd81-4a9c-8442-63afc75ac870.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_008058b2-bd81-4a9c-8442-63afc75ac870.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;收工&lt;/p&gt;</description>
        </item><item>
            <title>saltshaker--一个salt的webui</title>
            <link>http://localhost:1313/posts/2018/07/2018-07-06-saltshaker-%E4%B8%80%E4%B8%AAsalt%E7%9A%84webui/</link>
            <pubDate>Fri, 06 Jul 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/07/2018-07-06-saltshaker-%E4%B8%80%E4%B8%AAsalt%E7%9A%84webui/</guid>
            <description>&lt;p&gt;salt的webui,官方的是halite,但已经被放弃了，不维护很久了 尝试过其他几个star比较的开源实现,比如saltpad,但要么就是bug满天飞,要么就是技能栈不符难以二次开发 最后发现了一个开源实现叫saltshaker的不错,最终效果如下 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/07/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_82481f1c-b153-4fb5-928f-2b98163e9635.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_82481f1c-b153-4fb5-928f-2b98163e9635.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;官方项目地址 &lt;a class=&#34;link&#34; href=&#34;https://github.com/yueyongyue/saltshaker&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/yueyongyue/saltshaker&lt;/a&gt; 部署文档见 install.txt&lt;/p&gt;&#xA;&lt;p&gt;大致总结过程如下,非详情.&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git clone https://github.com/yueyongyue/saltshaker.git&#xA;pip install virtualenv&#xA;virtualenv env&#xA;source env/bin/activate&#xA;yum install salt-api.noarch&#xA;&#xA;salt-api --version&#xA;pip install cherrypy==3.8.0&#xA;useradd -M -s /sbin/nologin admin&#xA;passwd admin&#xA;vim /etc/salt/master.d/saltapi.conf&#xA;systemctl restart salt-master.service&#xA;systemctl restart salt-api.service&#xA;systemctl status salt-api.service&#xA;systemctl status salt-master.service&#xA;lsof -i:50075&#xA;pip install Django==1.8.4&#xA;pip install django-crontab&#xA;&#xA;yum install python-devel.x86_64&#xA;yum install mysql-devel&#xA;yum install MySQL-python&#xA;yum install gcc&#xA;&#xA;pip install mysql-python&#xA;&#xA;查源码，改dashboard/views里index函数checkport的端口&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;几个容易踩坑的地方:&lt;/p&gt;&#xA;&lt;p&gt;1.centos7.4用pip安装mysql-python的时候，需要先安装python-devel,mysql-devel,MySQL-python,gcc,否则会报错&lt;/p&gt;&#xA;&lt;p&gt;2.supervisor要自己装，相关配置自己写一下，也容易&lt;/p&gt;&#xA;&lt;p&gt;3.如果salt-api等几个部件没有运行在默认端口，那么启动saltshaker后在首页会显示down的状态，需要修改dashboard/views.py里的index函数checkport里的端口号.&lt;/p&gt;&#xA;&lt;p&gt;4.如果salt-master版本比较高(大于2015.x)，官方yum源的salt-api就没有与之对应的版本了，需要自己下载salt-api的新包，我是自建的yum源，然后&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;createrepo &amp;lt;path&amp;gt;&#xA;createrepo --update &amp;lt;path&amp;gt; &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;更新仓库信息，安装最新的包&lt;/p&gt;&#xA;&lt;p&gt;5.django crontab在settings.py里被注释掉了3个，得把注释去掉，然后把所有django crontab跑起来.&lt;/p&gt;&#xA;&lt;p&gt;最后，这个东西感觉也不是很完善好用，不过是django的，二次开发也很容易，有机会再自己来改改。&lt;/p&gt;</description>
        </item><item>
            <title>关于supervisor/gosuv等控制django/flask进程的小贴士</title>
            <link>http://localhost:1313/posts/2018/02/2018-02-11-%E5%85%B3%E4%BA%8Esupervisor-gosuv%E7%AD%89%E6%8E%A7%E5%88%B6django-flask%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B0%8F%E8%B4%B4%E5%A3%AB/</link>
            <pubDate>Sun, 11 Feb 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/02/2018-02-11-%E5%85%B3%E4%BA%8Esupervisor-gosuv%E7%AD%89%E6%8E%A7%E5%88%B6django-flask%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B0%8F%E8%B4%B4%E5%A3%AB/</guid>
            <description>&lt;p&gt;在使用supervisor/gosuv等进程控制程序控制django/flask进程时，常常会出现一个&amp;quot;BUG&amp;quot;&amp;mdash;&amp;mdash;输入supervisor restart {app}/gosuv stop/start {app}后，经常会出现django/flask重启失败，因为端口已占用的错误。&lt;/p&gt;&#xA;&lt;p&gt;这里我们常常想到，先把端口关掉不就可以了？经常在代码中加入如下命令：(如果程序是django或者flask，占用的端口是82端口)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import subprocess&#xA;import os&#xA;&#xA;pid = os.popen(&amp;#34;lsof -i:82|grep python|awk &amp;#39;{print $2}&amp;#39;&amp;#34;).read()&#xA;if len(pid):&#xA;    subprocess.check_output(&amp;#34;kill -9 &amp;#34;+str(int(pid)), shell=True)&#xA;#注意，这里一定要用subprocess库来kill进程。用os.system运行kill -9或os.kill()都会导致新进程产生&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这样虽然可行，但是比较麻烦。其实占用端口的原因是flask/django服务器自动reload造成的，只需要在supervisor/gosuv的启动指令里，加上&amp;ndash;noreload参数就不会产生这个&amp;quot;BUG&amp;quot;了，举例如下：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#原来启动指令&#xA;python manage.py runserver 0.0.0.0:82&#xA;#更新启动指令&#xA;python manage.py runserver 0.0.0.0:82 --noreload&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;搞定&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>部署sentry捕获项目错误信息</title>
            <link>http://localhost:1313/posts/2018/01/2018-01-25-%E9%83%A8%E7%BD%B2sentry%E6%8D%95%E8%8E%B7%E9%A1%B9%E7%9B%AE%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF/</link>
            <pubDate>Thu, 25 Jan 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/01/2018-01-25-%E9%83%A8%E7%BD%B2sentry%E6%8D%95%E8%8E%B7%E9%A1%B9%E7%9B%AE%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF/</guid>
            <description>&lt;p&gt;sentry是一款专用于捕捉项目错误信息的分布式开源软件，可以轻松的捕捉到不同项目的错误信息并汇总，方便实时查看上下文排错以及报警等。 最终效果图如下： &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/sentry1.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/sentry1.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/sentry2.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/sentry2.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/sentry3.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/sentry3.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;首先，sentry和ELK的不同之处在于，虽然都基于LOG的追踪，但sentry主要关注错误的捕获和上下文重出现报警，而ELK主要关注日志的处理。&lt;/p&gt;&#xA;&lt;h4 id=&#34;1sentry的部署&#34;&gt;1.sentry的部署&#xA;&lt;/h4&gt;&lt;p&gt;官方文档 &lt;a class=&#34;link&#34; href=&#34;https://docs.sentry.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://docs.sentry.io/&lt;/a&gt; 大致来说，主要分为如下几个步骤：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#安装postgresql&#xA;apt-get install postgresql&#xA;apt-get install postgresql-contrib&#xA;&#xA;#安装celery，redis&#xA;pip install celery&#xA;apt-get install redis-server&#xA;&#xA;#安装需要的包&#xA;apt-get install python-setuptools python-dev libxslt1-dev gcc libffi-dev libjpeg-dev libxml2-dev libxslt-dev libyaml-dev libpq-dev&#xA;&#xA;#安装sentry，推荐使用venv环境&#xA;pip install sentry&#xA;&#xA;#生成配置文件,也可制定配置文件路径&#xA;#sentry init /etc/sentry &#xA;sentry init&#xA;&#xA;#配置数据库&#xA;sudo -u postgres psql&#xA;create user admin with password &amp;#39;admin&amp;#39;;&#xA;create database sentry owner admin;&#xA;grant all privileges on database sentry to admin;&#xA;&#xA;#提升该用户superuser权限&#xA;alter role admin superuser;&#xA;&#xA;#修改sentry的相关配置，配置数据库相关设置，与上数据库设置相符合&#xA;vi /root/.sentry/sentry.conf.py&#xA;&#xA;#初始化数据库，可以制定配置文件路径也可默认&#xA;#SENTRY_CONF=/etc/sentry sentry upgrade&#xA;sentry upgrade&#xA;&#xA;#添加celery用root用户跑的环境变量&#xA;export C_FORCE_ROOT=&amp;#34;true&amp;#34;&#xA;&#xA;#最后创建用户&#xA;sentry createuser&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在upgrade过程中可能会出现错误，根据具体错误类型判断如何排错，然后删掉数据库后重建数据库，再upgrade即可，一般都是数据库权限问题。&lt;/p&gt;&#xA;&lt;h4 id=&#34;2sentry的使用&#34;&gt;2.sentry的使用&#xA;&lt;/h4&gt;&lt;p&gt;主要要跑3个任务，如下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#SENTRY_CONF=/etc/sentry sentry run web&#xA;sentry run web&#xA;#SENTRY_CONF=/etc/sentry sentry run worker&#xA;sentry run worker&#xA;#SENTRY_CONF=/etc/sentry sentry run cron&#xA;sentry run cron&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我在测试环境中是用gosuv来跑的，效果如图： &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/gosuv.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/gosuv.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; 其中要注意的是，如果任务直接用&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sentry run web&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这样来跑的话，会找不到配置文件，所以需要配置成如下结构： &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/gosuv2.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/gosuv2.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; 同时，还跑了一个用于测试监控捕获错误的flask程序，其中用到了venv，所以gosuv也好，supervisor也好，都需要做成如下设置&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#找到venv的虚拟环境，用虚拟环境的bin运行项目&#xA;./venv/bin/python runserver.py&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;3sentry-web的应用和配置&#34;&gt;3.sentry web的应用和配置&#xA;&lt;/h4&gt;&lt;p&gt;默认起的sentry web占用的是9000端口，也可以自己修改端口号。 登陆ip:9000，输入刚才设置的邮箱账号密码进入sentry，填一下相关设置 点击右上角new project,选择你需要监控错误的对象，这里选择flask，然后会出现 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/sentry4.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/sentry4.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; 主要关注这个DSN key，在已有的项目可以在这里查看 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/sentry5.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/sentry5.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;然后首先在客户端安装maven[flask]&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip install raven[flask]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;最后在flask程序里添加如下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#__init__.py里设置app，故添加如下&#xA;from raven.contrib.flask import Sentry&#xA;sentry = Sentry(app, &#xA; dsn=&amp;#39;http://f1010071f12c47768dc6b5a4700d9c2e:5643252bcc70471eb5232a632f3ea133@10.32.80.118:9000//2&amp;#39;&#xA; )&#xA;&#xA;#views.py里添加如下&#xA;from flask_security import login_required, current_user&#xA;from hello import app&#xA;from hello import sentry&#xA;&#xA;@app.route(&amp;#39;/error&amp;#39;)&#xA;def error():&#xA;    try:&#xA;        1/0&#xA;    except ZeroDivisionError:&#xA;        sentry.captureException()&#xA;        return &amp;#39;error&amp;#39;&#xA;&#xA;@app.route(&amp;#39;/raise&amp;#39;)&#xA;def auto_raise():&#xA;    raise IndexError&#xA;&#xA;@app.route(&amp;#39;/log&amp;#39;)&#xA;def log():&#xA;    sentry.captureMessage(&amp;#39;hello, world!&amp;#39;)&#xA;    return &amp;#39;logging&amp;#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;类似如图结构： &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/flask.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/flask.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;然后就可以在sentry中即时捕捉到对应的错误和logging了&lt;/p&gt;</description>
        </item><item>
            <title>supervisor集中化管理web工具cesi</title>
            <link>http://localhost:1313/posts/2018/01/2018-01-11-supervisor%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86web%E5%B7%A5%E5%85%B7cesi/</link>
            <pubDate>Thu, 11 Jan 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/01/2018-01-11-supervisor%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86web%E5%B7%A5%E5%85%B7cesi/</guid>
            <description>&lt;p&gt;linux进程管理器supervisor是会经常被用到的，但服务器多了之后，每个服务器的进程也不方便管理。同时，supervisor自带的web界面比较简陋，所以尝试了一下官网推荐的一些第三方开源软件，推荐一下这个cesi。 最终效果如下： &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/1.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/1.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; [&lt;img src=&#34;images/2.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;](&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/2.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://www.calmkart.com/wp-content/uploads/2018/01/2.jpg&lt;/a&gt;)&lt;/p&gt;&#xA;&lt;p&gt;1.首先是关于supervisor 通过apt或pip安装都可以&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get install supervisor&#xA;#pip install supervisor&#xA;echo_supervisord_conf &amp;gt; /etc/supervisor/supervisord.conf&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;关于supervisor配置文件&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[unix_http_server]&#xA;#这里配置是否用unix socket通信来让supervisor与supervisorctl做通信&#xA;&#xA;[inet_http_server]&#xA;#这里是用的http的方式做通信&#xA;&#xA;[supervisorctl]&#xA;#这里选择supervisorctl到底用以上两种中的哪种方式来与supervisor通信，选择一种即可，记得填写密码&#xA;&#xA;[program:pro_name]&#xA;stdout_logfile = {path}&#xA;redirect_stderr = true  ;让stderr也写入stdout中&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;常用操作&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;supervisorctl reload #重启加载supervisor配置文件&#xA;supervisorctl update #只增加新增的配置文件&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.关于cesi&lt;/p&gt;&#xA;&lt;p&gt;项目地址：&lt;a class=&#34;link&#34; href=&#34;https://github.com/Gamegos/cesi&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/Gamegos/cesi&lt;/a&gt; 安装cesi&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get install sqlite3 python python-flask&#xA;git clone https://github.com/Gamegos/cesi&#xA;cd cesi&#xA;sqlite3 ./userinfo.db &amp;lt; userinfo.sql&#xA;cp cesi.conf /etc/cesi.conf&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;配置cesi.conf,我的配置如下，一看就懂了&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[node:118]&#xA;username = ***&#xA;password = ***&#xA;host = 127.0.0.1&#xA;port = 9001&#xA;&#xA;[node:calmkart]&#xA;username = ***&#xA;password = ***&#xA;host = 45.76.71.69&#xA;port = 9001&#xA;&#xA;[node:121]&#xA;username = ***&#xA;password = ***&#xA;host = *.*.*.121&#xA;port = 9001&#xA;&#xA;[environment:my_env]&#xA;members = 118,calmkart,121&#xA;&#xA;[cesi]&#xA;database = /root/cesi/userinfo.db&#xA;activity_log = /var/log/cesi.log&#xA;host = 0.0.0.0&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;用supervisor运行cesi,配置文件如下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[program:cesi]&#xA;directory = /root/cesi/cesi/&#xA;command = python web.py&#xA;autostart = true&#xA;startsecs = 5&#xA;autorestart = true&#xA;startretries = 3&#xA;user = root&#xA;redirect_stderr = true&#xA;stdout_logfile = /var/log/cesi1.log&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;开启任务&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;supervisorctl start cesi&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;默认账号密码：admin,admin 端口需要改的自己去web.py里面改 you get it&lt;/p&gt;&#xA;&lt;p&gt;本测试服地址： &lt;a class=&#34;link&#34; href=&#34;http://cesi.calmkart.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://cesi.calmkart.com&lt;/a&gt; 此外，其他常用的supervisor相关第三方工具还有 suponoff gosuv&lt;/p&gt;</description>
        </item><item>
            <title>django使用middleware实现views的访问限制</title>
            <link>http://localhost:1313/posts/2017/12/2017-12-27-django%E4%BD%BF%E7%94%A8middleware%E5%AE%9E%E7%8E%B0views%E7%9A%84%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6/</link>
            <pubDate>Wed, 27 Dec 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/12/2017-12-27-django%E4%BD%BF%E7%94%A8middleware%E5%AE%9E%E7%8E%B0views%E7%9A%84%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6/</guid>
            <description>&lt;p&gt;需要实现这样的需求，对于以个django app，需要对其中的一些restful api做IP访问限制，这样实现起来最方便的是在middleware中写逻辑。&lt;/p&gt;&#xA;&lt;p&gt;关于django中间件的说明： &lt;a class=&#34;link&#34; href=&#34;http://usyiyi.cn/translate/Django_111/topics/http/middleware.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://usyiyi.cn/translate/Django_111/topics/http/middleware.html&lt;/a&gt; &lt;a class=&#34;link&#34; href=&#34;http://python.usyiyi.cn/translate/django_182/topics/http/middleware.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://python.usyiyi.cn/translate/django_182/topics/http/middleware.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;在django app得middleware.py中添加如下代码&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from django.http import HttpResponse&#xA;&#xA;class checkIPMiddleware(object):&#xA;    def process_request(self, request):&#xA;        root_func = request.path.split(&amp;#34;/&amp;#34;)[1]&#xA;        api_flag = True if root_func==&amp;#34;api&amp;#34; else False&#xA;        if api_flag:&#xA;            ip = request.META.get(&amp;#34;HTTP_X_REAL_IP&amp;#34;, request.META.get(&amp;#34;REMOTE_ADDR&amp;#34;))&#xA;            if (ip==&amp;#34;10.10.10.10&amp;#34; or ip==&amp;#34;11.11.11.11&amp;#34;):&#xA;                return None&#xA;            else:&#xA;                return HttpReponse(&amp;#34;you are not allowed&amp;#34;)&#xA;        return None&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;关于request对象内容，详情如下(本代码限制的是所有/api/后的访问)： &lt;a class=&#34;link&#34; href=&#34;http://python.usyiyi.cn/translate/django_182/ref/request-response.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://python.usyiyi.cn/translate/django_182/ref/request-response.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;关于获取用户IP，在没有反向代理的情况下可以获取http头中的REMOTE_ADDR字段，用request.META对象来获取 当有Nginx等反向代理的时候，就会获取到本机IP，所以需要在nginx反向代理时，将用户原IP记录下来写入HTTP头中 既配置nginx配置如下(/site-enable/default):&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;location .... {    &#xA;    proxy_set_header X-Real-IP $remote_addr;&#xA;    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#xA;    proxy_set_header Host $http_host;&#xA;    proxy_set_header X-NginX-Proxy true;&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;最后在settings.py中将这个class添加进去&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;MIDDLEWARE_CLASSES = [&#xA;        &amp;#39;appname.middleware.checkIPMiddleware&amp;#39;&#xA;]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;重启django之后，则/api后的restful api只允许10.10.10.10和11.11.11.11访问，其他时候就会返回&amp;quot;you are not allowed&amp;quot;&lt;/p&gt;</description>
        </item><item>
            <title>使用zabbix api提取趋势(trend)和历史(history)数据</title>
            <link>http://localhost:1313/posts/2017/12/2017-12-27-%E4%BD%BF%E7%94%A8zabbix-api%E6%8F%90%E5%8F%96%E8%B6%8B%E5%8A%BFtrend%E5%92%8C%E5%8E%86%E5%8F%B2history%E6%95%B0%E6%8D%AE/</link>
            <pubDate>Wed, 27 Dec 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/12/2017-12-27-%E4%BD%BF%E7%94%A8zabbix-api%E6%8F%90%E5%8F%96%E8%B6%8B%E5%8A%BFtrend%E5%92%8C%E5%8E%86%E5%8F%B2history%E6%95%B0%E6%8D%AE/</guid>
            <description>&lt;p&gt;zabbix restful api说明见官网文档 &lt;a class=&#34;link&#34; href=&#34;https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/apiinfo&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/apiinfo&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;使用了github上封装好的python zabbix api,免去了自己造轮子的过程 &lt;a class=&#34;link&#34; href=&#34;https://github.com/lukecyca/pyzabbix&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/lukecyca/pyzabbix&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;这个封装的python zabbix api实现起来也比较简单，主要是用缺省的类__getattr__()方法，调用zabbix的restful api&lt;/p&gt;&#xA;&lt;p&gt;首先用pip安装pyzabbix&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip install pyzabbix&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;具体实现获取trend和history代码如下:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#---coding:utf-8---&#xA;&#xA;from pyzabbix import ZabbixAPI&#xA;import time&#xA;class get_net(object):&#xA;&#x9;url = &amp;#34;&amp;#34;&#xA;&#x9;username = None&#xA;&#x9;password = None&#xA;&#xA;&#x9;def __init__(self, server, user, passwd):&#xA;&#x9;&#x9;self.url = &amp;#34;http://&amp;#34;+server+&amp;#34;/zabbix&amp;#34;&#xA;&#x9;&#x9;self.username = user&#xA;&#x9;&#x9;self.password = passwd&#xA;&#xA;&#x9;def get_trend(self, info_list):&#xA;&#x9;&#x9;z = ZabbixAPI(self.url)&#xA;&#x9;&#x9;z.login(self.username,self.password)&#xA;&#x9;&#x9;for info in info_list:&#xA;&#x9;&#x9;&#x9;hosts = z.host.get(filter={&amp;#34;host&amp;#34;:info[&amp;#34;ip&amp;#34;]})&#xA;&#x9;&#x9;&#x9;if hosts:&#xA;&#x9;&#x9;&#x9;&#x9;host_id = hosts[0][&amp;#34;hostid&amp;#34;]&#xA;&#x9;&#x9;&#x9;print host_id&#xA;&#x9;&#x9;&#x9;items = z.item.get(hostids=host_id,filter={&amp;#34;key_&amp;#34;:&amp;#34;ifHCOutOctets[&amp;#34;+info[&amp;#34;interface&amp;#34;]+&amp;#34;]&amp;#34;})[0]&#xA;&#x9;&#x9;&#x9;if items:&#xA;&#x9;&#x9;&#x9;&#x9;item_id = items[&amp;#34;itemid&amp;#34;]&#xA;&#x9;&#x9;&#x9;trend = z.trend.get(itemids=item_id)&#xA;&#x9;&#x9;&#x9;for td in trend:&#xA;&#x9;&#x9;&#x9;&#x9;clock = self.get_clock(td[&amp;#39;clock&amp;#39;])&#xA;&#x9;&#x9;&#x9;&#x9;if (&amp;#34;20:00&amp;#34; in clock) or (&amp;#34;21:00&amp;#34; in clock) or (&amp;#34;22:00&amp;#34; in clock):&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;print clock+&amp;#34;        &amp;#34;+str(int(td[&amp;#34;value_avg&amp;#34;])*8/1048576)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;f = open(info[&amp;#34;name&amp;#34;],&amp;#34;a&amp;#34;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;f.write(clock+&amp;#34;        &amp;#34;+str(int(td[&amp;#34;value_avg&amp;#34;])*8/1048576))&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;f.write(&amp;#34;\n&amp;#34;)&#xA;&#x9;&#x9;&#x9;f.close()&#xA;&#xA;&#x9;def get_history(self, info_list):&#xA;&#x9;&#x9;z = ZabbixAPI(self.url)&#xA;&#x9;&#x9;z.login(self.username,self.password)&#xA;&#x9;&#x9;for info in info_list:&#xA;&#x9;&#x9;&#x9;hosts = z.host.get(filter={&amp;#34;host&amp;#34;:info[&amp;#34;ip&amp;#34;]})&#xA;&#x9;&#x9;&#x9;if hosts:&#xA;&#x9;&#x9;&#x9;&#x9;host_id = hosts[0][&amp;#34;hostid&amp;#34;]&#xA;&#x9;&#x9;&#x9;print host_id&#xA;&#x9;&#x9;&#x9;items = z.item.get(hostids=host_id,filter={&amp;#34;key_&amp;#34;:&amp;#34;ifHCOutOctets[&amp;#34;+info[&amp;#34;interface&amp;#34;]+&amp;#34;]&amp;#34;})[0]&#xA;&#x9;&#x9;&#x9;if items:&#xA;&#x9;&#x9;&#x9;&#x9;item_id = items[&amp;#34;itemid&amp;#34;]&#xA;&#x9;&#x9;&#x9;history = z.history.get(itemids=item_id,time_from=1512129600)&#xA;&#x9;&#x9;&#x9;r_t = []&#xA;&#x9;&#x9;&#x9;print history&#xA;&#x9;&#x9;&#x9;for hs in history:&#xA;&#x9;&#x9;&#x9;&#x9;clock = self.get_clock(hs[&amp;#39;clock&amp;#39;])&#xA;&#x9;&#x9;&#x9;&#x9;if (&amp;#34;20:&amp;#34; in clock) or (&amp;#34;21:&amp;#34; in clock) or (&amp;#34;22:&amp;#34; in clock):&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;print clock+&amp;#34;        &amp;#34;+str(int(hs[&amp;#34;value&amp;#34;])/1048576)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;r_t.append(clock+&amp;#34;        &amp;#34;+str(int(hs[&amp;#34;value&amp;#34;])/1048576))&#xA;&#x9;&#x9;&#x9;r_t_str = &amp;#34;\n&amp;#34;.join(r_t)&#xA;&#x9;&#x9;&#x9;f = open(&amp;#34;test_history&amp;#34;,&amp;#34;a&amp;#34;)&#xA;&#x9;&#x9;&#x9;f.write(r_t_str)&#xA;&#x9;&#x9;&#x9;f.close()&#xA;&#x9;&#xA;&#x9;def get_clock(self, value):&#xA;&#x9;&#x9;clock = time.localtime(int(value))&#xA;&#x9;&#x9;format = &amp;#39;%Y-%m-%d %H:%M&amp;#39;&#xA;&#x9;&#x9;return time.strftime(format,clock)&#xA;&#xA;#test = get_net(&amp;#34;zabbix服务器IP&amp;#34;, &amp;#34;user&amp;#34;, &amp;#34;pass&amp;#34;)&#xA;#test.get_trend([{&amp;#34;ip&amp;#34;:&amp;#34;机器IP&amp;#34;,&amp;#34;name&amp;#34;:&amp;#34;某机器&amp;#34;,&amp;#34;interface&amp;#34;:&amp;#34;某接口名&amp;#34;}])&#xA;#test.get_trend(info列表，格式如上)&#xA;#test.get_history([{&amp;#34;ip&amp;#34;:&amp;#34;机器IP&amp;#34;,&amp;#34;name&amp;#34;:&amp;#34;某机器&amp;#34;,&amp;#34;interface&amp;#34;:&amp;#34;某接口名&amp;#34;}])&#xA;#test.get_history(info列表，格式如上)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;注： 其中get_clock()函数用于做linux时间戳转换。&lt;/p&gt;</description>
        </item><item>
            <title>修改salt源码实现jobs.list_jobs加密账号密码</title>
            <link>http://localhost:1313/posts/2017/12/2017-12-18-%E4%BF%AE%E6%94%B9salt%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0jobs-list_jobs%E5%8A%A0%E5%AF%86%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/</link>
            <pubDate>Mon, 18 Dec 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/12/2017-12-18-%E4%BF%AE%E6%94%B9salt%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0jobs-list_jobs%E5%8A%A0%E5%AF%86%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/</guid>
            <description>&lt;p&gt;在salt master中为各个minion运行各种命令，当输入命令中显式带有账号密码时，可以在master端通过 salt.runners.jobs.last_run() salt.runners.jobs.list_job() salt.runners.jobs.list_jobs() salt.runners.jobs.list_jobs_filter() 等种种方法查看到账号密码，这样就会有安全风险。 所以，可以通过修改salt源码的方式实现对显示密码的记录加密。最终效果如下图： &lt;img src=&#34;images/zzxg.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;修改方法很简单，首先找到系统中的salt文件夹，本测试机在&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/usr/lib/python2.7/dist-packages/salt/&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;修改./runners/jobs.py文件&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#添加函数,这里主要是正则匹配，可以匹配更多的pass选项，实现更多的隐藏密码&#xA;import re&#xA;def encry_pass(target):&#xA;    result = re.sub(r&amp;#34;(?&amp;lt;=--password )\w+&amp;#34;, &amp;#34;*&amp;#34;, target)&#xA;    return result&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;并在list_job()函数，list_jobs()函数，list_jobs_filter()函数，print_job()函数末尾分别加入如下代码&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#list_job()&#xA;ret = eval(encry_pass(str(ret)))   #增加此行&#xA;return ret&#xA;&#xA;#list_jobs()&#xA;mret = eval(encry_pass(str(mret)))    #增加此行&#xA;return mret&#xA;&#xA;#list_jobs_filter()&#xA;ret = eval(encry_pass(str(ret)))    #增加此行    &#xA;return ret&#xA;&#xA;#print_job()&#xA;ret = eval(encry_pass(str(ret)))    #增加此行&#xA;return ret&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;搞定&lt;/p&gt;&#xA;&lt;p&gt;一点小补充： 为什么要用&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ret = eval(encry_pass(str(ret)))&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;因为ret是dict类型，得先把dict类型转换成str类型再写入encry_pass()正则匹配函数的参数里，然后encry_pass()正则匹配函数返回一个str对象，而ret需要的是dict对象，所以需要再用eval()转回来,也就是 ret(dict)&amp;mdash;-&amp;gt;str(ret)&amp;mdash;&amp;ndash;&amp;gt;ret(str)&amp;mdash;&amp;ndash;&amp;gt;result(str)&amp;mdash;&amp;ndash;&amp;gt;eval(result)&amp;mdash;&amp;ndash;&amp;gt;result(dict)&amp;mdash;&amp;ndash;&amp;gt;ret(dict)&lt;/p&gt;</description>
        </item><item>
            <title>增强nginx的autoindex功能(文件排序，文件MD5值)</title>
            <link>http://localhost:1313/posts/2017/12/2017-12-18-%E5%A2%9E%E5%BC%BAnginx%E7%9A%84autoindex%E5%8A%9F%E8%83%BD%E6%96%87%E4%BB%B6%E6%8E%92%E5%BA%8F%E6%96%87%E4%BB%B6md5%E5%80%BC/</link>
            <pubDate>Mon, 18 Dec 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/12/2017-12-18-%E5%A2%9E%E5%BC%BAnginx%E7%9A%84autoindex%E5%8A%9F%E8%83%BD%E6%96%87%E4%BB%B6%E6%8E%92%E5%BA%8F%E6%96%87%E4%BB%B6md5%E5%80%BC/</guid>
            <description>&lt;p&gt;原始的nginx文件服务器autoindex功能非常单一，也不够美观，连按时间或者文件大小排序功能都没有，所以通过nginx插件和修改源码的方式为其增加了一些新的功能。 最终效果如下：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/zzxg-1.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;用到的插件为file-md5和ngx-fancyindex，nginx版本是1.6.2&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git clone https://github.com/cfsego/file-md5.git&#xA;git clone https://github.com/aperezdc/ngx-fancyindex.git&#xA;wget https://github.com/nginx/nginx/archive/release-1.6.2.tar.gz&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;修改/ngx-fancyindex/template.h文件&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;//插入script&#xA;&amp;#34;&amp;lt;script src=\&amp;#34;https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js\&amp;#34;&amp;gt;&amp;#34;&#xA;&amp;#34;&amp;lt;/script&amp;gt;&amp;#34;&#xA;&amp;#34;&amp;lt;script src=\&amp;#34;/static/md5.js\&amp;#34;&amp;gt;&amp;#34;&#xA;&amp;#34;&amp;lt;/script&amp;gt;&amp;#34;&#xA;//修改页面表格宽度&#xA;&amp;#34;&amp;lt;tr&amp;gt;&amp;#34;&#xA;&amp;#34;&amp;lt;th style=\&amp;#34;width:30%\&amp;#34;&amp;gt;&amp;lt;a href=\&amp;#34;?C=N&amp;amp;O=A\&amp;#34;&amp;gt;File Name&amp;lt;/a&amp;gt;&amp;amp;nbsp;&amp;lt;a href=\&amp;#34;?C=N&amp;amp;O=D\&amp;#34;&amp;gt;&amp;amp;nbsp;&amp;amp;darr;&amp;amp;nbsp;&amp;lt;/a&amp;gt;&amp;lt;/th&amp;gt;&amp;#34;&#xA;&amp;#34;&amp;lt;th style=\&amp;#34;width:35%\&amp;#34;&amp;gt;&amp;lt;a href=\&amp;#34;?C=S&amp;amp;O=A\&amp;#34;&amp;gt;File Size&amp;lt;/a&amp;gt;&amp;amp;nbsp;&amp;lt;a href=\&amp;#34;?C=S&amp;amp;O=D\&amp;#34;&amp;gt;&amp;amp;nbsp;&amp;amp;darr;&amp;amp;nbsp;&amp;lt;/a&amp;gt;&amp;lt;/th&amp;gt;&amp;#34;&#xA;&amp;#34;&amp;lt;th style=\&amp;#34;width:25%\&amp;#34;&amp;gt;&amp;lt;a href=\&amp;#34;?C=M&amp;amp;O=A\&amp;#34;&amp;gt;Date&amp;lt;/a&amp;gt;&amp;amp;nbsp;&amp;lt;a href=\&amp;#34;?C=M&amp;amp;O=D\&amp;#34;&amp;gt;&amp;amp;nbsp;&amp;amp;darr;&amp;amp;nbsp;&amp;lt;/a&amp;gt;&amp;lt;/th&amp;gt;&amp;#34;&#xA;&amp;#34;&amp;lt;/tr&amp;gt;&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接着执行&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd ./nginx-release-1.6.2&#xA;./auto/configure --prefix=/usr/local/nginx --with-pcre --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module --add-module=../file-md5-master --add-module=../ngx-fancyindex&#xA;make&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后修改nginx配置文件&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vi /etc/nginx/site-enable/default&#xA;###########################&#xA;更多fancyindex插件配置选项参考&#xA;http://www.ttlsa.com/nginx/nginx-module-ngx-fancyindex/&#xA;https://www.nginx.com/resources/wiki/modules/fancy_index/#directives&#xA;###########################&#xA;root /var/www; //改为需要路径，测试机中是/var/www/&#xA;location / {&#xA; 36         # First attempt to serve request as file, then&#xA; 37         # as directory, then fall back to displaying a 404.&#xA; 38         fancyindex on;&#xA; 39         fancyindex_exact_size off;&#xA; 40         fancyindex_ignore &amp;#34;static&amp;#34;;&#xA; 41         add_header Content-MD5 $file_md5;&#xA; 42     }&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在需要分享的路径创建文件./static/md5.js，测试机中是/var/www/&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mkdir /var/www/static&#xA;vi /var/www/static/md5.js&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$(document).ready(function(){&#xA;&#x9;var current_index = 1;&#xA;&#x9;function get_md5(){&#xA;&#x9;&#x9;if(current_index==$(&amp;#34;tr&amp;#34;).length){&#xA;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;var url = $(&amp;#34;tr&amp;#34;)[current_index].childNodes[0].childNodes[0].href;&#xA;&#x9;&#x9;$.ajax({&#xA;        &#x9;url: url,           &#xA;        &#x9;type: &amp;#34;HEAD&amp;#34;,&#xA;        &#x9;complete: function(jqXHR, textStatus) {&#xA;        &#x9;&#x9;var file_size = $(&amp;#34;tr&amp;#34;)[current_index].childNodes[1].childNodes[0].data;     &#xA;        &#x9;&#x9;var md5 = jqXHR.getResponseHeader(&amp;#34;Content-MD5&amp;#34;);&#xA;        &#x9;&#x9;console.log(jqXHR.getAllResponseHeaders());&#xA;        &#x9;&#x9;if(md5!=null &amp;amp;&amp;amp; file_size!=&amp;#34;-&amp;#34;){&#xA;        &#x9;&#x9;&#x9;$(&amp;#34;tr&amp;#34;)[current_index].childNodes[1].innerHTML += (&amp;#34;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp&amp;#34;+&amp;#34;[md5:&amp;#34;+md5+&amp;#34;]&amp;#34;);&#xA;        &#x9;&#x9;&#x9;}&#xA;        &#x9;&#x9;current_index++;&#xA;        &#x9;&#x9;get_md5();&#xA;        &#x9;&#x9;}&#xA;    &#x9;&#x9;});&#xA;&#x9;&#x9;}&#xA;&#x9;get_md5();&#xA;});&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后在nginx-release-1.6.2目录下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;killall nginx&#xA;cd ./objs&#xA;./nginx -c /etc/nginx/nginx.conf&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;即可&lt;/p&gt;&#xA;&lt;h4 id=&#34;关于md5js原理的一些小说明&#34;&gt;&lt;strong&gt;关于md5.js原理的一些小说明：&lt;/strong&gt;&#xA;&lt;/h4&gt;&lt;p&gt;file-md5模块是第三方模块，必须通过手动编译安装。 功能是将文件md5值插入文件的http头的Content-MD5字段中，效果如图&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/2.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;在ngx-fancyindex源码中，调用md5.js的js脚本，从前端通过jquery ajax读取所有文件http头重的Content-MD5字段，再写入页面中。&lt;/p&gt;&#xA;&lt;p&gt;因为ajax是异步的，所以无法通过普通的for循环或者赋值给全局变量的方式运行，所以要用递归+回调函数的方式，才能达成正确的效果。&lt;/p&gt;&#xA;&lt;p&gt;设置递归终止条件current_index==$(&amp;ldquo;tr&amp;rdquo;).length，循环遍历所有的文件连接，提取http头中的md5值写入页面中即可。&lt;/p&gt;&#xA;&lt;p&gt;但性能还是有些问题的，有些大文件的计算比较浪费时间。这里已经将ajax的请求type换成了HEAD类型，因为不再请求文件主体，所以请求速度是GET类型的10倍以上。&lt;/p&gt;&#xA;&lt;p&gt;所有文件git地址： &lt;a class=&#34;link&#34; href=&#34;https://github.com/calmkart/nginx_autoindex-&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/calmkart/nginx_autoindex-&lt;/a&gt; 编译好的nginx可执行文件： &lt;a class=&#34;link&#34; href=&#34;https://github.com/calmkart/nginx_autoindex-/archive/0.1.tar.gz&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/calmkart/nginx_autoindex-/archive/0.1.tar.gz&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>NFS搭建及端口安全控制</title>
            <link>http://localhost:1313/posts/2017/12/2017-12-05-nfs%E6%90%AD%E5%BB%BA%E5%8F%8A%E7%AB%AF%E5%8F%A3%E5%AE%89%E5%85%A8%E6%8E%A7%E5%88%B6/</link>
            <pubDate>Tue, 05 Dec 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/12/2017-12-05-nfs%E6%90%AD%E5%BB%BA%E5%8F%8A%E7%AB%AF%E5%8F%A3%E5%AE%89%E5%85%A8%E6%8E%A7%E5%88%B6/</guid>
            <description>&lt;p&gt;NFS服务用于文件分享和文件同步，功能就不描述了，架构是C/S的模式&lt;/p&gt;&#xA;&lt;p&gt;一.简单配置&lt;/p&gt;&#xA;&lt;p&gt;1.服务端&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt install nfs-kernel-server&#xA;vi /etc/exports&#xA;########添加如下#######&#xA;/opt/nfs *(ro,sync,no_subtree_check)&#xA;#NFS共享路径 IP(只读，同步，不检查父目录)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;service nfs-kernel-server restart &#xA;service rpcbind restart&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;测试：showmount -e&lt;/p&gt;&#xA;&lt;p&gt;2.客户端&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get install nfs-common&#xA;mount 远程nfs_ip:/路径 /本地路径&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;二.NFS服务端口控制&lt;/p&gt;&#xA;&lt;p&gt;服务端配置：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# /etc/default/nfs-common&#xA; STATDOPTS=&amp;#34;--port 32765 --outgoing-port 32766&amp;#34;&#xA;&#xA; # /etc/default/nfs-kernel-server&#xA; RPCMOUNTDOPTS=&amp;#34;-p 32767&amp;#34;&#xA;&#xA; # /etc/default/quota&#xA; RPCRQUOTADOPTS=&amp;#34;-p 32769&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt; # /etc/sysctl.conf&#xA;fs.nfs.nfs_callback_tcpport = 32764&#xA;fs.nfs.nlm_tcpport = 32768&#xA;fs.nfs.nlm_udpport = 32768&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sysctl --system&#xA;service nfs-kernel-server restart&#xA;service rpcbind restart&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;则可以将服务端端口限制为:&lt;/p&gt;&#xA;&lt;p&gt;2049,111,32764-32769 TCP/UDP&lt;/p&gt;</description>
        </item><item>
            <title>saltstack的安装和基本使用</title>
            <link>http://localhost:1313/posts/2017/11/2017-11-29-saltstack%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</link>
            <pubDate>Wed, 29 Nov 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/11/2017-11-29-saltstack%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</guid>
            <description>&lt;p&gt;saltstack可用于批量管理集群,用的是c/s架构，master管理多个minion&lt;/p&gt;&#xA;&lt;p&gt;测试系统：debian8.7&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;一.安装master&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;1.添加apt key&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget -O - https://repo.saltstack.com/apt/debian/8/amd64/latest/SALTSTACK-GPG-KEY.pub | sudo apt-key add -&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.将saltstack源添加进apt源&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vi /etc/apt/sources.list&#xA;#添加saltstack源&#xA;deb http://repo.saltstack.com/apt/debian/8/amd64/latest jessie main&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3.更新apt&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get update&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;4.安装master端相关组件&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get install salt-api&#xA;apt-get install salt-cloud&#xA;apt-get install salt-master&#xA;apt-get install salt-minion&#xA;apt-get install salt-ssh&#xA;apt-get install salt-syndic&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;5.配置master&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vi /etc/salt/master&#xA;####################常见配置如下####################&#xA;#指定master，冒号后有一个空格&#xA;user: root&#xA;#自动接收minion&#xA;auto_accept: True&#xA;&#xA;#-------以下为可选--------------&#xA;#自动接收minion&#xA;auto_accept: True&#xA;#salt的运行线程，开的线程越多一般处理的速度越快，但一般不要超过CPU的个数&#xA;worker_threads: 10&#xA;# master的管理端口&#xA;publish_port : 4505&#xA;# master跟minion的通讯端口，用于文件服务，认证，接受返回结果等&#xA;ret_port : 4506&#xA;# 如果这个master运行的salt-syndic连接到了一个更高层级的master,那么这个参数需要配置成连接到的这个高层级master的监听端口&#xA;syndic_master_port : 4506&#xA;# 指定pid文件位置&#xA;pidfile: /var/run/salt-master.pid&#xA;# saltstack 可以控制的文件系统的开始位置&#xA;root_dir: /&#xA;# 日志文件地址&#xA;log_file: /var/log/salt_master.log&#xA;# 分组设置&#xA;nodegroups:&#xA;  group_all: &amp;#39;*&amp;#39;&#xA;# salt state执行时候的根目录&#xA;file_roots:&#xA;  base:&#xA;    - /srv/salt/&#xA;# 设置pillar 的根目录&#xA;pillar_roots:&#xA;  base:&#xA;    - /srv/pillar&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;6.启动master&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;systemctl start salt-master&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;二.安装minion&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;1.安装salt-minion&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get install salt-minion&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.配置minion相关信息&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vi /etc/salt/minion&#xA;&#xA;###################以下为常见设置###########################&#xA;#指定master，冒号后有一个空格&#xA;master: 10.32.80.121&#xA;&#xA;#-------以下为可选--------------&#xA;# minion的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串&#xA;id: xx&#xA;# salt运行的用户权限&#xA;user: root&#xA;# master的识别ID，可以是IP，域名，或是可以通过DNS解析的字符串&#xA;master : ip&#xA;# master通讯端口&#xA;master_port: 4506&#xA;# 备份模式，minion是本地备份，当进行文件管理时的文件备份模式&#xA;backup_mode: minion&#xA;# 执行salt-call时候的输出方式&#xA;output: nested &#xA;# minion等待master接受认证的时间&#xA;acceptance_wait_time: 10&#xA;# 失败重连次数，0表示无限次，非零会不断尝试到设置值后停止尝试&#xA;acceptance_wait_time_max: 0&#xA;# 重新认证延迟时间，可以避免因为master的key改变导致minion需要重新认证的syn风暴&#xA;random_reauth_delay: 60&#xA;# 日志文件位置&#xA;log_file: /var/logs/salt_minion.log&#xA;# 文件路径基本位置&#xA;file_roots:&#xA;  base:&#xA;    - /etc/salt/minion/file&#xA;# pillar基本位置&#xA;pillar_roots:&#xA;  base:&#xA;    - /data/salt/minion/pillar&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3.启动minion&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;systemctl start salt-minion&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;三.通过master管理minion&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;1.配置key&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#查看当前所有的key&#xA;salt-key&#xA;&#xA;#注册所有key&#xA;salt-key -A&#xA;&#xA;#注册某个key&#xA;salt-key -a minion_id&#xA;&#xA;#删除全部key&#xA;salt-key -D&#xA;&#xA;#删除某个key&#xA;salt-key -d minion_id&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.测试是否连通&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#测试所有minion的连通性&#xA;salt &amp;#39;*&amp;#39; test.ping&#xA;&#xA;#测试某个minion的连通性&#xA;salt &amp;#39;minion_id&amp;#39; test.ping&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3.常用命令&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#salt cmd.run用于让minion批量执行命令&#xA;salt &amp;#39;*&amp;#39; cmd.run &amp;#39;ifconfig&amp;#39;&#xA;salt &amp;#39;minion_id&amp;#39; cmd.run &amp;#39;ifconfig&amp;#39;&#xA;&#xA;#salt-run manage查看minioni信息&#xA;salt-run manage.status #查看所有minion状态&#xA;salt-run manage.down ##查看down掉的minion&#xA;salt-run manage.up ##查看up的minion&#xA;&#xA;#salt-key管理密钥&#xA;salt-key [options]&#xA;salt-key -L              ##查看所有minion-key&#xA;salt-key -a &amp;lt;key-name&amp;gt;   ##接受某个minion-key&#xA;salt-key -d &amp;lt;key-name&amp;gt;   ##删除某个minion-key&#xA;salt-key -A              ##接受所有的minion-key&#xA;salt-key -D              ##删除所有的minion-key&#xA;&#xA;#salt-call在minion上执行某命令&#xA;salt-call [options] &amp;lt;function&amp;gt; [arguments]&#xA;salt-call test.ping           ##自己执行test.ping命令&#xA;salt-call cmd.run &amp;#39;ifconfig&amp;#39;  ##自己执行cmd.run函数&#xA;&#xA;#salt-cp分发文件给minion(不支持目录分发)&#xA;salt-cp &amp;#39;*&amp;#39; testfile.html /tmp   #把testfile.html发送到所有minion的/tmp文件夹&#xA;salt-cp &amp;#39;test*&amp;#39; index.html /tmp/a.html   #把index.html发送到所有test*的minion并重命名为/tmp/a.html&#xA;&#xA;#目标minion分组&#xA;修改/etc/salt/master&#xA;nodegroups:&#xA;  testgroup1: &amp;#39;L@test82.salt.cn,test83.salt.cn&amp;#39;&#xA;  testgroup2: &amp;#39;192.168.2.84&amp;#39;&#xA;#-N为分组命令符&#xA;salt -N testgroup1 test.ping&#xA;#分组分为多种类型：&#xA;    G -- 针对 Grains 做单个匹配，例如：G@os:Ubuntu&#xA;    E -- 针对 minion 针对正则表达式做匹配，例如：E@web\d+.(dev|qa|prod).loc&#xA;    P -- 针对 Grains 做正则表达式匹配，例如：P@os:(RedHat|Fedora|CentOS)&#xA;    L -- 针对 minion 做列表匹配，例如：L@minion1.example.com,minion3.domain.com or bl*.domain.com&#xA;    I -- 针对 Pillar 做单个匹配，例如：I@pdata:foobar&#xA;    S -- 针对子网或是 IP 做匹配，例如：S@192.168.1.0/24 or S@192.168.1.100&#xA;    R -- 针对客户端范围做匹配，例如： R@%foo.bar&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
        </item><item>
            <title>nginx配置文件nginx.conf中文详解</title>
            <link>http://localhost:1313/posts/2017/11/2017-11-21-nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6nginx-conf%E4%B8%AD%E6%96%87%E8%AF%A6%E8%A7%A3/</link>
            <pubDate>Tue, 21 Nov 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/11/2017-11-21-nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6nginx-conf%E4%B8%AD%E6%96%87%E8%AF%A6%E8%A7%A3/</guid>
            <description>&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;######Nginx配置文件nginx.conf中文详解#####&#xA;&#xA;#定义Nginx运行的用户和用户组&#xA;user www www;&#xA;&#xA;#nginx进程数，建议设置为等于CPU总核心数。&#xA;worker_processes 8;&#xA; &#xA;#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]&#xA;error_log /usr/local/nginx/logs/error.log info;&#xA;&#xA;#进程pid文件&#xA;pid /usr/local/nginx/logs/nginx.pid;&#xA;&#xA;&#xA;&#xA;#指定进程可以打开的最大描述符：数目&#xA;#工作模式与连接数上限&#xA;#这个指令是指当一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（ulimit -n）与nginx进程数相除，但是nginx分配请求并不是那么均匀，所以最好与ulimit -n 的值保持一致。&#xA;#现在在linux 2.6内核下开启文件打开数为65535，worker_rlimit_nofile就相应应该填写65535。&#xA;#这是因为nginx调度时分配请求到进程并不是那么的均衡，所以假如填写10240，总并发量达到3-4万时就有进程可能超过10240了，这时会返回502错误。&#xA;worker_rlimit_nofile 65535;&#xA;&#xA;events&#xA;{&#xA;    #参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型&#xA;    #是Linux 2.6以上版本内核中的高性能网络I/O模型，linux建议epoll，如果跑在FreeBSD上面，就用kqueue模型。&#xA;    #补充说明：&#xA;    #与apache相类，nginx针对不同的操作系统，有不同的事件模型&#xA;    #A）标准事件模型&#xA;    #Select、poll属于标准事件模型，如果当前系统不存在更有效的方法，nginx会选择select或poll&#xA;    #B）高效事件模型&#xA;    #Kqueue：使用于FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 和 MacOS X.使用双处理器的MacOS X系统使用kqueue可能会造成内核崩溃。&#xA;    #Epoll：使用于Linux内核2.6版本及以后的系统。&#xA;    #/dev/poll：使用于Solaris 7 11/99+，HP/UX 11.22+ (eventport)，IRIX 6.5.15+ 和 Tru64 UNIX 5.1A+。&#xA;    #Eventport：使用于Solaris 10。 为了防止出现内核崩溃的问题， 有必要安装安全补丁。&#xA;    use epoll;&#xA;&#xA;    #单个进程最大连接数（最大连接数=连接数*进程数）&#xA;    #根据硬件调整，和前面工作进程配合起来用，尽量大，但是别把cpu跑到100%就行。每个进程允许的最多连接数，理论上每台nginx服务器的最大连接数为。&#xA;    worker_connections 65535;&#xA;&#xA;    #keepalive超时时间。&#xA;    keepalive_timeout 60;&#xA;&#xA;    #客户端请求头部的缓冲区大小。这个可以根据你的系统分页大小来设置，一般一个请求头的大小不会超过1k，不过由于一般系统分页都要大于1k，所以这里设置为分页大小。&#xA;    #分页大小可以用命令getconf PAGESIZE 取得。&#xA;    #[root@web001 ~]# getconf PAGESIZE&#xA;    #4096&#xA;    #但也有client_header_buffer_size超过4k的情况，但是client_header_buffer_size该值必须设置为“系统分页大小”的整倍数。&#xA;    client_header_buffer_size 4k;&#xA;&#xA;    #这个将为打开文件指定缓存，默认是没有启用的，max指定缓存数量，建议和打开文件数一致，inactive是指经过多长时间文件没被请求后删除缓存。&#xA;    open_file_cache max=65535 inactive=60s;&#xA;&#xA;    #这个是指多长时间检查一次缓存的有效信息。&#xA;    #语法:open_file_cache_valid time 默认值:open_file_cache_valid 60 使用字段:http, server, location 这个指令指定了何时需要检查open_file_cache中缓存项目的有效信息.&#xA;    open_file_cache_valid 80s;&#xA;&#xA;    #open_file_cache指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一直是在缓存中打开的，如上例，如果有一个文件在inactive时间内一次没被使用，它将被移除。&#xA;    #语法:open_file_cache_min_uses number 默认值:open_file_cache_min_uses 1 使用字段:http, server, location  这个指令指定了在open_file_cache指令无效的参数中一定的时间范围内可以使用的最小文件数,如果使用更大的值,文件描述符在cache中总是打开状态.&#xA;    open_file_cache_min_uses 1;&#xA;    &#xA;    #语法:open_file_cache_errors on | off 默认值:open_file_cache_errors off 使用字段:http, server, location 这个指令指定是否在搜索一个文件是记录cache错误.&#xA;    open_file_cache_errors on;&#xA;}&#xA; &#xA; &#xA; &#xA;#设定http服务器，利用它的反向代理功能提供负载均衡支持&#xA;http&#xA;{&#xA;    #文件扩展名与文件类型映射表&#xA;    include mime.types;&#xA;&#xA;    #默认文件类型&#xA;    default_type application/octet-stream;&#xA;&#xA;    #默认编码&#xA;    #charset utf-8;&#xA;&#xA;    #服务器名字的hash表大小&#xA;    #保存服务器名字的hash表是由指令server_names_hash_max_size 和server_names_hash_bucket_size所控制的。参数hash bucket size总是等于hash表的大小，并且是一路处理器缓存大小的倍数。在减少了在内存中的存取次数后，使在处理器中加速查找hash表键值成为可能。如果hash bucket size等于一路处理器缓存的大小，那么在查找键的时候，最坏的情况下在内存中查找的次数为2。第一次是确定存储单元的地址，第二次是在存储单元中查找键 值。因此，如果Nginx给出需要增大hash max size 或 hash bucket size的提示，那么首要的是增大前一个参数的大小.&#xA;    server_names_hash_bucket_size 128;&#xA;&#xA;    #客户端请求头部的缓冲区大小。这个可以根据你的系统分页大小来设置，一般一个请求的头部大小不会超过1k，不过由于一般系统分页都要大于1k，所以这里设置为分页大小。分页大小可以用命令getconf PAGESIZE取得。&#xA;    client_header_buffer_size 32k;&#xA;&#xA;    #客户请求头缓冲大小。nginx默认会用client_header_buffer_size这个buffer来读取header值，如果header过大，它会使用large_client_header_buffers来读取。&#xA;    large_client_header_buffers 4 64k;&#xA;&#xA;    #设定通过nginx上传文件的大小&#xA;    client_max_body_size 8m;&#xA;&#xA;    #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。&#xA;    #sendfile指令指定 nginx 是否调用sendfile 函数（zero copy 方式）来输出文件，对于普通应用，必须设为on。如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络IO处理速度，降低系统uptime。&#xA;    sendfile on;&#xA;&#xA;    #开启目录列表访问，合适下载服务器，默认关闭。&#xA;    autoindex on;&#xA;&#xA;    #此选项允许或禁止使用socke的TCP_CORK的选项，此选项仅在使用sendfile的时候使用&#xA;    tcp_nopush on;&#xA;     &#xA;    tcp_nodelay on;&#xA;&#xA;    #长连接超时时间，单位是秒&#xA;    keepalive_timeout 120;&#xA;&#xA;    #FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。&#xA;    fastcgi_connect_timeout 300;&#xA;    fastcgi_send_timeout 300;&#xA;    fastcgi_read_timeout 300;&#xA;    fastcgi_buffer_size 64k;&#xA;    fastcgi_buffers 4 64k;&#xA;    fastcgi_busy_buffers_size 128k;&#xA;    fastcgi_temp_file_write_size 128k;&#xA;&#xA;    #gzip模块设置&#xA;    gzip on; #开启gzip压缩输出&#xA;    gzip_min_length 1k;    #最小压缩文件大小&#xA;    gzip_buffers 4 16k;    #压缩缓冲区&#xA;    gzip_http_version 1.0;    #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）&#xA;    gzip_comp_level 2;    #压缩等级&#xA;    gzip_types text/plain application/x-javascript text/css application/xml;    #压缩类型，默认就已经包含textml，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。&#xA;    gzip_vary on;&#xA;&#xA;    #开启限制IP连接数的时候需要使用&#xA;    #limit_zone crawler $binary_remote_addr 10m;&#xA;&#xA;    #负载均衡配置&#xA;    upstream jh.w3cschool.cn {&#xA;     &#xA;        #upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。&#xA;        server 192.168.80.121:80 weight=3;&#xA;        server 192.168.80.122:80 weight=2;&#xA;        server 192.168.80.123:80 weight=3;&#xA;&#xA;        #nginx的upstream目前支持4种方式的分配&#xA;        #1、轮询（默认）&#xA;        #每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。&#xA;        #2、weight&#xA;        #指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。&#xA;        #例如：&#xA;        #upstream bakend {&#xA;        #    server 192.168.0.14 weight=10;&#xA;        #    server 192.168.0.15 weight=10;&#xA;        #}&#xA;        #2、ip_hash&#xA;        #每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。&#xA;        #例如：&#xA;        #upstream bakend {&#xA;        #    ip_hash;&#xA;        #    server 192.168.0.14:88;&#xA;        #    server 192.168.0.15:80;&#xA;        #}&#xA;        #3、fair（第三方）&#xA;        #按后端服务器的响应时间来分配请求，响应时间短的优先分配。&#xA;        #upstream backend {&#xA;        #    server server1;&#xA;        #    server server2;&#xA;        #    fair;&#xA;        #}&#xA;        #4、url_hash（第三方）&#xA;        #按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。&#xA;        #例：在upstream中加入hash语句，server语句中不能写入weight等其他的参数，hash_method是使用的hash算法&#xA;        #upstream backend {&#xA;        #    server squid1:3128;&#xA;        #    server squid2:3128;&#xA;        #    hash $request_uri;&#xA;        #    hash_method crc32;&#xA;        #}&#xA;&#xA;        #tips:&#xA;        #upstream bakend{#定义负载均衡设备的Ip及设备状态}{&#xA;        #    ip_hash;&#xA;        #    server 127.0.0.1:9090 down;&#xA;        #    server 127.0.0.1:8080 weight=2;&#xA;        #    server 127.0.0.1:6060;&#xA;        #    server 127.0.0.1:7070 backup;&#xA;        #}&#xA;        #在需要使用负载均衡的server中增加 proxy_pass http://bakend/;&#xA;&#xA;        #每个设备的状态设置为:&#xA;        #1.down表示单前的server暂时不参与负载&#xA;        #2.weight为weight越大，负载的权重就越大。&#xA;        #3.max_fails：允许请求失败的次数默认为1.当超过最大次数时，返回proxy_next_upstream模块定义的错误&#xA;        #4.fail_timeout:max_fails次失败后，暂停的时间。&#xA;        #5.backup： 其它所有的非backup机器down或者忙的时候，请求backup机器。所以这台机器压力会最轻。&#xA;&#xA;        #nginx支持同时设置多组的负载均衡，用来给不用的server来使用。&#xA;        #client_body_in_file_only设置为On 可以讲client post过来的数据记录到文件中用来做debug&#xA;        #client_body_temp_path设置记录文件的目录 可以设置最多3层目录&#xA;        #location对URL进行匹配.可以进行重定向或者进行新的代理 负载均衡&#xA;    }&#xA;     &#xA;     &#xA;     &#xA;    #虚拟主机的配置&#xA;    server&#xA;    {&#xA;        #监听端口&#xA;        listen 80;&#xA;&#xA;        #域名可以有多个，用空格隔开&#xA;        server_name www.w3cschool.cn w3cschool.cn;&#xA;        index index.html index.htm index.php;&#xA;        root /data/www/w3cschool;&#xA;&#xA;        #对******进行负载均衡&#xA;        location ~ .*.(php|php5)?$&#xA;        {&#xA;            fastcgi_pass 127.0.0.1:9000;&#xA;            fastcgi_index index.php;&#xA;            include fastcgi.conf;&#xA;        }&#xA;         &#xA;        #图片缓存时间设置&#xA;        location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$&#xA;        {&#xA;            expires 10d;&#xA;        }&#xA;         &#xA;        #JS和CSS缓存时间设置&#xA;        location ~ .*.(js|css)?$&#xA;        {&#xA;            expires 1h;&#xA;        }&#xA;         &#xA;        #日志格式设定&#xA;        #$remote_addr与$http_x_forwarded_for用以记录客户端的ip地址；&#xA;        #$remote_user：用来记录客户端用户名称；&#xA;        #$time_local： 用来记录访问时间与时区；&#xA;        #$request： 用来记录请求的url与http协议；&#xA;        #$status： 用来记录请求状态；成功是200，&#xA;        #$body_bytes_sent ：记录发送给客户端文件主体内容大小；&#xA;        #$http_referer：用来记录从那个页面链接访问过来的；&#xA;        #$http_user_agent：记录客户浏览器的相关信息；&#xA;        #通常web服务器放在反向代理的后面，这样就不能获取到客户的IP地址了，通过$remote_add拿到的IP地址是反向代理服务器的iP地址。反向代理服务器在转发请求的http头信息中，可以增加x_forwarded_for信息，用以记录原有客户端的IP地址和原来客户端的请求的服务器地址。&#xA;        log_format access &amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;&#xA;        &amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;&#xA;        &amp;#39;&amp;#34;$http_user_agent&amp;#34; $http_x_forwarded_for&amp;#39;;&#xA;         &#xA;        #定义本虚拟主机的访问日志&#xA;        access_log  /usr/local/nginx/logs/host.access.log  main;&#xA;        access_log  /usr/local/nginx/logs/host.access.404.log  log404;&#xA;         &#xA;        #对 &amp;#34;/&amp;#34; 启用反向代理&#xA;        location / {&#xA;            proxy_pass http://127.0.0.1:88;&#xA;            proxy_redirect off;&#xA;            proxy_set_header X-Real-IP $remote_addr;&#xA;             &#xA;            #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP&#xA;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#xA;             &#xA;            #以下是一些反向代理的配置，可选。&#xA;            proxy_set_header Host $host;&#xA;&#xA;            #允许客户端请求的最大单文件字节数&#xA;            client_max_body_size 10m;&#xA;&#xA;            #缓冲区代理缓冲用户端请求的最大字节数，&#xA;            #如果把它设置为比较大的数值，例如256k，那么，无论使用firefox还是IE浏览器，来提交任意小于256k的图片，都很正常。如果注释该指令，使用默认的client_body_buffer_size设置，也就是操作系统页面大小的两倍，8k或者16k，问题就出现了。&#xA;            #无论使用firefox4.0还是IE8.0，提交一个比较大，200k左右的图片，都返回500 Internal Server Error错误&#xA;            client_body_buffer_size 128k;&#xA;&#xA;            #表示使nginx阻止HTTP应答代码为400或者更高的应答。&#xA;            proxy_intercept_errors on;&#xA;&#xA;            #后端服务器连接的超时时间_发起握手等候响应超时时间&#xA;            #nginx跟后端服务器连接超时时间(代理连接超时)&#xA;            proxy_connect_timeout 90;&#xA;&#xA;            #后端服务器数据回传时间(代理发送超时)&#xA;            #后端服务器数据回传时间_就是在规定时间之内后端服务器必须传完所有的数据&#xA;            proxy_send_timeout 90;&#xA;&#xA;            #连接成功后，后端服务器响应时间(代理接收超时)&#xA;            #连接成功后_等候后端服务器响应时间_其实已经进入后端的排队之中等候处理（也可以说是后端服务器处理请求的时间）&#xA;            proxy_read_timeout 90;&#xA;&#xA;            #设置代理服务器（nginx）保存用户头信息的缓冲区大小&#xA;            #设置从被代理服务器读取的第一部分应答的缓冲区大小，通常情况下这部分应答中包含一个小的应答头，默认情况下这个值的大小为指令proxy_buffers中指定的一个缓冲区的大小，不过可以将其设置为更小&#xA;            proxy_buffer_size 4k;&#xA;&#xA;            #proxy_buffers缓冲区，网页平均在32k以下的设置&#xA;            #设置用于读取应答（来自被代理服务器）的缓冲区数目和大小，默认情况也为分页大小，根据操作系统的不同可能是4k或者8k&#xA;            proxy_buffers 4 32k;&#xA;&#xA;            #高负荷下缓冲大小（proxy_buffers*2）&#xA;            proxy_busy_buffers_size 64k;&#xA;&#xA;            #设置在写入proxy_temp_path时数据的大小，预防一个工作进程在传递文件时阻塞太长&#xA;            #设定缓存文件夹大小，大于这个值，将从upstream服务器传&#xA;            proxy_temp_file_write_size 64k;&#xA;        }&#xA;         &#xA;         &#xA;        #设定查看Nginx状态的地址&#xA;        location /NginxStatus {&#xA;            stub_status on;&#xA;            access_log on;&#xA;            auth_basic &amp;#34;NginxStatus&amp;#34;;&#xA;            auth_basic_user_file confpasswd;&#xA;            #htpasswd文件的内容可以用apache提供的htpasswd工具来产生。&#xA;        }&#xA;         &#xA;        #本地动静分离反向代理配置&#xA;        #所有jsp的页面均交由tomcat或resin处理&#xA;        location ~ .(jsp|jspx|do)?$ {&#xA;            proxy_set_header Host $host;&#xA;            proxy_set_header X-Real-IP $remote_addr;&#xA;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#xA;            proxy_pass http://127.0.0.1:8080;&#xA;        }&#xA;         &#xA;        #所有静态文件由nginx直接读取不经过tomcat或resin&#xA;        location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|&#xA;        pdf|xls|mp3|wma)$&#xA;        {&#xA;            expires 15d; &#xA;        }&#xA;         &#xA;        location ~ .*.(js|css)?$&#xA;        {&#xA;            expires 1h;&#xA;        }&#xA;    }&#xA;}&#xA;######Nginx配置文件nginx.conf中文详解#####&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
        </item><item>
            <title>vim/nginx语法高亮插件</title>
            <link>http://localhost:1313/posts/2017/11/2017-11-20-vim-nginx%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%E6%8F%92%E4%BB%B6/</link>
            <pubDate>Mon, 20 Nov 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/11/2017-11-20-vim-nginx%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%E6%8F%92%E4%BB%B6/</guid>
            <description>&lt;p&gt;1.vim语法高亮插件molokai&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd ~/.vim/&#xA;mkdir ./colors&#xA;cd ./colos&#xA;wget https://raw.githubusercontent.com/tomasr/molokai/master/colors/molokai.vim&#xA;echo colorscheme molokai  &amp;gt;&amp;gt; ~/.vimrc&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.nginx语法高亮插件nginx.vim&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mkdir -pv  ~/.vim/syntax&#xA;cd ~/.vim/syntax&#xA;wget -O nginx.vim  http://www.vim.org/scripts/download_script.php?src_id=19394&#xA;echo &amp;#34;au BufRead,BufNewFile /etc/nginx/*,/usr/local/nginx/conf/* if &amp;amp;ft == &amp;#39;&amp;#39; | setfiletype nginx | endif &amp;#34; &amp;gt;&amp;gt; ~/.vim/filetype.vim&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
        </item><item>
            <title>用phpMyAdmin在线管理mysql数据库</title>
            <link>http://localhost:1313/posts/2017/11/2017-11-20-%E7%94%A8phpmyadmin%E5%9C%A8%E7%BA%BF%E7%AE%A1%E7%90%86mysql%E6%95%B0%E6%8D%AE%E5%BA%93/</link>
            <pubDate>Mon, 20 Nov 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/11/2017-11-20-%E7%94%A8phpmyadmin%E5%9C%A8%E7%BA%BF%E7%AE%A1%E7%90%86mysql%E6%95%B0%E6%8D%AE%E5%BA%93/</guid>
            <description>&lt;p&gt;本站phpMyAdmin测试地址：&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/phpMyAdmin&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;www.calmkart.com/phpMyAdmin&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;1.在&lt;a class=&#34;link&#34; href=&#34;https://www.phpmyadmin.net/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;phpMyAdmin&lt;/a&gt;官方网站下载最新版本软件&lt;/p&gt;&#xA;&lt;p&gt;2.unzip解压，文件夹改名为phpMyAdmin&lt;/p&gt;&#xA;&lt;p&gt;3.把config.sample.inc.php复制一份为config.inc.php&lt;/p&gt;&#xA;&lt;p&gt;4.修改以下两处&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$cfg[‘Servers’][$i][‘controluser’] = ‘您的数据库名称’;&#xA;$cfg[‘Servers’][$i][‘controlpass’] = ‘您的数据库密码’;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;root用户要用sudo所以无权限登陆，这时候推荐专门设置一个phpmyadmin用户用于管理&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;mysql -uroot -p&#xA;CREATE USER &amp;#39;phpmyadmin&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;some_pass&amp;#39;;&#xA;GRANT ALL PRIVILEGES ON *.* TO &amp;#39;phpmyadmin&amp;#39;@&amp;#39;localhost&amp;#39; WITH GRANT OPTION;&#xA;FLUSH PRIVILEGES;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;5.把phpMyAdmin文件夹复制到nginx配置的server主目录，我这里是/var/www/html/&lt;/p&gt;&#xA;&lt;p&gt;6.访问http://域名/phpMyAdmin即可&lt;/p&gt;</description>
        </item><item>
            <title>《Python进阶》读书笔记(3)</title>
            <link>http://localhost:1313/posts/2017/11/2017-11-16-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B03/</link>
            <pubDate>Thu, 16 Nov 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/11/2017-11-16-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B03/</guid>
            <description>&lt;h4 id=&#34;16异常处理&#34;&gt;16.异常处理&#xA;&lt;/h4&gt;&lt;p&gt;捕获所有异常：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;except Exception as e:&#xA;    print e&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;try/except/finally语句:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;try:&#xA;    #首先执行&#xA;    pass&#xA;except:&#xA;    #异常的话执行&#xA;    pass&#xA;finally:&#xA;    #无论是否异常，在最后都执行&#xA;    pass&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;try/else语句：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;try:&#xA;    #首先执行&#xA;    pass&#xA;else:&#xA;    #异常的话执行,且不被捕获异常&#xA;    pass&#xA;finally:&#xA;    #无论是否异常，在最后都执行&#xA;    pass&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;17简易webserver&#34;&gt;17.简易webserver&#xA;&lt;/h4&gt;&lt;p&gt;python2:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;python -m SimpleHTTPServer 8888&#xA;#在当前文件夹建立简易http服务器，端口为8888&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;python3:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;python -m http.server 8888&#xA;#在当前文件夹建立简易http服务器，端口为8888&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;注意，在python2中SimpleHTTPServer是处理GET和HEAD请求的，而CGIHTTPServer处理POST请求。&lt;/p&gt;&#xA;&lt;h4 id=&#34;18pprint&#34;&gt;18.pprint&#xA;&lt;/h4&gt;&lt;p&gt;可以用于打印dict等数据结构，比较漂亮&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from pprint import pprint&#xA;    pprint({a:1,b:2})&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;19forelse从句&#34;&gt;19.for/else从句&#xA;&lt;/h4&gt;&lt;p&gt;else仅在for循环正常结束时才会执行，当for循环被break时，不执行else&lt;/p&gt;&#xA;&lt;p&gt;举例说明：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;for item in container:&#xA;    if search_something(item):&#xA;        # Found it!&#xA;        process(item)&#xA;        break&#xA;else:&#xA;    # Didn&amp;#39;t find anything..&#xA;    not_found_in_container()&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;20用with块自动释放句柄&#34;&gt;20.用with块自动释放句柄&#xA;&lt;/h4&gt;&lt;p&gt;with块可在有异常时，自动释放句柄&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;with open(&amp;#39;a.txt&amp;#39;,&amp;#39;r+&amp;#39;) as f:&#xA;#打开成功才会获得句柄，有异常则自动释放&#xA;    file = f.read()&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;用io.open可制定编码方式：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import io &#xA;with io.open(&amp;#39;a.txt&amp;#39;, &amp;#39;w&amp;#39;, encoding=&amp;#39;utf-8&amp;#39;) as f:&#xA;    f.write(.......)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;而直接使用open(),do,close()的方式，可能因为各种error而导致没有释放资源。&lt;/p&gt;&#xA;&lt;h4 id=&#34;21协程&#34;&gt;21.协程&#xA;&lt;/h4&gt;&lt;p&gt;与生成器有点像，但生成器是返回可迭代对象的生产者，而携程是接受参数的消费者。&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;def grep(pattern):&#xA;    print(&amp;#34;Searching for&amp;#34;, pattern)&#xA;    while True:&#xA;        line = (yield)&#xA;        if pattern in line:&#xA;            print(line)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们通过send方法传送给协程数据，然后用close()方法来关闭&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;search = grep(&amp;#39;coroutine&amp;#39;)&#xA;next(search)&#xA;#output: Searching for coroutine&#xA;search.send(&amp;#34;I love you&amp;#34;)&#xA;search.send(&amp;#34;Don&amp;#39;t you love me?&amp;#34;)&#xA;search.send(&amp;#34;I love coroutine instead!&amp;#34;)&#xA;#output: I love coroutine instead!&#xA;search = grep(&amp;#39;coroutine&amp;#39;)&#xA;search.close()&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=124&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;《Python进阶》读书笔记(1)&lt;/a&gt; &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=139&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;《Python进阶》读书笔记(2)&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>《Python进阶》读书笔记(1)</title>
            <link>http://localhost:1313/posts/2017/11/2017-11-15-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B01/</link>
            <pubDate>Wed, 15 Nov 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/11/2017-11-15-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B01/</guid>
            <description>&lt;h4 id=&#34;1args与kwargs传参不定长传参&#34;&gt;&lt;strong&gt;1.*args与**kwargs传参(不定长传参)&lt;/strong&gt;&#xA;&lt;/h4&gt;&lt;p&gt;其中*args是列表传参,**kwargs是字典传参&lt;/p&gt;&#xA;&lt;p&gt;使用举例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;function(fargs, *args, **kwargs)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以用function(1)，function([1,2])，function({a:1})调用函数，都没问题。&lt;/p&gt;&#xA;&lt;h4 id=&#34;2生成器yield&#34;&gt;&lt;strong&gt;2.生成器yield&lt;/strong&gt;&#xA;&lt;/h4&gt;&lt;p&gt;可理解为只能被迭代一次的迭代器，可以节省内存&lt;/p&gt;&#xA;&lt;p&gt;使用举例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;def generation_function():&#xA;    for i in range(10):&#xA;        yield i&#xA;&#xA;for item in generation_function():&#xA;#generation_function是生成器，可被迭代的&#xA;    print item&#xA;#输出是0-&amp;gt;9，但并不需要建立一个list，节省了内存&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;3匿名函数&#34;&gt;&lt;strong&gt;3.匿名函数&lt;/strong&gt;&#xA;&lt;/h4&gt;&lt;p&gt;lambda，可减少无需重复函数&lt;/p&gt;&#xA;&lt;p&gt;格式：lambda 参数:操作&lt;/p&gt;&#xA;&lt;p&gt;使用举例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;lambda x : x+1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;4map&#34;&gt;&lt;strong&gt;4.map()&lt;/strong&gt;&#xA;&lt;/h4&gt;&lt;p&gt;将function应用于后面参数的所有LIST元素中，返回结果。(python2返回list,python3返回迭代器)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;map(function, list)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;也支持多参数:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;map(function, list1, list2, list3....)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;常结合lambda匿名函数一起使用&lt;/p&gt;&#xA;&lt;p&gt;使用举例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;items=[1,2,3,4,5]&#xA;print map(lambda x : x**2, items)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;输出[1,4,9,16,25]&lt;/p&gt;&#xA;&lt;p&gt;map的本质既将一个函数映射到若干列表的所有元素上。&lt;/p&gt;&#xA;&lt;h4 id=&#34;5filter&#34;&gt;5.filter()&#xA;&lt;/h4&gt;&lt;p&gt;过滤list中的元素，返回符合条件元素的list&lt;/p&gt;&#xA;&lt;p&gt;使用举例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;number_list = range(-5,5)&#xA;less_than_zero = filter(lambda x : x&amp;lt;0, number_list)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;输出[-5,-4,-3,-2,-1]&lt;/p&gt;&#xA;&lt;h4 id=&#34;6reduce&#34;&gt;6.reduce()&#xA;&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from functools import reduce)&#xA;product = reduce((lambda x,y:x*y),[1,2,3,4])&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;输出24&lt;/p&gt;&#xA;&lt;h4 id=&#34;7set&#34;&gt;7.set&#xA;&lt;/h4&gt;&lt;p&gt;集合既不能包含重复值(其他行为与list相似)&lt;/p&gt;&#xA;&lt;p&gt;语法：set(list)&lt;/p&gt;&#xA;&lt;p&gt;交集：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;print (set1.intersection(set2))&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;差集：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;print (set1.difference(set2))&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;8三元运算符&#34;&gt;8.三元运算符&#xA;&lt;/h4&gt;&lt;p&gt;使用举例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;is_fat = True&#xA;state = &amp;#34;fat&amp;#34; if is_fat else &amp;#34;not fat&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=139&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;《Python进阶》读书笔记(2)&lt;/a&gt; &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=150&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;《Python进阶》读书笔记(3)&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>《Python进阶》读书笔记(2)</title>
            <link>http://localhost:1313/posts/2017/11/2017-11-15-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B02/</link>
            <pubDate>Wed, 15 Nov 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/11/2017-11-15-python%E8%BF%9B%E9%98%B6%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B02/</guid>
            <description>&lt;h4 id=&#34;9装饰器&#34;&gt;9.装饰器&#xA;&lt;/h4&gt;&lt;p&gt;既将函数传参给装饰器函数，在函数执行的上下文作某些通用操作。&lt;/p&gt;&#xA;&lt;p&gt;记得要用@wraps复制函数名称(__name__)，等等属性&lt;/p&gt;&#xA;&lt;p&gt;使用举例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from functools import wraps&#xA;&#xA;def requires_auth(f):&#xA;    @wraps(f)&#xA;    def decorated(*args, **kwargs):&#xA;        auth = request.authorization&#xA;        if not auth or not check_auth(auth.username, auth.password):&#xA;            #若未登录，返回401&#xA;            authenticate()&#xA;        return f(*args, **kwargs)&#xA;    return decorated&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;10可变数据类型和不可变数据类型&#34;&gt;10.可变数据类型和不可变数据类型&#xA;&lt;/h4&gt;&lt;p&gt;可变数据类型：list,dict&lt;/p&gt;&#xA;&lt;p&gt;不可变数据类型：int,float,string,tuple&lt;/p&gt;&#xA;&lt;p&gt;可变不可变，指的是变量指向的值：可变，就是说可以改变指向的值而地址不变。不可变，就是说改变变量的值必然改变地址。&lt;/p&gt;&#xA;&lt;p&gt;python中的赋值(=)，就是左侧得到右侧内存的引用。&lt;/p&gt;&#xA;&lt;p&gt;举例说明：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;a = [1]&#xA;print a  #----&amp;gt;[1]&#xA;b = a&#xA;b.append(2)&#xA;print a #-----&amp;gt;[1,2]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;因为list为可变数据类型，而a和b指向同一片内存。当对b做+=操作时，只是向后扩充内存内容，而不会修改内存位置。所以a也改变了。&lt;/p&gt;&#xA;&lt;p&gt;同时要注意，python函数被定义时，默认参数只会被计算一次，不会每次都计算。所以，默认参数最好不要用可变数据类型，就算要用，也要注意在之后不要对其做修改。&lt;/p&gt;&#xA;&lt;h4 id=&#34;11__slots__&#34;&gt;11.__slots__&#xA;&lt;/h4&gt;&lt;p&gt;在类的定义中使用__slots__=[&amp;ldquo;name&amp;rdquo;,&amp;ldquo;age&amp;rdquo;]，则只有__slots__这个set中的属性可以被分配内存，不在其中的不可被分配内存。&lt;/p&gt;&#xA;&lt;h4 id=&#34;12容器collections&#34;&gt;12.容器collections&#xA;&lt;/h4&gt;&lt;p&gt;1.defaultdict&lt;/p&gt;&#xA;&lt;p&gt;调用不存在的key时，会用默认的工厂方法作为key默认值.&lt;/p&gt;&#xA;&lt;p&gt;举例说明：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from collections import defaultdic&#xA;&#xA;favourite_colors = defaultdict(list)&#xA;for name,color in colors:&#xA;    favourite_colors[name].append(color)&#xA;    #默认用name这个list作为KEY&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.counter计数器&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from collections import counter&#xA;c= counter(...)#为内部元素计数&#xA;favs = counter(name for name,color in colors)&#xA;#为name计数,以dict返回&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;3.deque双向链表&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from collections import deque&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;4.namedtuple命名元组&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;from collections import namedtuple&#xA;&#xA;animal = namedtuple(&amp;#39;animal&amp;#39;, &amp;#39;name age type&amp;#39;)&#xA;perry = animal(name=&amp;#34;perry&amp;#34;, age=31, type=&amp;#34;cat&amp;#34;)&#xA;#可以访问perry.name这样访问属性&#xA;print perry.name&#xA;#输出perry&#xA;#可将命名元组转换为dict，用_asdict()方法&#xA;perry._asdict()&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;13dir&#34;&gt;13.dir()&#xA;&lt;/h4&gt;&lt;p&gt;返回对象所有属性和方法&lt;/p&gt;&#xA;&lt;p&gt;举例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;a = [1,2,3]&#xA;print dir(a)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;14type和id&#34;&gt;14.type()和id()&#xA;&lt;/h4&gt;&lt;p&gt;type()返回对象类型，id()返回不同种类对象唯一ID&lt;/p&gt;&#xA;&lt;h4 id=&#34;15推导式&#34;&gt;15.推导式&#xA;&lt;/h4&gt;&lt;p&gt;1.列表推导式&lt;/p&gt;&#xA;&lt;p&gt;通过for和if生成list&lt;/p&gt;&#xA;&lt;p&gt;举例说明：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;m=[i for i in range(30) if i%3 is 0]&#xA;#------------这是list-----这是条件-----&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;语法：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;variable = [out_exp for out_exp in input_list if out_exp==2]&#xA;#----------------------------------这是list------这是条件----&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.字典推导式&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;dict = {v:k for k,v in some_dict.items()}&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=124&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;《Python进阶》读书笔记(1)&lt;/a&gt; &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/?p=150&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;《Python进阶》读书笔记(3)&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>两个简单的linux监控软件</title>
            <link>http://localhost:1313/posts/2017/11/2017-11-08-%E4%B8%A4%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84linux%E7%9B%91%E6%8E%A7%E8%BD%AF%E4%BB%B6/</link>
            <pubDate>Wed, 08 Nov 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/11/2017-11-08-%E4%B8%A4%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84linux%E7%9B%91%E6%8E%A7%E8%BD%AF%E4%BB%B6/</guid>
            <description>&lt;p&gt;除了zabbix，nagios这样重量型的监控软件之外，挑选了几个简单的linux监控软件，也还比较好用，记录一下&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;1.linux-dash&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;源地址：&lt;a class=&#34;link&#34; href=&#34;https://github.com/afaqurk/linux-dash&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/afaqurk/linux-dash&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;汉化地址：&lt;a class=&#34;link&#34; href=&#34;https://github.com/NoBey/linux-dash-zh&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/NoBey/linux-dash-zh&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;安装过程非常简单，不啰嗦了。&lt;/p&gt;&#xA;&lt;p&gt;本服务器试用地址：&lt;a class=&#34;link&#34; href=&#34;http://linux-dash.calmkart.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://linux-dash.calmkart.com/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;2.psdash&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;源地址：&lt;a class=&#34;link&#34; href=&#34;https://github.com/Jahaja/psdash&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/Jahaja/psdash&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;安装过程同样略过，很简单。&lt;/p&gt;&#xA;&lt;p&gt;本服务器试用地址：&lt;a class=&#34;link&#34; href=&#34;http://psdash.calmkart.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://psdash.calmkart.com/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;可以感受下到底哪个比较好用。&lt;/p&gt;</description>
        </item><item>
            <title>扩展并修改bash源码使支持rsyslog且增加审计条目</title>
            <link>http://localhost:1313/posts/2017/09/2017-09-13-%E6%89%A9%E5%B1%95%E5%B9%B6%E4%BF%AE%E6%94%B9bash%E6%BA%90%E7%A0%81%E4%BD%BF%E6%94%AF%E6%8C%81rsyslog%E4%B8%94%E5%A2%9E%E5%8A%A0%E5%AE%A1%E8%AE%A1%E6%9D%A1%E7%9B%AE/</link>
            <pubDate>Wed, 13 Sep 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/09/2017-09-13-%E6%89%A9%E5%B1%95%E5%B9%B6%E4%BF%AE%E6%94%B9bash%E6%BA%90%E7%A0%81%E4%BD%BF%E6%94%AF%E6%8C%81rsyslog%E4%B8%94%E5%A2%9E%E5%8A%A0%E5%AE%A1%E8%AE%A1%E6%9D%A1%E7%9B%AE/</guid>
            <description>&lt;p&gt;最终效果： log记录: /var/log/messages&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2017/09/1.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/1.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;history记录: history&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2017/09/2-1.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/2-1.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;首先去gnu下载最新版的bash源码，本次采用的是bash-4.4版本&lt;/p&gt;&#xA;&lt;p&gt;编辑config-top.h文件，主要关注以下两点: 一.103行，取消&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#define SSH_SOURCE_BASHRC&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;的注释 二.116行，取消&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#define SYSLOG_HISTORY&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;的注释&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;然后编辑bashhist.c源码文件，主要关注750行-&amp;gt;800行。 未经修改的原文件：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;void&#xA;bash_syslog_history (line)&#xA;     const char *line;&#xA;{&#xA;  char trunc[SYSLOG_MAXLEN];&#xA;  static int first = 1;&#xA;&#xA;  if (first)&#xA;    {&#xA;      openlog (shell_name, OPENLOG_OPTS, SYSLOG_FACILITY);&#xA;      first = 0;&#xA;    }&#xA;&#xA;  if (strlen(line) &amp;lt; SYSLOG_MAXLEN)&#xA;    syslog (SYSLOG_FACILITY|SYSLOG_LEVEL, &amp;#34;HISTORY: PID=%d UID=%d %s&amp;#34;, getpid(), current_user.uid, line);&#xA;  else&#xA;    {&#xA;      strncpy (trunc, line, SYSLOG_MAXLEN);&#xA;      trunc[SYSLOG_MAXLEN - 1] = &amp;#39;\0&amp;#39;;&#xA;      syslog (SYSLOG_FACILITY|SYSLOG_LEVEL, &amp;#34;HISTORY (TRUNCATED): PID=%d UID=%d %s&amp;#34;, getpid(), current_user.uid, trunc);&#xA;    }&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里主要就是用来修改syslog服务的相关记录项，可以增删功能。 修改后的代码：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;bash_syslog_history (line)&#xA;     const char *line;&#xA;{&#xA;  char trunc[SYSLOG_MAXLEN];&#xA;  static int first = 1;&#xA;  FILE *fp;&#xA;  char buffer[LEN_p];&#xA;  fp=popen(&amp;#34;echo \&amp;#34;[`who am i 2&amp;gt;/dev/null| awk &amp;#39;{print $NF}&amp;#39;|sed -e &amp;#39;s/ [()]//g&amp;#39;|sed &amp;#39;s/(//g&amp;#39;|sed &amp;#39;s/)//g&amp;#39;`]\&amp;#34;&amp;#34;,&amp;#34;r&amp;#34;);&#xA;  fgets(buffer,sizeof(buffer),fp);&#xA;  int ii = LEN_p-1;&#xA;  while(ii&amp;gt;=0 &amp;amp;&amp;amp; buffer[ii]==&amp;#39; &amp;#39;)&#xA;  ii--;&#xA;  buffer[ii] = &amp;#39;\0&amp;#39;;&#xA;  char buffer_test[LEN_p];&#xA;  int iii = 0;&#xA;  int jjj = 0;&#xA;  while(buffer[iii]!=&amp;#39;\0&amp;#39;){&#xA;   if(buffer[iii]&amp;lt;32)&#xA;     iii++;&#xA;    else&#xA;     buffer_test[jjj++]=buffer[iii++];&#xA;&#xA;  }&#xA;  buffer_test[jjj]=&amp;#39;\0&amp;#39;;&#xA;  //const char *buffer_test;&#xA;  //buffer_test = buffer;&#xA;  pclose(fp);&#xA;  //buffer_test = getenv(&amp;#34;NAME_OF_KEY&amp;#34;);&#xA;  if (first)&#xA;    {&#xA;      openlog (shell_name, OPENLOG_OPTS, SYSLOG_FACILITY);&#xA;      first = 0;&#xA;    }&#xA;&#xA;  if (strlen(line) &amp;lt; SYSLOG_MAXLEN)&#xA;    syslog (SYSLOG_FACILITY|SYSLOG_LEVEL, &amp;#34;HISTORY: PID=%d UID=%d User=%s KEY=%s CMD=%s&amp;#34;, getpid(), current_user.uid, current_user.user_name, buffer_test,line);&#xA;  else&#xA;    {&#xA;      strncpy (trunc, line, SYSLOG_MAXLEN);&#xA;      trunc[SYSLOG_MAXLEN - 1] = &amp;#39;\0&amp;#39;;&#xA;      syslog (SYSLOG_FACILITY|SYSLOG_LEVEL, &amp;#34;HISTORY (TRUNCATED): PID=%d UID=%d User=%s KEY=%s CMD=%s&amp;#34;, getpid(), current_user.uid, current_user.user_name, buffer_test,trunc);&#xA;    }&#xA;}&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里既是通过修改源码的方法添加了审计username和IP的功能，如需要加入其他任何功能直接在这里写C代码就可以了。 然后，有唯一一个需要注意的要点，rsyslog处理所有ascii&amp;lt;32的特殊字符都会显示#012无法识别，所以无论用rsyslog记录什么，都需要把ascii&amp;lt;32的特殊字符删除掉 然后编译，替换/bin/bash不再多说&lt;/p&gt;&#xA;&lt;p&gt;最后，可以编辑/etc/profile，修改环境变量，添加如下三行常用配置：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;export HISTTIMEFORMAT=&amp;#34;[%Y-%m-%d %H:%M:%S] [`who am i 2&amp;gt;/dev/null| awk &amp;#39;{print $NF}&amp;#39;|sed -e &amp;#39;s/[    ()]//g&amp;#39;`] &amp;#34;&#xA;export HISTSIZE=&amp;#34;999999&amp;#34;&#xA;readonly PROMPT_COMMAND=&amp;#34;history -a&amp;#34;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;第一行定义history格式 第二行第一history最大存储 第三行让所有用户操作都能即时写入history中，而不是退出session时再写入(如果同时又几个用户登录，可能导致history事件错乱)&lt;/p&gt;</description>
        </item><item>
            <title>(转)字符串和编码</title>
            <link>http://localhost:1313/posts/2017/09/2017-09-05-%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E7%BC%96%E7%A0%81/</link>
            <pubDate>Tue, 05 Sep 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/09/2017-09-05-%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E7%BC%96%E7%A0%81/</guid>
            <description>&lt;p&gt;一篇关于PYTHON字符串和编码的文章，写的很好，原地址：&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431664106267f12e9bef7ee14cf6a8776a479bdec9b9000&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431664106267f12e9bef7ee14cf6a8776a479bdec9b9000&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;全文如下：&lt;/p&gt;&#xA;&lt;h3 id=&#34;字符编码&#34;&gt;字符编码&#xA;&lt;/h3&gt;&lt;p&gt;我们已经讲过了，字符串也是一种数据类型，但是，字符串比较特殊的是还有一个编码问题。&lt;/p&gt;&#xA;&lt;p&gt;因为计算机只能处理数字，如果要处理文本，就必须先把文本转换为数字才能处理。最早的计算机在设计时采用8个比特（bit）作为一个字节（byte），所以，一个字节能表示的最大的整数就是255（二进制11111111=十进制255），如果要表示更大的整数，就必须用更多的字节。比如两个字节可以表示的最大整数是&lt;code&gt;65535&lt;/code&gt;，4个字节可以表示的最大整数是&lt;code&gt;4294967295&lt;/code&gt;。&lt;/p&gt;&#xA;&lt;p&gt;由于计算机是美国人发明的，因此，最早只有127个字符被编码到计算机里，也就是大小写英文字母、数字和一些符号，这个编码表被称为&lt;code&gt;ASCII&lt;/code&gt;编码，比如大写字母&lt;code&gt;A&lt;/code&gt;的编码是&lt;code&gt;65&lt;/code&gt;，小写字母&lt;code&gt;z&lt;/code&gt;的编码是&lt;code&gt;122&lt;/code&gt;。&lt;/p&gt;&#xA;&lt;p&gt;但是要处理中文显然一个字节是不够的，至少需要两个字节，而且还不能和ASCII编码冲突，所以，中国制定了&lt;code&gt;GB2312&lt;/code&gt;编码，用来把中文编进去。&lt;/p&gt;&#xA;&lt;p&gt;你可以想得到的是，全世界有上百种语言，日本把日文编到&lt;code&gt;Shift_JIS&lt;/code&gt;里，韩国把韩文编到&lt;code&gt;Euc-kr&lt;/code&gt;里，各国有各国的标准，就会不可避免地出现冲突，结果就是，在多语言混合的文本中，显示出来会有乱码。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/0&#34; alt=&#34;char-encoding-problem&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;因此，Unicode应运而生。Unicode把所有语言都统一到一套编码里，这样就不会再有乱码问题了。&lt;/p&gt;&#xA;&lt;p&gt;Unicode标准也在不断发展，但最常用的是用两个字节表示一个字符（如果要用到非常偏僻的字符，就需要4个字节）。现代操作系统和大多数编程语言都直接支持Unicode。&lt;/p&gt;&#xA;&lt;p&gt;现在，捋一捋ASCII编码和Unicode编码的区别：ASCII编码是1个字节，而Unicode编码通常是2个字节。&lt;/p&gt;&#xA;&lt;p&gt;字母&lt;code&gt;A&lt;/code&gt;用ASCII编码是十进制的&lt;code&gt;65&lt;/code&gt;，二进制的&lt;code&gt;01000001&lt;/code&gt;；&lt;/p&gt;&#xA;&lt;p&gt;字符&lt;code&gt;0&lt;/code&gt;用ASCII编码是十进制的&lt;code&gt;48&lt;/code&gt;，二进制的&lt;code&gt;00110000&lt;/code&gt;，注意字符&lt;code&gt;&#39;0&#39;&lt;/code&gt;和整数&lt;code&gt;0&lt;/code&gt;是不同的；&lt;/p&gt;&#xA;&lt;p&gt;汉字&lt;code&gt;中&lt;/code&gt;已经超出了ASCII编码的范围，用Unicode编码是十进制的&lt;code&gt;20013&lt;/code&gt;，二进制的&lt;code&gt;01001110 00101101&lt;/code&gt;。&lt;/p&gt;&#xA;&lt;p&gt;你可以猜测，如果把ASCII编码的&lt;code&gt;A&lt;/code&gt;用Unicode编码，只需要在前面补0就可以，因此，&lt;code&gt;A&lt;/code&gt;的Unicode编码是&lt;code&gt;00000000 01000001&lt;/code&gt;。&lt;/p&gt;&#xA;&lt;p&gt;新的问题又出现了：如果统一成Unicode编码，乱码问题从此消失了。但是，如果你写的文本基本上全部是英文的话，用Unicode编码比ASCII编码需要多一倍的存储空间，在存储和传输上就十分不划算。&lt;/p&gt;&#xA;&lt;p&gt;所以，本着节约的精神，又出现了把Unicode编码转化为“可变长编码”的&lt;code&gt;UTF-8&lt;/code&gt;编码。UTF-8编码把一个Unicode字符根据不同的数字大小编码成1-6个字节，常用的英文字母被编码成1个字节，汉字通常是3个字节，只有很生僻的字符才会被编码成4-6个字节。如果你要传输的文本包含大量英文字符，用UTF-8编码就能节省空间：&lt;/p&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;字符&lt;/th&gt;&#xA;          &lt;th&gt;ASCII&lt;/th&gt;&#xA;          &lt;th&gt;Unicode&lt;/th&gt;&#xA;          &lt;th&gt;UTF-8&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;A&lt;/td&gt;&#xA;          &lt;td&gt;01000001&lt;/td&gt;&#xA;          &lt;td&gt;00000000 01000001&lt;/td&gt;&#xA;          &lt;td&gt;01000001&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;中&lt;/td&gt;&#xA;          &lt;td&gt;x&lt;/td&gt;&#xA;          &lt;td&gt;01001110 00101101&lt;/td&gt;&#xA;          &lt;td&gt;11100100 10111000 10101101&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;p&gt;从上面的表格还可以发现，UTF-8编码有一个额外的好处，就是ASCII编码实际上可以被看成是UTF-8编码的一部分，所以，大量只支持ASCII编码的历史遗留软件可以在UTF-8编码下继续工作。&lt;/p&gt;&#xA;&lt;p&gt;搞清楚了ASCII、Unicode和UTF-8的关系，我们就可以总结一下现在计算机系统通用的字符编码工作方式：&lt;/p&gt;&#xA;&lt;p&gt;在计算机内存中，统一使用Unicode编码，当需要保存到硬盘或者需要传输的时候，就转换为UTF-8编码。&lt;/p&gt;&#xA;&lt;p&gt;用记事本编辑的时候，从文件读取的UTF-8字符被转换为Unicode字符到内存里，编辑完成后，保存的时候再把Unicode转换为UTF-8保存到文件：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/0&#34; alt=&#34;rw-file-utf-8&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;浏览网页的时候，服务器会把动态生成的Unicode内容转换为UTF-8再传输到浏览器：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/0&#34; alt=&#34;web-utf-8&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;所以你看到很多网页的源码上会有类似&lt;code&gt;&amp;lt;meta charset=&amp;quot;UTF-8&amp;quot; /&amp;gt;&lt;/code&gt;的信息，表示该网页正是用的UTF-8编码。&lt;/p&gt;&#xA;&lt;h3 id=&#34;python的字符串&#34;&gt;Python的字符串&#xA;&lt;/h3&gt;&lt;p&gt;搞清楚了令人头疼的字符编码问题后，我们再来研究Python的字符串。&lt;/p&gt;&#xA;&lt;p&gt;在最新的Python 3版本中，字符串是以Unicode编码的，也就是说，Python的字符串支持多语言，例如：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; print(&amp;#39;包含中文的str&amp;#39;)&#xA;包含中文的str&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;对于单个字符的编码，Python提供了&lt;code&gt;ord()&lt;/code&gt;函数获取字符的整数表示，&lt;code&gt;chr()&lt;/code&gt;函数把编码转换为对应的字符：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; ord(&amp;#39;A&amp;#39;)&#xA;65&#xA;&amp;gt;&amp;gt;&amp;gt; ord(&amp;#39;中&amp;#39;)&#xA;20013&#xA;&amp;gt;&amp;gt;&amp;gt; chr(66)&#xA;&amp;#39;B&amp;#39;&#xA;&amp;gt;&amp;gt;&amp;gt; chr(25991)&#xA;&amp;#39;文&amp;#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果知道字符的整数编码，还可以用十六进制这么写&lt;code&gt;str&lt;/code&gt;：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; &amp;#39;\u4e2d\u6587&amp;#39;&#xA;&amp;#39;中文&amp;#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;两种写法完全是等价的。&lt;/p&gt;&#xA;&lt;p&gt;由于Python的字符串类型是&lt;code&gt;str&lt;/code&gt;，在内存中以Unicode表示，一个字符对应若干个字节。如果要在网络上传输，或者保存到磁盘上，就需要把&lt;code&gt;str&lt;/code&gt;变为以字节为单位的&lt;code&gt;bytes&lt;/code&gt;。&lt;/p&gt;&#xA;&lt;p&gt;Python对&lt;code&gt;bytes&lt;/code&gt;类型的数据用带&lt;code&gt;b&lt;/code&gt;前缀的单引号或双引号表示：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;x = b&amp;#39;ABC&amp;#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;要注意区分&lt;code&gt;&#39;ABC&#39;&lt;/code&gt;和&lt;code&gt;b&#39;ABC&#39;&lt;/code&gt;，前者是&lt;code&gt;str&lt;/code&gt;，后者虽然内容显示得和前者一样，但&lt;code&gt;bytes&lt;/code&gt;的每个字符都只占用一个字节。&lt;/p&gt;&#xA;&lt;p&gt;以Unicode表示的&lt;code&gt;str&lt;/code&gt;通过&lt;code&gt;encode()&lt;/code&gt;方法可以编码为指定的&lt;code&gt;bytes&lt;/code&gt;，例如：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; &amp;#39;ABC&amp;#39;.encode(&amp;#39;ascii&amp;#39;)&#xA;b&amp;#39;ABC&amp;#39;&#xA;&amp;gt;&amp;gt;&amp;gt; &amp;#39;中文&amp;#39;.encode(&amp;#39;utf-8&amp;#39;)&#xA;b&amp;#39;\xe4\xb8\xad\xe6\x96\x87&amp;#39;&#xA;&amp;gt;&amp;gt;&amp;gt; &amp;#39;中文&amp;#39;.encode(&amp;#39;ascii&amp;#39;)&#xA;Traceback (most recent call last):&#xA;  File &amp;#34;&amp;lt;stdin&amp;gt;&amp;#34;, line 1, in &amp;lt;module&amp;gt;&#xA;UnicodeEncodeError: &amp;#39;ascii&amp;#39; codec can&amp;#39;t encode characters in position 0-1: ordinal not in range(128)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;纯英文的&lt;code&gt;str&lt;/code&gt;可以用&lt;code&gt;ASCII&lt;/code&gt;编码为&lt;code&gt;bytes&lt;/code&gt;，内容是一样的，含有中文的&lt;code&gt;str&lt;/code&gt;可以用&lt;code&gt;UTF-8&lt;/code&gt;编码为&lt;code&gt;bytes&lt;/code&gt;。含有中文的&lt;code&gt;str&lt;/code&gt;无法用&lt;code&gt;ASCII&lt;/code&gt;编码，因为中文编码的范围超过了&lt;code&gt;ASCII&lt;/code&gt;编码的范围，Python会报错。&lt;/p&gt;&#xA;&lt;p&gt;在&lt;code&gt;bytes&lt;/code&gt;中，无法显示为ASCII字符的字节，用&lt;code&gt;\x##&lt;/code&gt;显示。&lt;/p&gt;&#xA;&lt;p&gt;反过来，如果我们从网络或磁盘上读取了字节流，那么读到的数据就是&lt;code&gt;bytes&lt;/code&gt;。要把&lt;code&gt;bytes&lt;/code&gt;变为&lt;code&gt;str&lt;/code&gt;，就需要用&lt;code&gt;decode()&lt;/code&gt;方法：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; b&amp;#39;ABC&amp;#39;.decode(&amp;#39;ascii&amp;#39;)&#xA;&amp;#39;ABC&amp;#39;&#xA;&amp;gt;&amp;gt;&amp;gt; b&amp;#39;\xe4\xb8\xad\xe6\x96\x87&amp;#39;.decode(&amp;#39;utf-8&amp;#39;)&#xA;&amp;#39;中文&amp;#39;&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;要计算&lt;code&gt;str&lt;/code&gt;包含多少个字符，可以用&lt;code&gt;len()&lt;/code&gt;函数：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; len(&amp;#39;ABC&amp;#39;)&#xA;3&#xA;&amp;gt;&amp;gt;&amp;gt; len(&amp;#39;中文&amp;#39;)&#xA;2&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;len()&lt;/code&gt;函数计算的是&lt;code&gt;str&lt;/code&gt;的字符数，如果换成&lt;code&gt;bytes&lt;/code&gt;，&lt;code&gt;len()&lt;/code&gt;函数就计算字节数：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; len(b&amp;#39;ABC&amp;#39;)&#xA;3&#xA;&amp;gt;&amp;gt;&amp;gt; len(b&amp;#39;\xe4\xb8\xad\xe6\x96\x87&amp;#39;)&#xA;6&#xA;&amp;gt;&amp;gt;&amp;gt; len(&amp;#39;中文&amp;#39;.encode(&amp;#39;utf-8&amp;#39;))&#xA;6&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可见，1个中文字符经过UTF-8编码后通常会占用3个字节，而1个英文字符只占用1个字节。&lt;/p&gt;&#xA;&lt;p&gt;在操作字符串时，我们经常遇到&lt;code&gt;str&lt;/code&gt;和&lt;code&gt;bytes&lt;/code&gt;的互相转换。为了避免乱码问题，应当始终坚持使用UTF-8编码对&lt;code&gt;str&lt;/code&gt;和&lt;code&gt;bytes&lt;/code&gt;进行转换。&lt;/p&gt;&#xA;&lt;p&gt;由于Python源代码也是一个文本文件，所以，当你的源代码中包含中文的时候，在保存源代码时，就需要务必指定保存为UTF-8编码。当Python解释器读取源代码时，为了让它按UTF-8编码读取，我们通常在文件开头写上这两行：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#!/usr/bin/env python3&#xA;# -*- coding: utf-8 -*-&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;第一行注释是为了告诉Linux/OS X系统，这是一个Python可执行程序，Windows系统会忽略这个注释；&lt;/p&gt;&#xA;&lt;p&gt;第二行注释是为了告诉Python解释器，按照UTF-8编码读取源代码，否则，你在源代码中写的中文输出可能会有乱码。&lt;/p&gt;&#xA;&lt;p&gt;申明了UTF-8编码并不意味着你的&lt;code&gt;.py&lt;/code&gt;文件就是UTF-8编码的，必须并且要确保文本编辑器正在使用UTF-8 without BOM编码：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/001427719248811c5f9fd37acf54f6f93d7affbd80dd79b000&#34; alt=&#34;set-encoding-in-notepad&amp;#43;&amp;#43;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;如果&lt;code&gt;.py&lt;/code&gt;文件本身使用UTF-8编码，并且也申明了&lt;code&gt;# -*- coding: utf-8 -*-&lt;/code&gt;，打开命令提示符测试就可以正常显示中文：&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/0014277193240041efdda5a5de14f58a0879d8d4efcee66000&#34; alt=&#34;py-chinese-test-in-cmd&#34; /&gt;&#xA;&lt;/p&gt;</description>
        </item><item>
            <title>一个简单的，支持自建词库的背英语单词网站</title>
            <link>http://localhost:1313/posts/2017/09/2017-09-04-%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%94%AF%E6%8C%81%E8%87%AA%E5%BB%BA%E8%AF%8D%E5%BA%93%E7%9A%84%E8%83%8C%E8%8B%B1%E8%AF%AD%E5%8D%95%E8%AF%8D%E7%BD%91%E7%AB%99/</link>
            <pubDate>Mon, 04 Sep 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/09/2017-09-04-%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%94%AF%E6%8C%81%E8%87%AA%E5%BB%BA%E8%AF%8D%E5%BA%93%E7%9A%84%E8%83%8C%E8%8B%B1%E8%AF%AD%E5%8D%95%E8%AF%8D%E7%BD%91%E7%AB%99/</guid>
            <description>&lt;p&gt;由于近来在学英语，需要背英语单词。但网上背英语单词的网站好像不花钱都不支持自建词库，所以就顺手自己写了一个简单而支持自建词库的背英语单词网站，自用。(&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/learn&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;www.calmkart.com/learn&lt;/a&gt;)&lt;/p&gt;&#xA;&lt;p&gt;首先需要解决的问题是英语单词的翻译过程，我的第一反应是考虑用GOOGLE翻译的API，但是经过查询，需要收费，国内的大多在线翻译的API一般也都是要收费的。 然后开始考虑用爬网页的方式去做，但因为GOOGLE有自己的防爬机制(token)，通过本地计算后再爬网页的话也比较麻烦，浪费时间。 所以最后采取了使用本地词典数据库的方法来做翻译。&lt;/p&gt;&#xA;&lt;p&gt;最复杂的地方是PYTHON中字符编码的问题，需要很多次无谓ENCODE和DECODE，于是我采用了最简单的方法，完全放弃使用python2.7，而直接采用python3.6，很好的解决了字符编码的问题。剩下的后端的东西都比较简单，无非上传查找翻译等等，见后文的代码地址。&lt;/p&gt;&#xA;&lt;p&gt;主要页面功能如下： &lt;img src=&#34;images/1.jpg&#34; alt=&#34;&#34; /&gt;&#xA; &lt;img src=&#34;images/2.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;前后端数据交互采用了由后端渲染的方式，用了flask的jinja2模板。&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;这里采用jinja2模板渲染之后又一个可以考虑的地方，是用户每次切换一个单词就去服务器查询一次结果还是服务器直接查询出该用户字典所有单词结果直接传给用户，用户切词等于完全在本地通过JS操作，和服务器完全脱离关系。 在这里采用了后一种方式，直接把用户词典的所有翻译结果传给客户端，然后用户切词完全依靠JS操作，不需要再去服务器做查询，这样应该是比较快的，而且也能给服务器减轻负担。&lt;/p&gt;&#xA;&lt;p&gt;前端是采用了bootstrap框架，bootstrap的布局是分成12格，挺好用的。&lt;/p&gt;&#xA;&lt;p&gt;项目地址：&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/learn&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;www.calmkart.com/learn&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;代码已上传github,地址：&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/calmkart/learn_english&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/calmkart/learn_english&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;自行使用时请先修改setting文件中的路径，用于与本地匹配。&lt;/p&gt;</description>
        </item><item>
            <title>自用简易VIM配置</title>
            <link>http://localhost:1313/posts/2017/08/2017-08-24-%E8%87%AA%E7%94%A8%E7%AE%80%E6%98%93vim%E9%85%8D%E7%BD%AE/</link>
            <pubDate>Thu, 24 Aug 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/08/2017-08-24-%E8%87%AA%E7%94%A8%E7%AE%80%E6%98%93vim%E9%85%8D%E7%BD%AE/</guid>
            <description>&lt;p&gt;最常用到的编辑器VIM，记录一下自用简易配置方式，方便需要的时候使用。&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;cd&#xA;./.vimrc&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;./.vimrc&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;&amp;#34;去掉vi的一致性&amp;#34;&#xA;set nocompatible&#xA;&amp;#34; 隐藏滚动条&amp;#34;&#xA;set guioptions-=r&#xA;set guioptions-=L&#xA;set guioptions-=b&#xA;&amp;#34;隐藏顶部标签栏&amp;#34;&#xA;set showtabline=0&#xA;&amp;#34;设置字体&amp;#34;&#xA;set guifont=Monaco:h13&#xA;syntax on    &amp;#34;开启语法高亮&amp;#34;&#xA;set background=dark        &amp;#34;设置背景色&amp;#34;&#xA;set fileformat=unix    &amp;#34;设置以unix的格式保存文件&amp;#34;&#xA;set tabstop=4    &amp;#34;设置table长度&amp;#34;&#xA;set shiftwidth=4        &amp;#34;同上&amp;#34;&#xA;set showmatch    &amp;#34;显示匹配的括号&amp;#34;&#xA;set scrolloff=5        &amp;#34;距离顶部和底部5行&amp;#34;&#xA;set laststatus=2    &amp;#34;命令行为两行&amp;#34;&#xA;set fenc=utf-8      &amp;#34;文件编码&amp;#34;&#xA;set backspace=2&#xA;set mouse=n        &amp;#34;启用鼠标&amp;#34;&#xA;set selection=exclusive&#xA;set selectmode=mouse,key&#xA;set matchtime=5&#xA;set ignorecase        &amp;#34;忽略大小写&amp;#34;&#xA;set incsearch&#xA;set hlsearch        &amp;#34;高亮搜索项&amp;#34;&#xA;set expandtab        &amp;#34;不允许扩展table&amp;#34;&#xA;set autoread&#xA;set list&#xA;set listchars=tab:&amp;gt;-&#xA;set nu&#xA;&#xA;map  :w:!python %&#xA;&#xA;set rtp+=~/.vim/bundle/Vundle.vim&#xA;call vundle#begin()&#xA;Plugin &amp;#39;VundleVim/Vundle.vim&amp;#39;&#xA;Plugin &amp;#39;vim-airline/vim-airline&amp;#39;&#xA;call vundle#end()&#xA;&#xA;let g:airline_powerline_fonts = 1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后安装插件 这里主要安装Vundle管理插件以及界面美化插件vim-airline&lt;/p&gt;&#xA;&lt;p&gt;1.安装Vundle&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;VIM下运行 :BundleInstall 进行安装插件 :BundleClean 卸载没有写在./.vimrc中的插件&lt;/p&gt;&#xA;&lt;p&gt;2.安装vim-airline Plugin &amp;lsquo;vim-airline/vim-airline&amp;rsquo; 既可&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;配置已上传github: &lt;a class=&#34;link&#34; href=&#34;https://github.com/calmkart/vim_config&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/calmkart/vim_config&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>zabbix报警收敛</title>
            <link>http://localhost:1313/posts/2017/08/2017-08-23-zabbix%E6%8A%A5%E8%AD%A6%E6%94%B6%E6%95%9B/</link>
            <pubDate>Wed, 23 Aug 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/08/2017-08-23-zabbix%E6%8A%A5%E8%AD%A6%E6%94%B6%E6%95%9B/</guid>
            <description>&lt;p&gt;因zabbix可能同一段时间报警过多，接受消息时如果不做收敛可能出错也不容易审查，所以需要一个报警收敛机制。&lt;/p&gt;&#xA;&lt;p&gt;实验环境分为server端与client端： server端模拟收敛程序通过TCP SOCKET连接接受zabbix报警，做收敛处理并发送； client端模拟zabbix报警程序，通过TCP SOCKET连接发送模拟的zabbix报警给server;&lt;/p&gt;&#xA;&lt;p&gt;server端程序如下：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# -*- coding:utf-8 -*-&#xA;from threading import Timer&#xA;import urllib2&#xA;import socket&#xA;import threading&#xA;import re&#xA;&#xA;#event_list为收敛类型数目列表&#xA;#ip_list为IP收敛字典列表&#xA;#summary为收敛类型说明列表&#xA;#keyw为正则匹配元素&#xA;&#xA;class convergence(object):&#xA;&#x9;event_list = [0,0,0,0]&#xA;&#x9;summary = [&amp;#39;获取uptime时间失败&amp;#39;,&amp;#39;SNMP_cant_respond_for_5minutes错误&amp;#39;,&amp;#39;OK错误&amp;#39;,&amp;#39;流量速率异常错误&amp;#39;]&#xA;&#x9;ip_list = [{},{},{},{}]&#xA;&#x9;keyw = [&amp;#39;获取uptime时间失败&amp;#39;,&amp;#39;SNMPcan\&amp;#39;trespondfor5minutes&amp;#39;,&amp;#39;ok&amp;#39;,&amp;#39;流量速度异常&amp;#39;]&#xA;&#x9;t = None&#xA;&#x9;&#xA;&#x9;def convergence(self,event):&#xA;&#x9;&#x9;temp = self.keyword(event)&#xA;&#x9;&#x9;ip = self.findip(event)&#xA;&#x9;&#x9;if temp != 0:&#xA;&#x9;&#x9;&#x9;#做报警IP收敛&#xA;&#x9;&#x9;&#x9;if self.ip_list[temp-1].has_key(ip):&#xA;&#x9;&#x9;&#x9;&#x9;self.ip_list[temp-1][ip] = self.ip_list[temp-1][ip]+1&#xA;&#x9;&#x9;&#x9;else:&#xA;&#x9;&#x9;&#x9;&#x9;self.ip_list[temp-1][ip] = 1&#xA;&#x9;&#x9;&#x9;#做报警条目收敛&#xA;&#x9;&#x9;&#x9;self.event_list[temp-1] = self.event_list[temp-1]+1&#xA;&#x9;&#x9;&#x9;if self.t == None:&#xA;&#x9;&#x9;&#x9;&#x9;self.timer(event)&#xA;&#x9;&#x9;&#x9;else:&#xA;&#x9;&#x9;&#x9;&#x9;pass&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;else:&#xA;&#x9;&#x9;&#x9;#按原格式发送&#xA;&#x9;&#x9;&#x9;print event&#xA;&#x9;&#x9;&#x9;pass&#xA;&#xA;&#x9;def send(self,event):&#xA;&#x9;&#x9;print &amp;#39;目前的缓存区为&amp;#39;+str(self.event_list)&#xA;&#x9;&#x9;if max(self.event_list) == 0:&#xA;&#x9;&#x9;&#x9;pass&#xA;&#x9;&#x9;else:&#xA;&#x9;&#x9;&#x9;for i in range(0,len(event_list)):&#xA;&#x9;&#x9;&#x9;&#x9;if self.event_list[i]==0:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;pass&#xA;&#x9;&#x9;&#x9;&#x9;else:#发送收敛后的报警到指定位置&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;content = str(event_list[i]+&amp;#39;次&amp;#39;+self.summary[i]+&amp;#39;(前20秒内)&amp;#39;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;self.event_list[i] = 0&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;self.t = None&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;urllib2.urlopen(&amp;#39;http://www.calmkart.com&amp;#39;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;print content&#xA;&#xA;&#x9;def timer(self,event):#启动定时器&#xA;&#x9;&#x9;self.t = Timer(20,self.send,args=[event])&#xA;&#x9;&#x9;self.t.start()&#xA;&#x9;&#xA;&#x9;def keyword(self,event):&#xA;&#x9;&#x9;for i in range(0,len(self.keyw)):&#xA;&#x9;&#x9;&#x9;if re.search(self.keyw[i],event,flags=re.IGNORECASE) != None:&#xA;&#x9;&#x9;&#x9;&#x9;return i+1&#xA;&#x9;&#x9;return 0&#xA;&#x9;&#xA;&#x9;def findip(self,event):&#xA;&#x9;&#x9;m = re.search(r&amp;#39;(?&amp;lt;![\.\d])(?:\d{1,3}\.){3}\d{1,3}(?![\.\d])&amp;#39;,event)&#xA;&#x9;&#x9;if m is not None:&#xA;&#x9;&#x9;&#x9;ip = m.group()&#xA;&#x9;&#x9;&#x9;return str(ip)&#xA;&#x9;&#x9;return &amp;#39;查不到IP&amp;#39;&#xA;&#xA;test = convergence()&#xA;&#xA;#tcp测试,server端，接收&#xA;host = &amp;#39;0.0.0.0&amp;#39;&#xA;port = 9001&#xA;s = socket.socket()&#xA;s.bind((host,port))&#xA;s.listen(5)&#xA;&#xA;while True:&#xA;&#x9;c,addr = s.accept()&#xA;&#x9;data = c.recv(1024)&#xA;&#x9;test.convergence(data)&#xA;&#x9;&#xA;##udp测试,server端，接收&#xA;#s= socket.socket(socket.AF_INET, socket.SOCK_DGRAM)&#xA;#host = &amp;#39;10.17.16.207&amp;#39;&#xA;#port = 9001&#xA;#s.bind((host,port))&#xA;#&#xA;#while True:&#xA;#&#x9;data,addr = s.recvfrom(2048)&#xA;#&#x9;test.convergence(data)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;clent端程序如下：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# --- coding:utf-8 ---&#xA;import random&#xA;from multiprocessing.connection import Client&#xA;&#xA;str1 = [&#xA;&#x9;&amp;#39;192.168.0.1SNMP错误&amp;#39;,&#xA;        &amp;#39;192.168.0.2SNMP错误&amp;#39;,&#xA;        &amp;#39;192.168.0.100,OK&amp;#39;,&#xA;        &amp;#39;192.168.0.101,ok&amp;#39;,&#xA;&#x9;&amp;#39;192.168.0.102,流量速率异常&amp;#39;,&#xA;&#x9;&amp;#39;192.168.0.103,流量速率异常&amp;#39;,&#xA;&#x9;&amp;#39;192.168.0.104,获取uptime时间失败&amp;#39;,&#xA;&#x9;&amp;#39;192.168.0.105,获取uptime时间失败&amp;#39;&#xA;] &#xA;address = (&amp;#39;0.0.0.0&amp;#39;,9001)&#xA;&#xA;for i in range(0,1000):&#xA;&#x9;m = str1[random.randrange(0,11)]&#xA;&#x9;conn = Client(address)&#xA;&#x9;conn.send(m)&#xA;&#x9;conn.close&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;主要用到的工具是正则表达式做匹配&lt;/p&gt;&#xA;&lt;p&gt;代码已上传至github,地址 &lt;a class=&#34;link&#34; href=&#34;https://github.com/calmkart/Zabbix_convergence&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/calmkart/Zabbix_convergence&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>windows配置snmp v3监控(net-snmp)</title>
            <link>http://localhost:1313/posts/2017/08/2017-08-10-windows%E9%85%8D%E7%BD%AEsnmp-v3%E7%9B%91%E6%8E%A7net-snmp/</link>
            <pubDate>Thu, 10 Aug 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/08/2017-08-10-windows%E9%85%8D%E7%BD%AEsnmp-v3%E7%9B%91%E6%8E%A7net-snmp/</guid>
            <description>&lt;p&gt;因为windows本身是不支持snmp v3的，所以需要第三方工具的帮助 这里我们选择常用的net-snmp&lt;/p&gt;&#xA;&lt;h4 id=&#34;步骤&#34;&gt;&lt;strong&gt;步骤：&lt;/strong&gt;&#xA;&lt;/h4&gt;&lt;p&gt;1.关闭本系统中的SNMP服务&lt;/p&gt;&#xA;&lt;p&gt;2.安装vc x64库&lt;/p&gt;&#xA;&lt;p&gt;3.安装openssl x64版本(最新版本)&lt;/p&gt;&#xA;&lt;p&gt;4.解压openssl 0.9.8zf x64版，将ssleay32.dll和libeay32.dll复制进c:/windows/system32和c:/windows/syswow64 里，替换原文件&lt;/p&gt;&#xA;&lt;p&gt;5.安装net-snmp-5.5.0-2.x64版本的net-snmp，记得勾选with windows extension dll support和encryption support(openssl)选项(WINDOWS DLL可以开启一些不能使用的功能，encrytion support才可以开启登录且验证的SNMP V3功能)&lt;/p&gt;&#xA;&lt;p&gt;6.安装activeperl，默认安装既可&lt;/p&gt;&#xA;&lt;p&gt;7.运行c:/usr/registeragent.bat 把SNMP V3服务进行注册&lt;/p&gt;&#xA;&lt;p&gt;8.编写 c:\usr\etc\snmp\snmpd.conf 配置文件，这里我用的配置如下（细节不赘述）&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;agentAddress  udp:0.0.0.0:161&#xA;createUser authPrivUser  SHA &amp;#34;passwordauthprivuser&amp;#34;  DES&#xA;#  Full read-only access for SNMPv3&#xA;#  Full write access for encrypted requests&#xA;#     Remember to activate the &amp;#39;createUser&amp;#39; lines above&#xA;rouser   authPrivUser   priv&#xA;sysLocation    Sitting on the Dock of the Bay&#xA;sysContact     Me &amp;lt;me@example.org&amp;gt;&#xA;# Application + End-to-End layers&#xA;sysServices    72&#xA;# At least one  &amp;#39;mountd&amp;#39; process&#xA;proc  mountd&#xA;# No more than 4 &amp;#39;ntalkd&amp;#39; processes - 0 is OK&#xA;proc  ntalkd    4&#xA;# At least one &amp;#39;sendmail&amp;#39; process, but no more than 10&#xA;proc  sendmail 10 1&#xA;# 10MBs required on root disk, 5% free on /var, 10% free on all other disks&#xA;#disk       /     10000&#xA;#disk       /var  5%&#xA;#includeAllDisks  10%&#xA;# Unacceptable 1-, 5-, and 15-minute load averages&#xA;load   12 10 5&#xA;#   send SNMPv2c traps&#xA;#   send SNMPv2c INFORMs&#xA;# Remember to activate the &amp;#39;createUser&amp;#39; lines above&#xA;iquerySecName   internalUser       &#xA;rouser          internalUser&#xA;# generate traps on UCD error conditions&#xA;defaultMonitors          yes&#xA;# generate traps on linkUp/Down&#xA;linkUpDownNotifications  yes&#xA;#  Run as an AgentX master agent&#xA;master          agentx&#xA;#  Listen for network connections (from localhost)&#xA;#  rather than the default named socket /var/agentx/master&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;测试&#34;&gt;&lt;strong&gt;测试：&lt;/strong&gt;&#xA;&lt;/h4&gt;&lt;p&gt;snmp v3 安全级别有三种，分别为 noAuthNoPriv（不认证也不加密）、authNoPriv（认证但是不加密）、 authPriv（既认证又加密）&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/uYrkAw4K6DZqj3vdzfAOg.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;常见的 SNMP OID列表 监控需要用到的OID如下连接:&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.ttlsa.com/monitor/snmp-oid/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://www.ttlsa.com/monitor/snmp-oid/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;本次整个配置过程所有程序安装包在此下载:&lt;/p&gt;&#xA;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/snmp_v3_allinone.rar&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://www.calmkart.com/snmp_v3_allinone.rar&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>用telnetlib库实现交换机批量管理</title>
            <link>http://localhost:1313/posts/2017/08/2017-08-07-%E7%94%A8telnetlib%E5%BA%93%E5%AE%9E%E7%8E%B0%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%89%B9%E9%87%8F%E7%AE%A1%E7%90%86/</link>
            <pubDate>Mon, 07 Aug 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/08/2017-08-07-%E7%94%A8telnetlib%E5%BA%93%E5%AE%9E%E7%8E%B0%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%89%B9%E9%87%8F%E7%AE%A1%E7%90%86/</guid>
            <description>&lt;p&gt;在日常工作中，有时候会遇到需要批量操作多台交换机的情况。而交换机普遍是采用定制系统，默认是telnet登陆，即使换成ssh登陆也无法使用ansible进行统一管理，所以通过python telnetlib库实现了交换机的批量管理(交换机型号为思科2960x)&lt;/p&gt;&#xA;&lt;p&gt;实现代码如下： switch_telnet.py&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#encoding=utf-8&#xA;import sys&#xA;import telnetlib&#xA;import time&#xA;&#xA;def tel(ip,user,password):&#xA;    tn = telnetlib.Telnet(ip,port=23)&#xA;    tn.read_until(&amp;#39;Verification\r\n\r\nUsername: &amp;#39;)&#xA;    tn.write(user+&amp;#39;\n&amp;#39;)&#xA;#   tn.set_debuglevel(2)&#xA;    #password&#xA;    tn.read_until(&amp;#39;Password: &amp;#39;)&#xA;    tn.write(password+&amp;#39;\n&amp;#39;)&#xA;    #login fail&#xA;    if tn.read_some()==&amp;#39;\r\nPassword: &amp;#39;:&#xA;        print &amp;#39;\033[1;31;40m&amp;#39;+ip+&amp;#39;\033[0m&amp;#39;+&amp;#39;     password is wrong,login false!&amp;#39;&#xA;        tn.close()&#xA;        return 1&#xA;    #login successs&#xA;    tn.write(&amp;#39;enable\n&amp;#39;)&#xA;    #password&#xA;    tn.read_until(&amp;#39;Password: &amp;#39;)&#xA;    tn.write(password+&amp;#39;\n&amp;#39;)&#xA;    #enable susccess set terimal length&#xA;    tn.read_until(&amp;#39;Switch#&amp;#39;)&#xA;    tn.write(&amp;#39;ter len 0\n&amp;#39;)&#xA;    time.sleep(1)&#xA;    if tn.read_some()==&amp;#39;ter len 0\r\nSwitch#&amp;#39;:&#xA;        print ip+&amp;#39;     telnet login susccess&amp;#39;&#xA;        return tn&#xA;    print ip+&amp;#39;     terminal length 0 false!&amp;#39;&#xA;    return 1&#xA;&#xA;def comm(tn,ip,cmd):&#xA;    tn.write(cmd+&amp;#39;\n&amp;#39;)&#xA;    time.sleep(.2)&#xA;    result = tn.read_very_eager()&#xA;    print (&amp;#39;\033[1;31;40m&amp;#39;+ip+&amp;#39;\033[0m&amp;#39;+&amp;#39;   &amp;#39;+result)&#xA;&#xA;ip_list = []&#xA;user_list = []&#xA;password_list = []&#xA;tn = []&#xA;ip_fp = open(&amp;#39;ip_list&amp;#39;,&amp;#39;r&amp;#39;)&#xA;ip_fs = ip_fp.read()&#xA;ip_fp.close()&#xA;fa = ip_fs.split(&amp;#39;\n&amp;#39;)&#xA;&#xA;for i in range(0,len(fa)-1):&#xA;    f_res = fa[i].split(&amp;#39;,&amp;#39;)&#xA;    ip_list.append(f_res[0])&#xA;    user_list.append(f_res[1])&#xA;    password_list.append(f_res[2])&#xA;&#xA;for i in range(0,len(fa)-1):&#xA;    tn.append(tel(ip_list[i],user_list[i],password_list[i]))&#xA;&#xA;while 1:&#xA;    cmd = raw_input(&amp;#34;input the command: &amp;#34;)&#xA;    if cmd == &amp;#39;quit&amp;#39;:&#xA;        for i in range(0,len(fa)-1):&#xA;            tn[i].write(&amp;#39;quit\n&amp;#39;)&#xA;        break&#xA;&#xA;    for i in range(0,len(fa)-1):&#xA;        comm(tn[i],ip_list[i],cmd+&amp;#39;\n&amp;#39;)&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;脚本详解：&lt;/p&gt;&#xA;&lt;p&gt;主要使用了python的telnetlib库，下面概述常见的几个方法。&lt;/p&gt;&#xA;&lt;p&gt;telnetlib.Telnet([host[, port[, timeout]]]) 此方法返回一个client对象，可操作&lt;/p&gt;&#xA;&lt;p&gt;Telnet.read_until(expected[, timeout]) 此方法阻塞读取缓存区输出，匹配expected才继续&lt;/p&gt;&#xA;&lt;p&gt;Telnet.read_all() 读取所有输出，读取到结束符或者连接中断&lt;/p&gt;&#xA;&lt;p&gt;Telnet.read_some() 读取至少一个输出&lt;/p&gt;&#xA;&lt;p&gt;Telnet.read_very_eager() 读取尽量多的输出，但记得要time.sleep()一定时间，不然会因为来不及读取所有数据导致数据丢失&lt;/p&gt;&#xA;&lt;p&gt;Telnet.write(buffer) 向client对象写入数据，记得换行符\n&lt;/p&gt;&#xA;&lt;p&gt;Telnet.close() 关闭连接&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;操作指南：&lt;/p&gt;&#xA;&lt;p&gt;使用时在同路径下编辑ip_list文件，格式为ip,username,password既可，一个交换机占一行，如下例：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;10.32.19.9,cisco,123456&#xA;10.32.19.10,cisco,654321&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;运行 python ./switch_telnet.py&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/TdCoxrKTPjmnsPncPk6g.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;显示所有交换机IP的登陆情况，然后输入命令交互即可（类似ansible）&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;images/69tpvwdEhq4CEDx3XQohhQ.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;可以随意使用exit命令，但直接退出脚本指令为quit&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;其他：&lt;/p&gt;&#xA;&lt;p&gt;同类可用库还有pexpect，非常强大 如果是SSH登陆的交换机，可以使用netmiko，还可以用fabric批量管理，不再赘述&lt;/p&gt;&#xA;&lt;p&gt;项目源码已上传github &lt;a class=&#34;link&#34; href=&#34;https://github.com/calmkart/switch_telnet&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/calmkart/switch_telnet&lt;/a&gt;&lt;/p&gt;</description>
        </item><item>
            <title>openstack部署指南(devstack/newton)</title>
            <link>http://localhost:1313/posts/2017/08/2017-08-03-openstack%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97devstacknewton/</link>
            <pubDate>Thu, 03 Aug 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/08/2017-08-03-openstack%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97devstacknewton/</guid>
            <description>&lt;h1 id=&#34;1部署环境&#34;&gt;1.部署环境&#xA;&lt;/h1&gt;&lt;p&gt;本次openstack部署环境为三台服务器，系统统一为ubuntu16.04 server。三台服务器分别为R730，R720，R710，其中R730作为控制节点+网络节点+计算节点，R710与R720作为计算节点。&lt;/p&gt;&#xA;&lt;p&gt;部署环境如下图所示： &lt;img src=&#34;images/QerThQ3lh1t69wOLWlXP3g.png&#34; alt=&#34;&#34; /&gt;&#xA; 其中各机器eth1网卡为管理及API网络（同时也是部署与下载网络），eth2网卡为虚拟机内部租户网络，控制节点R730服务器的eth2网卡为用来上网的外部网络。&lt;/p&gt;&#xA;&lt;p&gt;其中各节点安装服务列表如下： (R730)Devstack-controller：Keystone,Glance,Cinder,Neutron,Nova&amp;hellip;.. (R720)Devstack-compute-1：KVM Hypervisor,Nova,Neutron agent&amp;hellip;. (R710)Devstack-compute-2：KVM Hypervisor,Nova,Neutron agent&amp;hellip;.&lt;/p&gt;&#xA;&lt;h1 id=&#34;2控制节点网络拓扑&#34;&gt;2.控制节点网络拓扑&#xA;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;images/%e7%81%ab%e6%98%9f%e5%9b%be%e7%89%87_20170803_141421.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;外网网卡eth2绑定OVS外部网络网桥Br-ex，再通过虚拟路由器连接内部OVS网桥Br-int与Br-ex，实现内部虚拟机与外部的通信。 但由于虚拟路由默认自带DHCP功能，会污染外部网络，所以目前的做法是将虚拟路由的DHCP功能关闭，为内部一台跳板机手动配置IP，然后所有内部虚拟机通过此跳板机访问。&lt;/p&gt;&#xA;&lt;h1 id=&#34;3部署过程细节&#34;&gt;3.部署过程细节&#xA;&lt;/h1&gt;&lt;h2 id=&#34;1为各台服务器配置网卡参数&#34;&gt;1.为各台服务器配置网卡参数&#xA;&lt;/h2&gt;&lt;p&gt;/etc/network/interfaces&lt;/p&gt;&#xA;&lt;p&gt;R730： &lt;img src=&#34;images/1.png&#34; alt=&#34;&#34; /&gt;&#xA; R720： &lt;img src=&#34;images/2.png&#34; alt=&#34;&#34; /&gt;&#xA; R710： &lt;img src=&#34;images/3.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;重启机器&lt;/p&gt;&#xA;&lt;p&gt; &lt;/p&gt;&#xA;&lt;h2 id=&#34;2配置devstack相关环境&#34;&gt;2.配置devstack相关环境&#xA;&lt;/h2&gt;&lt;h3 id=&#34;1配置中国的镜像源&#34;&gt;1.配置中国的镜像源&#xA;&lt;/h3&gt;&lt;p&gt;Vi /etc/apt/sources.list&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse&#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse&#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse&#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse&#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Apt-get update Apt-get upgrade&lt;/p&gt;&#xA;&lt;h3 id=&#34;2配置pip源&#34;&gt;2.配置PIP源&#xA;&lt;/h3&gt;&lt;p&gt;Mkdir /root/.pip&lt;/p&gt;&#xA;&lt;p&gt;Vi /root/.pip/pip.conf&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[global]&#xA;timeout = 60&#xA;index-url = http://pypi.douban.com/simple&#xA;trusted-host = pypi.douban.com&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;3下载devstack代码&#34;&gt;3.下载devstack代码&#xA;&lt;/h3&gt;&lt;p&gt;本次部署使用的openstack是newton版本&lt;/p&gt;&#xA;&lt;p&gt;git clone &lt;a class=&#34;link&#34; href=&#34;https://git.openstack.org/openstack-dev/devstack&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://git.openstack.org/openstack-dev/devstack&lt;/a&gt; -b stable/newton (网络慢的话可以考虑本机下载后SCP到服务器上)&lt;/p&gt;&#xA;&lt;h3 id=&#34;4配置devstack部署安装相关环境&#34;&gt;4.配置devstack部署安装相关环境&#xA;&lt;/h3&gt;&lt;p&gt;安装python-pip Apt-get install python-pip&lt;/p&gt;&#xA;&lt;p&gt;创建stack用户 Devstack/tools/create-stack-user.sh 添加权限 Vi /etc/sudoers&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# User privilege specification&#xA;root    ALL=(ALL:ALL) ALL&#xA;stack   ALL=(ALL:ALL) ALL&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Chmod 777 /edv/pts/0&lt;/p&gt;&#xA;&lt;p&gt;Mv devstack /opt/stack/ Chown -R stack:stack /opt/stack/devstack&lt;/p&gt;&#xA;&lt;p&gt;切换到stack用户 Su - stack Cd devstack&lt;/p&gt;&#xA;&lt;h3 id=&#34;5编写配置文件&#34;&gt;5.编写配置文件&#xA;&lt;/h3&gt;&lt;p&gt;Vi local.conf 配置文件可选参数太多，不再列出，下附本次部署的配置文件&lt;/p&gt;&#xA;&lt;p&gt;R730(控制节点)部署文件local.conf:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[[local|localrc]]&#xA; &#xA;MULTI_HOST=true&#xA; &#xA;# management &amp;amp; api network&#xA;HOST_IP=10.32.19.1&#xA;LOGFILE=/opt/stack/logs/stack.sh.log&#xA; &#xA;# Credentials&#xA;ADMIN_PASSWORD=admin&#xA;MYSQL_PASSWORD=secret&#xA;RABBIT_PASSWORD=secret&#xA;SERVICE_PASSWORD=secret&#xA;SERVICE_TOKEN=abcdefghijklmnopqrstuvwxyz&#xA; &#xA;# enable neutron-ml2-vlan&#xA;disable_service n-net&#xA;enable_service q-svc,q-agt,q-dhcp,q-l3,q-meta,neutron,q-lbaas,q-fwaas&#xA;Q_AGENT=openvswitch&#xA;ENABLE_TENANT_VLANS=True&#xA;TENANT_VLAN_RANGE=3001:4000&#xA;PHYSICAL_NETWORK=eno2&#xA; &#xA;LOG_COLOR=True&#xA;LOGDIR=$DEST/logs&#xA;SCREEN_LOGDIR=$LOGDIR/screen&#xA; &#xA;#network&#xA;FIXED_RANGE=192.168.0.0/24&#xA;NETWORK_GATEWAY=192.168.0.1&#xA;FLOATING_RANGE=10.32.19.0/22&#xA;PUBLIC_NETWORK_GATEWAY=10.32.16.1&#xA;Q_FLOATING_ALLOCATION_POOL=start=10.32.19.3,end=10.32.19.10&#xA; &#xA;# use TryStack git mirror&#xA;GIT_BASE=http://git.trystack.cn&#xA;NOVNC_REPO=http://git.trystack.cn/kanaka/noVNC.git&#xA;SPICE_REPO=http://git.trystack.cn/git/spice/spice-html5.git&#xA; &#xA; &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;R720(计算节点)部署文件local.conf:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[[local|localrc]]&#xA; &#xA;MULTI_HOST=true&#xA; &#xA;# management &amp;amp; api network&#xA;HOST_IP=10.32.19.2&#xA; &#xA;# Credentials&#xA;ADMIN_PASSWORD=admin&#xA;MYSQL_PASSWORD=secret&#xA;RABBIT_PASSWORD=secret&#xA;SERVICE_PASSWORD=secret&#xA;SERVICE_TOKEN=abcdefghijklmnopqrstuvwxyz&#xA; &#xA;# Service information&#xA;SERVICE_HOST=10.32.19.1&#xA;MYSQL_HOST=$SERVICE_HOST&#xA;RABBIT_HOST=$SERVICE_HOST&#xA;GLANCE_HOSTPORT=$SERVICE_HOST:9292&#xA;Q_HOST=$SERVICE_HOST&#xA;KEYSTONE_AUTH_HOST=$SERVICE_HOST&#xA;KEYSTONE_SERVICE_HOST=$SERVICE_HOST&#xA; &#xA;ENABLED_SERVICES=n-cpu,q-agt,neutron,n-api-meta,cinder,c-vol,placement-client&#xA;Q_AGENT=openvswitch&#xA;ENABLE_TENANT_VLANS=True&#xA;TENANT_VLAN_RANGE=3001:4000&#xA;PHYSICAL_NETWORK=default&#xA; &#xA;# vnc config&#xA;NOVA_VNC_ENABLED=True&#xA;NOVNCPROXY_URL=&amp;#34;http://$SERVICE_HOST:6080/vnc_auto.html&amp;#34;&#xA;VNCSERVER_LISTEN=$HOST_IP&#xA;VNCSERVER_PROXYCLIENT_ADDRESS=$VNCSERVER_LISTEN&#xA; &#xA;LOG_COLOR=True&#xA;LOGDIR=$DEST/logs&#xA;SCREEN_LOGDIR=$LOGDIR/screen&#xA; &#xA;# use TryStack git mirror&#xA;GIT_BASE=http://git.trystack.cn&#xA;NOVNC_REPO=http://git.trystack.cn/kanaka/noVNC.git&#xA;SPICE_REPO=http://git.trystack.cn/git/spice/spice-html5.git&#xA; &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;R710(计算节点)部署文件local.conf:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[[local|localrc]]&#xA; &#xA;MULTI_HOST=true&#xA; &#xA;# management &amp;amp; api network&#xA;HOST_IP=10.32.19.3&#xA; &#xA;# Credentials&#xA;ADMIN_PASSWORD=admin&#xA;MYSQL_PASSWORD=secret&#xA;RABBIT_PASSWORD=secret&#xA;SERVICE_PASSWORD=secret&#xA;SERVICE_TOKEN=abcdefghijklmnopqrstuvwxyz&#xA; &#xA;# Service information&#xA;SERVICE_HOST=10.32.19.1&#xA;MYSQL_HOST=$SERVICE_HOST&#xA;RABBIT_HOST=$SERVICE_HOST&#xA;GLANCE_HOSTPORT=$SERVICE_HOST:9292&#xA;Q_HOST=$SERVICE_HOST&#xA;KEYSTONE_AUTH_HOST=$SERVICE_HOST&#xA;KEYSTONE_SERVICE_HOST=$SERVICE_HOST&#xA; &#xA;ENABLED_SERVICES=n-cpu,q-agt,neutron,n-api-meta,cinder,c-vol,placement-client&#xA;Q_AGENT=openvswitch&#xA;ENABLE_TENANT_VLANS=True&#xA;TENANT_VLAN_RANGE=3001:4000&#xA;PHYSICAL_NETWORK=default&#xA; &#xA;# vnc config&#xA;NOVA_VNC_ENABLED=True&#xA;NOVNCPROXY_URL=&amp;#34;http://$SERVICE_HOST:6080/vnc_auto.html&amp;#34;&#xA;VNCSERVER_LISTEN=$HOST_IP&#xA;VNCSERVER_PROXYCLIENT_ADDRESS=$VNCSERVER_LISTEN&#xA; &#xA;LOG_COLOR=True&#xA;LOGDIR=$DEST/logs&#xA;SCREEN_LOGDIR=$LOGDIR/screen&#xA; &#xA;# use TryStack git mirror&#xA;GIT_BASE=http://git.trystack.cn&#xA;NOVNC_REPO=http://git.trystack.cn/kanaka/noVNC.git&#xA;SPICE_REPO=http://git.trystack.cn/git/spice/spice-html5.git&#xA; &#xA; &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;3部署过程&#34;&gt;3.部署过程&#xA;&lt;/h2&gt;&lt;p&gt;首先在R730控制节点运行 ./stack.sh 等待部署完成，差不多2钟头内就会完成&lt;/p&gt;&#xA;&lt;p&gt;然后把外网网卡eno2绑定到外部网络网桥br-ex上，把eno2的ip交给br-ex网桥。接着把/etc/neutron/l3_agent.ini中external_network_bridge选项改为br-ex。 同时，修改/etc/neutron/plugins/ml2/ml2_conf.ini文件，把br-ex对应的项目选择正确，同时记录flat_networks的名称，与下面的外网网桥对应，此名称即为horizon中FLAT网络类型的物理网络名称，一定不可填错。最后通过screen -x stack进入neutron服务，重启之，即可。&lt;/p&gt;&#xA;&lt;p&gt;然后在R710和R720计算节点运行 ./stack.sh 既可（计算节点部署时间在30分钟以内，可随时按上述操作步骤新增计算节点）&lt;/p&gt;&#xA;&lt;h1 id=&#34;4其他杂项&#34;&gt;4.其他杂项&#xA;&lt;/h1&gt;&lt;h2 id=&#34;1部署过程中出错的解决方案&#34;&gt;1.部署过程中出错的解决方案&#xA;&lt;/h2&gt;&lt;p&gt;首先查看错误类型，常见的错误是网络问题导致下载失败 然后运行 ./unstack.sh 解除安装&lt;/p&gt;&#xA;&lt;p&gt;再运行 ./clean.sh 清理环境&lt;/p&gt;&#xA;&lt;p&gt;然后重试安装，如果还是出BUG的话，删除/opt/stack/目录，删除stack用户，重新git clone一个devstack包，创建stack用户进行安装(记得查看python-pip有无安装，没有安装一定要先安装好)&lt;/p&gt;&#xA;&lt;h2 id=&#34;2更改devstack部署配置localconf&#34;&gt;2.更改devstack部署配置local.conf&#xA;&lt;/h2&gt;&lt;p&gt;直接./unstack.sh然后./stack.sh重新部署既可，速度很快，10分钟内就会重新部署完成&lt;/p&gt;&#xA;&lt;h2 id=&#34;3重启服务器导致所有服务全部宕机&#34;&gt;3.重启服务器导致所有服务全部宕机&#xA;&lt;/h2&gt;&lt;p&gt;直接./unstack.sh然后./stack.sh重新部署既可，速度很快，10分钟内就会重新部署完成&lt;/p&gt;&#xA;&lt;h2 id=&#34;4调试openstack各模块参数后重启服务&#34;&gt;4.调试openstack各模块参数后重启服务&#xA;&lt;/h2&gt;&lt;p&gt;使用screen重启服务，切换到stack用户 运行 screen - x stack（或查找screen编号） 通过ctrl+a+p  ctrl+a+n 切换openstack服务 通过ctrl+c 中断服务，然后在对应的窗口按 ↑ 回车 重启服务&lt;/p&gt;&#xA;&lt;h2 id=&#34;5使用不了openstack命令api&#34;&gt;5.使用不了openstack命令API&#xA;&lt;/h2&gt;&lt;p&gt;首先source openrc admin admin&lt;/p&gt;&#xA;&lt;h2 id=&#34;6希望指定由具体哪台服务器创建虚拟机&#34;&gt;6.希望指定由具体哪台服务器创建虚拟机&#xA;&lt;/h2&gt;&lt;p&gt;创建Zone和Aggreate（以R730为例） Source openrc admin admin Nova aggregate-create 3 3 把对应的服务器分配进zone里 Nova aggregate-add-host 3 R730 查看 zone信息 Nova service-list 如上方法吧R710和R720分进不同zone&lt;/p&gt;&#xA;&lt;p&gt;再进入horizon创建虚拟机界面，就会有域选择 &lt;img src=&#34;images/4.png&#34; alt=&#34;&#34; /&gt;&#xA; 选择1就从710创建，选择2从720创建，选择3从730创建。&lt;/p&gt;&#xA;&lt;h2 id=&#34;7解决devstack部署openstack默认配额问题&#34;&gt;7.解决devstack部署openstack默认配额问题&#xA;&lt;/h2&gt;&lt;p&gt;可直接修改/etc/nova/nova.conf配置文件中的默认选择（如 quota_instances=10），然后重启nova服务 也可以直接修改 source openrc admin admin 查看租户配额 Nova quota-defaults &amp;ndash;tenant 租户名 改变租户配额(举例改变实例数量) Nova quota-update &amp;ndash;instance 999 租户名&lt;/p&gt;</description>
        </item><item>
            <title>pppoe_server部署指南(ubuntu_server16.04)</title>
            <link>http://localhost:1313/posts/2017/08/2017-08-03-pppoe_server%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97ubuntu_server16-04/</link>
            <pubDate>Thu, 03 Aug 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/08/2017-08-03-pppoe_server%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97ubuntu_server16-04/</guid>
            <description>&lt;p&gt;服务器系统为ubuntu16.04 server&lt;/p&gt;&#xA;&lt;h1 id=&#34;网络结构&#34;&gt;网络结构:&#xA;&lt;/h1&gt;&lt;p&gt;&lt;img src=&#34;images/20170803_163110.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;Server(ubuntu16.04)： 双网卡，enp0s3内网网卡（无法上外网，IP 169.254.0.10/16），enp0s8外网网卡（IP10.32.18.159/22）&lt;/p&gt;&#xA;&lt;p&gt;Client1(ubuntu16.04)：单网卡，enp0s3内网网卡（无法上外网，IP169.254.1.10/16）&lt;/p&gt;&#xA;&lt;p&gt;Client2(WIN7)：单网卡，内网网卡（无法上外网，IP169.254.39.53/16）&lt;/p&gt;&#xA;&lt;h1 id=&#34;1首先配源&#34;&gt;1.首先配源&#xA;&lt;/h1&gt;&lt;p&gt;Vi  /etc/apt/source.list&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted &#xA;deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted &#xA;deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted &#xA;deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial universe &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse &#xA;deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-properties &#xA;deb http://archive.canonical.com/ubuntu xenial partner &#xA;deb-src http://archive.canonical.com/ubuntu xenial partner &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted &#xA;deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-properties &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe &#xA;deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Apt-get update&lt;/p&gt;&#xA;&lt;p&gt;Apt-get upgrade&lt;/p&gt;&#xA;&lt;h2 id=&#34;2下载安装rp-pppoe&#34;&gt;2.下载安装rp-pppoe&#xA;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Wget https://www.roaringpenguin.com/files/download/rp-pppoe-3.12.tar.gz&#xA;Tar xzvf rp-pppoe-3.12.tar.gz&#xA;Chown -R root:root /rp-pppoe-3.12/&#xA;Apt-get Install libc6-dev&#xA;Apt-get Install gcc&#xA;Apt-get install make&#xA;Apt-get install ppp&#xA;./rp-pppoe-3.12/go&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;输入相关信息&lt;/p&gt;&#xA;&lt;h2 id=&#34;3配置ppp&#34;&gt;3.配置ppp&#xA;&lt;/h2&gt;&lt;p&gt;先卸载重装一遍ppp(如果已经预装)用以还原设置&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Apt-get purge ppp&#xA;Apt-get install ppp&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;修改ppp配置文件&lt;/p&gt;&#xA;&lt;p&gt;Vi  /etc/ppp/options&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Ms-dns 10.32.64.33&#xA;Ms-dns 10.32.64.34&#xA;Asyncmap 0&#xA;Auth&#xA;Crtscts&#xA;Lock&#xA;Hide-password&#xA;Modem&#xA;-pap&#xA;+chap&#xA;Lcp-echo-interval 30&#xA;Lcp-echo-failure 4&#xA;Noipx&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中-pap和+chap配置代表选择chap验证，pap验证方式无法在XP以上系统使用。&lt;/p&gt;&#xA;&lt;p&gt;Vi  /etc/ppp/pppoe-server-options&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Auth&#xA;Require-chap&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;添加登录用户信息&lt;/p&gt;&#xA;&lt;p&gt;Vi  /etc/ppp/chap-secrets&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# client server secret  IP address&#xA;“test” * “test” *&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;(有其他用户需要登录直接写在这个文件下)&lt;/p&gt;&#xA;&lt;h2 id=&#34;4启动pppoe服务&#34;&gt;4.启动PPPOE服务&#xA;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Pppoe-server -I enp0s3 -L 172.168.0.1 -R 172.168.0.100 -N 10&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;-I 后加 监听PPPOE服务的网卡 -L后加 PPPOE虚拟服务器IP（随意设置） -R后加 PPPOE网络IP起始（随意设置） -N后加可同时连接数&lt;/p&gt;&#xA;&lt;p&gt;可通过ps -aux|grep ppp查看启动是否成功 设置ipv4转发&lt;/p&gt;&#xA;&lt;p&gt;Vi /etc/sysctl.conf&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Net.ipv4.ip_forward = 1&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Sysctl -p 然后设置iptables伪装&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Iptables -t nat -A POSTROUTING -s 172.168.0.0/24 -o enp0s8 -j MASQUERADE&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt; &lt;/p&gt;&#xA;&lt;p&gt;把172.168段的伪装到enp0s8外网网卡上。既可拨上外网。&lt;/p&gt;</description>
        </item></channel>
</rss>
