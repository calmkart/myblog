<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Salt on cAlm的个人Blog</title>
        <link>http://localhost:1313/tags/salt/</link>
        <description>Recent content in Salt on cAlm的个人Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Fri, 06 Jul 2018 00:00:00 +0000</lastBuildDate><atom:link href="http://localhost:1313/tags/salt/index.xml" rel="self" type="application/rss+xml" /><item>
            <title>saltshaker--一个salt的webui</title>
            <link>http://localhost:1313/posts/2018/07/2018-07-06-saltshaker-%E4%B8%80%E4%B8%AAsalt%E7%9A%84webui/</link>
            <pubDate>Fri, 06 Jul 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/07/2018-07-06-saltshaker-%E4%B8%80%E4%B8%AAsalt%E7%9A%84webui/</guid>
            <description>&lt;p&gt;salt的webui,官方的是halite,但已经被放弃了，不维护很久了 尝试过其他几个star比较的开源实现,比如saltpad,但要么就是bug满天飞,要么就是技能栈不符难以二次开发 最后发现了一个开源实现叫saltshaker的不错,最终效果如下 &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/07/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_82481f1c-b153-4fb5-928f-2b98163e9635.png&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/%e4%bc%81%e4%b8%9a%e5%be%ae%e4%bf%a1%e6%88%aa%e5%9b%be_82481f1c-b153-4fb5-928f-2b98163e9635.png&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;官方项目地址 &lt;a class=&#34;link&#34; href=&#34;https://github.com/yueyongyue/saltshaker&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/yueyongyue/saltshaker&lt;/a&gt; 部署文档见 install.txt&lt;/p&gt;&#xA;&lt;p&gt;大致总结过程如下,非详情.&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;git clone https://github.com/yueyongyue/saltshaker.git&#xA;pip install virtualenv&#xA;virtualenv env&#xA;source env/bin/activate&#xA;yum install salt-api.noarch&#xA;&#xA;salt-api --version&#xA;pip install cherrypy==3.8.0&#xA;useradd -M -s /sbin/nologin admin&#xA;passwd admin&#xA;vim /etc/salt/master.d/saltapi.conf&#xA;systemctl restart salt-master.service&#xA;systemctl restart salt-api.service&#xA;systemctl status salt-api.service&#xA;systemctl status salt-master.service&#xA;lsof -i:50075&#xA;pip install Django==1.8.4&#xA;pip install django-crontab&#xA;&#xA;yum install python-devel.x86_64&#xA;yum install mysql-devel&#xA;yum install MySQL-python&#xA;yum install gcc&#xA;&#xA;pip install mysql-python&#xA;&#xA;查源码，改dashboard/views里index函数checkport的端口&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;几个容易踩坑的地方:&lt;/p&gt;&#xA;&lt;p&gt;1.centos7.4用pip安装mysql-python的时候，需要先安装python-devel,mysql-devel,MySQL-python,gcc,否则会报错&lt;/p&gt;&#xA;&lt;p&gt;2.supervisor要自己装，相关配置自己写一下，也容易&lt;/p&gt;&#xA;&lt;p&gt;3.如果salt-api等几个部件没有运行在默认端口，那么启动saltshaker后在首页会显示down的状态，需要修改dashboard/views.py里的index函数checkport里的端口号.&lt;/p&gt;&#xA;&lt;p&gt;4.如果salt-master版本比较高(大于2015.x)，官方yum源的salt-api就没有与之对应的版本了，需要自己下载salt-api的新包，我是自建的yum源，然后&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;createrepo &amp;lt;path&amp;gt;&#xA;createrepo --update &amp;lt;path&amp;gt; &#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;更新仓库信息，安装最新的包&lt;/p&gt;&#xA;&lt;p&gt;5.django crontab在settings.py里被注释掉了3个，得把注释去掉，然后把所有django crontab跑起来.&lt;/p&gt;&#xA;&lt;p&gt;最后，这个东西感觉也不是很完善好用，不过是django的，二次开发也很容易，有机会再自己来改改。&lt;/p&gt;</description>
        </item><item>
            <title>修改salt源码实现jobs.list_jobs加密账号密码</title>
            <link>http://localhost:1313/posts/2017/12/2017-12-18-%E4%BF%AE%E6%94%B9salt%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0jobs-list_jobs%E5%8A%A0%E5%AF%86%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/</link>
            <pubDate>Mon, 18 Dec 2017 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2017/12/2017-12-18-%E4%BF%AE%E6%94%B9salt%E6%BA%90%E7%A0%81%E5%AE%9E%E7%8E%B0jobs-list_jobs%E5%8A%A0%E5%AF%86%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/</guid>
            <description>&lt;p&gt;在salt master中为各个minion运行各种命令，当输入命令中显式带有账号密码时，可以在master端通过 salt.runners.jobs.last_run() salt.runners.jobs.list_job() salt.runners.jobs.list_jobs() salt.runners.jobs.list_jobs_filter() 等种种方法查看到账号密码，这样就会有安全风险。 所以，可以通过修改salt源码的方式实现对显示密码的记录加密。最终效果如下图： &lt;img src=&#34;images/zzxg.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;修改方法很简单，首先找到系统中的salt文件夹，本测试机在&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/usr/lib/python2.7/dist-packages/salt/&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;修改./runners/jobs.py文件&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#添加函数,这里主要是正则匹配，可以匹配更多的pass选项，实现更多的隐藏密码&#xA;import re&#xA;def encry_pass(target):&#xA;    result = re.sub(r&amp;#34;(?&amp;lt;=--password )\w+&amp;#34;, &amp;#34;*&amp;#34;, target)&#xA;    return result&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;并在list_job()函数，list_jobs()函数，list_jobs_filter()函数，print_job()函数末尾分别加入如下代码&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#list_job()&#xA;ret = eval(encry_pass(str(ret)))   #增加此行&#xA;return ret&#xA;&#xA;#list_jobs()&#xA;mret = eval(encry_pass(str(mret)))    #增加此行&#xA;return mret&#xA;&#xA;#list_jobs_filter()&#xA;ret = eval(encry_pass(str(ret)))    #增加此行    &#xA;return ret&#xA;&#xA;#print_job()&#xA;ret = eval(encry_pass(str(ret)))    #增加此行&#xA;return ret&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;搞定&lt;/p&gt;&#xA;&lt;p&gt;一点小补充： 为什么要用&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ret = eval(encry_pass(str(ret)))&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;因为ret是dict类型，得先把dict类型转换成str类型再写入encry_pass()正则匹配函数的参数里，然后encry_pass()正则匹配函数返回一个str对象，而ret需要的是dict对象，所以需要再用eval()转回来,也就是 ret(dict)&amp;mdash;-&amp;gt;str(ret)&amp;mdash;&amp;ndash;&amp;gt;ret(str)&amp;mdash;&amp;ndash;&amp;gt;result(str)&amp;mdash;&amp;ndash;&amp;gt;eval(result)&amp;mdash;&amp;ndash;&amp;gt;result(dict)&amp;mdash;&amp;ndash;&amp;gt;ret(dict)&lt;/p&gt;</description>
        </item></channel>
</rss>
