<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Supervisor on cAlm的个人Blog</title>
        <link>http://localhost:1313/tags/supervisor/</link>
        <description>Recent content in Supervisor on cAlm的个人Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Sun, 11 Feb 2018 00:00:00 +0000</lastBuildDate><atom:link href="http://localhost:1313/tags/supervisor/index.xml" rel="self" type="application/rss+xml" /><item>
            <title>关于supervisor/gosuv等控制django/flask进程的小贴士</title>
            <link>http://localhost:1313/posts/2018/02/2018-02-11-%E5%85%B3%E4%BA%8Esupervisor-gosuv%E7%AD%89%E6%8E%A7%E5%88%B6django-flask%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B0%8F%E8%B4%B4%E5%A3%AB/</link>
            <pubDate>Sun, 11 Feb 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/02/2018-02-11-%E5%85%B3%E4%BA%8Esupervisor-gosuv%E7%AD%89%E6%8E%A7%E5%88%B6django-flask%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B0%8F%E8%B4%B4%E5%A3%AB/</guid>
            <description>&lt;p&gt;在使用supervisor/gosuv等进程控制程序控制django/flask进程时，常常会出现一个&amp;quot;BUG&amp;quot;&amp;mdash;&amp;mdash;输入supervisor restart {app}/gosuv stop/start {app}后，经常会出现django/flask重启失败，因为端口已占用的错误。&lt;/p&gt;&#xA;&lt;p&gt;这里我们常常想到，先把端口关掉不就可以了？经常在代码中加入如下命令：(如果程序是django或者flask，占用的端口是82端口)&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;import subprocess&#xA;import os&#xA;&#xA;pid = os.popen(&amp;#34;lsof -i:82|grep python|awk &amp;#39;{print $2}&amp;#39;&amp;#34;).read()&#xA;if len(pid):&#xA;    subprocess.check_output(&amp;#34;kill -9 &amp;#34;+str(int(pid)), shell=True)&#xA;#注意，这里一定要用subprocess库来kill进程。用os.system运行kill -9或os.kill()都会导致新进程产生&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这样虽然可行，但是比较麻烦。其实占用端口的原因是flask/django服务器自动reload造成的，只需要在supervisor/gosuv的启动指令里，加上&amp;ndash;noreload参数就不会产生这个&amp;quot;BUG&amp;quot;了，举例如下：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#原来启动指令&#xA;python manage.py runserver 0.0.0.0:82&#xA;#更新启动指令&#xA;python manage.py runserver 0.0.0.0:82 --noreload&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;搞定&lt;/p&gt;&#xA;</description>
        </item><item>
            <title>supervisor集中化管理web工具cesi</title>
            <link>http://localhost:1313/posts/2018/01/2018-01-11-supervisor%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86web%E5%B7%A5%E5%85%B7cesi/</link>
            <pubDate>Thu, 11 Jan 2018 00:00:00 +0000</pubDate>
            <guid>http://localhost:1313/posts/2018/01/2018-01-11-supervisor%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86web%E5%B7%A5%E5%85%B7cesi/</guid>
            <description>&lt;p&gt;linux进程管理器supervisor是会经常被用到的，但服务器多了之后，每个服务器的进程也不方便管理。同时，supervisor自带的web界面比较简陋，所以尝试了一下官网推荐的一些第三方开源软件，推荐一下这个cesi。 最终效果如下： &lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/1.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;&lt;img src=&#34;images/1.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/a&gt; [&lt;img src=&#34;images/2.jpg&#34; alt=&#34;&#34; /&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;](&lt;a class=&#34;link&#34; href=&#34;http://www.calmkart.com/wp-content/uploads/2018/01/2.jpg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://www.calmkart.com/wp-content/uploads/2018/01/2.jpg&lt;/a&gt;)&lt;/p&gt;&#xA;&lt;p&gt;1.首先是关于supervisor 通过apt或pip安装都可以&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get install supervisor&#xA;#pip install supervisor&#xA;echo_supervisord_conf &amp;gt; /etc/supervisor/supervisord.conf&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;关于supervisor配置文件&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[unix_http_server]&#xA;#这里配置是否用unix socket通信来让supervisor与supervisorctl做通信&#xA;&#xA;[inet_http_server]&#xA;#这里是用的http的方式做通信&#xA;&#xA;[supervisorctl]&#xA;#这里选择supervisorctl到底用以上两种中的哪种方式来与supervisor通信，选择一种即可，记得填写密码&#xA;&#xA;[program:pro_name]&#xA;stdout_logfile = {path}&#xA;redirect_stderr = true  ;让stderr也写入stdout中&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;常用操作&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;supervisorctl reload #重启加载supervisor配置文件&#xA;supervisorctl update #只增加新增的配置文件&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;2.关于cesi&lt;/p&gt;&#xA;&lt;p&gt;项目地址：&lt;a class=&#34;link&#34; href=&#34;https://github.com/Gamegos/cesi&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;https://github.com/Gamegos/cesi&lt;/a&gt; 安装cesi&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;apt-get install sqlite3 python python-flask&#xA;git clone https://github.com/Gamegos/cesi&#xA;cd cesi&#xA;sqlite3 ./userinfo.db &amp;lt; userinfo.sql&#xA;cp cesi.conf /etc/cesi.conf&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;配置cesi.conf,我的配置如下，一看就懂了&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[node:118]&#xA;username = ***&#xA;password = ***&#xA;host = 127.0.0.1&#xA;port = 9001&#xA;&#xA;[node:calmkart]&#xA;username = ***&#xA;password = ***&#xA;host = 45.76.71.69&#xA;port = 9001&#xA;&#xA;[node:121]&#xA;username = ***&#xA;password = ***&#xA;host = *.*.*.121&#xA;port = 9001&#xA;&#xA;[environment:my_env]&#xA;members = 118,calmkart,121&#xA;&#xA;[cesi]&#xA;database = /root/cesi/userinfo.db&#xA;activity_log = /var/log/cesi.log&#xA;host = 0.0.0.0&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;用supervisor运行cesi,配置文件如下&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[program:cesi]&#xA;directory = /root/cesi/cesi/&#xA;command = python web.py&#xA;autostart = true&#xA;startsecs = 5&#xA;autorestart = true&#xA;startretries = 3&#xA;user = root&#xA;redirect_stderr = true&#xA;stdout_logfile = /var/log/cesi1.log&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;开启任务&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;supervisorctl start cesi&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;默认账号密码：admin,admin 端口需要改的自己去web.py里面改 you get it&lt;/p&gt;&#xA;&lt;p&gt;本测试服地址： &lt;a class=&#34;link&#34; href=&#34;http://cesi.calmkart.com&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;&#xA;    &gt;http://cesi.calmkart.com&lt;/a&gt; 此外，其他常用的supervisor相关第三方工具还有 suponoff gosuv&lt;/p&gt;</description>
        </item></channel>
</rss>
